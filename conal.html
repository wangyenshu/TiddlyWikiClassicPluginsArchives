<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><script src="//archive.org/includes/athena.js" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app218.us.archive.org';v.server_ms=684;archive_analytics.send_pageview({});});</script>
<script type="text/javascript" src="https://web-static.archive.org/_static/js/bundle-playback.js?v=1B2M2Y8A" charset="utf-8"></script>
<script type="text/javascript" src="https://web-static.archive.org/_static/js/wombat.js?v=1B2M2Y8A" charset="utf-8"></script>
<script>window.RufflePlayer=window.RufflePlayer||{};window.RufflePlayer.config={"autoplay":"on","unmuteOverlay":"hidden","showSwfDownload":true};</script>
<script type="text/javascript" src="https://web-static.archive.org/_static/js/ruffle/ruffle.js"></script>
<script type="text/javascript">
    __wm.init("https://web.archive.org/web");
  __wm.wombat("http://journal.conal.net:80/","20130827021950","https://web.archive.org/","web","https://web-static.archive.org/_static/",
	      "1377569990");
</script>
<link rel="stylesheet" type="text/css" href="https://web-static.archive.org/_static/css/banner-styles.css?v=1B2M2Y8A" />
<link rel="stylesheet" type="text/css" href="https://web-static.archive.org/_static/css/iconochive.css?v=1B2M2Y8A" />
<!-- End Wayback Rewrite JS Include -->

<script type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 2, revision: 5, date: new Date("Aug 24, 2007"), extensions: {}};
//]]>
</script>
<!--
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) UnaMesa Association 2004-2007

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<!--PRE-HEAD-START-->
<!--{{{-->
<style type="text/css">
#contentWrapper {display:none;}
body { background:#003; }
</style>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;" toolbar-mode="auto">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="donato" style="position:relative;width:100%;height:0;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20130827021950/http%3A//journal.conal.net/"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><div id="wm-ipp-inside">
  <div id="wm-toolbar" style="position:relative;display:flex;flex-flow:row nowrap;justify-content:space-between;">
    <div id="wm-logo" style="/*width:110px;*/padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="https://web-static.archive.org/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="https://web-static.archive.org/_static/images/toolbar/wayback-toolbar-logo-100.png, https://web-static.archive.org/_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, https://web-static.archive.org/_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="c" style="display:flex;flex-flow:column nowrap;justify-content:space-between;flex:1;">
      <form class="u" style="display:flex;flex-direction:row;flex-wrap:nowrap;" target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://journal.conal.net/" onfocus="this.focus();this.select();" style="flex:1;"/><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20130827021950" /><input type="submit" value="Go" />
      </form>
      <div style="display:flex;flex-flow:row nowrap;align-items:flex-end;">
                <div class="s" id="wm-nav-captures" style="flex:1;">
                    <a class="t" href="/web/20130827021950*/http://journal.conal.net/" title="See a list of every capture for this URL">37 captures</a>
          <div class="r" title="Timespan for captures of this URL">11 Mar 2007 - 27 Aug 2013</div>
          </div>
        <div class="k">
          <a href="" id="wm-graph-anchor">
            <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
              <canvas id="wm-sparkline-canvas" width="750" height="27" border="0"></canvas>
            </div>
          </a>
        </div>
      </div>
    </div>
    <div class="n">
      <table>
        <tbody>
          <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
          <tr class="m">
            <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20130726033249/http://journal.conal.net:80/" title="26 Jul 2013"><strong>Jul</strong></a></td>
            <td class="c" id="displayMonthEl" title="You are here: 02:19:50 Aug 27, 2013">AUG</td>
            <td class="f" nowrap="nowrap">Sep</td>
          </tr>
          <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
          <tr class="d">
            <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20130726033249/http://journal.conal.net:80/" title="03:32:49 Jul 26, 2013"><img src="https://web-static.archive.org/_static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a></td>
            <td class="c" id="displayDayEl" style="width:34px;font-size:22px;white-space:nowrap;" title="You are here: 02:19:50 Aug 27, 2013">27</td>
            <td class="f" nowrap="nowrap"><img src="https://web-static.archive.org/_static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0" /></td>
          </tr>
          <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
          <tr class="y">
            <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20120119180713/http://journal.conal.net/" title="19 Jan 2012"><strong>2012</strong></a></td>
            <td class="c" id="displayYearEl" title="You are here: 02:19:50 Aug 27, 2013">2013</td>
            <td class="f" nowrap="nowrap">2014</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="r" style="display:flex;flex-flow:column nowrap;align-items:flex-end;justify-content:space-between;">
      <div id="wm-btns" style="text-align:right;height:23px;">
                <span class="xxs">
          <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#" title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php" title="Sign In" id="wm-sign-in">
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
        </span>
                <a class="xxs" href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
        <a id="wm-tb-close" href="#close" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share" class="xxs">
        <a href="/web/20130827021950/http://web.archive.org/screenshot/http://journal.conal.net/"
           id="wm-screenshot"
           title="screenshot">
          <span class="wm-icon-screen-shot"></span>
        </a>
        <a href="#" id="wm-video" title="video">
          <span class="iconochive-movies"></span>
        </a>
        <a id="wm-share-facebook" href="#" data-url="https://web.archive.org/web/20130827021950/http://journal.conal.net:80/" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
        <a id="wm-share-twitter" href="#" data-url="https://web.archive.org/web/20130827021950/http://journal.conal.net:80/" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
      <div style="padding-right:2px;text-align:right;white-space:nowrap;">
        <a id="wm-expand" class="wm-btn wm-closed" href="#expand"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span class="xxs" style="font-size:80%;">About this capture</span></a>
      </div>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
        <div id="wm-capinfo-notice" source="api"></div>
                <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="https://web-static.archive.org/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="wm-ipp-print">The Wayback Machine - https://web.archive.org/web/20130827021950/http://journal.conal.net:80/</div>
<script type="text/javascript">//<![CDATA[
__wm.bt(750,27,25,2,"web","http://journal.conal.net/","20130827021950",1996,"https://web-static.archive.org/_static/",["https://web-static.archive.org/_static/css/banner-styles.css?v=1B2M2Y8A","https://web-static.archive.org/_static/css/iconochive.css?v=1B2M2Y8A"], false);
  __wm.rw(1);
//]]></script>
<!-- END WAYBACK TOOLBAR INSERT -->
 <div id="SplashScreen" style="border: 1px solid #ccc; -moz-border-radius:1em; display:block; text-align:center; width:400px; margin:100px auto; padding:.5em; color:#fff; font-size:24pt; font-family:verdana,arial,helvetica,sans; background-color:#006;">Conal's Journal is loading<div style="font-size: 18px; color:#fff;">please wait...</div></div>
<!--}}}-->
<!--PRE-HEAD-END-->
<title> Conal's Journal - a non-linear personal web notebook </title>
<style type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.checkUnsavedChanges) checkUnsavedChanges(); if(window.scrubNodes) scrubNodes(document.body);">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston, Copyright &copy; 2007 UnaMesa Association
</div>
<noscript>
	<div id="javascriptWarning">This page requires JavaScript to function properly.<br/><br/>If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected{color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.sparkline {background:[[ColorPalette::PrimaryPale]]; border:0;}
.sparktick {background:[[ColorPalette::PrimaryDark]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:'alpha(opacity:60)';}
/*}}}*/</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0em 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0em 1em 1em; left:0px; top:0px;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0em 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 .3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0em 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0em 0em 0em 0em; margin:0.4em 0em 0.2em 0em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0em 0em 0em 0em; margin:0.4em 0em 0.2em 0em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0em 0em 0em; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0em;}
.wizardFooter .status {padding:0em 0.4em 0em 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em 0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0em; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em 0.2em 0.2em 0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em 0.2em 0.2em 0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em 1em 1em 1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0em;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0em 0em 0.5em;}
.tab {margin:0em 0em 0em 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0em 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0em 1em;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0em 0.25em; padding:0em 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0px 3px 0px 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0em; font-size:.9em;}
.editorFooter .button {padding-top:0px; padding-bottom:0px;}

.fieldsetFix {border:0; padding:0; margin:1px 0px 1px 0px;}

.sparkline {line-height:1em;}
.sparktick {outline:0;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em 0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em 0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0em; right:0em;}
#backstageButton a {padding:0.1em 0.4em 0.1em 0.4em; margin:0.1em 0.1em 0.1em 0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; margin:0em 3em 0em 3em; padding:1em 1em 1em 1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em 0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which use a logographic writing system and need larger font sizes.
***/

/*{{{*/
body {font-size:0.8em;}

#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}

.subtitle {font-size:0.8em;}

.viewer table.listView {font-size:0.95em;}

.htmlarea .toolbarHA table {border:1px solid ButtonFace; margin:0em 0em;}
/*}}}*/</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none ! important;}
#displayArea {margin: 1em 1em 0em 1em;}
/* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
noscript {display:none;}
}
/*}}}*/</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar closeTiddler closeOthers +editTiddler &gt; fields syncing permalink references jump'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar +saveTiddler -cancelTiddler deleteTiddler'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank TiddlyWiki, you'll need to modify the following tiddlers:
* SiteTitle &amp; SiteSubtitle: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* MainMenu: The menu (usually on the left)
* DefaultTiddlers: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="OptionsPanel">
<pre>These InterfaceOptions for customising TiddlyWiki are saved in your browser

Your username for signing your edits. Write it as a WikiWord (eg JoeBloggs)

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; SaveBackups
&lt;&lt;option chkAutoSave&gt;&gt; AutoSave
&lt;&lt;option chkRegExpSearch&gt;&gt; RegExpSearch
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; CaseSensitiveSearch
&lt;&lt;option chkAnimate&gt;&gt; EnableAnimations

----
Also see AdvancedOptions</pre>
</div>
</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title="2006" modifier="Conal Elliott" modified="200701022053" created="200610312042" tags="year">
<pre></pre>
</div>
<div title="2006-10" modifier="Conal Elliott" modified="200610312112" created="200610312042" tags="2006 October month">
<pre></pre>
</div>
<div title="2006-10-22" modifier="Conal Elliott" modified="200611190405" created="200610230159" tags="2006-10 day">
<pre>* Ordered a Kinesis Maxim ergonomic keyboard
* Messed around more with my [[Emergence of NVC|http://emergence.awakeningcompassion.com]] tiddlywiki.
* Made a [[Projects|http://emergence.awakeningcompassion.com/Projects]] tiddlywiki.</pre>
</div>
<div title="2006-10-23" modifier="Conal Elliott" modified="200610312047" created="200610232307" tags="2006-10 day">
<pre>* How about a [[Pajama|http://conal.net/Pajama]] applet in a tiddler?
&lt;html&gt;&lt;p align=center&gt;
&lt;applet code=&quot;swirl_wedge_annulus_ybrings.class&quot; archive=&quot;../pajama.jar,swirl_wedge_annulus_ybrings.jar&quot; width=&quot;210&quot; height=&quot;226&quot; codebase=&quot;http://conal.net/Pajama/examples&quot;&gt;
        &lt;param name=swirliness value=0.5&gt;
        &lt;param name=inner_radius value=0.3&gt;
        &lt;param name=wedges value=10&gt;
        &lt;param name=coverage value=0.7&gt;
        &lt;/applet&gt;
&lt;/p&gt;&lt;/html&gt;
* Got my authentication sign-up script to be editable.  I renamed signup and login_form, made new templates, and copied in their content.
* Edited the instructions to suggest &quot;First Last&quot; and why.  I'm greatly relieved to have eliminated the inconsistency in instructions.
</pre>
</div>
<div title="2006-10-24" modifier="Conal Elliott" modified="200611011818" created="200610241636" tags="2006-10 day">
<pre>* Printed Awakening Compassion materials.  Brought them to Erika, along with the cards and flyers she'll put out for her (first) NVC intro tonight.
* Called Patty Z.  Can she print if I email her a PDF?  No.  Computer problems.
* [[visit with Patty Z on 2006-10-24]]
* Printed the [[Emergence of NVC|http://emergence.awakeningcompassion.com]] notebook, after doing a lot of tweaking for font sizes.
</pre>
</div>
<div title="2006-10-25" modifier="Conal Elliott" modified="200611182243" created="200610251558" tags="2006-10 day">
<pre>* Changed how I use &quot;to do&quot;.  Made it a separate [[misc to do]] tiddler. Move elements into journal entries when done.
* //Idea:// [[tiddlywiki mixins]].
* //Idea:// [[parametric tiddlers]].
* Entered more notes from yesterday, including my +++^[visit with Patty]&lt;&lt;tiddler &quot;visit with Patty Z on 2006-10-24&quot;&gt;&gt;===.
* Sent Sandy Fox a note about [[yesterday|2006-10-24]]'s visit with Patty.  Sandy had encouraged me and offered some energy.
* Reply to [[Ralf Hutchison]] about coming to work with me and live with us for a while.
* Started using NestedSlidersPlugin, so I can have chunks hide &amp; reveal.  Very neat!
* Clean up the &quot;All&quot; tiddler list in [[Emergence of NVC| http://emergence.awakeningcompassion.com]], so that it shows content only, and not mechanism.
* Moved MainMenu to horizontal and reclaim the left space for tiddler content
* Started using dates as tags of idea &amp; conversation tiddlers.   Next, move &quot;tagging&quot; in ViewTemplate.
</pre>
</div>
<div title="2006-10-26" modifier="Conal Elliott" modified="200610312048" created="200610261700" tags="2006-10 day">
<pre>* Here's an idea about proxying for Haloscan-based comments: use {{{TinyHTTPProxy.py}}} from SUZUKI Hisao, and tweak my Apache rewrite rules to route the request outside of Zope.  First, try the proxy on its own.  Didn't work for me.  Maybe I don't understand how to use it.
* Tweaked the instructions in HorizontalMainMenuStyles to be self-contained.
* Added a picture to [[my user tiddler|http://emergence.awakeningcompassion.com/#%5B%5BConal%20Elliott%5D%5D]] in the [[Emergence of NVC|http://emergence.awakeningcompassion.com]] TW.
* Integrated Sandy's rewritten form of the psncc training &quot;prerequisites&quot;.  It took several passes of rewriting and exchanges with Sandy.
* Evening [[phone call with Rita Herzog and Sandy Fox]].</pre>
</div>
<div title="2006-10-27" modifier="Conal Elliott" modified="200610312157" created="200610271726" tags="2006-10 day">
<pre>* Pan returned my call.  We chatted some about the Emergence proposal.  
** He asked how do we deal with someone giving a great workshop but not really on NVC.  Presumably hey'd get positive reviews.  How would the online matching system let people know about the NVC mismatch?  I think the answer is in the richness of the feedback, beyond a single number.  
** He has a different perception about the use of the word &quot;trainer&quot; in psncc.  He hears people say &quot;certified&quot; when they mean it, and otherwise they mean people who train.  I guess I could check more.  I do believe Patty, Mel, Holly E, and even Moreah mean certified when they don't say so.  And Sandy doesn't, and apparently not Pan.
** He suggested that I especially listen to Barb tonight to get to hear the beauty she experiences in the assessment process
** I guess I'm still somewhat steamed after last night's phone call with Rita H.
* Found [[CommentPlugin]].  It just adds a comment tiddler and sets up tags.  Nice idea and very elegant, but requires a login.
* Wrote up notes on psncc [[emergence meeting of 2006-10-27]]

</pre>
</div>
<div title="2006-10-28" modifier="Conal Elliott" modified="200611182250" created="200610281856" tags="2006-10 day">
<pre>* Snagged plugins from TiddlyTools:
** ResizeEditorPlugin: works great, but I think it ate my control-enter
** AutoTaggerPlugin: wow!
** ResizeEditTextPlugin: doesn't work yet.  Version problem, since TW isn't 2.1 yet.
** RearrangeTiddlersPlugin: I love it!
** CollapseTiddlersPlusPlugin (and corresponding CollapsedTemplate)
* Some afterthoughts from the [[emergence meeting of 2006-10-27]]:
** &quot;Compassionate Consciousness&quot;
** &quot;Learning, Living, Sharing, and //Evolving// NVC&quot;
** I want to write an article on [[the evolution of Nonviolent Communication]].
* Went to Sandy's to watch &quot;The Secret&quot; with her &amp; others.
* I'm experimenting with placement of {{{tagging}}} in the TW.  For now, I tweaked  StyleSheet to put tags &amp; tagging into a table.  Looks okay but clumsily expressd.
* Started [[notes on CSS]] .
* Fixed a bug in {{{ZiddlyWiki/actions/import}}}.  Wasn't converting things like &quot;{{{&amp;amp;}}}&quot; back to &quot;{{{&amp;}}}&quot;.
</pre>
</div>
<div title="2006-10-29" modifier="Conal Elliott" modified="200610312048" created="200610291743" tags="2006-10 day">
<pre>* LTU article [&quot;Future of Software Design?&quot;|http://lambda-the-ultimate.org/node/1805].  Peter van Roy is exploring &quot;self-managing systems&quot;, which are based on cybernetics.
* Why not host my darcs repos on haskell.org?
* I'm getting an error message every time I open the Emergence ziddlywiki.  I don't know why. &lt;&lt;smiley :(&gt;&gt;
</pre>
</div>
<div title="2006-10-30" modifier="Conal Elliott" modified="200611151627" created="200610301541" tags="2006-10 day">
<pre>* Got the &quot;new journal&quot; button to add &quot;journal&quot; as a tag.  I looked at the {{{newJournal}}} source and saw that parameters after the first one get used as tags.
* Stopped resisting self-tagging of journal tiddlers.
* Idea: write some articles about NVC and solicit input and dialog from psncc folks, cnvc certification candidates, cnvc certified trainers, etc.  In addition to doing some writing, stir up some discussion and awareness.  Oh: make a wiki for the evolving articles.  Invite people to add comments directly.  Or to send email or have recorded phone conversations, which will get added in to the wiki.
** That principle of Marshall's in which he shifts labeling language to relationship language, such as reflecting &quot;That's a terrible picture&quot; into &quot;Oh, you don't like the picture?&quot;  I've heard him call that principle &quot;Never let anyone tell you who you are.&quot;  Offer and invite examples and translations.  Throw into the mix: &quot;trainer&quot;.  Guess: &quot;I trust that person to present NVC in a way I agree with.&quot;
** &quot;The Evolution of NVC&quot;.  Invite comments on past, present, and future.  Trace how NVC has evolved so far, which ideas came from whom (e.g. ~Max-Neef on needs).  Speculate on possible future trends.  In this light, consider the idea of &quot;preserving the integrity of the process&quot;.
* Looking for wysiwyg editors for TiddlyWiki.
** [[HTMLArea|http://www.dynarch.com/projects/htmlarea]] wysiwyg editor.  No longer maintained.  Points to [[InterAKT|http://www.interaktonline.com]]'s KTML 4.
** InterAKT was acquired by Adobe in September.  Apparently there is no longer a free KTML Lite.  &lt;&lt;smiley :(&gt;&gt;
** Found [[AsciiMathML: Translating ASCII math notation to Presentation MathML|http://www1.chapman.edu/~jipsen/asciimath.html]]. Pretty neat!  Combined with ~HtmlArea in the [[ASciencePad|http://math.chapman.edu/~jipsen/asciencepad/asciencepad.html]] TW.  I want TW markup, not HTML, however.
** [[Wikiwyg|http://www.wikiwyg.net]] looks like a reasonably good fit.
** Emailed the TW google group to ask for recommendations.
* Edited and sent note about psncc name.
* Called Kelly Darlington about getting together.  Breakfast 9am tomorrow at Alexa's in Bothell.
* Trying again with HaloscanMacro.  
** Seems to work fine without RSS, which is okay with me.
** Found http://gravatar.com, which serves out 80x80 pixel &quot;globally recognized avatars&quot; and is used by haloscan.  Currently out of action due to growth and non-scalable implementaton.  Up with 2.0 very soon.  See http://gravatar.com/blog.
** Of course, Haloscan serves ads in the comment window.  I could probably figure out a tricky way to filter them out, though it wouldn't be simple.  Better would be to find or create an Open Source replacement.
** Signed up for another Haloscan account: &quot;emergenceAcCom&quot;.  I'll want one user name per TW site.  No -- instead, I tweaked the HaloscMacro source to prepend an ~idPrefix specific to a TW.
** Changed haloscan date format from {{{m.d.y - g:i a}}} to {{{Y-m-d - g:i:s a}}} to {{{r}}} to {{{Y-m-d - g:i a}}}
** Contributed $15 to get a premium account (min $12), which (a) drops the ads in comments, and (b) lets me export comments.
* I also tried CommentPlugin.
** It works okay but requires either a log-in or that I make my TW open to anonymous edits.
** Perhaps I could do something on the ZW server end so that comments tiddlers are specially allowed without log-in.
** I see that comments are only editable by the comment's author.  Well, not exactly.  The &quot;(edit)&quot; button shows up if the same user is logged in--including &quot;Anonymous User&quot;, i.e., no log-in.  This fact suggests a simple approach:
*** Encourage people to log in, so that their comments are attributed to them and cannot be changed by others who are not logged in (and not easily changed by anyone, since doing so requires finding the comment hidden via its ~excludeLists tag).
*** Recommend that non-comments be tagged as &quot;protected&quot;.  Oh -- not quite, as &quot;protected&quot; means &quot;Only editable by its author or an administrator&quot;, according to http://ziddlywiki.com/#SpecialTags.  Hmm.

</pre>
</div>
<div title="2006-10-31" modifier="Conal Elliott" modified="200611020633" created="200610311539" tags="2006-10 day">
<pre>* Doing some hunting around for a wysiwyg editor
* Puzzling over Zope organization.
** Experiment: add cookie_auth to Journal.  Then, when I click on &quot;login&quot;, I get the title &quot;Conal's Journal&quot; instead of &quot;Emergence of NVC&quot;.
** Experiment: add acl_users to Journal.  Then I can add a user who has access to Journal but not the root directory.
** Conclusion: I want to make sub-directories for emergence, journal, etc.  People get user accounts for them separately.  I have an account at the root, which gives me access to all.
** Drawback: after logging in, the url is messed up.  Has an extra Folder level, e.g., journal.net.conal/Journal.
** Wait for Bob M to finish his 2.1 ZW, which will handle logging in via AJAX rather than by changing pages.
* Breakfast at Alexa's in Bothell with Kelly D.
* //Wow!// I hit upon a new way to organize my journal entries.  Tag each day's entry with &lt;&lt;tag day&gt;&gt; and with the month (e.g. &lt;&lt;tag 2006-10&gt;&gt;).  Similarly, tag each month with &lt;&lt;tag month&gt;&gt; and the month's name (e.g. &lt;&lt;tag October&gt;&gt;) and its year (e.g. &lt;&lt;tag 2006&gt;&gt;).  Tag each year with &lt;&lt;tag year&gt;&gt; (could also tag with &lt;&lt;tag decade&gt;&gt; or whatever).  Looks great in the [[site map]].  I'd like all this tagging to happen automatically.  For now I've tweaked the SideBarOptions &quot;new journal&quot; button to use the tag &lt;&lt;tag 2006-11&gt;&gt;.
* Emergence proposal: 
** Folded in questions &amp; answers from Friday night.
** Removed the last people labels (as far as I know), namely &quot;sharers&quot; and &quot;seekers&quot;, in favor of action language (what people //do// not what they //are//).  In most cases, the result is more succinct and, to me, clearer.
** Got notes from Friday night's yummy meeting.  Edited into a [[more readable form and put on the first wiki|http://sharenvc.net/meeting_notes/2006-10-27]].
** Sent out a note with the tweaked proposal and the notes from Friday, in preparation for tomorrow's meeting.
</pre>
</div>
<div title="2006-11" modifier="Conal Elliott" created="200701022055" tags="2006 November month">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2006-11-01" modifier="Conal Elliott" modified="200611021756" created="200611011605" tags="2006-11 day">
<pre>* Read [[The 18 Mistakes That Kill Startups|http://www.paulgraham.com/startupmistakes.html]] in Paul Graham's blog.  Worth remembering and revisiting.
** Single-founder myth.  &quot;Vote of no confidence&quot; from friends, no //esprit de corps// when things go wrong.
** Aside on java applets
&gt;The scary thing about platforms is that there are always some that seem to outsiders to be fine, responsible choices and yet, like Windows in the 90s, will destroy you if you choose them. Java applets were probably the most spectacular example. This was supposed to be the new way of delivering applications. Presumably it killed just about 100% of the startups who believed that.
* I found out why Firefox prints so huge for me.  In {{{File/Page Setup}}}, the scale was set to 150%.  Changed to 100%.  Then to &quot;shrink to fit page width&quot;.  Yay!  That dialog has margins and header/footer content as well.
* Lesson (again): meander through a program's options, taking note of what I find.  Don't wait until I have urgent demand for a feature.
* Learned that NestedSlidersPlugin, doesn't play nicely with lists unless I add a blank space after the final &quot;{{{===}}}&quot;.
* Got a response from Laurel about the Emergence proposal and meeting minutes.  She likes it a lot and had some substantive comments, including one about complementing systems theory as Ken Wilber recommends (interior, culture, external world).
* Long meeting among local folks who teach NVC, from 11:00am to 3:15pm at Elana's house.  After opening with foot washing/massage, we mostly talked about my [[Emergence proposal|http://emergence.awakeningcompassion.com]].  I'm still in shock about how much support &amp; acceptance I'm getting for my proposal.  After some tweaks, I think it will be ready to bring to next week's core team meeting.  I have hand-written notes.  Strangely, I felt quite deflated at the end.  Some of the sweet energy of [[Friday night's meeting|http://sharenvc.net/meeting_notes/2006-10-27]] was missing.  Or maybe disappointment over running out of people to fight.  I'll type up my notes, and maybe then I'll get some more clarity.
* Our usual NVC practice group night.  A few couldn't come, so I canceled.  Moreah didn't get the message and came by bus.  I met her at Third Place and we had a delightful long talk over hot apple cider.
</pre>
</div>
<div title="2006-11-02" modifier="Conal Elliott" modified="200611031908" created="200611021745" tags="2006-11 day">
<pre>* Wrote to [[Shelly Farnham|http://www.farnhamresearch.com]].  She does social technology research &amp; consulting and used to work at Microsoft Research.  Now she's involved with Mind Camp and dorkbot.
* Got a call from [[Michael Stillwater|http://www.innerharmony.com/michael.htm]].  Holly sang with him last night and gave him our business card.  He called to talk about creating a synthesis of his intuitive/empathic singing work with Compassionate Communication.  I think we're going to his ~ChantWave tonight on the peninsula.  He was very interested last night in Holly singing with him again.  She came home all lit up from her experience.  I suggested we might catch the ferry over together and chat.
* Wow!  A [[video|http://video.google.fr/videoplay?docid=-2237947353453839215&amp;hl=fr]] of an RC plane with video camera attached, transmitting to //and// controlled by a head-mounted display.
* Transition lunch for Masanda, with the Seattle Unity staff.
* Typed up notes from yesterday's psncc meeting.
* Sent [[note to Sandy about giving one's word]] and NVC Academy.
* Typed up and added [[my notes|http://sharenvc.net/meeting_notes]] on the &quot;Emergence&quot; part of yesterday's meeting.
* Holly &amp; I went to Michael Stillwater's ~ChantWave, which took place at Brian &amp; Lisa's home in Indianola (on the peninsula, near Kingston).  Had a great time.  I loved talking with Michael.  He really gets &amp; shares my vision of trusting in the innate wisdom of life, rather than using control top-down strategies.  Holly got lots of affirmation for her singing &amp; loveliness.
</pre>
</div>
<div title="2006-11-03" modifier="Conal Elliott" modified="200611040010" created="200611031916" tags="2006-11 day">
<pre>* Talked with Heather H.  Delightful reconnecting chat.  She had an incredibly restorative and blissful time at the Canada retreat.  Maybe get to see her this weekend while she's in town for school.
* Lunch with Pan.  We were going to talk tech, but Magic intervened.  I was 15 minutes late, due to my phone chat with Heather.  Just before I arrived, Mathias Kainrath dropped in on Pan.  Mathias was walking by looking for a bank, when he saw the NVC sign and had a strong urge to come in.  He moved to town from Maui four weeks ago after letting his life disintegrate, and now he's welcoming in new beginnings.  We invited him to lunch.  He's Austrian, and so Pan invited Elana, who joined us.  A thoroughly inspiring &amp; connecting conversation, with many common connections.  Mathias had already seen Holly on Wednesday night at Seattle U and had heard about Elana (and had seen Michael Stillwater) at Center for Spiritual Living on Sunday.  I loved getting to hear about Mathias's vision of healing &amp; communication.  He mentioned that he has a lot of experience leading men's groups groups, and I've been wanting to start one, so we decided on the spot that are in a men's group.  Elana said to talk to Ravi also, as he'd probably be interested.  Pan had gone back to his office by that time, so he didn't hear about it, and now I wonder if he'd want to join us also.
* On the way to lunch, I talked with Sandy about the proposal and whether to bring to core team next week.
** I'm not clear about what we'd propose.  What is the specific, positive, doable request?
** I explained that I'm not ready to propose an implementation plan and that I want to create the architecture myself, before looking for help.  I have an intuition for how it will all fit together in a very powerful way, with openness and feedback at all levels.  Once I get more detailed clarity about the architecture, then I'll look for ways people can help.  Before there's architecture, I don't know how to give an implementation plan.  Or maybe the plan is this: Conal creates the architecture (possibly with Shelly Farnham's help) and then asks for some implementation help, and then we invite people to contribute their bios etc.
** Sandy suggested that Holly &amp; I do a presentation of the proposal and then ask whether the group wants to move in that direction.  I guess it's just a statement of interest/intention for now.
** We also talked about the intermediate possibility that PSNCC opens up their web-site to folks who aren't certified, and changes the &quot;prerequisites&quot; in the way Sandy wrote up.
** Okay, so next I want to ask Holly for help in creating a presentation for Tuesday evening (core team meeting).  Sandy scheduled 90 minutes to our proposal.  I'd like the presentation to be clear and fairly detailed.  Not as loose (Q&amp;A) as before.
* Oops!  It's a good idea to close all tiddlers being edited before closing the web browser.  Otherwise I could lose some edits.
</pre>
</div>
<div title="2006-11-04" modifier="Conal Elliott" modified="200611050145" created="200611050144" tags="2006-11 day">
<pre>* Rest day.  Yum.
* Big misgivings about presenting the Emergence proposal to the core team on Tuesday.
* I want to post a note about the Emergence proposal to the [[NVC certification candidates yahoo group|http://groups.yahoo.com/group/nvccertificationcandidates]].
</pre>
</div>
<div title="2006-11-05" modifier="Conal Elliott" modified="200611062310" created="200611061626" tags="2006-11 day">
<pre>* Oops.  I forgot this morning's certification candidates support call.
* Listening to the [[2006-10-23]] support calls and taking notes:
** [[notes from 2006-10-23 morning certification candidate call]]
** [[notes from 2006-10-23 evening certification candidate call]]
* In reply to a certification candidate, &quot;I also believe that there is great awareness for a need for more assessors to alleviate the bottleneck&quot;:+++[response]&gt;
One of the key insights I came away with from reading &quot;Emergence&quot; (by Steven Johnson) is that //any top-down// approach to quality is in direct opposition to growth.  When I consider what will happen under the current certification scheme if we come up with more assessors, here's what I expect:
* More assessors lead to more certified trainers and more trainings of the quality that certification is intended to support.
* Then more people who learn and love NVC and who want to get certified and thus rely more on assessors.
* Again, the assessor supply lags behind the demand, so the bottleneck is back.
Given the effectiveness of NVC, I do believe that exponential growth is possible.  To support quality, we'd need corresponding exponential growth of the assessor pool.  The only way I know to do that is to replace the top-down approach with a bottom-up one, as slashdot did.  Specifically, this proposal recommends removing the distinction between assessors and assessees, empowering and encouraging everyone to assess.
=== 
* I want to break up the Q&amp;A section of the Emergence proposal into one tiddler per question.  Easier to edit.  More in harmony with the &quot;micro-content&quot; idea.  Simply tag each question as &quot;question&quot; and then use a macro to create the Q&amp;A section.  Maybe there's a way to have them included in how how recently edited.
* Very powerful TW extension here: http://tiddlywiki.abego-software.de.  
</pre>
</div>
<div title="2006-11-06" modifier="Conal Elliott" modified="200611091628" created="200611091627" tags="2006-11 day">
<pre>* Worked with Holly on new Emergence presentation for Tuesday night's psncc core team meeting.  Organized ideas in a tiddlywiki, and then Holly moved it into a nice ~PowerPoint presentation.</pre>
</div>
<div title="2006-11-07" modifier="Conal Elliott" modified="200611092125" created="200611081820" tags="2006-11 day">
<pre>* Finished preparations for presenting the Emergence proposal to the psncc core team.  Tweaked the powerpoint slides some.  Holly set up a lovely background and simple transitions.  There wasn't really a lot more to do, but still I didn't find myself able to really move my attention to something else.  Nervous energy, I guess.
* Scott Lewis phoned, in response to some questions.  (Scott is facilitating the CNVC support group conference calls.)  About phone conferencing, he uses http://freeaudioconferencing.com and likes the convenience.  They provide a dedicated line (samenumber each time).  Quieter phone lines than some.  What's in it for the companies? maybe a kickback from long-distance companies.  For recording, he uses audioacrobat.com: easy to do.  give you the link.  $20/month, based on bandwidth.
* Voted.  Holly &amp; I opted for computerized voting, which we thought would be fun &amp; fast.  Turned out to be a bottleneck, as there was only one electronic voting machine, compared to eight or so old-fashioned ones.
* Emergence presentation in the evening.  I had mixed feelings about doing the presentation, and I have mixed feelings afterward.  Still supportive response.  Mostly quite positive, and some concerns, which are helpful in seeing some issues.  I couldn't really ask for action, as the system isn't real yet.  Also, I'm burnt out on all the energy I've been putting in on this project.  I want to work on my graphics language projects and make t-shirts.
</pre>
</div>
<div title="2006-11-08" modifier="Conal Elliott" modified="200611090310" created="200611081822" tags="2006-11 day">
<pre>* Catching up on blogs etc.
* Called Charlotte &amp; will visit her this morning when Holly gets back from school.
* Trying out my new [[Kinesis Maxim split adjustable keyboard|http://www.kinesis-ergo.com/max-spec.htm]].  I want typing to be gentler on my wrists &amp; elbows.  From some conversations with my chiropracter, I suspect that my neck &amp; shoulder problems mainly come from my right elbow getting tweaked, which comes from typing.  To do: switch the &quot;insert&quot; and &quot;delete&quot; keys, since delete is a lot more useful to me than insert.  Now I also understand that a built-in numeric keypad was ergonomically harmful to me. It forced my mouse hand further from the keyboard, which prevented my right elbow from keeping a comfortable bend.  Just one look at a photo of a model using the keyboard was enough for me to see how much more comfortable typing could be.
* Reflecting on last night's Emergence presentation.  One thing stands out as quite a surprise.  Two people expressed concern about being left out, given that they're (a) not very computer literate, and (b) have misgivings about allowing people to publicly review them.  As I said last night, the last thing I want to do is create yet another system that includes some people and excludes others.  What surprises me is how easy it is to create another imaginary power base.  &quot;Imaginary&quot; in the sense that it's only an idea (imagining).  I've noticed other imaginary power bases (like CNVC or PSNCC certification, or being part of an &quot;in&quot; circle of some kid who starts acting like king), but I haven't been thought of myself as wielding that power.  For a moment last night, I got a taste.  No thanks.
* Found blog articles on serving ~MP3 files and another useful tip.  I posted a question on the first, about how to script and what parameters are available.
** [[Embed MP3 Files Into Your Website| http://googlesystem.blogspot.com/2006/07/embed-mp3-files-into-your-website.html]]
** [[Vibe Streamer - Create Your MP3 Server| http://googlesystem.blogspot.com/2006/07/vibe-streamer-create-your-mp3-server.html]]
** [[Play And Convert Any Multimedia File| http://googlesystem.blogspot.com/2006/05/play-and-convert-any-multimedia-file.html]]

</pre>
</div>
<div title="2006-11-09" modifier="Conal Elliott" modified="200611101938" created="200611091629" tags="2006-11 day">
<pre>* Put Tuesday night's [[Emergence presentation| http://emergence.awakeningcompassion.com/other/emergence.ppt]] on-line.
* I'd like to sync up a voice recording with a powerpoint presentation.  Record my voice and stepping within and between slides.  Maybe add a photo of myself to make it a bit more personal.  Or one photo per slide.  Also, look for a free alternative to MS powerpoint.  How about something that runs right in a web browser.
* Graphics processors are evolving into general stream processors.  See [[this article| http://arstechnica.com/news.ars/post/20061108-8182.html]] on the new ~NVidia 8800.
* Learning about [[Odeo|http://odeo.com]] for mp3 streaming in a web page.  Reading the forum, I found [[a post on &quot;audio quoting&quot;|http://forum.odeo.com/index.php?pg=kb.page&amp;id=43]] that looks like what I want.  Except, it looks like this method only works on //their// server.  Posted +++^[note]I'd like to have a web page with a single odeo player and a variety of separate buttons, each of which plays a different audio quote.  The audio quote feature is close to what I want, but I think requires (a) one player per quote, and (b) using odeo's server instead of my own.

Is it possible to use javascript to cause an embedded odeo player to start &amp; stop at selected time points, and if so, how?  Is there another approach that may do what I want?===.  Note sure the post went through.  I think I could use the audio quoting technique as is.  If so, I'd like to make it very convenient for people, by having a form for them to fill out, with start time, end time, and comments.  I'd synthesize the html from there.  Posted another note about the audio-quote feature not working at all for me.  I don't think it went through either.  Oh well.
* Corresponded with Roger.  He's concerned, as I am, that there not be any veiled demands in the &quot;pathway&quot; doc for people teaching NVC.
* Installed ~FireFox 2.0.  Massively broken for me, though Holly got along just fine.  I've lost tabs, my Bookmarks Toolbar Folder, and I don't know what else.  I hope I can get it working soon, as I depend on ~FireFox for most of what I do.
* I've been feeling discontent again lately.  Missing engagement.  I like having one or more projects I'm gung-ho about and in the middle of.  What would I like to work on?
** Eros project.  Improve the paper and implementation.  Get a source release out there and encourage people to help.
** Along these lines, learn to organize an open source project.
** Get my art shown at coffee shops.
** Self-organizing FAQ.  Yeah!
** Group annotation of audio.
* Found blog article [[Annotate online video with Mojiti|http://www.lifehacker.com/software/video/annotate-online-video-with-mojiti-213344.php]].  I've been wanting something like that for annotating workshops etc.
* Started &lt;&lt;tag idea&gt;&gt; tiddler on [[self-organizing FAQs]].
* Learned how to have each day's entry automatically tagged with its month.  Use {{{&lt;&lt;newJournal 'YYYY-0MM-0DD' {{new Date().formatString(&quot;YYYY-0MM&quot;)}} 'day'&gt;&gt;}}} in SideBarOptions.  The double braces surround javascript code, thanks to InlineJavascriptPlugin.  Wow -- what other cool stuff could I do with this ability?
</pre>
</div>
<div title="2006-11-10" modifier="Conal Elliott" modified="200611102000" created="200611101938" tags="2006-11 day">
<pre>* Another [[embedded audio player| http://google.blognewschannel.com/index.php/archives/2006/08/23/googles-mp3-embeddable-player]], thanks to Google and some folks digging around.  Oddly, with some files it starts playing right away &lt;html&gt;&lt;iframe src=&quot;http://mail.google.com/mail/html/audio.swf?audioUrl=http://www.itconversations.com/audio/download/itconversations-1332.mp3&quot; style=&quot;border: 1px solid rgb(170, 170, 170); width: 200px; height: 25px;&quot; id=&quot;musicPlayer&quot;&gt;&lt;/iframe&gt;&lt;/html&gt; and with some others not until the whole mp3 file is loaded &lt;html&gt;&lt;iframe src=&quot;http://mail.google.com/mail/html/audio.swf?audioUrl=http://slewwho.audioacrobat.com/download/af9c9917-4c0e-0dab-cae1-ba47f4539b82.mp3&quot; style=&quot;border: 1px solid rgb(170, 170, 170); width: 200px; height: 25px;&quot; id=&quot;musicPlayer&quot;&gt;&lt;/iframe&gt;&lt;/html&gt;.  Maybe there's a difference in server side support.  I know audioacrobat also streams, so maybe I can get another angle.
</pre>
</div>
<div title="2006-11-12" modifier="Conal Elliott" modified="200611131837" created="200611122012" tags="2006-11 day">
<pre>* Looking for focus again.  Projects:
** Haskell projects: Eros &amp; Phooey.  Implementation &amp; distribution.  Use darcs &amp; Daan's extensions.  Either on Joseph's server or http://haskell.org.  Maybe also learn trac.
** Organic FAQ
** Pictures: mat &amp; frame one for Becky, look for more picture inspirations.
* Discovered rounded corners via CSS, e.g., {{{-moz-border-radius: 1em}}}.  Used in [[TiddlyWikiTips|http://TiddlyWikiTips.com]].  Using for now in {{{tagged}}} and {{{tagging}}} styles.
* I invited Mathias K over for a visit.  Once he got here and saw my new ergo keyboard, he had some very specific advice about improving my set-up.  One is that keyboards should have the near end higher than the far end, so that the wrists are unstrained.  We did a few adjustments while he watched me.  I like it!  Also see this [[Cornell ergo site|http://ergo.human.cornell.edu/ergoguide.html]].  When Holly came home, we also talked about our Emergence proposal and more broadly about what we want to create in the world, via NVC.
* Getting darcsweb going.  Having some set-up problems:
** As usual, I can't get a cgi to run when it starts with {{{#! /usr/bin/env python}}}.  Replaced with {{{#! /usr/local/bin/python}}}.   I don't understand why.
** The CSS and ~PNGs aren't used.  When I try to look directly at the .css in the browser, I see that it's getting executed.  See comment in [[setting up CGIs]].
</pre>
</div>
<div title="2006-11-13" modifier="Conal Elliott" modified="200611141225" created="200611141128" tags="2006-11 day">
<pre>* Got darcsweb running.  See {{{Directory}}} tag incantation in [[setting up CGIs]].  The other trick was to really specify the path to darcs.  [[It's very pretty|http://conal.net/darcsweb]].  Next tackle darcs-server.
* From Wikipedia on [[Nikos Kazantzakis|http://en.wikipedia.org/wiki/Nikos_Kazantzakis]]:
&gt; His epitaph read &quot;I hope for nothing. I fear nothing. I am free.&quot;
</pre>
</div>
<div title="2006-11-14" modifier="Conal Elliott" modified="200611190338" created="200611141206" tags="2006-11 day">
<pre>* What does sociocracy say about paramount objections to an //existing// policy?  I have some about psncc's policies around who gets to put their picture &amp; bio on the web-site and advertise offerings.  My understanding of &quot;paramount objection&quot; is an objection that is so strong that I would withdraw my life energy from the shared undertaking.  That's what I was doing before Sandy joined PSNCC.  Since then I've been in a wait&amp;see holding pattern, plus some effort at changing the status quo.  And now I'm in that same place with CNVC as well.  Sent query to John Buck.
* In the wee hours of the morning, I started &lt;&lt;tag essay&gt;&gt; on [[NVC certification and violence]].  Of course the name would provoke a defensive reaction, so I'll want to change it before sharing.  I was irked and couldn't sleep.
* Erika J mentioned: when employees are asked what they most want in a job, money is not in the top ten.  Instead, things like working with people they like.  But when they don't get what they most want, //then// they ask for money.  As a compensation.  I relate to that in my own life with Holly.  I don't care much about cost of living when I'm really content with meaning, connection, contribution, and creative accomplishment.  When I'm not getting these things I really want, //then// I get cranky about our cost of living.
* Charlotte's birthday.  We went out to lunch and hung out &amp; danced &amp; stuff.  Then I played with Audrey while Char &amp; Eric had their first counseling appointment.
* Attended the small business startup, rather by accident.  Had a great time.  Did wonders for my self-confidence.
* I set up a Google Calendar &quot;Northwest Compassionate Communication&quot;.  I suspect that we really want two different calendars.  One would be visible to everyone and would contain all CC (NVC) workshops in our geographic area.  A second one would be of more limited interest, to folks who share CC.  I'm especially excited about the first one, since it can be easily updated at any time with new offerings (or canceled ones) and new info about offerings.  Also because it is decentralized and so is one easy &amp; concrete step from top-down control to openness.
</pre>
</div>
<div title="2006-11-15" modifier="Conal Elliott" modified="200701052031" created="200611151648" tags="2006-11 day">
<pre>* I've been making some big shifts in my attitude about PSNCC and CNVC.  Some progress in letting go of my attachment to them as strategies for inclusion, community, contribution, and support.  I'm noticing that my attachments get me into frustration, conflict, and demand.  What I want is peaceful allowing these organizations &amp; people to think &amp; act exactly as they do for as long as they do.  And for myself to create &amp; co-create communities that do support my exploration and work.  Some steps:
** Create a &quot;Northwest Compassionate Communication&quot; Google calendar and invite others to post their offerings, rather than waiting to be welcomed to post my offerings on the psncc list.  (Though now Sandy is requesting that the psncc list be opened up.)
** Call my Emergence vision a &quot;plan&quot; (or ???) rather than a &quot;proposal&quot;, as the latter means to me that I'm requesting approval.  As long as it makes sense to me, I'm going to do it with or without psncc or cnvc encouragement.  Look for a stronger word than &quot;plan&quot;.
** Write essays and post them on a blog or wiki.  Invite comments.
** Create a wiki for discussing NVC theory, since I've been dissatisfied with existing mailing lists &amp; wikis.
** Post pointers to my resources on http://nvcwiki.org.  Copy some content in there as well, and be bold about it.  Don't rely on others' acceptance though.
** Clearly and consistently use language the way I like to use it and want to hear it used.  If I want to use &quot;trainer&quot; to mean one who trains, then do it and allow psncc and cnvc folks to get confused or uncomfortable.  I could even use &quot;certified&quot; to mean that //someone// has &quot;attest[ed] to as the truth or meeting a standard&quot;.  For instance, I'm self-certified to teach NVC and ~CMU-certified as a ~PhD computer scientist.  To speak more specifically, I'd say certified by whom for what.  Be the change I want to see in the world.  This clarity of speech is very important to me in shifting from power-over to power-with.  I believe that implicitness of //relationship// is one of the language tricks of power-over, and part of the brilliance of Marshall Rosenberg's teaching is to make those relationships explicit.  For instance, translating &quot;That book was terrible&quot; to &quot;I'm disappointed with that book&quot;.
* Note to Roger &amp; Moreah about this shift.  +++[Excerpt]&gt;
I'm delighted with the changes that are starting to happen or at least being discussed in psncc.  At the same time, I'm realizing that I want a supportive community whether or not psncc or cnvc can play that role for me.  My &quot;Emergence&quot; exploration has clarified for me that the power of organizations like psncc or cnvc is purely by mutual agreement.  I think that's why I've become so emotionally reactive to the word &quot;trainer&quot; being co-opted by psncc folks to mean &quot;person whom some of us have approved to train&quot;, rather than its common meaning of &quot;one who trains&quot;.  And cnvc folks do the same but with a different &quot;us&quot;.  A Marshall-style reframe of the  jackal judgment/labeling &quot;You are (or are not) a trainer&quot; might be &quot;I feel comfortable (or uncomfortable) recommending you to people for NVC training&quot;.  Or it might be any of a variety of observations, feelings, needs, or requests.  I'm remembering Marshall's statement [[&quot;Never let someone in authority tell you what you are&quot;|http://www.cnvc.org/downlds/20020714.mp3]].

Anyway, with increasing clarity &amp; confidence, I'm brewing intentions &amp; manifestations of effective support and inclusiveness and release of my personal resistance to other people's thinking, speaking, or behavior.  Rather than changing current institutions, I want to create alternatives that work better.  And stay connected with the people I like in those old institutions, calmly &amp; clearly sharing what I'm up to without any request for approval.=== 
* Play date with Sandy Fox at our house.  Talked a bunch about where we are and where we want to go with PSNCC.  Very fun &amp; connecting also.
* Made AudioPlayerPlugin with {{{audioPlayer}}} and {{{marshallism}}} macros.  Example: &lt;&lt;marshallism 20020714&gt;&gt;.  Big test at [[Marshallisms]], but doesn't load well.  What I really want is to click on the clip name and have the player materialize.  Added {{{audioSlider}}} and {{{mbr}}} macros, but they don't work.  Maybe the {{{&lt;iframe&gt;}}}?  Experiment and see.  Ask for help from TW folks.  Another problem I suspect is that the player using doesn't really stream the audio from the source, so it all gets downloaded before the player starts up.  I'm still not sure about that.
</pre>
</div>
<div title="2006-11-16" modifier="Conal Elliott" modified="200611171828" created="200611161609" tags="2006-11 day">
<pre>* Found [[CivicSpace|http://civicspacelabs.org/civicspace/features]], a Drupal-based community-organizing platform.  Looks pretty useful.  Supports blogging, forums, polls &amp; surveys, files, photo galleries, social networking, contact management, event listings.  Related: [[CiviCRM|http://civicrm.org]].
* Working with darcs-server again.  Stuck.  Asked Daan for help.
* Experimenting with iframe and nestedSlider.  Worked okay on my home page as the iframe source, but not with the google audio player.
* Tweaked my MainMenu so that it gives me a tag for the current month: {{{&lt;&lt;tag {{new Date().formatString(&quot;YYYY-0MM&quot;)}}&gt;&gt;}}} (using InlineJavascriptPlugin).
* NVC marketing meeting.  Very informative.  Some I enjoyed learning.  Overall, I felt nauseous and disheartened.  So much of marketing I hear as manipulation -- skillfully imposing my personal will on other people's.  Especially in pressuring people to make quick decisions.
* Replaced &quot;proposal&quot; with &quot;plan&quot; in [[Emergence|http://emergence.awakeningcompassion.com]], now that I have enough clarity &amp; confidence to know I'm going to pursue realizing the Emergence vision.
</pre>
</div>
<div title="2006-11-17" modifier="Conal Elliott" modified="200611180313" created="200611171705" tags="2006-11 day">
<pre>* Blog finds:
** [[Locate a mailbox|http://www.payphone-project.com/mailboxes]]
** [[Sync your Google Calendar with your cell phone| http://www.lifehacker.com/software/top/sync-your-google-calendar-with-your-cell-phone-213886.php]]
** [[Skype 3.0 Beta: Facelift and a Boob Job| http://www.gizmodo.com/gadgets/software/skype-30-beta-facelift-and-a-boob-job-213286.php]]
** [[10 Reasons You Should Never Get a Job (Steve Pavlina)| http://www.stevepavlina.com/blog/2006/07/10-reasons-you-should-never-get-a-job/]]
* Pat's birthday!! &lt;&lt;smiley :)&gt;&gt;  Pat, Becky, Charlotte, Audrey, Holly &amp; I went to Denny's in Ballard.  Then presents &amp; hanging out.

What I'd like to accomplish today:
* Progress on using darcs-server
* Isolate the problem with the {{{audioSlider}}} macro and send note to TW list.
* Design an NVC offering.
</pre>
</div>
<div title="2006-11-18" modifier="Conal Elliott" modified="200611271953" created="200611182034" tags="2006-11 day">
<pre>* Met Brian at Hotwire.  He likes Daniel Quinn and saw my copy of //The Story of B//.  He recommended two other books: //Sophie's World// and //Art of Passion//.  Placed a hold on the former.  Couldn't find the latter.
* Made a new &lt;&lt;tag project&gt;&gt; category (tag).  Added [[Emergence of NVC]], [[Eros]], [[Phooey]], [[TiddlyWiki hacking]].
* Poking around with darcs-client and darcs-server, to determine why darcs push is failing.  I want much better diagnostics.  There is a verbose mode for darcs-server.  Find out how to activate it.  A possible problem: my repo permissions are {{{rw-rw-r--}}}, and the darcs-server perl script probably runs as user apache, which would not have write permission.  As an experiment, I tried {{{chmod -R u+w Eros}}} in my {{{darcs}}} directory.  Same error.  Added {{{-v}}} to {{{DARCS_APPLY_HTTP}}}.  Aha!  Found a +++^[relevant message]{{{Sat Nov 18 19:56:55 2006] [error] [client 24.41.41.187] Can't locate /home/conal/.darcs-server/darcs-server-lib.pl in @INC (@INC contains: /usr/lib/perl5/5.8.0/i386-linux-thread-multi /usr/lib/perl5/5.8.0 /usr/lib/perl5/site_perl/5.8.0/i386-linux-thread-multi /usr/lib/perl5/site_perl/5.8.0 /usr/lib/perl5/site_perl /usr/lib/perl5/vendor_perl/5.8.0/i386-linux-thread-multi /usr/lib/perl5/vendor_perl/5.8.0 /usr/lib/perl5/vendor_perl /usr/lib/perl5/5.8.0/i386-linux-thread-multi /usr/lib/perl5/5.8.0 .) at /home/conal/domains/conal/htdocs/cgi-bin/darcs-server.cgi line 19.}}}=== in the Apache error log.  Oh!  The apache user +++^[can't read the darcs-server directory]...{{{
[conal@feijoada darcs]$ sudo -u apache ls -l /home/conal/.darcs-server/darcs-server-lib.pl
ls: /home/conal/.darcs-server/darcs-server-lib.pl: Permission denied
}}}===, because I followed Daan's set-up directions, which say to do {{{chmod 700 .darcs-server}}}.  Got further to another error message.  Emailed Daan.
* Don Stewart posted [[Starting your own Haskell project| http://haskell.org/haskellwiki/How_to_write_a_Haskell_program]].  I want to do exactly that.  Follow his directions and give feedback.

</pre>
</div>
<div title="2006-11-19" modifier="Conal Elliott" modified="200701052035" created="200611192145" tags="2006-11 day">
<pre>* Church @ CSL
* Lunch with Holly at Tai Ho.
* Hanging out at Hotwire.
* I want to get a men's group going.  See if Ravi is interested and ask him if he knows others who might be.  Who else?  Look into advertising in The Stranger and Seattle Weekly.  Do I want to lead?  I thought I did, but I'd rather get support for myself.  My CA men's group worked great without a facilitator.
* Got this clarity from a conversation with Holly.  Here's why it's worthwhile for me to take care in my speaking when I'm in pain.  What I want is for the other person to attend to my pain.  If my words stimulate pain in the other, however, then I've given them something //more interesting// to focus on than my pain, namely their own.
* Tried out FileDropPlugin.  Looks like wonderful fun, but apparently depends on TW 2.1, and ZiddlyWiki isn't quite there yet.
* +++[Note to TiddlyWiki group about my experience with journaling in TW.]&gt;
This note shares a personal TW practice I've adopted.  Others may enjoy it as well.  Comments &amp; suggestions are very welcome.

For the last 20 years, I've been keeping a journal of my daily activities &amp; thoughts. I started in grad school when I noticed how often I felt discouraged at the end of a work day, not having a sense of accomplishment or clarity about what I've done with my time.  The journaling helped a lot, and I've been keeping it up since.  All that time, my journal has been in ascii, via GNU Emacs.  Since discovering TW recently, I've switched over my journaling from ascii &amp; emacs to TW, and I'm delighted with the change.  When I want to do a lot of writing/editing, I use Chris Klimas's [[Twee emacs mode| http://gimcrackd.com/etc/src/#Twee]].

My newJournal incantation tags each entry with its month and the word &quot;day&quot;:
{{{
&lt;&lt;newJournal 'YYYY-0MM-0DD' {{new Date().formatString(&quot;YYYY-0MM&quot;)}} 'day'&gt;&gt;
}}}
Similarly, each month is tagged &quot;month&quot; and the year, and years are tagged with the word &quot;year&quot;.  When I create a new topical tiddler (an idea, how-to, essay, etc), I tag that tiddler with its creation date.  My MainMenu has a tag for the current month.  I intend to use these month &amp; year tiddlers to capture monthly &amp; yearly plans and accomplishments.
{{{
&lt;&lt;tag {{new Date().formatString(&quot;YYYY-0MM&quot;)}}&gt;&gt;
}}}
Most fun of all, with this tagging in place, I use the {{{siteMap}}} macro to get a structured view on all I've been doing and thinking.

The result is at http://journal.conal.net.

BTW, copy&amp;paste from a rendered tiddler into gmail works great.

With much gratitude to the TW community,

  - Conal
=== 
</pre>
</div>
<div title="2006-11-20" modifier="Conal Elliott" modified="200611210630" created="200611201831" tags="2006-11 day">
<pre>* I wonder: could it be practical and powerful for tiddlywiki to use javascript directly as its language for macro invocation?  More precisely, JS is the language for //defining// macros, but two different little languages are used for //invoking// macros: one from wiki markup ({{{&lt;&lt;foo ...&gt;&gt;}}}), and one from template html ({{{macro='...'}}}).  I don't know to what degree these invocation languages support composition.
* Futzing with the LAN again.  This time I shut down the router, all of the computers, the network server //and// the cable modem.  I turned on the router, then my computer, and I could see the local network from my machine.  When I plugged the print server back in, my print job came out.  Differences that I'm aware of relative to previous tries: turned off the modem, shut down all computers.  Next time, try the modem specifically.
* Mathias visited.  We had a long talk, and he gave me some great inspirations.
</pre>
</div>
<div title="2006-11-22" modifier="Conal Elliott" modified="200701052036" created="200611221803" tags="2006-11 day">
<pre>* Tasha pointed me to her response to a [[LiveJournal post|http://community.livejournal.com/weddingplans/9003589.html]] about an engaged couple's conflict over last names.  I wrote +++[this response.]&gt;
Wow -- I'm worried about the three of you after reading your note.  I'm glad you have another year to go before the wedding.  Conflict is inevitable, and how you two handle conflict (or can learn to handle it) says a great deal about how happy your lives can be together.

I'd like to offer another perspective on compromise, namely that it's //poison// to relationships.  And it's never necessary when we get clear about what's really important to us underneath our positions, preferences and demands.  My partner &amp; I work with couples, and we encourage and help them to keep working on understanding and expressing their underlying needs, until they can joyfully let go of their current strategies in favor of ones that meet all of the present needs //fully// (no compromise).  The magic of this approach is that you both end up happy, //and// you're more intimately and compassionately connected than before the conflict arose.

In contrast, &quot;compromise means the resentment gets shared 50/50&quot;, leaving a bitter residue that gradually poisons your relationship and self-respect.  Most couples play this game until they divorce or, worse, live out their life sentences of disappointment.

The &quot;50/50&quot; quote is from the book &quot;Don't be Nice, Be Real&quot; by Kelly Bryson. //Please// read that book with your fiance and use the principles.  Also &quot;Nonviolent Communication&quot; (NVC) by Marshall Rosenberg.  (Where &quot;nonviolent&quot; means getting past habits of judgment, blame, demand, diagnosing, etc, to clear &amp; heartful thinking, speaking, and listening, so that mutual support becomes possible and joyful again.)  Better yet, find someone in your area who teaches NVC and/or can provide counseling/mediation using NVC.  Or phone up my parter &amp; me, and we'll help you (with or without your fiance) get oriented, free of charge.  The same offer  goes to anyone else reading this note.  Our phone # is 206.364.5063, and our web site is [[awakeningcompassion.com|http://awakeningcompasion.com]].

If you do seek counseling from your pastor, I hope you're watchful about his/her own orientation and examine whether it's compatible with your own.  Does he/she reinforce the patriarchal values of ownership/domination of women that you'd like to move beyond?  

Heartfelt best wishes,  - Conal
=== 
* Last week I ordered a 120GB Viewsonic Wireless Media Gateway, which is a wireless router with a hard drive and two USB ports for printers or other devices.  It gets us on the internet fine, and the file system shows up, but I haven't gotten the printer interfaces to work.  [[Searched| http://www.google.com/search?q=viewsonic+wireless+media+gateway+mygroup] and found [[someone with the same problem| http://www.smallnetbuilder.com/index2.php?option=com_content&amp;task=view&amp;id=24719&amp;pop=1&amp;page=0&amp;Itemid=80]].  After several tries, I called ViewSonic customer support (800-688-6688).  Did not find a solution.  Case # VSA-061122-0521.  Escalated (to a supervisor I guess).  I suspect the problem comes down to access permissions.  I'm going to try something else.  Edit {{{/LPRNG/etc/samba/smb.conf}}} on the device to make the group match our workgroup (mshome) rather than &quot;mygroup&quot;.  The catch is that I don't have permission to edit that config file.  Working on giving myself permission.  Failed.  I don't think it's really about permissions, since I'm able to get to write to {{{/media}}} but not {{{/LPRNG}}}, and they show the same permissions.  Maybe {{{/LPRNG}}} is really in ROM.
</pre>
</div>
<div title="2006-11-23" modifier="Conal Elliott" modified="200611232255" created="200611232033" tags="2006-11 day">
<pre>* Revisiting [[Phooey]], starting with my paper draft.  (See [[Phooey]] tiddler for details.)
* Having another go at making t-shirts.  My last batch bled terribly in the washer.  I forgot about them and let them sit wet all day on the first washing.  There are a lot of variables, and I don't know what's most important.
** print setting (//photo quality glossy film// vs plain paper), 
** heat press time, temperature &amp; pressure (45 seconds, medium-hard, at 325 degrees),
** washing (wait two days, dry on gentle for 5 minutes, then wash on gentle, promptly remove and dry on gentle).

</pre>
</div>
<div title="2006-11-24" modifier="Conal Elliott" modified="200611250156" created="200611242053" tags="2006-11 day">
<pre>* Talking with Holly this morning, it became crystal clear that I want to diversify the support &amp; personal connection in my life.  I created a tremendously broad support base for myself six years ago in preparing to end my marriage, and now I have just Holly.  No wonder I'm lonely and discontent.  As a first step, I'm starting up a men's group.
* Men's group potential members: Mathias, Rob Jennings, Pan Vera, Mitch Albala, Scott Steinhorst, Roger C.  Mathias is already in.  I talked with Rob, and he's in.  Left messages with the rest.
* Reworking my [[Phooey]] paper.  Started over fresh, moving my current {{{~/Phooey}}} directory to {{{~/Phooey/Old}}}.  I'm taking a much more top-down approach than previously.
* Idea: use Phooey to make a simple implementation of the rendering part of tangible values (not the interactive composition part).  Hopefully very simple, as there's a good deal in common.
* Switched my Emacs tex mode to use longlines.  I really dig longlines.

</pre>
</div>
<div title="2006-11-25" modifier="Conal Elliott" modified="200611262350" created="200611252236" tags="2006-11 day">
<pre>* Imagine presenting [[Eros]] as follows:
** Visualizing functional values
** Combining user-friendliness //and// composability (rather than choosing between them).  Yes -- this angle is probably the most significant, from a computer-science perspective.  That composability could be programmatic, using the Eros algebra.  It can also be gestural.
** Observe the role of //types// in composability.  If the type is something like //IO ()// or //UI () ()//, then we're not going to be able to compose.  A type like //IO a// may let us get info //out// but not in.  Even then, a //complete// UI would have type //IO ()//, which shows that we can no longer compose.
* Men's group progress.  Roger and Scott are very interested.  Scott is free weekday evenings other than Monday (and other than our NVC practice group 1st &amp; 3rd Wednesdays).  I'll talk with Mitch tomorrow.
</pre>
</div>
<div title="2006-11-26" modifier="Conal Elliott" modified="200612311633" created="200611262212" tags="2006-11 day">
<pre>* [[reply to Shulamit Day on 2006-11-26]]
* Note to TiddlyWiki group: +++[filtering tag lists?]&gt;
I'd like to filter out (hide) some tags generated by the tagChooser macro and under the &quot;All&quot; tab in SideBarTabs.  Specifically, I want to hide my daily (and maybe monthly) journal entries, i.e., tags having corresponding tiddlers bearing the tag &quot;day&quot; (and maybe &quot;month&quot;). Any hints?=== 
* Men's group: I talked with Ravi at CSL.  He wants in.  Monday &amp; Thursday evenings look good for him.  He'll be leaving for Austria on Dec 13. 
* [[Phooey]] paper: do I want the paper to be the implementation?  Tempting, but tilts the paper toward being very detailed.  Keep the paper &amp; implementation separate for starters, and then consider merging them.
* New tiddler: [[to read]].
* Starting a new Phooey project, along the lines of [[How to write a Haskell program |http://haskell.org/haskellwiki/How_to_write_a_Haskell_program#Libraries]].  I'm puzzling over which license to use.
</pre>
</div>
<div title="2006-11-27" modifier="Conal Elliott" modified="200612040220" created="200611271812" tags="2006-11 day">
<pre>* Men's group:
** Teo wants in
** Mitch is interested and had some reservations but wants to give it a go.  He wondered whether it would be ~NVC-centric, and if so, maybe it //and// the practice group would be more NVC than he wants.
* Installed GHC 6.6 and switched my {{{PATH}}} from 6.5 to 6.6.  Oh, now I need to recompile wxHaskell and re-add various packages.  Backed off to 6.5.  Try again later.
* Trying out {{{mkcabal}}} for Phooey.  Investigated, found &amp; fixed a problem, and wrote to Don S.  For now, I'll go with LGPL for the Phooey license.
* Getting new Phooey together
** Depends on the monad transformer library.  
*** I haven't know how to properly describe this dependency.  I'd had the local source copy wired into my makefile, which certainly won't do.  Looked and found http://www.cse.ogi.edu/~diatchki/monadLib.  The latest versions have Cabal support.
*** No version of monadLib quite seems to match my ghc/cabal version.  Old ones don't use hierarchical library module names or do inconsistently.  The latest versions (2.0 &amp; 2.0.1) yield {{{Unknown field 'extra-source-files'}}} from my cabal.  I guess I have an old cabal.  For now, I commented out the extra-source-files directive.
*** The standard Cabal incantation worked, though it put the library archive in {{{c:/Program Files}}}, which I don't like.  Instead, use {{{--prefix=c:/Haskell/packages}}}.  +++[Full version:]
{{{
runhaskell Setup.hs configure --prefix=c:/Haskell/packages
runhaskell Setup.hs build
runhaskell Setup.hs install
}}}
=== 
*** Why does monadLib use {{{Monad.}}} instead of {{{Control.Monad.}}}?
** Find packages at {{{http://darcs.haskell.org/packages}}}, including {{{monads}}} and {{{arrow}}}.  Undid my monadLib registration ({{{ghc-pkg unregister monadLib-2.0.1}}}) and started again with a {{{darcs get --partial http://darcs.haskell.org/packages/monads}}}.
** Similarly, grabbed the arrows package.  My cabal failed on it also.  I can comment out parts, but instead, I'm going for the latest cabal, at {{{http://darcs.haskell.org/packages/cabal}}}.
** Got latest Cabal; unregistered Cabal-1.0; followed build directions in README.  Worked!  Now I have Cabal-1.1.7.
** Returning to arrows, configure failed, wanting base&gt;=2.0.  Now I'm really tempted to switch to ghc-6.6, which probably has base-2.0.  First, try getting and building the latest base package via darcs.
** I don't know how to build the {{{base}}} package.  Switching to ghc-6.6 instead.  
*** Installing wxHaskell:
*** My first attempt failed: {{{Unable to find the 'wx-config' program: wx-config}}}.  I'll re-build wxWindows.  (In retrospect, I could have searched for wx-config and added it to my PATH, as the rest of the error message suggested.  Maybe I lost the path setting when I rebuilt my hard drive last year.)
*** Re-building wxWindows.  This time with {{{--with-opengl}}}, which I missed last time I built.  I do want opengl.
**** Returning to build wxHaskell, this time wx-config was found.  +++[configure.]{{{./configure --with-opengl  --prefix=c:/cygwin/usr/local}}}===  Broke immediately.  I started with a fresh copy of wxHaskell.  Then I got +++[this.]
{{{
ghc -c wx/src/Graphics/UI/WX/Types.hs -o out/wx/imports/Graphics/UI/WX/Types.o -iout/wx/imports -odir out/wx/imports -hidir out/wx/imports  -fvia-C -package-name wx -iout/wx/imports

wx/src/Graphics/UI/WX/Types.hs:94:0:
    Bad interface file: out/wx/imports/Graphics/UI/WXCore/Types.hi
	Something is amiss; requested module  wx:Graphics.UI.WXCore.Types differs from name found in the interface file wxcore:Graphics.UI.WXCore.Types
make: *** [out/wx/imports/Graphics/UI/WX/Types.o] Error 1
}}}
=== 
</pre>
</div>
<div title="2006-11-28" modifier="Conal Elliott" modified="200611300105" created="200611282303" tags="2006-11 day">
<pre>* Lots of snow last night!
* wxHaskell:
** Found an [[explanation and solution| http://sequence.complete.org/node/214]] for the build problem I ran into yesterday.  I also saw some messages about patches to make wxHaskell compile under ghc-6.6.  Where?  Oh, of course: {{{http://darcs.haskell.org/wxhaskell}}}!
** darcs-got wxhaskell-0.10.1.  Compiling.
** Tried using {{{--prefix=c:/Haskell/packages}}}.  C++ compilation couldn't find lots of .h files.  Switched to {{{--prefix=/usr/local}}}, which works fine.
** {{{make install}}} failed, saying {{{out/wxc/ewxw_main.d:1: *** multiple target patterns.  Stop.}}}.  I moved those .d files out of the way (into a new &quot;d&quot; directory) and retried.  Same problem with {{{out/wxc/ewxw/*.d}}}, so I moved them, too.  Succeeded.
** Got instructions {{{Done with wxcore... Now please run make wx and make wx-install}}}.  Did these two steps.
* I want to use haddock for my code.  darcs-got the latest.  It looks to be cabal-ready.  Oops -- haddock requires alex, which requires happy.
* For executables (happy, alex, haddock), use {{{--prefix=c:}}}, which dumps the exes in {{{c:/Haskell/bin}}}.  Added that directory to my PATH.  All built &amp; installed fine.
* Re-built &amp; re-installed {{{monads}}} ({{{monadLib}}}) and {{{arrows}}} packages, configuring with {{{--prefix=c:}}}, for consistency with executables.
* Got Phooey cabal working, all the way through installation (including ghc-pkg)!  Now I can start filling in the code.
* Got through all of my new implementation.  All compiles, including examples.  +++[Won't load yet.]{{{Loading package wxcore-0.10.1 ... can't load .so/.DLL for: wxc-msw2.4.2-0.10.1 (addDLL: unknown error)}}}=== 
* Next: haddock.
* Emergence:
** Mel shared an exchange on the cnvc-trainers discussion group about some pain &amp; ideas around re-certification.
** Sandy suggested it would be an opportune time to share Emergence with them, which I was also thinking.  Mel offered to pass on a note to them
** I want discussion to be inclusive of people, whether or not cnvc has certified them, so I started a new yahoo group: [[emergence-of-nvc| http://groups.yahoo.com/group/emergence-of-nvc]].
** Wrote this note for Mel to pass on to the cnvc-trainers yahoo group.+++
Our local NVC network has been exploring an alternative to certification.  While there are still more details to iron out, there's considerable interest in our group at this point.  I expect to prototype this alternative locally and then offer it globally.

The full, evolving, collaborative plan is at http://emergence.awakeningcompassion.com.  To stimulate your curiosity, here is an excerpt:
&lt;&lt;&lt;
Our goal is to support learning, living, and sharing of NVC consciousness.  We see tremendous potential for growth, and so we want to create a system that nurtures that growth.  The main parts of the plan are as follows.
* Create a web-based matching system that helps connect people sharing and seeking NVC.
* Focus on supporting rather than evaluating.
* Create and nurture a learning community. 
* Enable rapid growth of NVC consciousness by replacing the top-down assessment bottleneck with self-supporting community feedback.
* Support the continuing evolution of the NVC process.
&lt;&lt;&lt;
This plan is evolving and I welcome feedback, so as to continue improving it to meet needs around sharing NVC as effectively and joyfully as possible.  To facilitate discussion, I've created a new discussion group: http://groups.yahoo.com/group/emergence-of-nvc, and I encourage you to participate.
=== 
** Tomorrow, make an entry on http://www.nvcwiki.com.

</pre>
</div>
<div title="2006-11-29" modifier="Conal Elliott" modified="200612010029" created="200611292058" tags="2006-11 day">
<pre>* [&gt;img[http://conal.net/Pan/Gallery/transparent/power-xorgon.png]]Emergence:
** Mel sent out my note to the cnvc-trainers group.  One new member of emergence-of-nvc.
** I want my email address on the new group to be conal@awakeningcompassion.com, so I set that up.
** Added my [[emergence logo / power design| http://conal.net/Pan/Gallery/xorgonRings/with-center/g.png]] (at right) to the [[emergence-of-nvc group page| http://groups.yahoo.com/group/emergence-of-nvc]].
** Added an Emergence link on the nvcwiki [[&quot;other wikis&quot; page| http://en.nvcwiki.com/index.php/Many_NVC_wikis]].
** Wrote a group welcome message.+++&gt;
Welcome to the emergence-of-nvc discussion group.

I set up this group to support inclusive, transparent, and creative conversation around new, more effective directions in supporting the learning, living, and sharing of NVC consciousness.  The name &quot;Emergence&quot; comes from study of self-organizing systems, as found in living organisms and collections of organisms.  Emergent systems use primarily bottom-up mechanisms rather than top-down control.  They are thus deeply in harmony with NVC's &quot;Power With&quot; orientation, and they use growth to support quality rather than placing quality and growth in opposition.

As a starting point for this conversation, I encourage you to read and respond to the notebook at http://emergence.awakeningcompassion.com.  In case you're unable to view that notebook, you can get a PDF version (perhaps without the latest changes) at http://emergence.awakeningcompassion.com/other/emergence.pdf.

Warm regards,
Conal Elliott
conal@awakeningcompassion.com
http://conal.net
http://awakeningcompassion.com
=== 
** Jeff Brown sent a reply to Mel's forward of my note pointing to Emergence.  I think he sent it to the cnvc-trainers group.  I responded, asking to shift the conversation to my new discussion group.+++&gt;
Thanks for the inquiries.  In discussing them, I want conversation to include folks with and without cnvc certification, so I'd like to redirect the conversation to an open forum.  Would you be willing to re-send your note to emergence-of-nvc@yahoogroups.com, and suggest to the cnvc-trainers group that they go there for discussion?
=== 
** From the Onion, here is [[another perspective| http://www.theonion.com/content/node/55807]] on integrity vs evolution.  I added a link in the Emergence site [[here| http://emergence.awakeningcompassion.com/#%5B%5Bevolution%20of%20the%20NVC%20process%5D%5D]].  I wonder whether it will amuse or annoy more.  Sandy loved the Onion article and sent a copy to psncc folks.
* Still frozen &amp; snowy &amp; lovely outside today.  Been having a peaceful &amp; pleasant day.  Holly's school is closed today, and we just finished watching Contact, a favorite movie for each of us.
* Wow -- [[fascinating web site| http://www.enchantedmind.com/html/science/creative_chaos.html]], quoted from [[this page| http://www.songsouponsea.com/Promenade/GnosisM.html]], which also quotes Mom.
* Got some help &amp; camaraderie on the #haskell irc chat room.  Solved the problem I had yesterday with running Phooey.  Added {{{/usr/local/lib}}} to {{{PATH}}} (not {{{LD_LIBRARY_PATH}}}).  Then found that my output strings are getting truncated to their first character.  lispy on #haskell and later Daan Leijen on IM suggested that it's a Unicode issue.  Tomorrow, ask for help on the wxhaskell-users list.
* Chatted with Daan on IM.  He helped me with darcs, darcs-server, and wxhaskell problems.  I got the latest darcs-server patches.  Tomorrow, grab a fresh darcs from http://glozer.net/darcs.  See if my &quot;plink&quot; warning message goes away.  Recompile darcs-client, and put the latest darcs-server onto Joseph's server.  Do something about giving darcs-server permission to write to my repository.  Give {{{darcs push}}} another go.
* More Emergence: I saw that Jeff Brown posted his note to the cnvc-trainers &amp; nvccertificationcandidates groups, I replied to the latter group, asking to move the conversation to emergence-of-nvc, so the conversation can include everyone.  Now the group has seven members.
* Last week, I finally ordered the [[head-mounted display| http://www.3dvisor.com]] I've been wanting for many months.  It was supposed to arrive today, and it got on the FedEx truck in Bothell just a few miles away, but I guess they had snow/ice trouble.  The tracking site says &quot;Delay beyond our control&quot; and back to the Bothell FedEx facility.  Curiously, the shipment originated in Issaquah, also nearby.  
* By the way, last night Holly &amp; heard Ze Frank (very funny [[video blogger| http://www.zefrank.com/theshow]]) pronounce Issaquah accenting the second syllable and pronouncing it &quot;saw&quot;, rather than the first and &quot;suh&quot; as we do here.  I wonder if Ze's pronunciation is closer to the native people's.
</pre>
</div>
<div title="2006-11-30" modifier="Conal Elliott" modified="200612010531" created="200611302232" tags="2006-11 day">
<pre>* Rebuilt wxWidgets with {{{--enable-unicode}}}.  Same problem.  Rebuilt with {{{--disable-unicode}}}.  Ditto.  Responded to Eric Kow &amp; wxhaskell-users group giving more info and asking for more help.
* Emergence:
** Connecting correspondence with Shulamit Day, who lives in Ottowa.  We shared some rants about certification and some dreams.
** Now 11 members in the yahoo group.  Two messages.  Messages from Susan Skye (CNVC Certification Coordinator for North and South America) and Jim Manske (member of CNVC Global Coordinating Committee and husband of CNVC acting executive director) that went to other groups and will hopefully end up on the new group.  I like &amp; respect Susan, and I want a clear &amp; caring connection with her in this discussion.
** Got help from Mel and from Jeff Brown in rerouting messages from cnvc-trainers to emergence-of-nvc.  I appreciate Jeff's spirit and carefulness in communicating.
** Added an emergence-of-nvc link on the nvcwiki [[&quot;Mailing lists&quot; page| http://en.nvcwiki.com/index.php/Mailing_lists]].
** Improved the group blurb.
** Wrote [[reply on the &quot;bottleneck&quot; on 2006-11-30]].</pre>
</div>
<div title="2006-12" modifier="Conal Elliott" modified="200701022050" created="200611011754" tags="2006 December month">
<pre></pre>
</div>
<div title="2006-12-01" modifier="Conal Elliott" modified="200612021911" created="200612011649" tags="2006-12 day">
<pre>* I learned that Scott Fahlman [[invented the smiley| http://research.microsoft.com/~mbj/Smiley/Joke_Thread.html]] {{{:-)}}} in a CMU online conversation, one year before I got to CMU.
* More activity on [[emergence-of-nvc|http://groups.yahoo.com/group/emergence-of-nvc]].  Now 18 members.
* Unpacked my new [[head-mounted display|http://www.3dvisor.com]].  Installed the software.  Works with my  Acer notebook and Samsung Q1, though not 3D stereo, since I have ATI rather than ~NVidia graphics.  The [[3dvisor forum| http://www.3dvisor.com/forum]] contains [[a thread| http://www.3dvisor.com/forum/viewtopic.php?t=96]] about a virtual desktop app that gives one a very large virtual desktop and look around with head motion.  [[Found| http://kolbysoft.googlepages.com/surroundsight]] on the author's [[web site| http://kolbysoft.googlepages.com]].
* Problem with the [[Emergence site|http://emergence.awakeningcompassion.com]].  The name server stopped resolving my subdomain name.  A week or so ago, I switched registrars for awakeningcompassion.com from yahoo to 1and1.com.  When I did that, I stayed with 1and1's name servers rather than using {{{NS1.TWISTED4LIFE.COM}}} and {{{NS2.DIGITALSPECTRUM.BIZ}}} as Joseph helped me select for conal.net.  My guess is that the 1and1 name servers won't default subdomains to the domain's IP, while the two from Joseph do.  I added the subdomain through the 1and1 interface, and the problem was fixed.  As an experiment, I also switched name servers for nvc-connection.net, to see if it will pass through unknown subdomains.  After the nameserver change propagates, try http://foodle.nvc-connection.net.  If I get &quot;bad gateway&quot;, I'll know it worked and that I want to change over other nameservers as well.
* Look back at my email about changing registrar from yahoo.  I wonder I need to cancel or I'll yahoo will charge me for another year.
</pre>
</div>
<div title="2006-12-02" modifier="Conal Elliott" modified="200612040258" created="200612021927" tags="2006-12 day">
<pre>* My nvc-connection.net subdomains are not yet getting forwarded, after the name server switch.  I started writing Joseph a note, when I realized that the changes might not have propagated to dns servers yet.  Try again later today and tomorrow.  Learn about how all this stuff works.
* Fixed my TW printing style sheets.  I had various sizes tuned to compensate for a funny non-standard setting in my browser.  Turned off header printing in my journal.
* Since installing the 3dvisor, my Q1 has had very unreliable internet access.  It connects to the local network fine, but not the internet.  Other computers on the local network aren't having this problem, even my notebook, where I've also installed the 3dvisor software.  Puzzled.  
** As an experiment, I removed the 3dvisor software from the Q1's startup list and rebooted.  Now I can view some sites and not others.
** Hm.  I don't think I have any kind of antivirus on the Q1.  Install Spybot and Clamwin.
** Coincidentally, ~IE7 installed, including some anti-malware software.  After installing &amp; rebooting, my internet access problems seem to have vanished.
* I think I understand how to make huge windows in [[FullSize|http://www.fanix.com/fullscreen.html]].  Use the &quot;free sizing&quot; feature (toggle on from control-right menu in a window), together with resizing.  Keep moving the window down &amp; right and resizing up &amp; left.  Tedious but workable.
* Playing with the 3dvisor and reading ~PDFs by moving my head around.  I can make the window taller than the screen (by using ~FullScreen), but then Acrobat Reader won't fill in content more than one screen height.  Look for another PDF reader.
</pre>
</div>
<div title="2006-12-03" modifier="Conal Elliott" modified="200612051810" created="200612040158" tags="2006-12 day">
<pre>* Heard back from Eric Kow that he uses wxWidgets-2.6.3 with ghc-6.6.  Got wxWidgets-2.6.3.
** {{{../configure --with-msw --disable-shared --with-opengl --enable-unicode}}}
** ...
* CSL this morning.  Holly sang bax.
* Lunch at Charlotte's restaurant.  Then visited with Charlotte during her long afternoon break.
* Apparently GIMP 2.2 can make ico files, handy as tiny web site logos.
* Trying [[Foxit Reader 2.0| http://www.foxitsoftware.com/pdf/rd_intro.php]] as an alternative to Adobe Acrobat Reader.  See if it will let me make really huge windows, for reading with the 3dvisor.  No.  It behaves the same way: the window can be very tall, but the content won't cover more than a screen height's portion of the window.  Odd!
</pre>
</div>
<div title="2006-12-04" modifier="Conal Elliott" modified="200612311633" created="200612041729" tags="2006-12 day">
<pre>* Emergence:
** Responded to Susan Skye.+++&gt;Hi Susan,

I appreciate your inquiry, as I value clarity highly.  Since I want an open conversation, the cnvc-trainers list isn't the best fit for me to have the discussion.  Secondly, it would be inconvenient for me, since I'm not allowed access to the cnvc-trainers e-group.  Rather than my forwarding messages to you and others, you might instead visit the new group (http://groups.yahoo.com/group/emergence-of-nvc) and read messages without having to join.  If you want to post a reply or have the convenience of messages coming to you, it's quite easy to join (open to all, with no approval process).  Also, temporarily, at least, Dominic has offered to cross-post to cnvc-trainers.  Do these options work for you?

Warmly,  - Conal=== 
** Replied to Shulamit
* Phooey:
** Rebuilding wxHaskell to work with wxWidgets-2.6.3.  Loads of error messages.  Report &amp; query to wxHaskell-users list.
** Learning to use haddock, to generate library documentation.  haddock couldn't find my base library documentation.  Asked for help on #haskell chat, then on the haskell list.
* 3dvisor:
** Registered on the 3dvisor forum site.  Posted [[a note| http://www.3dvisor.com/forum/viewtopic.php?t=656]] asking about the status of ~SurroundSight Virtual Desktop and whether I could get the source code to hack on.
** Thinking about how to read documents with the visor.  I can visually scan some amount of text with ~SurroundSight, but I still want a way to move to the next page.  The visor picks up [[yaw, pitch and roll| http://www.egms.de/figures/journals/cto/2005-4/cto000011.f2.png]] ([[see also| http://liftoff.msfc.nasa.gov/academy/rocket_sci/shuttle/attitude/pyr.html]]).  Use yaw &amp; pitch for 2D scanning and roll for page turning.  Tilting the right ear to the right shoulder steps to the next page, while tilting the left ear to the left shoulder steps to the previous page.  Let the user tune the angle threshold that signifies a page turn.
* [[TiddlyWiki for the rest of us| http://www.giffmex.org/twfortherestofus.html]] (&quot;You will never find an easier entry-level TiddlyWiki instruction manual than this!&quot;)
</pre>
</div>
<div title="2006-12-05" modifier="Conal Elliott" modified="200612052215" created="200612051630" tags="2006-12 day">
<pre>* Idea: [[safe &amp; efficient internet computing]]
* 3dvisor: continued [[disucssion| http://www.3dvisor.com/forum/viewtopic.php?t=656]] of ~SurroundSight.
* Phooey: 
** Working with haddock.  Got help from Simon Marlow in response to yesterday's note.  In ghc-6.6's {{{package.conf}}}, replace {{{$topdir\\html}}} with {{{c:\\ghc\\ghc-6.6\\doc\\html}}}.  Fix expected in ghc-6.6.1.  +++^[Haddock'd]{{{runhaskell Setup.hs haddock}}}=== packages: monads, arrows
** Stopped resisting the Windows defaults for cabal &amp; haddock.  Now do {{{runhaskell Setup.hs configure}}} with //no arguments//.
** Oh, rats.  That doesn't work out either.  When haddock'ing Phooey, I get +++[this.]
{{{
Warning: cannot use package arrows-0.2:
   HTML directory &quot;C:\\Program Files\\Common Files\\arrows-0.2\\doc\\html&quot; does not exist.
}}}
===  I sent in a query to the haskell list.  Here is the +++[winning incantation.]
{{{
runhaskell Setup.hs configure --datadir=c:/Haskell/packages --prefix=c:/Haskell/packages
}}}
===  Then {{{runhaskell Setup.hs}}} with {{{build}}}, {{{haddock}}}, and {{{install}}}.
** Haddock doesn't recognize the latest ghc syntax, including infix type constructors and (worse) arrow notation.  For now, I've switched the infix and am not haddock'ing the examples (with arrow notation).  This problem is well-known.  The fix will apparently be to &quot;use the GHC API which obviously can parse all the syntactic extensions.&quot;

To do:
* Reply to Shulamit's note on the nvc-emergence group.
</pre>
</div>
<div title="2006-12-06" modifier="Conal Elliott" modified="200612070043" created="200612061707" tags="2006-12 day">
<pre>* wxWidgets &amp; wxHaskell:
** Rebuilding wxWidgets-2.6.3, this time dropping the {{{--with-msw}}}.  (Inspired from a post [[here| http://blog.gmane.org/gmane.comp.lib.wxwindows.general/day=20041207]].)  New config command: {{{../configure --disable-shared --with-opengl --enable-unicode}}} .
** Noticed in configure output: {{{checking for --enable-prologio... no}}}.  The first error message when compiling wxHaskell says {{{&quot;wxUSE_PROLOGIO must be defined&quot;}}}.  If after recompiling wxWidgets and then wxHaskell, I still get the {{{wxUSE_PROLOGIO}}} error, then rebuild wxWidgets with {{{--enable-prologio}}}.
** Sure enough, I still get the {{{wxUSE_PROLOGIO}}} error,  Rebuilding wxWidgets with {{{--enable-prologio}}}, I get +++[this error.]{{{configure: error: wxExpr and old-style resources are now available in contrib only}}}===   I don't know what else to try.
** Oh -- I think the wxHaskell build is finding the old wxWidgets (2.4).   The error message references {{{c:/cygwin/usr/local/include/wx/}}}, which is older than {{{wx-2.6}}} in the same directory.  I renamed wx to wx-2.4 to avoid this accident and recompiled.  Now wxHaskell is compiling.  Sent wxHaskell-users +++[message.]&gt;The compilation problem below seems to have been that my wxHaskell compile was picking up my old wxWidgets-2.4 include files rather than the new 2.6.3 ones.  Looking in /usr/local/include, I saw wx/ and wx-2.6.  Although the wxHaskell compilations explicitly ref'd include/wx-2.6, the error messages below ref'd include/wx, I fixed the problem by renaming include/wx to include/wx-2.4 and recompiling wxHaskell.=== Also mentioned the &quot;multiple target patterns&quot; problem and the {{{-fPIC}}} compiler warnings.
** The working configurations:
*** wxWidgets-2.6.3: {{{../configure --disable-shared --with-opengl --enable-unicode}}}
*** wxHaskell-0.10.1: {{{./configure --prefix=/usr/local --with-opengl}}}
** Success!  Now I have wxHaskell-0.10.1 and wxWidgets-2.6.3 working together with unicode, and no more truncated strings.
** One more thing to remember in building wxHaskell: build the documentation.  I don't know how to get the docs registered so they're picked up by haddock for libraries that //use// wxHaskell (like Phooey).  As a hack-around, I edited the wxcore and wx entries in ghc's {{{package.conf}}} +++[like so.]
{{{
haddockInterfaces = [&quot;c:/Haskell/wxhaskell/out/doc/wxhaskell.haddock&quot;], 
haddockHTMLs = [&quot;c:/Haskell/wxhaskell/out/doc&quot;]
}}}
=== 
** To file wxHaskell bug reports, see the [[project page| http://sourceforge.net/projects/wxhaskell]].
* Phooey:
** Asked Simon Marlow for a darcs.haskell.org account.  Sent him my public {{{id_dsa.pub}}}.  I'll place my projects there, since people already look there and it's presumably set up well or could be for things like darcs-server.
** All of my Phooey modules are haddock-commented.
** My dynamically-bounded slider example (ui2) crashes.  Odd!
* Read [[blog entry| http://therning.org/magnus/archives/228]] with a program for recursive directory listing.  I'd like it to be simpler and have the IO bits more separated.  Playing in {{{~/Misc/ListFiles.hs}}}.  For one thing, I'd like to separate out the tree structure from the linearization &amp; path concatenation.  Use rose trees {{{Data.Tree}}}.
* Men's group: Matthias called to check in.  I told him that I'm starting the men's group we talked about.  He's excited about it.  Include him ({{{m8p.kai@gmail.com}}}) in my email about it.  Called and left message with Pan.
</pre>
</div>
<div title="2006-12-07" modifier="Conal Elliott" modified="200612080546" created="200612071755" tags="2006-12 day">
<pre>* Phooey:
** Submitted wxHaskell [[bug report| http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1610984&amp;group_id=73133&amp;atid=536845]] (process dies on second {{{start}}}).  Also sent to wxHaskell-users with query.  Heard from Jeremy O'Donoghue that this is a known problem with wxWidgets-2.6.3.+++&gt;
There //is// a workaround for this: use wxWidgets 2.4.2 or earlier, which have a different allocation/deallocation strategy. This is why we continue to support wxWidgets 2.4.2.===  This may be a serious problem for me.
** Pondering library organization.  I made {{{Graphics.UI.Phooey}}} re-export most of {{{Graphics.UI.Phooey.UI}}}, while hiding the representation.
** Renamed module UIM to ~MonadicUI and UI to ~ArrowUI.
** Lots of haddock documentation, including a longish friendly intro in Phooey.hs.
** Lots of flailing around with darcs &amp; ssh.  My files &amp; directories are getting created so that they're unreadable or unsearchable by &quot;group&quot; and &quot;other&quot;.  That messes up use on the server.  Tomorrow check into UMASK.
* Can I implement Eros on Phooey?  Maybe just the visualization part of Eros.
</pre>
</div>
<div title="2006-12-08" modifier="Conal Elliott" modified="200612090433" created="200612090125">
<pre>* Discovery: Emacs ispell-minor-mode is causing the funny behavior I get at the start of text buffers when I hit space or enter after non-alphabetic characters.  Both keys are bound to ispell-minor-check.  To do: look for a newer ispell.
* MSA members get 12% [[discounts on Dell computers| http://whatcounts.com/t?r=1374&amp;c=731025&amp;l=34283&amp;ctl=15381FE:D17492C51C91D73DED0EA8EC1A0E58CFA04380EFC0D89E1E]]
* Replied to Louise Taylor, a student in the UK who asked about some of my Pan imagery.
* ssh issues
** Heard from Simon Marlow that the &quot;Patch bundle failed hash&quot; bug is known, and &quot;The one known workaround is to use the SSH that comes with MSYS and set CYGWIN=binmode.&quot;  I also sent Daan a note asking about his experience, since he uses darcs with servers, from Windows.
** Downloaded [[msys-1.0.10|http://www.mingw.org/download.shtml]].  Doesn't contain an ssh.   Asked Simon Marlow.
** Trying [[PuTTY|http://www.chiark.greenend.org.uk/~sgtatham/putty]].
* Playing with adding glow to my power design.
| [img[http://conal.net/Pan/Gallery/transparent/m-glow-inv-150.png]] | [img[http://conal.net/Pan/Gallery/transparent/m-glow-150.png]] | [img[http://conal.net/Pan/Gallery/transparent/z1.png]] |
* Response to Henry Wai on what I hope the yahoo group will achieve.+++&gt;
Hi Henry.
I like your question, as thinking about it has given me more clarity.  I've amended the group description.
I hope to achieve:
* well-grounded clarity about needs met and needs unmet by cnvc certification, to make it more likely that needs currently falling through the cracks are more likely to get addressed;
* seed collaboration on creating new means of meeting those needs;
* confirmation and/or redirection for my [[Emergence plan| http://emergence.awakeningcompassion.com]], so that it will support people's needs for learning, growth, community, and contribution as well as possible;
* learn whether top-down quality control strategies like certification do indeed thwart growth, as I and some others have suggested and still others have questioned; and
* encouragement &amp; community for myself and others sharing nvc.
As for how the group might achieve these goals:
* Through discussion of support quite different from what cnvc has been offering, people can get a new sense of possibilities and choice.
* As people share their personal goals behind their choice to pursue cnvc certification, especially in the light of other possible strategies, the underlying needs can become clearer and more room for separating those needs from the current certification strategy.
* Discuss the &quot;bottleneck&quot; issue for a reality check.
=== 
</pre>
</div>
<div title="2006-12-09" modifier="Conal Elliott" created="200612100629" tags="2006-12 day">
<pre>* Correspondence with Patrick Mulder, who asked me about running Fran.  Yesterday I updated the Fran page to say that Fran no longer runs and to invite collaboration on the topic.  Patrick has been using Pan# (Yale C# variation of Pan).
* Re-reading [[How to write a Haskell program| http://haskell.org/haskellwiki/How_to_write_a_Haskell_program]].  It's easy to set up darcs to run ~QuickCheck tests at each commit.  Apparently, the commit only happens if the tests all succeed.  Neat!
</pre>
</div>
<div title="2006-12-10" modifier="Conal Elliott" modified="200612110513" created="200612110511" tags="2006-12 day">
<pre>* Phone chat with Jake.  I enjoyed catching up.
* To make a release, do e.g., {{{darcs dist -d phooey-0.0}}}, which makes {{{phooey-0.0.tar.gz}}}.  Also tag via {{{darcs tag 0.0}}}.
* Try again using wxWidgets 2.4.2 instead of 2.6.3, so I can use wxHaskell (and therefore Phooey) with ghci.  See [[2006-12-07]].
** Went back to {{{c:/wxWindows-2.4.2/mybuild/}}} and did {{{make install}}}.  Note: created {{{c:/cygwin/usr/local/include/wx/}}}, as mentioned on [[2006-12-06]].
** Recompiling wxHaskell:
*** Do I have to recompile wxHaskell?  Try first without.  Crash.
** Configure then {{{make}}}, without {{{make clean}}}.  Lots of linker errors.
*** {{{make clean}}} then {{{make}}}.  I had the problem with {{{popupwin.h}}} mentioned on the [[wxHaskell build page| http://wxhaskell.sourceforge.net/building.html]].  Copied as recommended.  Started over with clean build.
*** Now I'm back to the problem of truncating my strings to one character.
*** Reconfigure and recompile wxWidgets 2.4.2, using config line from [[2006-12-06]].  Same problem.  Also rebuilding wxHaskell.  Long wait ....  Truncation.
*** Start all over with building wxWidgets 2.4.2, starting fresher.  Not just a &quot;make clean&quot;, but remove the contents of mybuild to make sure nothing old was hanging around.  Configured, built, and installed.  Everything works!  Full, untruncated strings.  Multiple starts in ghci.  And I prefer the visual style of sliders in 2.4.2 over 2.6.3.
* Return to the Phooey paper?  Two main contributions:
** The interface design
** Systematic development of the implementation by deconstruction imperative GUI programs.
* A while back, I changed my emacs ~LaTeX mode to use longlines minor mode.  Works fine in a pure ~LaTeX file, but not in a literate Haskell script with parts in Haskell mode and parts in ~LaTeX mode (mixed via mmm-mode).  If I save the file and then load it, I see hard line breaks.  I verified that the lines get saved long.  For now, I commented out the {{{longlines-mode}}} line in my {{{tex-mode-hook-function}}}, with the intention of doing it manually when I edit.  Or a magic comment that gets executed by emacs.  Found +++[a working incantation.]
{{{
%% Local Variables:
%% eval:(longlines-mode)
%% End:
}}}
===  Maybe I'd better just not use longlines-mode here, since it may hinder collaboration.  Hm.
</pre>
</div>
<div title="2006-12-11" modifier="Conal Elliott" modified="200612120723" created="200612102252" tags="2006-12 day">
<pre>* Don Stewart posted a [[blog entry| http://cgi.cse.unsw.edu.au/~dons/blog/2006/12/11#release-a-library-today]] that &quot;describes the entire process of writing, packaging and releasing a new Haskell library.&quot;  It's mainly a shell transcript.
* In a reply to Roger, I wrote a note with [[comments on the word &quot;trainer&quot;]].
* Simon M pointed me to msys-DTK, which has the msys version of ssh he uses.  See [[2006-12-08]].  I installed it and uninstalled cygwin's openssh.  Now, finally, I can {{{darcs put}}} and {{{darcs push}}} to {{{darcs.haskell.org}}}.  Works great as long as I don't use {{{darcs amend-record}}}.
* Finished my Phooey-0.0 release!  Sent out [[phooey-0.0 release note]].
</pre>
</div>
<div title="2006-12-12" modifier="Conal Elliott" modified="200612130129" created="200612121633" tags="2006-12 day">
<pre>* Caught up on http://planet.haskell.org reading.
* Phooey:
** Appeared in [[today's Haskell Weekly News| http://sequence.complete.org/hwn/20061212]].  Good timing!
** Added to the [[GUI libraries| http://haskell.org/haskellwiki/?title=Libraries_and_tools/GUI_libraries]] page of haskell.org.
** Got some queries on the haskell mailing list:
*** Antony Courtney asked how Phooey is like or unlike Yampa.  (I wonder why Yampa and not Fruit.  Maybe modesty.)  Also, asked about &quot;dynamic collections&quot;, an old Fruit issue.
*** Brian Hulley asked what I mean by inversion of logical dependencies in imperative UI programs.  Also about implementation efficiency and evaluation strategy.  He suggested that laziness may make efficiency easy.  I think he's right.  He also suggested an +++[example for the paper.]&gt;
If you're still thinking of examples for your paper it would also be really great to see how you'd create a widget that displays the result of another process (eg a window that displays the output as ghc compiles a program) or some other example of how to use the IO monad inside a widget for those unfamiliar with combining arrows with monads.=== 
** Working on the Phooey paper.
</pre>
</div>
<div title="2006-12-13" modifier="Conal Elliott" modified="200612141729" created="200612130234" tags="2006-12 day">
<pre>* Stumbled on [[TimeToMeet| http://www.timetomeet.info]], a free, web-based meeting scheduler, which I've been wanting for setting up the men's group.  I couldn't remember where I'd seen such a thing, when I looked yesterday.  I found it quite synchronistically today, in tracing back links to Phooey as reported by statcounter.
* Yoiks!  I got blog-spammed.  One of my blog entries got five spam comments.  I turned on &quot;word verification&quot;, which asks a commenter to read and enter a word.  Alternatively, I could turn on &quot;comment moderation&quot;, which notifies me of comments and won't post them until I give the okay. Moderation might be more convenient for commenters, but I'd still have to deal with spam.  In the process, I upgraded my blog to the new [[Blogger beta| http://beta.blogger.com]].
* Phooey:
** Doaitse Swierstra pointed out the my Phooey docs have some references to other library docs on my local machine.  I don't know how to fix the problem, so I sent a query to libraries@haskell.org.
** Read and replied to a note from Steve Schafer.  He suggested that push-vs-pull is more the crux of the &quot;dependency inversion&quot; issue.  I like the clarity of this dialog and want to improve the paper accordingly.
** After looking at the apache log analysis (awstat), I updated the statcounter to offset my late creation.  I had 892 Phooey visits yesterday, having sent my announcement at 11:15pm on the previous night.  Jeepers!
* More on web stats:
** I want to get all of my server log info analyzed and graphed.  It takes a long time, with the monthly logs (and running in Perl).  Set up regular, incremental analysis to run nightly.
** Made some helpful aliases for manual analysis, like {{{awupdate phooey}}} and {{{aw}}} (for {{{awupdate conal}}}).
** I don't know how to specify the log file from my awstats config file.  Log files have names like {{{access_log.2006-11-18}}}.  They roll over every 30 days.  For now, just edit {{{/etc/awstats/awstats.conal.conf}}} after each roll-over.  There has to be a better way.
** Got web-based dynamic invocation going.  Visit http://awstats.conal.net to see results of the last analysis.
** Enabled web-based //update//.  See the &quot;update now&quot; button on the [[stats page| http://awstats.conal.net]].
** I made {{{awstats.phooey.conf}}} that greps through my log file for &quot;phooey&quot;.  It has to grep through the whole thing, so it's pretty slow.
** Found [[Analog| http://www.analog.cx]], billed as &quot;The most popular logfile analyser in the world&quot;, and reportedly darn fast (implemented in C -- &quot;56 million logfile lines in 35 minutes on a 266MHz chip&quot;).  I don't see incremental analysis.
</pre>
</div>
<div title="2006-12-14" modifier="Conal Elliott" created="200612150303" tags="2006-12 day">
<pre>* Web statistics: Cranking through old logs.  I hope I'm not impacting Joseph's server noticeably.  It doesn't work reliably when I process the log files in //reverse// chrono order, so I'm going forward.
* Thoughts on  [[Eros| http://conal.net/papers/Eros]]:
** It keeps logic and UI //together and separable//.
** Maybe release it in stages:
*** Visualization of pure values.
*** Add programmatic composition, via the Eros algebra.
*** Add gestural composition.
** I want to layer Eros neatly on top of Phooey.  Probably doable without gestural composition.  With?
</pre>
</div>
<div title="2006-12-15" modifier="Conal Elliott" modified="200612160555" created="200612160512" tags="2006-12 day">
<pre>* There was a major wind and rain storm last night. The power went out and came back on only this evening.  The news said a million people in western Washington were without power.  This morning, Holly &amp; I found that there was power in Shoreline (adjacent to Lake Forest Park), so we had lunch at Sunni's and then went to Hotwire to use our computers.  We've been making Christmas presents, and I'm excited about what we're coming up with.
* This morning, I started thinking about how to recreate Eros on top of Phooey.  I'm still noodling it through, but I expect it will come out very elegantly.
* My files are all read-protected from others.  Some are read-write-protected from me.  Some have funny owners.  +++[Fixed.]
{{{
chmod -R u+rwX .
chmod -R og+r .
chown -R Conal .
chgrp -R None .
}}}
The capital X means &quot;execute only if the file is a directory or already has execute  permission&quot;.===  Unfortunately, new files that I create through Windows still come out as readable only by me.  I don't know why.  Reading up on [[permissions &amp; security for ~WinXP| http://support.microsoft.com/kb/308418]].+++&gt;
''Windows XP Home Edition''

Start in safe mode, and then log in as Administrator or as Administrative User. The Security tab is available for files or folders on NTFS volumes.

''Notes:''
* The Everyone group does not include the Anonymous Logon permission.
* You can set permissions only on drives that are formatted to use NTFS.
* To change permissions, you must be the owner or have the owner's permissions to change permissions.
* Groups or users that are granted Full Control permissions for a folder may delete files and subfolders in that folder, regardless of the permissions that protect the files and subfolders.
* If the check boxes in the ''Permissions for //user or group//'' box are unavailable, or if the ''Remove'' button is unavailable, the file or folder has inherited permissions from the parent folder. For more information about how inheritance affects files and folders, see Windows Help.
* By default, when you add a new user or group, the user or group has permissions for Read and Execute, List Folder Contents, and Read.
=== 
</pre>
</div>
<div title="2006-12-16" modifier="Conal Elliott" modified="200612172052" created="200612162116" tags="2006-12 day">
<pre>* Web statistics:
** Made an index page at http://awstats.conal.net, which redirects to http://conal.net/stats.html.
** I want to set up murraycreek.net.  The format got changed from &quot;common&quot; to &quot;combined&quot; on March 2, 2005.  I'll have to split the access log into two pieces and process them separately.  Process the old logs, too.  And clc press.
** Here's what I like about awstats, compared with statcounter:
*** it doesn't require anything on the individual web pages;
*** it catches absolutely all domain activity;
*** it keeps bazillions of detailed records (for free), not just the last hundred;
*** it shows old web traffic stats as well as new; and
*** it doesn't slow down visitors.
** See [[2006-12-17]] for down side.
</pre>
</div>
<div title="2006-12-17" modifier="Conal Elliott" created="200612190556" tags="2006-12 day">
<pre>* Spent most of the day making Christmas presents.  Since this journal is online, I won't say just yet what the presents are.
* Started working on my new implementation of Eros on Phooey.  I'm calling the new library &quot;TV&quot; for &quot;Tangible Values&quot; (Sean Seefried's suggested replacement for &quot;concrete values&quot;).  I'm happy with this layering approach, as a way to make Eros easier to work with and understand.  More exposed layers also gives me more points of contact with other people.
</pre>
</div>
<div title="2006-12-18" modifier="Conal Elliott" modified="200612190645" created="200612190556" tags="2006-12 day">
<pre>* We got California Christmas presents finished and mailed off.
* TV (Tangible Values):
** Implemented the conversion from //Output a// to //UI a ()//.  Very simple, which speaks well of my chosen abstractions.
** Noodling out this conversion lead me to realize that my //UI// arrow can be used in a style that mixes UI &amp; functionality or keeps them separate.  I can always take the separate style (//ui :: UI a ()//) and mix them (//pure (const a) &gt;&gt;&gt; ui :: UI () ()//).
** My first few simple examples work great.
** Formatting problem:
** Added some [[darcs tips]].</pre>
</div>
<div title="2006-12-19" modifier="Conal Elliott" modified="200612200713" created="200612200405" tags="2006-12 day">
<pre>* Thoughts on Tangible Values, etc:
** See thoughts on [[separating IO from logic]].
** The TV approach uses ~UIs as a means of visualizing pure (functional) values.  How far can we take this idea?  Can we view //all// ~UIs as visualizations of pure values separable from the UI specification?  Sounds fun to pursue.  Given a program with a UI, ask //what is the type// of the value being visualized?
** I parameterized my //Output// and //TV// type constructors over the underlying arrow (e.g., //UI//).  Make another example as well for //Kleisli// arrows.
* Idea: implement readFile and writeFile in terms of a primitive that uses an efficient packed representation, such as byte-strings.  Layer conversion to &amp; from standard (inefficient) strings to implement the current readFile &amp; writeFile.  Have fusion do the rest.
</pre>
</div>
<div title="2006-12-20" modifier="Conal Elliott" modified="200612210249" created="200612200740" tags="2006-12 day">
<pre>* TV:
** Added support for Kleisli arrows and IO in particular.  +++[Examples:]
{{{
type KIO = Kleisli IO

interactO :: Output KIO (String -&gt; String)
interactO = oLambda (kIn getContents) (kOut putStr)

io1 :: TV KIO String
io1 = tv (kOut putStrLn) &quot;Hello World!&quot;

io2 :: TV KIO (String -&gt; String)
io2 = tv interactO reverse

testO :: Output KIO (String -&gt; String)
testO = oLambda (kIn (readFile &quot;test.txt&quot;)) (kOut putStr)

onLines f = unlines.f.lines
onWords f = unwords.f.words

perLine f = onLines (map f)
perWord f = onWords (map f)

--  :: TV KIO (String -&gt; String)

io3 = tv testO (onLines reverse)
io4 = tv testO (onWords reverse)
io5 = tv testO (perLine (onWords reverse))

io3' = tv testO (perLine reverse)
io4' = tv testO (perWord reverse)
io5' = tv testO (perLine (perWord reverse))
}}}
=== 
** Think about new name, since the project is more general than &quot;tangible values&quot;.
* Operations that combine input &amp; output don't seem to fit very well into the //TV// style.  For instance, //readFile// can have a file name determined dynamically.  Similarly for sliders with dynamic bounds.
* Added text input to Phooey.  Bumped version number to 0.1.  Remember to record and push and &quot;make webdoc&quot; before I announce TV.
* Web server log file analysis:
** Project idea: fancy &amp; efficient [[Haskell-based web server log analyzer]].
** For friendlier web stats, use [[logresolve| http://httpd.apache.org/docs/2.0/programs/logresolve.html]] to do reverse DNS lookup.  It does its own caching.+++&gt;logresolve is a post-processing program to resolve IP-addresses in Apache's access logfiles. To minimize impact on your nameserver, logresolve has its very own internal hash-table cache. This means that each IP number will only be looked up the first time it is found in the log file.===  Tested on my 2006-12-18 log file (recently started, only 98k).  Canceled after a long wait.  Tried the first thousand lines, which took a good while.  I think this version of logresolve (found on Joseph's server) does only //transient// caching, while version 2.0 does //persistent// 
* Read article [[Crossing borders: JavaScript's language features| http://www-128.ibm.com/developerworks/java/library/j-cb12196/?ca=dgr-lnxw01Javascript-Respect]].  Focuses on higher-order functions and ~JavaScript's prototype-based object mode.
* Helping Sandy redirect the new web site.
* Wrote up some thoughts on releasing [[Pajama]] as an open source software project.
</pre>
</div>
<div title="2006-12-21" modifier="Conal Elliott" modified="200612220214" created="200612212227" tags="2006-12 day">
<pre>* TV:
** Thinking about how to define Input as a functor and Output as a co-functor, so I can conveniently fmap &amp; cofmap.  ''Problem'': suppose I have a pair-valued output, and then I fmap a function over the pair output.  The resulting output may have a non-pair type.  I've been thinking that fmap would have //no visible effect// (on the UI), which means that the user would still expect to be able to apply a function to a //part// of the pair-value output.  Denotationally, however, the pair is gone and generally unrecoverable.  This problem comes not just from pairs, and would happen in any fmap, since the type and the appearance are out of sync.  ''Idea'': render an fmap with a single output handle and suppress all output handles in the inner output.  Perhaps add some kind of decoration as well.  In terms of composition, the fmap is treated a primitive.
** Now generalize functor/co-functor to //arrow// and fmap/cofmap to right &amp; left composition with an arrow (possibly but not necessarily //pure//).
** Examples:
*** Convert string input or output to value input or output via //fmap read// or //cofmap show//.
*** Reading a dynamically named file.  Get the name with a name input, and then compose with //Kleisli readFile// to get a contents input.
*** Dynamically bounded sliders.  Get the bounds with an input, and compose with the dynamic slider UI (arrow) to get a value input.  (More realistically, the dynamic bounds would be wired into a single compact &amp; friendly widget.)
** The dynamically bounded slider example reminds me of dependent types.
** Combining arrows, like UI &amp; KIO, for file reading in a GUI app.
* Learn about XUL, which may be useful with Pajama.
** [[Wikipedia entry|http://en.wikipedia.org/wiki/XUL]]: &quot;XUL (pronounced zool ([zu:l])), the XML User Interface Language, is an XML user interface markup language developed by the Mozilla project.&quot;
** [[Firefox add-ons|https://addons.mozilla.org/search.php?cat=2]]
** [[Google search|http://www.google.com/search?q=xul]] yields many references.
* Also learn about [[Twisted| http://twistedmatrix.com]].  &quot;Twisted is a networking engine written in Python, supporting numerous protocols. It contains a web server, numerous chat clients, chat servers, mail servers, and more.&quot;
* Trying out Joseph's http://kyte.tv.  See [[kyte notes]].  Sent in feedback.  Made a channel and a show.  See the [[functional graphics channel]].
</pre>
</div>
<div title="2006-12-22" modifier="Conal Elliott" modified="200612222140" created="200612221531" tags="2006-12 day">
<pre>* Holly's birthday!
* Wrote up some thoughts on an [[community NVC blog]].  Sent a reply to Roger's note.
* Web server stuff:
** Joseph gave me the go-ahead to turn on reverse DNS lookup for my domains.  He doesn't think it'll make much server impact.  It was easy: just add {{{HostnameLookups on}}} in the virtual host section of the apache config.  I'm running logresolve over some of my old log files to get names and will then rerun awstats.
** Got murraycreek.net and clcpress.com awstats going.  In each case, I split up the log file in two, as it started with common format and then went to combined.  Processed part separately.  I also turned on name lookup for future accesses.
** Refactored my config files.  Now //much// easier to manage.
** Cleaned up emergence logs.  Moved out logs for journal and gtd redirections.  Gee -- server logs are not very informative for a ziddlywiki.  The contents get downloaded all at once, so I can't tell what is actually viewed.  With microcontent, I'd especially like more info.
</pre>
</div>
<div title="2006-12-23" modifier="Conal Elliott" modified="200701052041" created="200612240604" tags="2006-12 day">
<pre>* I want to change how log files are kept.  Log rotation and awstats collection don't work well together, since the newest log file has an unpredictable name.  Oh -- maybe it is predictable.  What about listing them all, sorting by date, and taking the most recent.  The following line ought to do it:  {{{cat `ls -t access_log.* | head -1`}}}.
* Got an inquiry comment on my blog about Eros.  I want to get it running again.  Found that hs-plugins isn't compiling with my ghc-6.6.  Sent dons a note.
* Great TV progress.  Added arrow-composition constructors to Input and Output.+++
\begin{code}
iCompose :: Input arr a -&gt; arr a b -&gt; Input arr b
oCompose :: arr a b -&gt; Output arr b -&gt; Output arr a
\end{code}
===  Made &quot;pure&quot; versions for fmap and cofmap.+++
\begin{code}
instance Arrow arr =&gt; Functor (Input arr) where
  fmap f input = input `iCompose` pure f

instance Arrow arr =&gt; Cofunctor (Output arr) where
  cofmap f input = pure f `oCompose` input
\end{code}
===  Very elegant examples.  Next, edit [[separating IO from logic]] to be consistent.
</pre>
</div>
<div title="2006-12-24" modifier="Conal Elliott" modified="200612311644" created="200612242140" tags="2006-12 day">
<pre>* TiddlyWiki:
** Discovered that I can copy &amp; paste from the html rendering of a TiddlyWiki into the html editing view of a blogger post, with formatting mostly intact.  Cool!
** CSS tweaking.  Changed margins for {{{.viewer pre}}} in StyleSheet, so I won't have to indent my code.  Also tweaked the button margins &amp; padding.
** Hmm.  The previous two points don't work well together.  If I leave TW CSS to do my indentation and paste into a blogger post, I'll lose the indentation.  Oh!  Unless I tweak my blogger formatting.  Yes.  But then there's gmail, and I don't know how to tweak my own CSS.  Maybe by stashing away some bits and pasting them in also.
** When I put a code display into a bullet item, it doesn't get indented, since it's specified as its own paragraph.  Trick: wrap with {{{++++}}} and {{{===}}}, which makes a &quot;slider&quot; that's initially open.++++
{{{
like such
}}}
===  As a nice side-benefit, the reader can collapse the code display.
** Added [[syntax highlighting for Haskell|SyntaxifyPlugin: Haskell]].
* Cancelled my Yahoo registration plan for awakeningcompassion.com.  I'd transferred to 1&amp;1 last month.
</pre>
</div>
<div title="2006-12-25" modifier="Conal Elliott" modified="200612282241" created="200612251437" tags="2006-12 day">
<pre>* Reading Simon PJ's &quot;[[Beautiful Concurrency| http://haskell.org/haskellwiki/Talk:SantaClausProblem]]&quot; article.  That link is a &quot;wiki talk page&quot;.  What a great idea!  I want a feedback page for everything I write, starting with drafts.  Got inspired with some ideas on a [[feedback system for writing]].
* Edited [[syntax rules for Haskell]] tiddler to try out a new style of writing using &quot;nested sliders&quot; (from NestedSlidersPlugin).
* In some context in Firefox, the //home// key switches to the first tab, and //control-home// moves the current tab to the first position.  What was that context?
* Ran across [[Sapir-Whorf and Programming Languages| http://www.cs.utexas.edu/~danb/courses/fa05/sapir-whorf/wiki]] -- a TW about a [[democratic college| http://demtexonline.com]] course.  (&quot;... to provide students with the opportunity to engage in democratic, egalitarian classes. Our classes are student designed and run.&quot;)
* TV:
** Maybe I could define some ~TVs that work for both IO and GUI.  Define a class of arrow types that provide some general utilities.+++
{{haskell{
promptString  :: String -&gt; arr () String
displayString :: arr String ()
}}}
===  Then define &quot;show&quot; versions in terms of these ones and {{{Input}}} &amp; {{{Output}}} versions of all four.
** Works great.  Now most of my TV examples run both terminal-style and GUI.
** Lovely type factoring for these multi-use examples.+++
{{haskell{
-- | For operations over all 'CommonInsOuts' arrows.
type Common f a = forall arr. CommonInsOuts arr =&gt; f arr a
-- | Inputs that work over all 'CommonInsOuts' arrows.
type CInput a = Common Input a
-- | Outputs that work over all 'CommonInsOuts' arrows.
type COutput a = Common Output a
}}}=== 
* Developed a spiral clock picture.+++
Make a row of white disks.+++
{{demoImg{
[img[http://conal.net/images/clocks/spiral-how/linear-disks.png]]}}}===  Add numbers.+++
{{demoImg{
[img[http://conal.net/images/clocks/spiral-how/linear-numbered-disks.png]]}}}===  Repeat horizontally and carefully arrange in spiral, so that a complete set of twelve disks makes it exactly around.+++
{{demoImg{
[img[http://conal.net/images/clocks/spiral-how/spiral-numbered-disks.png]]}}}===  Place over a background of some sort.+++
{{demoImg{
[img[http://conal.net/images/clocks/spiral-how/spiral-lichen.jpg]]}}}===  Crop with a disk.+++
{{demoImg{
[img[http://conal.net/images/clocks/spiral-how/spiral-lichen-cropped.png]]}}}===  Fade the numbers.+++
{{demoImg{
[img[http://conal.net/images/clocks/spiral-how/spiral-lichen-cropped-transp.png]]}}}=== 
=== 
</pre>
</div>
<div title="2006-12-26" modifier="Conal Elliott" modified="200612270624" created="200612262106" tags="2006-12 day">
<pre>* TV:
** Made prompts orthogonal to inputs &amp; output.+++
{{haskell{
class Arrow arr =&gt; CommonInsOuts arr where
  -- | Provide prompt label
  prompt :: String -&gt; arr a b -&gt; arr a b
  ...
}}}
=== 
** Next, make Input and Output versions.  Hmm.  Wrapping a prompt around //any// Input &amp; Output is not currently possible, and I think it requires extending those ~GADTs.  +++^In the process, consider merging my {{{CommonInsOuts}}} and {{{LayoutArr}}} classes.  I'm reluctant to merge, since {{{CommonInsOuts}}} has some methods that might not be definable for some arrows.===  What are the implications of Input &amp; Output versions of prompt?  Benefits:++++
* For UI, I can box up separate portions, like my &quot;shopping list&quot; example.  Maybe even different labelings of a repeated group of widgets.
* For IO, I can give give directions for a function.
=== Drawbacks:++++
* Adding a constructor requires me to figure out how to implement the Eros composition combinators.  For instance, suppose I label a lambda and then compose it with another lambda.  Or I label a pair and apply a function to part of it.  I suppose I could eliminate the label.  Or propagate it to the remaining pieces.
* //others?//
=== Did it.  Looking great.
** Made an Output version of interact.+++
{{haskell{
interactOut :: COutput (String -&gt; String)
interactOut = oLambda stringIn stringOut
}}}
Well, not quite equivalent, since it uses getLine instead of getContents.=== 
** Added a read/show version of interactOut.  So lovely.+++
{{haskell{
interactRSOut :: (Read a, Show b) =&gt; COutput (a -&gt; b)
interactRSOut = cofmap (wrapF show read) interactOut
}}}
=== 
* Got help from #haskell (dcoutts) so I can haddock TV.  I just had to add &quot;extensions: CPP&quot; to tv.cabal, so that Cabal would preprocess my sources with {{{-D__HADDOCK__}}} before passing them to Haddock.
* Finally got on track with module comments for Haddock.  It's very cool, as some of the header comments are interpreted and placed into the Haddock page header (portability, stability &amp; maintainer).
* Found emacs cabal-mode.  Fixed a bug and improved the templates.  Set to auto-insert.
</pre>
</div>
<div title="2006-12-27" modifier="Conal Elliott" modified="200612282213" created="200612272145" tags="2006-12 day">
<pre>* Blogs:++++
* [[the Haskell metatutorial| http://koweycode.blogspot.com/2006/12/haskell-metatutorial.html]] by Eric Kow.  The article inspired me to apply my [[self-organizing FAQs]] idea to learning Haskell.  The community is technical and playful, so I'd get great feedback.
=== 
* Men's group:++++
* Replied to Roger's inquiry.  I got some self-empathy in the process.+++&gt;
Hi Roger,
 
Here's the deal.  Once I started moving on getting a men's group together, I got a tremendous surge of creative energy, which pulled me out of a deep slump.  Since then, I've been going gangbusters on my technical projects.  And I've let men's group organizing slide.  I'm loving my productivity, and at the same I have a background uneasiness about ending up back in my slump without the support of a men's group.  And besides, I remember enjoying the connections I've had in past groups.  So, for my own well-being, I do want to get back on it.
 
I guess my recent inner resistance has been a fear that I'll get mired in details of scheduling, and have my attention pulled away from my creative work long enough that I'll lose my focus &amp; inspiration.  Perhaps I can give myself some reassurance that I'll keep placing a high personal priority on my projects while taking some more steps about getting a time for a first get-together.  Or (gasp) I might even ask for help.
 
  Warmly, - Conal
=== 
* Now I want to define a &quot;next action&quot; (GTD).  It would be something that lets me get a meeting scheduled.  I don't know whether to go low-tech with an email conversation about times, or high-tech with http://timetomeet.info.  Here's an action: make an experimental meeting request with Holly.  Did it.  Now waiting for her reply.  I'm tempted to think about what to do next after that.  Try letting it go and entrusting the decision to my more informed future self.
=== 
* TV etc:++++
* How do I want to divvy up the release?  Particularly, what kind of composition do I want to support and how?  I want some in there, to show off the power the ideas.  In particular, show how composition strips off matching input &amp; output.
* I'm uncomfortable with the size of Eros's ~ArrowX type class.  I stuffed a bunch of polymorphic functions in there, because (a) I don't know how to deal with polymorphism, and (b) I wanted the Input/Output structures to be transformed in a specific way.  My worry is that I've omitted some functions and at the same time have missed solving an important problem.  (Cf the 0, 1, &amp;infin; principle).  I could release a subset initially, and extend later if I still don't know a better way.  Or I could release as is, point out what I don't like, and ask for help.  I like this latter choice, as it's a departure for me and invites collaboration.
=== 
</pre>
</div>
<div title="2006-12-28" modifier="Conal Elliott" modified="200612311643" created="200612282028" tags="2006-12 day">
<pre>* Blogs:++++
* [[The Haskell metatutorial| http://koweycode.blogspot.com/2006/12/haskell-metatutorial.html]] by Eric Kow.  The article inspired me to apply my [[self-organizing FAQs]] idea to learning Haskell.  The community is technical and playful, so I'd get great feedback.
=== 
* Men's group:++++
* Replied to Roger's inquiry.  I got some self-empathy in the process.+++&gt;
Hi Roger,
 
Here's the deal.  Once I started moving on getting a men's group together, I got a tremendous surge of creative energy, which pulled me out of a deep slump.  Since then, I've been going gangbusters on my technical projects.  And I've let men's group organizing slide.  I'm loving my productivity, and at the same I have a background uneasiness about ending up back in my slump without the support of a men's group.  And besides, I remember enjoying the connections I've had in past groups.  So, for my own well-being, I do want to get back on it.
 
I guess my recent inner resistance has been a fear that I'll get mired in details of scheduling, and have my attention pulled away from my creative work long enough that I'll lose my focus &amp; inspiration.  Perhaps I can give myself some reassurance that I'll keep placing a high personal priority on my projects while taking some more steps about getting a time for a first get-together.  Or (gasp) I might even ask for help.
 
  Warmly, - Conal
=== 
* Now I want to define a &quot;next action&quot; (GTD).  It would be something that lets me get a meeting scheduled.  I don't know whether to go low-tech with an email conversation about times, or high-tech with http://timetomeet.info.  Here's an action: make an experimental meeting request with Holly.  Did it.  Now waiting for her reply.  I'm tempted to think about what to do next after that.  Try letting it go and entrusting the decision to my more informed future self.
=== 
* TV etc:++++
* How do I want to divvy up the release?  Particularly, what kind of composition do I want to support and how?  I want some in there, to show off the power the ideas.  In particular, show how composition strips off matching input &amp; output.
* I'm uncomfortable with the size of Eros's ~ArrowX type class.  I stuffed a bunch of polymorphic functions in there, because (a) I don't know how to deal with polymorphism, and (b) I wanted the Input/Output structures to be transformed in a specific way.  My worry is that I've omitted some functions and at the same time have missed solving an important problem.  (Cf the 0, 1, &amp;infin; principle).  I could release a subset initially, and extend later if I still don't know a better way.  Or I could release as is, point out what I don't like, and ask for help.  I like this latter choice, as it's a departure for me and invites collaboration.
* Define the Eros operators on the new Input &amp; Output constructors.++++
* Title.  Suppose I transform part of a titled pair.  I could drop the title, or maybe propagate it with change.  For instance, for a pair titled &quot;foo&quot;, an unchanged first component could get the title &quot;first of foo&quot;.  (Or for a lambda, &quot;argument of foo&quot; or &quot;result of foo&quot;.)  What about the transformed part?  I guess just drop it.
* Compose.  Examples:++++
* Turn a string output into a number pair output, using {{{cofmap show}}}.  Apply fstA.  I don't think any algorithm could figure out what to do.  Harder example: turn an image output into a number-pair output by rendering the pair as a disk whose center is at the given coordinate pair.  Then apply fstA.
* String-&gt;String version of grading program.  Suppose I have titles for input and output and for the whole function.  If I {{{cofmap (wrapF unparse parse)}}}, I won't even have an outer lambda.  Now compose with another function.  Yow.
=== These problems are not new to {{{OCompose}}}.  They're already present with {{{OPrim}}}.  My Eros solution was to have an {{{OEmpty}}} operator and use it when destructuring pairs or functions.+++
{{{
asOPair :: Output (a,b) -&gt; (Output a, Output b)
asOPair (OPair a b) = (a,b)
asOPair p           = (OEmpty,OEmpty)
}}}
=== I wonder if instead I could rely on some kind of default output.  I have a default output type class in Eros, but I don't think I can rely on having a type instance.
=== 
=== 
* TiddlyWiki:++++
* I want to copy &amp; paste from literate Haskell code into a tiddler.  Gave a first shot at [[literate Haskell plugin]].  Got stuck and asked for help on the TW group.  I also realized that I haven't gotten a reply to my last request because I forgot to send from my gmail account.  I created another google account as conal@conal.net and joined the TW group, choosing no email delivery.
* Got an answer from Bob M.  For the loading dependency problem, just pick a name that comes after the name of the syntax plugin.  So I renamed mine [[SyntaxifyPlugin: Haskell]].
* Bob also pointed me to [[an example| http://bob.mcelrath.org/tiddlyjsmath.html]] that would help with my [[literate Haskell plugin]].  This example renders ~LaTeX via Javascript, which is awesome.  Gives me ideas.  For instance, run my literate Haskell code through [[lhs2TeX| http://www.informatik.uni-bonn.de/~loeh/lhs2tex]] to make it look mathy.
* Going further, organize a whole literate Haskell program as a TW.++++
* One tiddler per top-level definition.
* Scan the code and automatically generate links for names that match tiddlers.
* Use a custom field for the type.
* Seems a shame to state the name twice.  Could get inconsistent.  At the least, have a consistency check.  Better, generate the name automatically.
* What about multiple modules?  Perhaps look to Haskell to give a good answer for TW, rather than vice versa.  That is, equate ~TWs with modules and have an explicit export &amp; import.   We could import all kinds of stuff between ~TWs, including Javascript code and CSS.
=== 
=== 
</pre>
</div>
<div title="2006-12-29" modifier="Conal Elliott" created="200612301747" tags="2006-12 day">
<pre>* I didn't get much sleep last night, so I've been pretty out of it today.
* Wrote a [[reply to Jeremy Ruston about dependencies]].
</pre>
</div>
<div title="2006-12-30" modifier="Conal Elliott" modified="200701050649" created="200612302152" tags="2006-12 day">
<pre>* TiddlyWiki:++++
* Flailed about with my [[literate Haskell plugin]].  Asked for [[help| http://groups-beta.google.com/group/TiddlyWiki/browse_frm/thread/12da5bf596bcc312]] again.  Bradley Meck pointed me to his NestedFormatterMacro, which is a great fit.  Added a specialized function to his code to make things really simple.+++
//{{{
config.formatters.push(
  config.macros.nestedFormatter.substAndWikify(
    &quot;haskellCode&quot;,
    &quot;^\\\\begin{code}\n&quot;,
    &quot;^\\\\end{code}\n&quot;,
    function (s) { return &quot;{{haskell{\n&quot;+s+&quot;}}}&quot;; }
  ));
//}}}
=== 
* Idea: have WikiNames render as links //only// if the tiddler exists.  That tweak would save me a lot of twiddling but still let me conveniently refer to system tiddlers.
=== 
* TV:++++
* Release the Eros algebra and encourage its use independently from UI and gestural composition.  Put in the hierarchical libraries, but where?  And what to call it (rather than my current &quot;~ArrowX&quot;)?
* Include only the methods needed to support the composition algebra.  I can subclass to add more.  Besides the Arrow methods, include result, funF, funS, funR, idA, flipA, curryA, uncurryA.  The last three are used to define inpF, inpS, inpFirst and inpSecond.  If I throw in swapA and dupA, then I get some nice defaults that don't use arr.  And fstA, sndA enable a default for swapA.  Only lAssocA and rAssocA remain.  Note that Arrow uses swapA and dupA.+++
{{haskell{
class Arrow a where
    ...
    second :: a b c -&gt; a (d,b) (d,c)
    second f = arr swap &gt;&gt;&gt; first f &gt;&gt;&gt; arr swap
		    where swap ~(x,y) = (y,x)
    ...
    (&amp;&amp;&amp;) :: a b c -&gt; a b c' -&gt; a b (c,c')
    f &amp;&amp;&amp; g = arr (\b -&gt; (b,b)) &gt;&gt;&gt; f *** g
}}}
=== I recommend similar definitions for ~ArrowX instances.+++
{{haskell{
    second f = swapA &gt;&gt;&gt; first f &gt;&gt;&gt; swapA
    f &amp;&amp;&amp; g  = dupA  &gt;&gt;&gt; f *** g
}}}
=== 
* What about pure/arr?  They're not required for the composition scheme, and they prevent code generation.  For ~OFun, I use ~OEmpty, i.e., invisible.  Keep discouraging its use.  It's fundamental to desugaring of arrow notation.
* When I revive my Eros code, I'll want Haddock docs, but Haddock doesn't understand infix type operators.  Rather than rewriting my type signatures, have a whack at tweaking Haddock.  Hopefully soon Haddock will integrate more with GHC, and then it will understand all GHC syntax.
* Did it.  Haddock now handles infix type operators.+++
{{haskell{
foodle :: Arrow (~&gt;) =&gt; a~&gt;b -&gt; b~&gt;c -&gt; a~&gt;c
foodle = undefined
 
doodle :: Arrow arr =&gt; a `arr` b
doodle = undefined
}}}
=== I submitted my changes.+++
{{{
$ darcs send
Creating patch to &quot;http://darcs.haskell.org/haddock&quot;...
Patch bundle will be sent to: Simon Marlow &lt;simonmar@microsoft.com&gt;
 
Sat Dec 30 17:53:05 Pacific Standard Time 2006  Conal Elliott &lt;conal@conal.net&gt;
  * infix type exprs
  Handle types like &quot;a ~&gt; b&quot; and &quot;a `arr` b&quot;.  I especially like this
  notation for arrow types.
Shall I send this patch? (1/1) [ynWvpxqadjk], or ? for help:y
Successfully sent patch bundle to: Simon Marlow &lt;simonmar@microsoft.com&gt;.
}}}
===   This darcs patch is my first on someone else's code!
* Pondering what to rename my ~ArrowX class.  What's its purpose?++++
* Enable point-free value construction.
=== 
=== 
</pre>
</div>
<div title="2006-12-31" modifier="Conal Elliott" modified="200701010650" created="200612311638" tags="2006-12 day">
<pre>* TiddlyWiki:++++
*  Inspired by the layout of NestedFormatterMacro, I revised the visual style of [[SyntaxifyPlugin: Haskell]] and [[literate Haskell plugin]].  Pretty.  Changed &quot;About&quot; to &quot;Description&quot; for grammatical consistency.
*  Read through [[Regular Expressions for client-side JavaScript -- a free online quick reference| http://www.visibone.com/regular-expressions]].  Wow -- powerful regexps.
*  Started listing LoadDependencies and UseDependencies in my plugins.
*  Made a [[smart quotes]] plugin.  Shared on the TiddlyWiki group.
*  [[Query| http://groups-beta.google.com/group/TiddlyWiki/browse_frm/thread/d65d329602ddcdca]] about conditionally linked/formatted ~CamelCase words.+++&gt;
I end up ~TwiddlePrefixing a lot of CamelCase words that I'm not intending as WikiLinks.   I think what I'd like is to render such words as links only if the tiddler exists.  That tweak would save me a lot of twiddling but still let me conveniently refer to system tiddlers.  Does anyone have such a hack or Any ideas on how to do it?
   ===
   Got back a pointer.  Made my own modification, via [[conditional WikiLink formatter]] and [[startup]].  Then Eric Shulman told me about DisableWikiLinksPlugin, which is friendlier.  Note his use of {{{&lt;option ... &gt;}}}.  Remember that for my customization.
  === 
* TV &amp; Eros:++++
*  Divide up the libraries as follows:++++
*   Phooey as is;
*   Eros's ~ArrowX and supporting;
*   TV, including ~ArrowX instance and examples of use;
*   Rest of Eros.
   === 
*  To sort out:++++
*   New name for ~ArrowX and place in hierarchy;
*   TV syntactic composition examples (including &quot;pipe&quot;);
*   Gestural composition.
   === 
*  Purpose &amp; nature of the Eros algebra: non-syntactic composition of transformations (editors) on typed values, ~GUIs, etc.  &quot;Deep function application&quot; (deep functions and deep application).  
*  Name ideas: ~DeepApply, ~DeepTransform, Arrow.Deep.  I like this last one as the name of the module and class.  What to call what's now &quot;Function&quot; (conversion to &amp; from functions)?
  === 
</pre>
</div>
<div title="2007" modifier="Conal Elliott" created="200701022054" tags="year">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2007-01" modifier="Conal Elliott" modified="200701012006" created="200612311639" tags="2007 January month">
<pre>Type the text for '2006-12'</pre>
</div>
<div title="2007-01-01" modifier="Conal Elliott" modified="200701280050" created="200701012005" tags="2007-01 day">
<pre>* Arrow.Deep:++++
*  Working through the implementation.
*  Came up with {{{arr}}}-free defaults for left- and right-association.+++
\begin{code}
lAssocA :: (a,(b,c)) ~&gt; ((a,b),c)
lAssocA = (idA***fstA) &amp;&amp;&amp; (sndA&gt;&gt;&gt;sndA)
	  -- arr (\ (a,(b,c)) -&gt; ((a,b),c))
 
rAssocA :: ((a,b),c) ~&gt; (a,(b,c))
rAssocA = (fstA&gt;&gt;&gt;fstA) &amp;&amp;&amp; (sndA *** idA)
	  -- arr (\ ((a,b),c) -&gt; (a,(b,c)))
\end{code}
   ===  The benefit is that I can (I think) use these defaults where {{{arr}}} is unavailable.
*  Removed from Deep the method defaults that use arr, so as to improve compile-time warnings.
*  Changed tupler type constructors (Pair1, Pair2) to be newtype wrappers around tuples.  Aesthetically, I like using exactly the same representation as tuples, and the code came out a little simpler.
*  Add Haddock comments.  Looks great.
*  Init'd a darcs repo.  Updated [[darcs tips]].
  === 
* TiddlyWiki:++++
*  Fun TW project: randomized logos.  Make a bunch of logo images for my journal.  Make a macro that randomly returns one argument out of many.  Use it in SiteLogo.
*  Do: extract my code from NestedFormatterMacro, making it be its own plugin.
*  Created [[RewritePlugin]] and [[RewritePlugin: Haskell]] to make my code prettier.  But oops -- I don't yet know how to run it inside my Haskell environment.  Idea: make a second formatters list, filtering for the ones that contain a special field.  Temporarily replace the main formatters before calling subWikify, and then restore.  Or maybe go ahead and wikify the contents.  What could happen?
*  Found that my journal doesn't work under Internet Explorer.  Bummer.  Asked for help.
  === 
* Other:++++
*  Revisit my [[power design| http://conal.net/Pan/Gallery/xorgonRings/g.png]].  Use three rings instead of six.
  === 
</pre>
</div>
<div title="2007-01-02" modifier="Conal Elliott" modified="200701050258" created="200701022102" tags="2007-01 day">
<pre>* Haskell projects:++++
*  Converting TV to use DeepArrow.  Copied and updated OFun from Eros.
*  Remember about http://haskell.org/hoogle.
*  Chatted with metaperl about arrows.
*  Noticed that there are two monad transformer libraries.  I used Iavor's &quot;monadLib&quot; for Phooey, but now I see &quot;mtl&quot;, which may be better integrated with the core libraries.  Urk.  I'd like simplicity and uniformity.  I grabbed, compiled &amp; install mtl and started converting Phooey to use it.  I'll have to change a lot, so I stopped for now and sent in a note to the Haskell libraries list asking about the two choices.  ''Problem'': Iavor's Monad.Id module does not export the Id constructor.  I fixed it and recompiled.  But now TV depends on an unreleased monadLib.
*  How do I want to use composition in TV?  One simple example is composition (piping).  Build it out of the DeepArrow operators, as an example.  Did it.  Works.
*  How do I want to handle titles and composition?  Added some thoughts to [[experiments with Output destructuring]], about titles.
  === 
* Web statistics:++++
*  I had five-day gap in December's [[stats| http://awstats.conal.net/-conal]].  Fixed it.
*  I'd like a different approach to log rotation.  The current one keeps changing the name of the current log file (every 30 days in my set-up), which means that the awstats config files have to get changed regularly.  I'd rather have the old log file get renamed.  The last bit would have to get processed by awstats and the server restarted (so it writes into the new log file instead of the old renamed one, since the writing tracks file descriptor).
  === 
</pre>
</div>
<div title="2007-01-03" modifier="Conal Elliott" created="200701031954" tags="2007-01 day">
<pre>* Haskell projects:++++
*  More [[experiments with Output destructuring]].  Eliminated the automatic title transformations.
*  Shae E (shapr) reminded me on #haskell that he is working (for pay) on [[HAppS -- Haskell Application Server| http://happs.org]].  I have a hunch that my TV/Eros work is applicable.  HAppS applies a monadic (and non-IO) discipline with write-ahead loggin to assure ACID (atomicity, consistency, isolation, durability).  It &quot;lets your app be simply a set of functions with types like:&quot; {{{a -&gt; MACID b}}} (from the [[tutorial| http://happs.org/HAppS/doc/tutorial.html]]).  Wrapping up these functions as a Kleisli arrow, I can drop it into TV.	What benefits would arise?  Remember that the arrows are used as //interfacing// around functional values.  To explore the possibilities, implement my [[self-organizing FAQs]] idea in Haskell on HAppS.
*  Started a project tiddler on [[TV]].
  === 
* TiddlyWiki:++++
*  Added coloring rules in [[SyntaxifyPlugin: Haskell]]: types/constructors and definitions/declarations.
*  Updated twee.el (TiddlyWiki editing mode for emacs) to automate insertion of sublists with nested sliders.  Now it's super easy to keep my delimiters balanced and my indentation as I want.  Sent to Chris Klimas.
  === 
* Misc:++++
*  I realized why I'd been having trouble with some of my email filter rules, in which I join many sender patterns with &quot;OR&quot;.  The problem was operator precedence.  &quot;OR&quot; binds more tightly than juxtapositon.  Solution: quote any pattern that contains spaces.  I also had to quote patterns with asterisks.
  === 
</pre>
</div>
<div title="2007-01-04" modifier="Conal Elliott" modified="200701050156" created="200701050132" tags="2007-01 day">
<pre>* TiddlyWiki:++++
*  Twee:++++
*   Played with [[tweebox | http://gimcrackd.com/etc/src/#Twee]] (.tw -&gt; .html) &amp; [[untwee| http://gimcrackd.com/etc/src/#%5B%5BConvert%20an%20existing%20TiddlyWiki%20to%20Twee%20format%20online%5D%5D]] (.tw -&gt; .html).  Did a simple test and also my whole journal.  Issues:++++
*    One blank line gets added between tiddlers on every tweebox/untwee round trip.
*    One syntax error in SyntaxifyPlugin.
    === 
*   Wrote [[note to Chris Klimas about twee (2007-01-04)]]
*   Messed with twee-mode some more.+++
*    Set page-delimiter to match tiddler titles.  Not exactly what I want, but close.  I'd love to have a command like mark-page that grabs the tiddler I'm editing (without name), so I can cut &amp; paste.
*    Added a command for inserting a haskell code environment.
*    Figured out that longlines-mode interfered with new-lines in {{{insert}}} calls.  Made a macro {{{twee-no-longlines}}}.
    === 
   === 
  === 
* Misc++++
*  Futzed with spam filering rules for conal.net and awakeningcompassion.net.  Came up with better coverage.
*  Lots of talking with Holly about our plans for Awakening Compassion, etc.
*  Brief chat with Sean Seefried.  Showed him my journal.  He hadn't see TiddlyWiki before.
  === 
</pre>
</div>
<div title="2007-01-05" modifier="Conal Elliott" modified="200701051743" created="200701051742" tags="2007-01 day">
<pre>* Haskell projects:++++
*  TV:++++
*   Started [[TV description]].
   === 
*  Haddock:++++
*   My patch got messed up.  Copied off the changed source files and grabbed a fresh repo.
*   I noticed a bug I think I introduced in HsSyn: &quot;f (&amp;&amp;&amp;) g&quot;.  Backed out my hsNameStr change for now.  Really fixed it.
*   Got my configurations of alex, happy, &amp; haddock consistent with library packages.  Now everything get configured as in [[cabal tips]].
*   Deactivated my html entities tweak to HaddockHtml.  It's a slippery slope and not entirely consistent.
*   Sent patch to Simon Marlow.  My previous {{{darcs send}}} attempt didn't get through, so this time, I used {{{darcs send -o FILE}}}.
   === 
  === 
</pre>
</div>
<div title="2007-01-06" modifier="Conal Elliott" modified="200701102144" created="200701071703" tags="2007-01 day">
<pre>* Haskell projects++++
*  I like the term &quot;composable interfaces&quot; to describe TV.  Does the term &quot;tangible values&quot; (and the short form &quot;TVs&quot;) still apply?  Maybe: &quot;tangible&quot; in that they can be &quot;touched&quot; (interfaced with) from outside.  Try on this broader understanding for a while.
*  Added boolean input &amp; output to Phooey &amp; TV.
*  Added default visualizations (type class {{{DefaultOut}}}).
*  Fixed up (haddock) documentation for TV.  Adding an introduction.
*  Idea: arrange for lazy string evaluation in UIs.  Rather than send the whole string over to wxWidgets, just send over the visible portion.  When more becomes visible, redo the conversion.  For efficiency, extend in chunks of //n// characters.
*  I want source code links.  Haddock has some new flags, and [[hscolour| http://www.cs.york.ac.uk/fp/darcs/hscolour]] can generate anchors for each definition, in addition to doing the coloring.  I darcs-got, compiled, and installed hscolour (so easy now, with [[Cabal| http://haskell.org/cabal]].)
  === 
* Misc++++
*  Switched from Trillian back to Gaim (2.00beta5).  I couldn't figure out how to get Trillian to alert me when someone spoke my nickname.  Gaim does it fine.
*  Found [[GlovePIE| http://carl.kenner.googlepages.com/glovepie]], a &quot;Glove Programmable Input Emulator&quot;.  Works with eMagin z800 and Wiimote.  More info on the [[P5 Glove| http://scratchpad.wikia.com/wiki/P5_Glove]] (and [[on Wikipedia| http://en.wikipedia.org/wiki/Wired_glove]]).  They're pretty cheap ($40-50 on ebay) and may work well with eMagin HMD.  I joined the [[yahoo group| http://tech.groups.yahoo.com/group/p5glove]].  I emailed an inquiry to the address on the [[product page| http://www.alliancedistributors.com/Alliance_Brand/Products.php]].  Heard back &quot;Minimum of ten&quot;.  For sale and videos [[here| http://www.vrealities.com/P5.html]].
  === 
</pre>
</div>
<div title="2007-01-07" modifier="Conal Elliott" modified="200701090013" created="200701071711" tags="2007-01 day">
<pre>* TV++++
*  I have hscolour working, to color my syntax and generate anchors.  The trick now is to get my sources pre-processed with {{{-D__HADDOCK__}}}, to eliminate the bits Haddock doesn't grok.  Cabal can do that, but it doesn't pass the {{{--source-module}}} and {{{--source-entity}}} flags that I need for definition anchoring.  Sent note to libraries@haskell.org.  Duncan Coutts suggested {{{--haddock-args}}}.  I implemented it.  Seems to be working, but oops.
  === 
*  I borked my cygwin installation in the process.  Recovering.+++
*   Uninstalled msys and &quot;msys developer tool kit&quot;.  I only installed them to get {{{darcs push}}} working with its ssh, and now it seems that the standard recommendation is to use the ssh and windows installation notes on the darcs site.
*   Rebooted.  Still borked.  (Symptom: &quot;grep&quot; doesn't catch anything.  Provocation: I did {{{rm -r /usr}}} in a shell, forgetting that {{{/usr}}} would be interpreted as {{{c:/cygwin/usr}}}.)
*   Cygwin setup didn't find &amp; fix the problems, so I said to revert all cygwin packages to the previous version, and then again to the current version.  Rebooting ....
*   Now missing cat &amp; date.  Oh -- there is a &quot;reinstall&quot; option in cygwin setup.  Doing a global reinstall.  Gee.  I wonder if it's installing even packages I hadn't previously installed.  Hm.  That'd be a lot.  In retrospect, I could have done a global reinstall from my //local// files.  Rebooting ....
*   Now bash starts up with &quot;regtool: command not found&quot;.  What's calling regtool?
*   Hmm.  I did another setup, this time being sure to say from the internet.  Maybe last time was local.  Rebooting ....
*   Still complains of missing programs, but the messages say &quot;: command not found&quot;, so I don't know what's going on.  Idea: punt cygwin and just use msys.
*   The instructions on [[building GHC for Windows| http://hackage.haskell.org/trac/ghc/wiki/Building/Windows]] describe another way to get just the right cygwin packages.
*   I uninstalled MinGW also.  I'm confused about whether it's needed, in addition to msys.  Remember this message.+++&gt;
When you install MinGW I suggest you install it to C:/mingw (replace C: with the drive of your choice).  Then create an /etc/fstab file with a line that has a value similar to: {{{C:/mingw /mingw}}}.===  This too.+++&gt;
MinGW-1.1 has a version of make.exe within its bin/ directory. Please be sure to rename this file to mingw32-make.exe once you've echo installed MinGW-1.1 because it's very deficient in function.=== 
*   Hmm.  I'm missing a lot of good stuff.  Bag msys &amp; mingw and go for a straight cygwin, from scratch.
*   Oh -- I missed some.  Try with just MinGW for starters.  Then add msys and then msysDTK.  Removed from my PATH: {{{c:\cygwin\usr\local\bin;c:\cygwin\usr\bin}}} and {{{;c:\cygwin\usr\local\lib}}}.  Keep {{{c:\msys\bin}}}.
*   No bash in basic MinGW.  Added binutils, mingw-utils, mingw-runtime, gcc-core.  Still no bash.
*   Installing msys &amp; msysDTK.  Changed SHELL from {{{c:/cygwin/bin/bash}}} to {{{c:/msys/1.0/bin/sh.exe}}}.  //Did not// remove CYGWIN setting of {{{binmode}}}.
*   Still no bash, so I changed my emacs {{{explicit-shell-file-name}}} to &quot;sh&quot;.  See what happens.
*   I'll defintely need my old c:/cygwin/usr/local.  Copied it from c:/was-cygwin/usr/local.  
*   Re-adding {{{c:\cygwin\usr\local\bin;c:\cygwin\bin;c:\cygwin\usr\local\lib}}} to the end of my PATH.  Changed my emacs shell back to &quot;bash&quot;.  See what happens.
*   Bash still complains about missing, unnamed programs.  Try taking msys &amp; mingw out of the loop.  Remove {{{c:\mingw\bin;c:\msys\1.0\bin;c:\msys\1.0\local\bin;}}} from PATH.  Rebooting ....  Reinstalling cygwin from the internet, using just the defaults.
*   Discovered that the error messages come from blank lines in my .bashrc and .aliases files.  My hunch: bash is confused over dos vs unix end-of-line conventions.  In my cygwin setup, I had the &quot;default text file type&quot; set to &quot;dos/text&quot; rather than the recommended (unix/binary).  Changed to binary.  Removed cygwin and cygwin-packages and reinstalled.  Again chose the default set of packages.
*   Still get the complaints.  I ran dos2unix over my .bashrc and .aliases, which helped a lot.  Hmm.  Isn't that why I want &quot;dos/text&quot; mode?  Now I just get one from {{{bash --login}}}, which happens with the desktop short-cut.  I don't remember the point of that flag.
*   Helpful hint from Cygwin FAQ: [[How can I copy and paste into Cygwin console windows?| http://cygwin.com/faq/faq.using.html#faq.using.copy-and-paste]].  Turn on &quot;quick edit mode&quot; in the console properties.  Use left to mark &amp; copy (right click), right to paste.
  === 
*  I read through a long discussion thread on libraries@haskell.org from January 2006, called &quot;Idea to allow people to comment on Haskell docs&quot;.  I think this thread led to the idea of source code linking and using hscolour.  Duncan also added a way to link to a wiki page for user comments.  I like that idea a lot.  At the very least, set up a wiki page for comments on each package I release.
</pre>
</div>
<div title="2007-01-08" modifier="Conal Elliott" modified="200701090729" created="200701081952" tags="2007-01 day">
<pre>* Cygwin etc+++
*  Text mode makes more sense to me.  Uninstalling &amp; reinstalling cygwin yet again.  Removed the CYGWIN environment variable (was set to &quot;binmode&quot;).  To do: [[read about this variable| http://www.redhat.com/docs/manuals/gnupro/GNUPro-Toolkit-03r1/gnupro_8.html#SEC58]], and try some values, including &quot;ntsec ntea&quot;.  (smbntsec may have made our Samba-based network media drive work.)  For now, &quot;ntea ntsec tty&quot;.   Could also try &quot;nobinmode&quot;, though I expect that would cause problems, too.  Rebooting....  Still the same.
*  I'm going to leave things as they are now, with my .bashrc and .aliases altered for unix end-of-lines.  See if any other symptoms arise.
*  Next, get a darcs-friendly ssh.  Follow [[these directions| http://darcs.net/DarcsWiki/WindowsConfiguration]].
*  I can use PuTTY to generate private &amp; public keys.  No, I already did that in July.  Just use that one.  Yep, it works.  Added Pageant to my Windows startup group.
*  But a different problem surfaced.  My interaction with remote shells is broken under both msys or cygwin bash on my end.  Specifically, my tab key completes but doesn't show the completion, the emacs commands like absolute-backspace don't work, and control-p for previous command shows a triangle shape, though it will re-execute the last command.  Wtf?  :(
*  I can't just avoid the newline problem.  It happens with every shell script, e.g., the &quot;darcs&quot; shell script wrapper I just installed.  That's a show-stopper.  What can I try next?
*  Used unix2dos to convert my .bashrc and .aliases back to dos style.  Reinstalling cygwin with &quot;binary&quot; default text mode.  (See [[this recommendation| http://cygwin.com/cygwin-ug-net/setup-net.html#id4725456]] in the setup directions.)  Setting CYGWIN to tty (in hopes of fixing my remote server problem).  See [[CYGWIN variable explanation| http://cygwin.com/cygwin-ug-net/using-cygwinenv.html]].
*  Found [[bash announcements| http://www.cygwin.com/ml/cygwin-announce/2006-12/msg00026.html]] about the problem I'm having.  Summary: (a) use dos2unix whenever needed, and (b) use the igncr shell option.  Both worked for me, but I prefer the latter.  I  did it by setting SHELLOPTS in my environment variables setting WinXP's System Properties, rather than in .profile or .bashrc, so that emacs would get it also.
*  Chatted with Joseph.  He uses [[securecrt| http://www.vandyke.com/products]] as his shell.  I'll check it out, but first [[rxvt| http://www.cygwin.com/faq/faq_toc.html#TOC65]].
*  rxvt: same problem.
*  securecrt: wow -- works great!  Way better than what i'm used to.  Nicely customizable.  Emacs support works great.  Nice coloring in the shell.
*  While darcs is working for me, I still have the &quot;plink&quot; warning message (&quot;{{{plink: unknown option &quot;-O&quot;}}}&quot;).  Searched and found many reports.  I got the latest [[daily darcs| http://glozer.net/darcs/daily/?C=M;O=D]] and set it up to be {{{c:/bin/darcsdir-cygwin/realdarcs.exe}}} (stashing the old one).  No more warning message!
  === 
* I'm very pleased with the outcome of my system changes.++++
*  Using PuTTY for my ssh, as recommended for darcs.
*  Using the latest darcs a realdarcs.exe.
*  Not using MinGW or MSYS.  They're installed but not used.  Might need for compiling ghc.
*  Using securecrt as my terminal program.  Emacs &amp; coloring.
  === 
* Haskell projects:++++
*  Got my Cabal tweak working.  Sent a note to the libraries list asking for feedback.  Now my Makefile generates links to syntax-colored source code.
*  Next, change the choice of colors, at least for punctuation.  Look into hscolour's CSS option.  A drawback is that I'd have to have a copy of the css for each source directory.  Stick with HTML.  I made a copy of Malcolm's [[sample .hscolour file| http://www.cs.york.ac.uk/fp/darcs/hscolour/.hscolour]], edited the choices, and placed it in my home directory.  I could instead have placed it in the project directories, but I'd rather not make multiple copies.  I love his use of a Read/Show data type for the config.+++
{{{
ColourPrefs
  { keyword  = [Bold,Foreground Blue]
  , keyglyph = [Foreground Red]
  , layout   = [Foreground Red]
  , comment  = [Foreground Green]
  , conid    = [Normal]
  , varid    = [Normal]
  , conop    = [Bold,Foreground Red]
  , varop    = [Foreground Red]
  , string   = [Foreground Magenta]
  , char     = [Foreground Magenta]
  , number   = [Foreground Magenta]
  , selection = [Bold, Foreground Magenta]
  , variantselection = [Dim, Foreground Red, Underscore]
  }
}}}
   === 
*  Next?  Links for a wiki page.++++
*   I see the flags, {{{--comments-base=URL}}}, {{{--comments-module=URL}}} and {{{--comments-entity=URL}}} for haddock.  For now, just use the first two.
*   Idea: rather than putting docs on darcs.haskell.org, put them on the Haskell wiki.  That way, comment links could be rendered in such a way that they reveal whether or not there are comments.  But, hmm.  Then haddock would have to generate wiki markup.  Interesting, since haddock has its own wiki-like markup.
*   I notice that the [[Gtk2Hs page on haskell.org|http://haskell.org/gtk2hs]] is a WordPress blog.  Good idea and very pretty.
*   Where to put a wiki page for my projects/packages?  Look at http://haskell.org/haskellwiki/Special:Categories.
*   Sent a note to haskell libraries list about comments &amp; wiki pages.
   === 
*  Realized that entity source pointers should be to the %{FILE} (where the code really is), not %{MODULE} (current exporting module).  But with preprocessing, the temporary pre-processed file gets used instead of the original.  Probably an oversight.  I sent a query.
*  Next, continue on my TV explanation.  Do I really want to be putting it in the haddock doc.  Maybe better in the project wiki page.  On the other hand, the haddock doc gives me links from example references to the entity docs, which is pretty sweet.
*  Progress on my TV library commentary.  Next: more of the algebra (but may be better in the other modules), the general story with arrows, //composition// and {{{DeepArrow}}}. 
  === 
* No idea how [[this page| http://www.oncotton.co.uk/peter/index/A4PAPERCUT_000.htm]] came up on my browser, but I love it.  Here's [[the entry page| http://www.oncotton.co.uk/peter]].
</pre>
</div>
<div title="2007-01-09" modifier="Conal Elliott" modified="200701100559" created="200701091753" tags="2007-01 day">
<pre>* Haskell projects++++
*  Got a reply from Duncan, saying that %{FILE} ought to track the Haskell line pragma in the source and hence be the original source.  I experimented some and found that the {{{-optP-P}}} flag leads to these pragmas being lost.  Sent a reply.  At Duncan's suggestion, I commented out the &quot;-optP-P&quot; (in Cabal's {{{Distribution/PreProcess.hs}}}), and now everything works great.
*  Oops -- noticed a parsing problem.++++
{{{
iPrim :: () ~&gt; a -&gt; Input (~&gt;) a
}}}
   ===  This declaration doesn't parse unless I parenthesize {{{() ~&gt; a}}}.  Compare the [[GHC grammar| http://darcs.haskell.org/ghc-6.6/ghc/compiler/parser/Parser.y.pp]] with my tweaked Haddock grammar.  The two grammars don't correspond very closely, and I'll be glad when there's just one.  I moved the infix production from doctype to tydoc, which makes sense to me.  I wonder why the ghc grammar works.
*  Also found an unparsing bug.  Type operators weren't always getting parenthesized when used non-infix.  I moved the parens from ppHsAType to ppHsName.
*  Changed my use of {{{arr}}} to {{{~&gt;}}} in my code.
*  Worked on getting external library references to point to locations on the web, rather than to my local copy.  Ran into a block with Haddock's apparent bias toward --use-package over --read-interface.  I can get Cabal to insert the latter, but I don't know how to get it to remove the former.
*  Idea: [[wiki haddock]].  Sent to haskell libraries discussion list.
  === 
* Cygwin stuff++++
*  Darcs fails.++++
{{{
bash-3.2$ darcs pull
darcs failed:  Not a repository: http://darcs.haskell.org/haddock (user error (Failed to download URL http://darcs.haskell.org/haddock/_darcs/inventory
libcurl: couldn't connect to host))
}}}
   ===  My hunch: my new bash {{{igncr}}} setting.  Try turning off this setting.  After also doing a dos2unix over the darcs script, my &quot;darcs pull&quot; worked fine.
*  So, I removed my SHELLOPTS setting and did {{{dos2unix .bashrc .profile .aliases}}}.  I'll do more dos2unix as needed.
  === 
</pre>
</div>
<div title="2007-01-10" modifier="Conal Elliott" modified="200701110817" created="200701102154" tags="2007-01 day">
<pre>* Haskell projects ++++
*  Correspondence with Duncan &amp; Iavor about my [[wiki haddock]] idea.
*  Wrote a [[note about TiddlyWiki and Haskell]] and thoughts on [[using TiddlyWiki to view programs]].
*  More TV writing.
*  I want a TV composition example, to show the power of separable interfaces &amp; values.  Simple idea: take apart a string into words ({{{words}}}), reverse each word ({{{reverse}}}), and put the result back together ({{{unwords}}}).
*  Added Emacs bindings {{{\C-'}}} and {{{\C-@}}} to surround words (expressions) with tick marks or at signs, for Haddock documentation.
  === 
* Men's group ++++
*  Made GMail contacts group.
*  Got missing email info.
*  Sent note about kick-off meeting.
*  Set up [[TimeToMeet|timetomeet.info]] meeting and sent.  Heard back from Mitch and Roger.
  === 
* TiddlyWiki ++++
*  Tweaked twee.el to sometimes expand-abbrev.
*  Idea: [[tiddlers in your favorite editor]].  Sent to the TiddlyWiki and twee-code google groups.  Heard back from Bob M.
  === 
</pre>
</div>
<div title="2007-01-11" modifier="Conal Elliott" modified="200701112206" created="200701111405" tags="2007-01 day">
<pre>* TV ++++
*  I'd like to extended the {{{DefaultIn}}} and {{{DefaultOut}}} type classes to handle lists in a general way, but still handle String (list of Char) in the most familiar way.  The {{{Read}}} and {{{Show}}} classes have a special trick.  Can I adapt it?  Made a first attempt. +++
{{{
class DefaultIn a where
  defaultIn     :: CInput a
  defaultInList :: CInput [a]

instance DefaultIn Bool where
  defaultIn     = boolIn False
  defaultInList = readInL

instance DefaultIn a =&gt; DefaultIn [a] where
  defaultIn     = defaultInList
  defaultInList = error &quot;defaultInList: not yet defined for [a]&quot;

instance (DefaultIn a, DefaultIn b) =&gt; DefaultIn (a,b) where
  defaultIn     = IPair defaultIn defaultIn
  defaultInList = error &quot;defaultInList: not yet defined for (a,b)&quot;
}}}
   === What to do for lists and pairs?  Similar situation for {{{DefaultOut}}}, which must also address //functions//.  Whatever I do must apply to all {{{CommonInsOuts}}} arrows, in particular, {{{UI}}} and {{{KIO}}}.  I can imagine reasonable solutions, but I'm not clear on what general policy to impose.
*  Postpone this design question.  Copy my attempt to a new {{{DefaultsList}}} module, and revert to the old {{{Defaults}}} for now.  Keep {{{DefaultsList}}} in darcs and in {{{TV.cabal}}}, so it will get compiled and even have Haddock declaration, but don't export it.  Leave comments to encourage others to think about the problem.
*  Cleaned up my TV Makefile some.  I learned about {{{mkdir -p}}} (make intervening directories if necessary) from dons on #haskell and so removed the one ugly hack I had in my Makefile.
  === 
* Misc Haskell stuff: ++++
*  Wrote some [[tips on using hscolour]].  I want it to be a blog article.  I can copy &amp; paste the rendered version of this tiddler into my [[Blogger blog| http://conal-elliott.blogspot.com]], but I lose CSS and fancy TiddlyWiki features like +++^[nested sliders.]like this one===  Instead, I want my blog to be a subset of this journal, say, determined by a special tag.
*  Idea: [[haddock for library illustration]].
  === 
* [[Emergence| http://emergence.awakeningcompassion.com]] ++++
*  I want to guide those leaving feedback about somebody, so that everyone knows what actual experience the reviewer has.
  === 
* Misc ++++
*  Asked for help on #emacs ++++&gt;
does anyone know a tight way to compute a string of n spaces in elisp?  extra credit for generality (e.g, n repetitions of a given character).
   === Learned about {{{make-string}}}, which is perfect: {{{(make-string n ? )}}}.
  === 
</pre>
</div>
<div title="2007-01-12" modifier="Conal Elliott" modified="200701132117" created="200701121906" tags="2007-01 day">
<pre>* Haskell projects ++++
*  What to do next ++++
*   [[TV]]: Add a bit about ideas for other arrow, like {{{Kleisli HAppS}}}.  Change the module structure.  Decide location for {{{Cofunctor}}}.  Look at to-do list.
*   [[Phooey]]: Change location of library docs on server.  Add source &amp; comment links.
*   [[DeepArrow]]: Docs, examples.
   === 
*  Chatted with Sean Seefried (saved in Gmail and in my Chats folder). ++++
*   He helped me get my public key working with darcs.haskell.org again.
*   We discussed how to describe TV and where to put it in the module hierarchy.  The conversation reminded me that the whole //hierarchy// paradign doesn't work for me.
*   This slogan popped into my mind: &quot;Ready to use &amp; ready to reuse&quot;?  We both liked it.  A variation: &quot;Usability meets reusability&quot;.  Or &quot;User-friendly meets reuse-friendly&quot;, or even just &quot;Use and Reuse&quot;.
   === 
*  On-going conversation about Cabal's use of a textual package description vs a Haskell DSEL.
  === 
* Misc ++++
*  Idea: [[mmm-mode for Haddock comments]]
*  Idea: [[quotation TiddlyWiki]]
*  [[note to Sandy about server software and the power of computers]]
  === 
</pre>
</div>
<div title="2007-01-13" modifier="Conal Elliott" modified="200701142019" created="200701140517" tags="2007-01 day">
<pre>* Haskell projects ++++
*  Some conversations on cabal-dev and #haskell about Cabal and its use of a textual specification instead of a DSEL.
*  Decided to keep the package name &quot;phooey&quot; in lower case.  I've gone back &amp; forth on this one.  People seem to be using all lower case if a single word and mix in upper case for acronyms and multi-words.  Okay by me.
*  I wanted some more order, so I moved my current Haskell projects into ~/Haskell.  I'll move others (Eros, Pajama) when I revisit them.
*  There will be a lot of commonality among make files, so I created [[cabal-make]]{{{.inc}}}, which is shared include file in {{{~/Haskell}}} and worked to make it customizable.  Include it from my projects.
*  Recompiled Iavor's monadLib package using my {{{cabal-make.inc}}}, which helped me get bugs out.  I copied the resulting docs to the server and Iavor a note asking him to look and to copy them to his repo, or preferably, to try generating them himself, and to give me some feedback.  I also sent a patch with some small code tweaks that came up.  Oh, oops.  I just remembered that I have some personal patches to haddock needed to build these docs.  Iavor won't be able to do it himself until I get the patches into Haddock.  Sent another note.
*  Next I'd better get my {{{--no-use-packages}}} Cabal flag in place.
*  The monad library I was using (Iavor's {{{monadLib-2.0.1}}}) is now obsolete, so I'm trying the new version.  Start with [[DeepArrow]].  First, I did {{{darcs record --all}}} (my first in the project), so I can back out.
*  Changes for {{{monadLib-3.1.0}}}: ++++
| //Old// | //New// |
|import Monad.Id|import Monads(Id,runId) |
|import Monad.Prelude|import Monads|
|import Monad.ReaderT|import  Monads(ReaderT,runReader)|
|Trans|MonadT|
|Id a //application//|return a|
|Id a //pattern//|a = runId ida|
|getR|ask|
|runReader|runReaderT|
|updateR|new def in Phooey.TagT|
   === These changes sufficed for Phooey.  Hurray!
*  Now I can test {{{--no-use-packages}}}, and I see that I broke {{{--haddock-args}}}.  I lose all of my args.  Simple test: {{{./setup haddock --haddock-arg=--bloonk}}}.  Found it.  Missing capitalization of a constructor in a match clause.  Was never falling through to the {{{HaddockOther}}} case.
*  [[DeepArrow]], [[Phooey]], and [[TV]] are all building fine.
  === 
* Men's group ++++
*  Mathias is available any evening.  Prefers not on Friday or Saturday.  Prefer not to do it the same week as the NVC group.
  === 
</pre>
</div>
<div title="2007-01-14" modifier="Conal Elliott" modified="200701150833" created="200701142020" tags="2007-01 day">
<pre>* Haskell projects ++++
*  I'm ready to decide on the modules for TV.  Use {{{Graphics.UI}}} only for the small {{{UI}}} module.  Otherwise, take a new top-level piece of the name space {{{Interface}}}.
*  That one small module is the only reason TV depends on Phooey.  Supposed I moved the UI piece out of TV (though it was the sole original motivation for TV).  Where would I put that piece?  A whole new package?  If so, what to call it?
*  Maybe better to release as one package (dependent on Phooey) and ask for feedback.
*  I better get more IO examples going.
*  Cofunctor location?  Other Cofunctor functions?   For now, use {{{Data.Cofunctor}}} as a placeholder and leave a comment inviting others to join in and make another place for it.  Then use that place in a future release.
*  Renamed {{{lib-make.inc}}} to [[cabal-make]]{{{.inc}}}.  More descriptive and inviting for other Haskellers.  Give it a Haskell wiki page.
*  Considering the name //functoid// for the generalization of function used with deep arrows.  That word already has some uses. +++
*   [[ecommerce context string mappings| http://en.wikipedia.org/wiki/Functoid]] (also called &quot;maporator&quot;!)
*   [[FC++| http://www-static.cc.gatech.edu/~yannis/fc++/boostpaper/fcpp.sectfull.html]]
*   Informally [[for xml schema mapping| http://www.urbandictionary.com/define.php?term=functoid]].
   === There may be more.  Perhaps I better look for another word.  How about &quot;functoon&quot;?  Seems to mean &quot;function&quot; in some language, but I don't know which.
*  Decided to put package pages at the top level of the Haskell wiki, rather than under &quot;Packages&quot;.  Use tags (several per package), not categories!
*  Idea: Give my projects a sort of &quot;inverse FAQ&quot;, in which I ask questions of my users.
*  Correspondence with Iavor about {{{monadLib}}}, including my choice of {{{monadLib}}} vs {{{mtl}}}.  He mentioned that {{{mtl}}} is currently distributed with Hugs &amp; GHC (though maybe not for long), so it's more convenient for users.  I didn't realize that.
*  Discovered that hscolour didn't make anchors for {{{newtype}}}.  Fixed and darcs-sent Malcolm the patch.
*  Mediawikis have &quot;talk&quot; pages that correspond to each content page.  Is that where I want comments to go, rather than a &quot;Comments&quot; page?  What would be the corresponding content page?  I don't know.
*  Wrote up a [[DeepArrow wiki page| http://haskell.org/haskellwiki/DeepArrow]].  Here's a bit saved for the TV page. +++
While thinking about the code for rendering these interfaces into GUIs, I noticed that it contains almost nothing but generic arrow operations.  (//Go to talk about generalized interfaces//.)=== 
  === 
* Misc ++++
*  Gedanken experiment: Imagine using my personal storage and all content on the web entirely without names (addresses) and classification, using (multiple) tagging and searching instead.  There could still be a sort of &quot;name&quot; as a unique identifier, but it would have no semantic content.
*  [[Pandion|http://www.pandion.be]] is an open-protocol, encryping IM client that is extensible via HTML and Javascript.  Imagine cool stuff I could do with Javascript, especially automatically generated from a DSEL and/or Yhc.
  === 
</pre>
</div>
<div title="2007-01-15" modifier="Conal Elliott" modified="200701160433" created="200701151852">
<pre>* Haskell projects ++++
*  Switched from monadLib to mtl. +++
*   DeepArrow: easy (Id -&gt; Identity)
*   Phooey: not so easy.  See replacements below.
*   TV: Trivial (Id -&gt; Identity)
   === I had to make several replacements. +++
|import MonadLib(Id,runId)|import Control.Monad.Identity (Identity,runIdentity)|
|updateR (mine)|local|
||import Control.Monad.Trans|
|MonadT|Control.Monad.MonadTrans|
|BaseM|???|
|inBase|lift^n|
|runReaderT op r|runReaderT r op|
   === 
*  Urk. Hackage wants a single &quot;category&quot; for my libraries.  What category to give DeepArrow?  I made up &quot;Composition&quot;.
*  Gave Cabal another Haddock flag {{{--no-hide-other-modules}}}.
  === 
* Misc ++++
*  Trying out [[mozex| http://mozex.mozdev.org/development.html]] for Emacs via FireFox.  It's more customizable, and it lets me set up a keyboard shortcut (control-space).
  === 
</pre>
</div>
<div title="2007-01-16" modifier="Conal Elliott" modified="200701171023" created="200701162223" tags="2007-01 day">
<pre>* Misc ++++
*  Consider using longlines for my README &amp; CHANGES files.  Will they then wrap when viewed in a browser?  No.  At least not under FireFox.  Oh well.
  === 
* Haskell projects: ++++
*  Lots of great progress.
*  Phooey 0.1 is ready to ship.
*  Idea: instead of defining both curried and uncurried definitions, use {{{uncurryA}}}.  Catch: loses the overall title.  Fix it, by having {{{curryA}}} and ilk preserve &amp; transform outer titles.  Did it.
*  I got all three projects released, announced, and added to Hackage.  Quite a project.
*  Integrated my Cabal tweaks (new Haddock flags) with other patches.  Made a patch for all but the -optP-P issue, and sent to Isaac J.  Query about approach to -optP-P.  When that's all straightened out, I'll release [[cabal-make]].
  === 
</pre>
</div>
<div title="2007-01-20" modifier="Conal Elliott" modified="200701210354" created="200701201745" tags="2007-01 day">
<pre>* Misc ++++
*  What do I want to focus on next?  Blogging!
*  Started list of [[blogging topics]]
*  Note to Haskell list about hyperlinking code formatters. ++++&gt;
I'd like to turn source code (mine and others') into a fully hyperlinked form, in which every name reference links to the name's definition.  Syntax-coloring would be great also.  I see Programmatica.  Is it in use, supported, and reasonably easy to install and use?  Are there other options?
*  I want to rearrange my tiddler view so that tags &amp; tagging are out of the way.  I like the [[MPTW| http://mptw.tiddlyspot.com]] styles, but I don't think I can use them until ZiddlyWiki is caught up to TW 2.1.
   === 
  === 
* Blogging ++++
*  [[interfaces -- combined and separable]]
*  Clarifying a research question for TV ++++
*   TV+Phooey can be thought of as a functional approach to GUIs.  Or maybe the interface part, of type {{{Output UI a}}}, is the type of GUIs for values of type {{{a}}}.  So far TV and Phooey GUIs are very simple.  Does the TV approach scale up to arbitrarily rich GUIs?  To find out, take some rich examples of GUI applications and tease them apart into two parts: the pure value and the GUI.  Then further decompose into simpler TVs.
   === 
  === 
</pre>
</div>
<div title="2007-01-21" modifier="Conal Elliott" modified="200701220451" created="200701220018" tags="2007-01 day">
<pre>* TiddlyWiki: ++++
*  Got tags &amp; tagging out of the way.   Were right-floating.  Now top &amp; bottom.  Lots of CSS tweaking.
*  Tweaked AutoTaggerPlugin so it won't self-tag journal entries.  I'd turned off auto-date-tagging a while back, because of self-taggin.  Now back on.  Emailed my tweak to Eric Shulman (who wrote the plugin).
*  Fixed the problems preventing my TiddlyWiki from working in Internet Explorer.  The problems both came from defining a JS variable in one tiddler that is used in another.  All is fine when I instead extend the core variable {{{config}}}.  I changed &quot;{{{syntaxify}}}&quot; to &quot;{{{config.macros.syntaxify}}}&quot; In SyntaxifyPlugin, and &quot;{{{declareRewrites}}}&quot; to &quot;{{{config.macros.rewrite.declare}}}&quot; in RewritePlugin.  I don't know why dependent plugins can successfully access {{{config}}}, but not {{{syntaxify}}}.
  === 
</pre>
</div>
<div title="2007-01-22" modifier="Conal Elliott" created="200701230718" tags="2007-01 day">
<pre>* Misc ++++
*  Holly &amp; visited Audrey (approaching 14 months old) and went for a walk in the park.  Then lunch with Pat.
*  The PSNCC mailing for [[trainings| http://psncc.org/trainings]] came out this morning, with five of our [[Awakening Compassion| http://awakeningcompassion.com]] classes (four free intros and two five-week series).
  === 
* Haskell projects ++++
*  Tweaked Cabal so that it checks the Haddock version before choosing
*  Adapted [[software releases 2007-01]] as a [[blog entry| http://conal-elliott.blogspot.com/2007/01/software-releases.html]].  Eventually I want my TW to be my blog, say with a special tag that identifies tiddlers as blog entries.
  === 
</pre>
</div>
<div title="2007-01-23" modifier="Conal Elliott" modified="200701250551" created="200701240501" tags="2007-01 day">
<pre>* Misc ++++
*  Got myself a new monitor: 24-inch Gateway FPD2458W.  Huge improvement in space.  Color looks great.  Tiltable (with auto-tilting desktop.)  But there's significant ghosting of black text on white background.  The text isn't as sharp as I'd like, but maybe that's the same issue.  Tried Holly's computer.  Looks great, so the problem is with my computer rather than with the monitor.
*  Looking for a replacement computer: one that has an nVidia card (for stereo head-mount display) and dvi (for high quality signal into the new monitor).  I'd like something fairly light for travel.  Recent graphics processor, for future GPU work (Vertigo re-do).
  === 
</pre>
</div>
<div title="2007-01-24" modifier="Conal Elliott" modified="200701250554" created="200701250344" tags="2007-01 day">
<pre>* Haskell projects ++++
*  There's now a [[wxHaskell wiki page| http://www.haskell.org/haskellwiki/WxHaskell]].  I added pointers to Phooey and TV and found a tip on layout&quot;Got layout troubles? Packing things inside yet another panel seems to help sometimes&quot;.
*  Yep, using that tip, I finally fixed the my horizontal layout problem.  Now all widgets stretch properly.  This fix will improve TV as well for pair inputs and outputs.  Pushed the Phooey patch to the server.
  === 
* [[Computer shopping| computer shopping 2007-01]].  Called Fry's.  Their PC notebooks don't have DVI.  Only one nVidia notebook: 17\&quot; Toshiba Qosmio.  One left, $2700, core 2 duo, 2.0 ghz, 240 GB HD (2x120), nVidia 7600.
</pre>
</div>
<div title="2007-01-25" modifier="Conal Elliott" modified="200701261832" created="200701252213" tags="2007-01 day">
<pre>* More [[computer shopping 2007-01]]
* Joseph pointed me to a neat demo: http://labs.live.com/photosynth.  Didn't work for me, but try again later.
* Haskell projects ++++
*  What's my direction from here? ++++
*   Blog about the grading example.
*   Rebuild Eros on my recent pieces.  Figure out how to do gestural composition without code redundancy.
*   Abstract out wxHaskell specifics from Phooey &amp; TV.  Add a gtk2hs implementation.  Use type classes.  Split Phooey into PhooeyCore, PhooeyWx, and PhooeyGtk.
*   Write up Phooey.  Target ICFP?
   === 
*  [[installing Gtk2Hs]]
  === 
</pre>
</div>
<div title="2007-01-26" modifier="Conal Elliott" modified="200701271637" created="200701262307" tags="2007-01 day">
<pre>* Misc ++++
*  To do: generalize [[smart quotes]] plugin and use it for &quot;{{{@ ... @}}}&quot; in Haskell code.  Did it: [[rewrite delimiters]] and [[rewrite delimiters -- personal]].  But, oops, my approach to Haskell delimiters is bogus.  the plugin re-wikifies the replacement delimiters separately, not in context.  So I'm deleting these new plugins.  (They'll hang around in the Zope store.)
*  Called Portable One to [[ask about Asus A8Js]].
  === </pre>
</div>
<div title="2007-01-27" modifier="Conal Elliott" modified="200701280142" created="200701272300" tags="2007-01 day">
<pre>* TiddlyWiki ++++
*  To support literate Haskell as TW source, I fixed up RewritePlugin to handle LHS and RHS substitution patterns.  Now the at sign syntax is super-easy to specify.  See [[RewritePlugin: Haskell]].
*  Changed SyntaxifyPlugin to syntaxify in-line style code.  In the generated shadow StyleSheetSyntaxify, I factored the font setting out of {{{.viewer div.syntaxify}}}.
*  Added a configuration option to SyntaxifyPlugin to determine whether to show lines in alternating colors (which I don't like).
*  Send the SyntaxifyPlugin changes to Bob M.
*  Now I think I'm ready to go back to my blog post about TV.  Urgh.  I rediscovered the unfriendly interaction between mmm and longlines modes in Emacs.  When a mmm buffer opens up in longlines mode, the long lines actually get broken.  Rats.  What the heck do I do about that?
  === 
</pre>
</div>
<div title="2007-01-28" modifier="Conal Elliott" modified="200701300701" created="200701300700" tags="2007-01 day 2007-01-28">
<pre>* TiddlyWiki ++++
*  Correspondence with Bob M about my tweaks to his SyntaxifyPlugin.
*   My single-identifier haskell expressions are all getting interpreted as
definition lines, due to the simple regexp I used.  Fixed!  Javascript regexps are powerful!  I love the lookahead feature.  Too bad there's not a &quot;lookbehind&quot;.
  === 
* Haskell projects ++++
*  Finished a first draft of [[separating IO from logic -- example]], in the style I'd to use.  It's a literate Haskell program that also works as TiddlyWiki markup.  Ran into some issues. ++++
*   When I use longlines mode, Emacs and GHC have different ideas about line numbers, so my error messages are off.
*   Line spacing rules in TW are such that I have to remove some of my empty lines to eliminate unwanted double empty lines.  Come to think of it, that happens a lot, following bulleted lists and code blocks.  One place this different bites me pasting into GMail.  Fix the problem in TiddlyWiki and update my tiddlers accordingly.  (Tedious, but better sooner than later.)
   === 
  === 
</pre>
</div>
<div title="2007-01-29" modifier="Conal Elliott" created="200701300701" tags="2007-01 day">
<pre>* Corresponded with Bob McElrath about SyntaxifyPlugin and related issues.
* Experimented with copying rendered tiddlers to my Blogger blog.  Requires copying some of my TW CSS into the blog template.  Then I realized that RSS feeds &amp; aggregators won't get the CSS, so my posts will look crummy.  Instead, I'm going to use my blog for teasers that point to tiddlers in my journal.  This way I can also use fancy stuff like nested sliders, Pajama-generated Java applets, etc.  And it may draw Haskell folks into TW.
* Progress on [[separating IO from logic -- example]].  I'm increasingly doubtful about my @Cofunctor@ instance for @Output@ in TV, because I don't know how to combine with the DeepArrow algebra.
</pre>
</div>
<div title="2007-02" modifier="Conal Elliott" modified="200708020131" created="200708020130" tags="2007 February month">
<pre>Type the text for '2007-02'</pre>
</div>
<div title="2007-02-04" modifier="Conal Elliott" modified="200702050331" created="200702050046" tags="2007-02 day">
<pre>* On Friday &amp; Saturday, Jake &amp; I attended [[RecentChangesCamp|2007.RecentChangesCamp.org]].
* Yoips.  The eMagin 3D visor just jumped from $549 to $1500.  See [[this forum discussion|http://www.3dvisor.com/forum/viewtopic.php?t=894]].  I already bought mine, but the price jump means fewer people would be able to use any development work I were to do for it.
* Idea: make a TW formatter that auto-links to Haddock definitions.  For similarity to Haddock, use the notation 'foo'.  Make specially tagged &quot;export tiddlers&quot; containing a module URL and list of names.  At TW initialization, these modules are parsed to make a table that maps names to URLs.  Alternatively, do some ajax magic to make the documentation appear as an overlay.  Maybe hook up with Hoogle.  Or use the {{{.haddock}}} files.  Use the single quotes in regular text (as in Haddock documentation), but drop them in code.
* I tried to factor out file reading in [[separating IO from logic -- example]], but it doesn't type-check.  +++
\begin{code}
coalesceT_2 = tv (oLambda (fmap parseTasks contentsIn)
		          (cofmap show defaultOut))
	         coalesce

gradingT_3 = fromFile &quot;tasks&quot; -&gt;| coalesceT_2 -&gt;| summarizeT -&gt;| toFile &quot;summaries&quot;

grades_6 = runTV gradingT_3 &gt;&gt; runTV (fromFile &quot;summaries&quot;)
\end{code}
=== The problem is that @coalesceT_2@ has a @Task@ input, not a @String@ input.
* Another bit excised, since the mentioned functions are not released yet. +++
This pattern of using an identity function and a file is generally useful, so it has a name, &quot;[[fromFile| http://darcs.haskell.org/packages/TV/doc/html/Interface-TV-IO.html#fromFile]]&quot;.  The command above is equivalent to &quot;@runTV (fromFile &quot;tasks&quot;)@&quot;.  (There is also &quot;[[toFile| http://darcs.haskell.org/packages/TV/doc/html/Interface-TV-IO.html#toFile]]&quot;.)
=== </pre>
</div>
<div title="2007-02-08" modifier="Conal Elliott" modified="200702082300" created="200702082036" tags="2007-02 day">
<pre>* Getting my new computer set up
* I'm having eye strain.  Is it the new computer, or (giant) monitor, or something else?  I've turned the contrast &amp; brightness way down on the new monitor.
* Emailed in a scan of my computer receipt for the free upgrade from XP Pro to Vista Business.
* Some TW correspondence about inheritance &amp; TWs.
* Still mulling over [[composition and interfaces]].  I want to resolve how the DeepArrow composition combinators apply when the shapes aren't as expected.  It may be possible to decompose even primitive pair consumers into pairs of primitive consumers, and then compose in the arrow being @first@- or @second@-lifted.  Even for a primitive function output, in some sense must have a producer of arguments and a consumer of results.  For now, however, I think I'll make the composition functions partial.  I can then eliminate the empty and composition constructors for @Input@ and @Output@ and yield dynamic errors.  Give it a try.
* The new computer runs [[Pan| http://conal.net/Pan]] toys about 5x as fast as my old computer.  Wow!</pre>
</div>
<div title="2007-02-09" modifier="Conal Elliott" modified="200702100853" created="200702100255" tags="2007-02 day">
<pre>* Emacs ++++
*  Worked on the problematic interaction between linelines and mmm modes. ++++
*   If I turn off longlines before turning on mmm, mmm still creates line breaks in the long lines.
*   On the other hand, if longlines was never on to begin with, mmm does not create line breaks.
*   Set some pause points (y-or-n-p) in the mmm-mode code.  The breakage happens during {{{(funcall mode)}}} in {{{mmm-update-mode-info}}} in {{{mmm-region.el}}}.   I guess what happens is that the line breaks ought to be removed but they're not.  
*   Finally fixed this long-standing problem with a tweak to mmm-mode-on.
*   Emailed my fix to the person maintaining mmm-mode, and asked him to integrate the fix.
*   Learned a useful trick.  To track line numbers while compiling, simply turn off longlines mode.
   === 
*  Learned about emacs refill-mode.  Great for typing auto-filled contexts.  As I enter text, the paragraph refills itself.
*  Tweaked my Emacs default frame parameters to better suit my new machine.  More elegant and robust than my previous setup.
*  Use mmm in TWs for submode content other than Haskell code: html, css, and javascript.  Found &amp; installed css-mode and javascript.
  === 
* TiddlyWiki ++++
*  Wondering how to free up space in my TW now consumed by the SideBar.  Studied Eric S's [[TiddlyTools| http://www.tiddlytools.com]].  He uses NestedSlidersPlugin and MoveablePanelPlugin.  Powerful &amp; simple.  I grabbed a bunch of related plugins from TiddlyTools.  I don't yet have the MoveablePanelPlugin stuff working for me.
*  Discovered that SyntaxifyPlugin clobbers the original customClasses formatter.  Fixed it.  Sent note to Bob M about the change.  Looked at the [[trac setup| http://trac.tiddlywiki.org/tiddlywiki/browser/Trunk/contributors/BobMcElrath/plugins/syntaxify.js]].  I want to learn to work with trac and svn.
  === 
* Misc ++++
*  Trying out Second Life, to see how my new computer does.
*  Idea: implement twee and untwee by means of [[bi-directional arrow combinators| http://www.cs.ru.nl/A.vanWeelden/bi-arrows]].  Hmm... do bi-arrows fit DeepArrow?
*  There's a [[joystick emulator for the z800| http://raeldor.blogspot.com/2006/09/z800-joystick-emulator-released.html]].
  === 
</pre>
</div>
<div title="2007-02-10" modifier="Conal Elliott" created="200702110421" tags="2007-02 day">
<pre>* Tinking and correspondence with Chris Klimas about twee/untwee.
* I want to get [[separating IO from logic -- example]] out for people to read.  Updated TV/CHANGES.  This example does not depend on Phooey or wxHaskell at all, and wxHaskell is difficult to install.  It might be a good time to split TV into a core TV (with KIO) and a TV-phooey.
* TV-0.1 release +++
*  Removed iEmpty &amp; iEmpty and corresponding constructors. Generate dynamic errors earlier rather than later.
*  Removed ICompose &amp; OCompose constructors.  Redefined iCompose and oCompose (and consequently fmap on inputs and cofmap on outputs) to work only on (possibly titled) primitives.  I don't know how to implement the DeepArrow algebra with OCompose.
*  Added wrapO and wrapAO, sort of analogous (or dual) to wrapF.  I'm not sure the name is a great choice.  I've also considered &quot;unwrapO&quot;.
*  Added readShow, defined via wrapO.
*  Redefined interactRSOut via readShow and renamed &quot;interactLineRS&quot;. Added &quot;interactRS&quot;.
*  Added fromFile &amp; toFile TV functions.
*  Added fileOut
*  Moved Grading example from src/Examples.hs to src/Grading.hs
*  Added &quot;short lines&quot; example to src/Examples.hs.
*  Added type alias RunTV for defining types of runTV specializations, such as runUI and runIO.
  === 
* TV-0.1.1 release:  ++++
*  Changed all files to *nix-style line endings.
*  Restored source pointers in docs.  Had gotten lost.
  === 
* Big improvements in my build &amp; test proces.  Much more automated now. ++++
*  Extract package name and version from .cabal file
*  Targets: {{{darcs-repo}}}, {{{darcs-tag}}}, {{{darcs-dist}}}, {{{test-get-build}}}.
  === Simplified [[project release check-list]].
*  Pushed changes, made dist, updated hackage for DeepArrow-0.0.1, phooey-0.2.1, TV-0.1.1.
</pre>
</div>
<div title="2007-02-11" modifier="Conal Elliott" modified="200702122025" created="200702122024" tags="2007-02 day">
<pre>* [[How and Why AJAX, Not Java, Became the Favored Technology for RIAs|http://ajaxworldmagazine.com/read/333329.htm]] (rich internet applications).  See in particular the discussion of Flash+ActionScript as an alternative to Java.  May be a good target for some of my work.
* Separating out TV &amp; GuiTV.
</pre>
</div>
<div title="2007-02-12" modifier="Conal Elliott" created="200702130523" tags="2007-02 day">
<pre>* Released TV 0.2 and GuiTV 0.2.  Mainly, the releases are about separating out GUI functionality so that core TV is easier to install.
* Made [[teaser blog post|http://conal-elliott.blogspot.com/2007/02/separating-io-from-logic-example.html]] for [[separating IO from logic -- example]].
* Ran into strange problem with a class instance getting lost when re-exporting a module.  Sent note to haskell list.</pre>
</div>
<div title="2007-02-13" modifier="Conal Elliott" modified="200702132322" created="200702131828" tags="2007-02 day">
<pre>* Submitted a [[bug report| http://hackage.haskell.org/trac/ghc/ticket/1145]] for the import problem mentioned yesterday.
* I heard back that my TW fails under Opera (which I'd forgotten).  Found &amp; fixed the problem.  Opera didn't like the regexp {{{{code} }}}used in [[RewritePlugin: Haskell]].  I added back-slashes before the braces, and now FF, IE, and Opera are all happy.  Hooray!
* Some choices for next focus ++++
*  [[cabal-make]] ++++
*   Set up a repo on darcs.haskell.org
*   Improve documentation: file comments, wiki, blog post
   === 
*  [[TV]] ++++
*   Come up with a simple [[HAppS| http://happs.org]] application and make it with TV.  See the [[tutorial| http://www.haskell.org/haskellwiki/HAppS_tutorial]].
   === 
*  [[Eros]] ++++
*   Continue the rebuilding of Eros on Phooey &amp; TV.
   === 
*  [[Phooey]] ++++
*   Return to the Phooey paper.  Explain how Phooey works.  Inversion of control.
   === 
  === 
</pre>
</div>
<div title="2007-02-14" modifier="Conal Elliott" modified="200702142352" created="200702141845" tags="2007-02 day">
<pre>* Thoughts on the [[Phooey]] paper ++++
*  Mix some top-down &amp; bottom-up in the presentation.  Construct the UI arrow on top of the UI monad before constructing the UI monad.
*  Put it together first without the layout monad and then define and mix it in with a simple tweak.
*  Now the development is pretty simple ++++
*   Define UI on top of UIM via the AmA arrow-and-monad transformer
*   Implement UIM on top of CB (the &quot;callback&quot; monad transformer)
*   Toss in simple frame creation (runWx).
*   Add layout, via TagT and LayoutT and a small tweak to UIM.
   === 
  === 
* [[cabal-make]] ++++
*  Correspondence with Eric Yow about my broken wxHaskell doc links.  He think haddock changed its convention (dot vs dash for module name separators).  I'm puzzled.  I whipped up a shell script to make symlinks, at Eric's suggestion.
*  Switched to CSS, on ndm's suggestion.  The cabal-make settings determine the hscolour.css file.  I have a cross-project copy in {{{~/Haskell}}}.
*  Added a substitution for the haddock &quot;FILE&quot; variable (like the &quot;MODULE&quot; variable), so that I can put the hscolour'd source files all into one directory, which enables sharing of a common hscolour.css.  Sent patch to Simon Marlow.
*  [[hscolour| http://www.cs.york.ac.uk/fp/darcs/hscolour]] flag changes.
  === 
</pre>
</div>
<div title="2007-02-15" modifier="Conal Elliott" modified="200702161900" created="200702161859" tags="2007-02 day">
<pre>* Getting [[lhs2TeX| http://www.iai.uni-bonn.de/~loeh/lhs2tex/]] working, with help from Andres.  Works now.</pre>
</div>
<div title="2007-02-16" modifier="Conal Elliott" created="200702161900" tags="2007-02 day">
<pre>* Morning readings ++++
* [[OnceAndOnlyOnce| http://c2.com/ppr/wiki/WikiPagesAboutRefactoring/OnceAndOnlyOnce.html]]
*  [[MysticalProgramming| http://c2.com/cgi/wiki?MysticalProgramming]]
* [[CodeSmell| http://c2.com/ppr/wiki/WikiPagesAboutRefactoring/CodeSmell.html]]
*  [[DrivingMetaphor| http://c2.com/cgi/wiki?DrivingMetaphor]] (and contained links): could apply to the game of [[Making
Life Wonderful]].
*  [[DependencyInjection| http://c2.com/cgi/wiki?DependencyInjection]]
*  [[A Lisp dream| http://xkcd.com/comics/lisp.jpg]]
  === </pre>
</div>
<div title="2007-02-17" modifier="Conal Elliott" modified="200702172322" created="200702172126" tags="2007-02 day">
<pre>* Made a [[user page| http://haskell.org/haskellwiki/User:Conal]] for myself on the Haskell wiki.
* [[cabal-make]] ++++
*  Explored alternatives for placing hscolour'd source code.  Gave up.  Added a comment to {{{cabal-make.inc}}}. +++&gt;
Note: (a) no project-level source link (--source-base), and (b) hscolour'd source code is generated at &quot;dist/src.Foo.Bar.hs.html&quot;.  I prefer (a) project-level source link and (b) &quot;dist/src/Foo.Bar.hs.html&quot;, but I don't know how to get haddock to keep the first slash and replace the others.  I took out source-base rather than link to a directory that mixes hscolour'd code and haddock docs.  Better solution: add a hscolour flag for the hscolour.css file location, and put the sources back into a tree with links to that file.  I don't know how to construct the necessary relative references, which would be something like &quot;../../hscolour.css&quot;.  Another idea: add per-source-directory symlinks to the shared CSS.  Simple but less browser-cache-friendly.  I don't know how to make this idea work either, since I don't know how to make real symlinks in my cygwin environment. === 
*  Eliminated the requirement that the {{{Exposed-Modules:}}} Cabal spec line could not contain the first module.  Made the regexp more flexible and added a {{{sed}}}.
   === </pre>
</div>
<div title="2007-02-19" modifier="Conal Elliott" modified="200702191943" created="200702191937" tags="2007-02 day">
<pre>* Correspondence with Wolfgang Jeltsch.  He spotted a problem in my @AmA@ formulation in [[Phooey]].  I doubt there's a solution at the current level of generality, i.e., with an arbitrary monad for //m//.  Also, my definition of @Source = IO@ fails to capture the read-only property of sources.  Look for another formulation, and then revisit @AmA@.</pre>
</div>
<div title="2007-02-21" modifier="Conal Elliott" created="200702212039" tags="2007-02 day">
<pre>* First reading of [[Applicative programming with effects| http://www.soi.city.ac.uk/~ross/papers/Applicative.pdf]].  Swapped out @Monad@ for @Applicative@ in Phooey.  Renamed AmA to AAA.
</pre>
</div>
<div title="2007-02-22" modifier="Conal Elliott" modified="200702230904" created="200702230101" tags="2007-02 day">
<pre>* Thinking, talking with Holly, and correspondence about some NWCompass issues, including inclusion/exclusion and &quot;trust&quot;. 
* Created a blog &quot;[[Evolving NVC| http://awakeningcompassion.com/evolving]]&quot;.  Wrote a note called &quot;[[Trust that| http://awakeningcompassion.com/evolving/?p=3]]&quot; and another called &quot;[[Promises, predictions, and wishes| http://awakeningcompassion.com/evolving/?p=4]]&quot;.
* Contemplating applicative functors &amp; Phooey.</pre>
</div>
<div title="2007-02-23" modifier="Conal Elliott" modified="200702240220" created="200702240219" tags="2007-02 day">
<pre>* NVC ++++
*  I'm gathering the understanding that the implementation of sociocracy got seriously off track at the Feb 3/4 retreat and since then.  I've been talking with various folks, piecing together and mulling over what's going on currently in the group's efforts to implement sociocracy.
*  Blogging ++++
*   [[Trouble at the beginning| http://awakeningcompassion.com/evolve/?p=7]]
*   [[Some comments on the word &quot;trainer&quot;| http://awakeningcompassion.com/evolve/?p=8]]
   === 
  === 
* Haskell projects ++++
*  Thinking about applicative functors for data-driven computation/evaluation.  (Paper title: &quot;Functional interfaces for data-driven evaluation&quot;.)  Seems a great fit.  Idea: instead of treating inputs &amp; outputs differently, have outputs be IO-valued data-driven computations.
  === 
</pre>
</div>
<div title="2007-02-25" modifier="Conal Elliott" created="200702251719" tags="2007-02 day">
<pre>* Got some feedback from the sociocray yahoo group.  Wrote another blog post: [[Clear aims| http://awakeningcompassion.com/evolve/?p=9]].
* Progress on applicative functors for UIs.  So far it's a great fit.  Pretty similar in implementation to the monadic style, but allows me to hide the value sources.  I think it tracks dependencies much better than the monad (and better than the arrow layered on the monad).  In &quot;//liftAm f a1 ... am//&quot;, there's a dependency of the whole on each of the //ai//, but no dependencies among the //ai//.</pre>
</div>
<div title="2007-02-28" modifier="Conal Elliott" modified="200703010522" created="200703010338" tags="2007-02 day">
<pre>* NVC ++++
*  Last night's class in &quot;[[A Journey Through the Heart of Nonviolent Communication| http://awakeningcompassion.com/seattleunitywinter07.htm]]&quot; was fantastic!  We're delighted with our new approach to teaching NVC Consciousness &amp; skills (not OFNR!).  Our class members (we chose to be 15 of them) is loving it also.  Sandy came last night and raved at length &amp; depth afterward.
*  On Monday, we gave an NVC intro (same approach) to the [[Washington Health Foundation| http://www.whf.org]].  All of us present ate it up!
*  In-depth exchanges with Doug, Barb, Liv, and Sandy regarding our sociocracy, mission, and inclusion.
*  Some sociocracy correspondence in response to an internal dissonance between the my understandings of the intentions and the language.  I'll blog about my insights soon on [[NVC Evolves| http://awakeningcompassion.com/evolve]].
*  Long response to Sharon V who moderates the online sociocracy discussion group.  She did not approve a note of mine describing my intention/language dissonance.
*  I'm spending a big fraction of my time in these NVC &amp; sociocracy issues (and not as much on my ICFP papers).  I'm fairly unattached to persuading anyone or getting my preferred policies, especially since I'm moving back to CA soon.  Having my [[NVC Evolves| http://awakeningcompassion.com/evolve]] blog, however, gives me a place to publish the insights I'm getting.  Some others on the planet can then discover these insights and join in community with me.  That's enough for me.
*  I love this quote from Krishnamurth, describing his secret:  &quot;I don't mind what happens.&quot;
  === 
* Haskell projects ++++
*  The applicative functor interface is working out very nicely for data-driven computation and for GUIs.  Simpler and more efficient (tighter change propagation).
*  Next, what about TV?  I've formulated it in terms of arrows.  How about applicative functors?
*  There's a wiki page on [[Haskell-related blog articles| http://haskell.org/haskellwiki/Blog_articles]].  I added my [[separating IO from logic -- example]].
  === 
</pre>
</div>
<div title="2007-03" modifier="Conal Elliott" created="200708020131" tags="2007 March month">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2007-03-02" modifier="Conal Elliott" modified="200703022240" created="200703021658" tags="2007-03 day">
<pre>* Updated the what's-new list on my [[home page| http://conal.net]].  I really want to take a whole new approach to my home page and web site.  Something that shows the overall structure and invites the reader into exploring sections.  Would I want a TiddlyWiki?
* In using applicative functors for Phooey &amp; TV, address some questions. ++++ 

How to model outputs (value consumers)?  Currently I use @a ~&gt; ()@.  If I have an applicative functor F that represents sources of values, I can map inputs to F.  What about outputs?  Consider an output (type-specialized):
\begin{code}
stringOut :: Output UI String
\end{code}
 I might map @stringOut@ to
\begin{code}
stringDisplay :: UI (String -&gt; IO ())
\end{code}
Alternatively, to
\begin{code}
(stringDisplay &lt;*&gt;) :: UI String -&gt; UI (IO ())
\end{code}
I'd probably want to use @fromBottomL@ for @presentLambda@, to get the output below the input.

How to deduce the choice of @IO@ here or eliminate the need for it?

Idea: compose the applicative UI functor with a Kleisli arrow to make a new arrow:
\begin{code}
type UIA = UI :.:: KIO
\end{code}
where @:.::@ composes unary and binary type constructors. ++++
\begin{code}
newtype (f :.:: (~&gt;)) a b = T_TT { runT_TT :: f (a ~&gt; b) }

instance (Applicative f, Arrow (~&gt;)) =&gt; Arrow (f :.:: (~&gt;)) where
  pure              = T_TT . pure . A.pure
  T_TT f &gt;&gt;&gt; T_TT g = T_TT (liftA2 (&gt;&gt;&gt;) f g)
  first (T_TT f)    = T_TT (liftA first f)
\end{code}
  ===  Now I can just change Phooey to use the applicative functor interface, and leave TV to work with arrows.

On the other hand, I don't make much use of arrows in TV, mostly @a ~&gt; ()@ and @() ~&gt; b@.  Maybe there's a simple &amp; general way to have the output type determined.  Maybe an associated type.
 === </pre>
</div>
<div title="2007-03-03" modifier="Conal Elliott" modified="200703052000" created="200703051852" tags="2007-03 day 2007-03-05">
<pre>* Haskell projects ++++
*  I'm pretty happy with my small, simple @DataDriven@ library and its use in @ApplicativeUI@.  Next, rebuild @MonadUI@, using @DataDriven@.
* Redid @MonadUI@.  ++++
Wow.  Now @ApplicativeUI@ will fit right on top of it.  In the new @MonadUI@,
\begin{code}
type UI = ReaderT Win (LayoutT IO)

type Source = DataDriven IO

type Upd = Updater IO  -- IO ()
\end{code}
Widgets have types like
\begin{code}
stringDisplay :: Source String -&gt; UI (Source Upd)

textEntry :: UI (Source String)
\end{code}
I haven't yet figured out how to handle things like sliders with dynamic bounds, i.e., widgets that have both an input and an output aspect.
   === 
  === 
</pre>
</div>
<div title="2007-03-07" modifier="Conal Elliott" modified="200703071933" created="200703071918">
<pre>* Haskell projects ++++
*  More recent progress reworking [[Phooey]] on top of applicative functors.  It's all getting very simple.
*  One key simplification was to change the monadic version so that &quot;sources&quot; are data-driven values, rather than simple IO computations.  It was then easy to rebuild the applicative version on top of the monadic version.
*  I explored why my recursive examples blow up.  For instance, ++++
\begin{code}
ui4 :: UI (Source ())
ui4 = mdo  lo &lt;- isliderDyn (pair (pure 0)  hi) 3
           hi &lt;- isliderDyn (pair lo (pure 10)) 8
           return (pure ())

pair :: Applicative f =&gt; f a -&gt; f b -&gt; f (a,b)
pair = liftA2 (,)
\end{code}
   === I think the problem is that both widgets try to extract a value from the other when they're created.  Possible solution: bubble up delayed actions during UI creation.  I could probably do it with a simple @WriterT@ monad transformer.  In mtl, @WriterT@ works with arbitrary monoids, not just lists.  So I don't even have to make a list of actions and then sequence them.
  === 
* NVC ++++
*  I love how our Seattle Unity series is going.  We had our fourth (three-hour) meeting out of six last night, and then stayed after to talk for another hour.  Pretty deep.
  === 

</pre>
</div>
<div title="2007-03-08" modifier="Conal Elliott" modified="200703091757" created="200703081928" tags="2007-03 day">
<pre>* Haskell projects / ICFP prep ++++
*  Where am I now? ++++
*   I like the applicative functor approach for data-driven computation and GUIs.
*   Dynamic sliders work in the monad version but not the arrow version.  Odd.
   === 
*  Where to go? ++++
*   Define scope of papers and get focused on writing.
*   More &quot;event&quot; stuff.  Cumulative data-driven computations.  Examples.
*   I want to get some missing instances into the standard libraries.
*   Get dynamic sliders working in arrow interface.
*   Recursive version of MonadUI, ArrowUI.  What about ApplicativeUI?  Is there a standard fixpoint operator?
*   Do I want to re-do TV on top of an applicative interface or leave in terms of arrow?
*   Could I build ArrowUI on ApplicativeUI?
*   Remove the Phooey module and recommend that apps directly import MonadUI, ApplicativeUI, or ArrowUI.  Maybe rename them Phooey/{Monad,Applicative,Arrow}.hs.
   === 
*  Possible paper topics ++++
*   &quot;Interfaces for Data-Driven Computation&quot;, or &quot;Imperative GUIs -- Phooey!  Simple Functional Approaches to GUI Programming&quot;
*   &quot;Tangible Values and Composable Interfaces&quot;
*   &quot;Functional Programming by Interacting with Tangible Values&quot;
   === 
*  Made a Haskell wiki page with my current [[type composition| http://haskell.org/haskellwiki/TypeComposition]] module, asking for comments &amp; suggestions.
  === 
</pre>
</div>
<div title="2007-03-09" modifier="Conal Elliott" modified="200703130126" created="200703092104" tags="2007-03 day">
<pre>* Haskell projects / ICFP prep ++++
*  Here's a paper I'd love to submit: &quot;GUIs are visualizations of pure functional values&quot;. ++++
*   Currently it's more of a thesis statement than a demonstration.
*   [[TV]] points in this direction.
*   To really have a paper, demonstrate the thesis with typical and varied GUI examples.
*   Not just graphical interfaces, but also IO, as in [[separating IO from logic -- example]]
   === 
*  Discovered a wonderful simplification of the @DataDriven@ implementation. ++++
Reading the @Applicative@ source code, I ran across this definition:
\begin{code}
instance Monoid a =&gt; Applicative ((,) a) where
    pure x = (mempty, x)
    (u, f) &lt;*&gt; (v, x) = (u `mappend` v, f x)
\end{code}
(I asked about the motivation for  this definition and learned that it corresponds to the writer monad.)  Note how similar this code is to my @DataDriven@ instance:
\begin{code}
data DataDriven src m a = DD { current :: src a, subscribe :: m }
 
instance (Monoid m, Applicative src)
      =&gt; Applicative (DataDriven src m) where
  pure a = DD (pure a) mempty
  DD srcF subF &lt;*&gt; DD srcX subX =
         DD (srcF &lt;*&gt; srcX) (subF `mappend` subX)
\end{code}
Aha!  My @DataDriven@ definition is isomorphic to a simple composition:
\begin{code}
type DD src m = (,) m :.: src
\end{code}
I can even replace the monoid instance
\begin{code}
-- standard Monoid instance for Applicative applied to Monoid
instance (Applicative (DataDriven src m), Monoid a)
      =&gt; Monoid (DataDriven src m a) where
  { mempty = pure mempty; mappend = (*&gt;) }
\end{code}
with this more general version
\begin{code}
-- standard Monoid instance for Applicative applied to Monoid
instance (Applicative (f :.: g), Monoid a)
      =&gt; Monoid ((f :.: g) a) where
  { mempty = pure mempty; mappend = (*&gt;) }
\end{code}
Note that the @Applicative@ constraint is implied by @Applicative f@ and @Applicative g@, thanks to the @Applicative@ instance for @f :.: g@.  I use the form above, because it's totally boilerplate.
   === 
  === 
</pre>
</div>
<div title="2007-03-12" modifier="Conal Elliott" modified="200703130136" created="200703122027" tags="2007-03 day">
<pre>* Haskell projects / ICFP prep ++++
*  Where to go from here with Phooey?  I could make a simplified version with data-driven values, a monad, and an applicative functor.  At first omit even flexible layout.  
*  What about TV, which currently expects an arrow?   ++++
*   Can I change it to work with a functor and a cofunctor?
*   Would I parameterize by both a functor &amp; cofunctor?
*   Or maybe use functional dependencies or [[indexed types| http://haskell.org/haskellwiki/GHC/Indexed_types]] (in GHC 6.7+).
*   For Phooey, I have a functor (the applicative functor @UI@).  What's the cofunctor?  ++++
I think it's @Consumer UI IO@, where
\begin{code}
newtype Consumer f src a = Consumer (f (a -&gt; src ()))

instance Functor f =&gt; Cofunctor (Consumer f src) where
  cofmap h (Consumer f) = Consumer (fmap (. h) f)
\end{code}
However, I can factor @Consumer@ very nicely
\begin{code}
instance (Functor g, Cofunctor f) =&gt; Cofunctor (g :.: f) where
  cofmap h (T_T gf) = T_T (fmap (cofmap h) gf)

newtype Flip g b a = Flip (g a b)

instance Arrow (~&gt;) =&gt; Cofunctor (Flip (~&gt;) b) where
  cofmap h (Flip f) = Flip (arr h &gt;&gt;&gt; f)

type Consumer f src = f :.: Flip (-&gt;) (src ())
\end{code}

Here's another definition
\begin{code}
newtype Consumer' f src a = Consumer' (f a -&gt; src ())
\end{code}
Or, factored:
\begin{code}
type Consumer' f src = Flip (-&gt;) (src ()) :.: f
\end{code}
and that version needs the following, also compelling, definition for @Cofunctor (g :.: f)@
\begin{code}
instance (Cofunctor g, Functor f) =&gt; Cofunctor (g :.: f) where
  cofmap h (T_T gf) = T_T (cofmap (fmap h) gf)
\end{code}
If I provide both instances, GHC says &quot;Duplicate instance declarations&quot;.  What to do?
    === 
   === 
*  Idea: use associated types in Eros, to eliminate the continuation passing style used in interpreting gestures.
  === 
</pre>
</div>
<div title="2007-03-29" modifier="Conal Elliott" created="200703300757" tags="2007-03 day 2007-03-30">
<pre>Lately:
* Getting ready to move to California (house in the woods on 20 acres).  Leaving Friday April 6.
* Worked quite a bit on [[Tangible Functional Programming| http://conal.net/papers/Eros]].  I put a draft and [[blogged| http://conal-elliott.blogspot.com/2007/03/icfp-07-paper-draft-comments-please.html]], which got onto Planet Haskell, [[programming reddit| http://programming.reddit.com/search?q=conal]], and [[Lambda the Ultimate| http://lambda-the-ultimate.org/node/2159]], yielding a couple thousand visitors.  I asked for comments.  The paper is due April 6 (moving day).
* Just now, I put out [[Phooey| http://haskell.org/haskellwiki/Phooey]] 1.0 and [[TypeCompose| http://haskell.org/haskellwiki/TypeCompose]] 0.0.  I sent Wolfgang Jeltsch a pointer and asked him to give it a try and let me know what happens.  I'd told him about my new applicative functor approach, and he's now done it also in his &quot;Vegetables&quot; system.  He's planning to submit to the Haskell Workshop, as I am.  I suggested we explore options, including collaboration.  I don't yet know what his contributions would be.</pre>
</div>
<div title="2007-04" modifier="Conal Elliott" modified="200801120317" created="200708020131" tags="2007 April month" changecount="2">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2007-04-22" modifier="Conal Elliott" modified="200707040049" created="200707040048" tags="2007-04 day">
<pre>* I'm reading Alan Watts's &quot;The Wisdom of Insecurity&quot;.  Some favorite passages ++++
&gt; Human beings appear to be happy just so long as they have a future to which they can look forward--whether it be a &quot;good time&quot; tomorrow or an everlasting life beyond the grave.  For various reasons, more and more people find it hard to believe in the latter.  On the other hand, the former has the disadvantage that when this &quot;good time&quot; arrives, it is difficult to enjoy it to the full without some promise of more to come.  If happiness always depends on something expected in the future, we are chasing a will-o'-the-wisp that ever eludes our grasp, until the future, and ourselves, vanish into the abyss of death. [p 15]

&gt; The common error of ordinary religious practice is to mistake the symbol for the reality, to look at the finger pointing the way and then to suck it for comfort rather than follow it.  Religious ideas are like words--of little use, and often misleading, unless you know the concrete realities to which they refer.  The word &quot;water&quot; is a useful means of communication amongst those who know water.  The same is true of the word and the idea called &quot;God&quot;. [p 23]

&gt; We must here make a clear distinction belief and faith, because, in general practice, belief has come to mean a state of mind which is almost the opposite of faith.  Belief, as I use the word here, is the insistence that the truth is what one would &quot;lief&quot; or wish it to be.  The believer will open his mind to the truth on condition that it fits with his preconceived ideas and wishes.  Faith, on the other hand, is an unreserved opening of the mind to the truth, whatever it may turn out to be.  Faith has no preconceptions; it is a plunge into the  unknown.  Belief clings, buth faith lets go.  In this sense of the word, faith is the essential virtue of science, and likewise of any religion that is not self-deception. [p 24]

&gt; You can only know God through an open mind just as you can only see the sky through a clear window.  You will not see the sky if you have covered the glass with blue paint. [p. 25]

&gt; What religion calls the vision of God is found in giving up any belief in the idea of God. [p. 27]
  === 
</pre>
</div>
<div title="2007-04-23" modifier="Conal Elliott" created="200707040049" tags="2007-04 day">
<pre>* My applicative functor formulation of [[Phooey]] points to an idea for changing TV.  Instead of an Input Functor and an Output cofunctor, have just Input.  Define @Output a = Input (Sink a)@, perhaps generalizing Sink to some other cofunctor or comonad.  Note that a functor &amp; cofunctor composed yield a cofunctor, as expected.  Problem: I represent Output as an (generalized) algebraic data type so I can transform it via the DeepArrow combinators.
* [[WiPeer| http://www.wipeer.com]] is free software that enables wi-fi computers to connect without a router.</pre>
</div>
<div title="2007-04-26" modifier="Conal Elliott" created="200705010112" tags="2007-04 day">
<pre>* I've been side-tracked from software work by the Murray Creek move and settling in.  What might I work on now? ++++
*  Paper for Haskell Workshop.  About what? ++++
*   Phooey and data-driven computation.
*   TV for a variety of &quot;interface&quot; arrows.
   === 
*  Think more about the Zipper.  Could it be an instance of my favorite Wand paper (&quot;Continuation-Based Program Transformation Strategies&quot;, I think JACM 1980)?  What happens with more static typing, as in a statically typed object language?
*  Eliminate the complicated continuations in my Eros implementation.  Explore using associated types instead.
*  More generally, work on refactoring Eros and preparing for release.
*  Get Pajama re-factored and released.
*  Misc new projects ++++
*   Get going on something 3D, especially with gloves and head-tracking head-mounted display in mind.  I'll be getting the P5 gloves soon.
*   Music/sound synthesis
   === 
  === </pre>
</div>
<div title="2007-04-27" modifier="Conal Elliott" created="200707040051" tags="2007-04 day">
<pre>* Some links: ++++
*  Found [[Windows keyboard shortcuts| http://www.smartcomputing.com/editorial/article.asp?article=articles/archive/l0811/12l11/12l11.asp]]
*  [[clipmarks|http://www.clipmarks.com]]: Social web content clipping.
*  [[Genuine Curiosity| http://www.genuinecuriosity.com]]
  === 
* Responded to [[Eros paper comments from Kragen]]
</pre>
</div>
<div title="2007-04-28" modifier="Conal Elliott" created="200707040052" tags="2007-04 day">
<pre>* Idea: incremental web page viewing.  When I visit a web page, the server sends me a delta, i.e., a description of an edit that brings my copy up to date.  Ditto for any mutable data on the internet.  Could such a thing be rigged up from a version control system?
* In general, design web sites and services with streaming in mind, rather than a single block of data.  Consider these examples: blog, tiddlywiki, catalog.  Hm.  Make this description clearer, since (I think) HTML already streams into a web browser.
</pre>
</div>
<div title="2007-04-29" modifier="Conal Elliott" modified="200707040059" created="200707040057" tags="2007-04 day">
<pre>* Describing the Koch curve (inspired by [[A quick diversion| http://calculist.blogspot.com/2007/04/quick-diversion.html]]).  Some thoughts ++++
Use a single representation for all levels of detail.  Have a constructor that provides an approximation and an exact version.  For the Koch curve, the approximation will be a line segment, and the exact version will be nine transformed versions of the whole.

The transformations are (a) uniform scale (by 1/5 for the Koch curve), (b) turn left, (c) turn right, and translate (to the end of the canonical line segment).

Provide a render function that turns an abstract curve description into a stream of drawing commands, given a depth or epsilon.

\begin{code}
data Figure = LineSeg | Xfo Transform Figure | Figs [Figure] | Approx Figure Figure

fractal :: [Transform] -&gt; Figure
fractal xfos = frac
 where
   frac = Approx LineSeg (Figs [Xfo xfo frac | xfo &lt;- xfos])
\end{code}
=== 
* I'm reading Alan Watts's book &quot;The Wisdom of Insecurity&quot;.  The following passage touches the heart of what I wanted to get at in my post &quot;Trust that ...&quot; ++++&gt;
We must here make a clear distinction belief and faith, because, in general practice, belief has come to mean a state of mind which is almost the opposite of faith.  Belief, as I use the word here, is the insistence that the truth is what one would &quot;lief&quot; or wish it to be.  The believer will open his mind to the truth on condition that it fits with his preconceived ideas and wishes.  Faith, on the other hand, is an unreserved opening of the mind to the truth, whatever it may turn out to be.  Faith has no preconceptions; it is a plunge into the  unknown.  Belief clings, buth faith lets go.
=== What Watts calls &quot;faith&quot;, one might also call &quot;Trust&quot;, and what he calls &quot;belief&quot;, one might call &quot;trust that ...&quot;.  In this sense, the need for &quot;Trust&quot; does not depend on someone acting a certain way and so is re-aligned with what we call &quot;needs&quot; in NVC.

</pre>
</div>
<div title="2007-05" modifier="Conal Elliott" created="200801120317" tags="2007 May month" changecount="1">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2007-05-11" modifier="Conal Elliott" created="200707040100" tags="2007-05 day">
<pre>* Called Starband: 888-424-4121 (option 4 for &quot;maintenance event&quot;).  Notes: ++++
*  We have a &quot;SkyEdge&quot; modem.
*  For modem/dish info, visit 192.168.1.1.  Oops -- IP conflict with the router.  Had to direct-connect for now.  Click on &quot;telemetry&quot; and confirmed that the second number was 7ish dB rather than 5 or lower.
*  Started using testmy.net for speed test.
*  Ron noticed that we're in the bandwidth penalty box.
*  Info on our limit: ++++
*   Limit: 976.6mB in a 7 day window.  When hit, we get throttled until our 7 day window bandwidth is 683.6mB.
*   History: May 5: 173mB, 6: 381mB, 7,8,9 negligible, 10: 419, 11: 362.
*   To track our usage: sign in to starband.net, click &quot;my accounts&quot;, then link at page bottom to usage graph.
   === 
  === 
</pre>
</div>
<div title="2007-05-12" modifier="Conal Elliott" created="200707040101" tags="2007-05 day">
<pre>* Tracking bandwidth usage with the [[Starband monitor| http://www.starband.net/monitor/viewgraph.aspx?gp=1]].  I suspect that bandwidth gets eaten even when both computers are suspended.  Try again.  11:23:58, 16.9MB.  Suspending.
</pre>
</div>
<div title="2007-05-15" modifier="Conal Elliott" created="200707040101" tags="2007-05 day">
<pre>* A while back, Wolfgang J pointed out an inefficiency of the UI arrow in Phooey, related to automatic splitting and merging of pair-valued sources.  His solution is to keep sources explicit.  Another idea is to use type functions to avoid having to cram multiple sources into one.  Similar to Manuel Ch's trick of efficient array representations.  Catch: if only some types can be handled, then I can't strictly implement the arrow interface.
* Reimplemented Phooey's applicative functor (AF) interface very simply, using type composition. ++++
\begin{code}
type Extractor  = IO
type Notifier   = IO () -&gt; IO ()

type DataDriven nfr xtr = (,) nfr `O` xtr

type Source = DataDriven Notifier Extractor

type UI = (-&gt;) Win `O` IO `O` (,) Layout `O` Source
\end{code}
I'm not sure the abstraction is worth it here.  Alternatively,
\begin{code}
type Source = (,) Notifier `O` Extractor

type Source = (,) (IO () -&gt; IO ()) `O` IO
\end{code}
All in one:
\begin{code}
type UI = (-&gt;) Win `O` IO `O` (,) Layout `O` (,) (IO () -&gt; IO ()) `O` IO
\end{code}
  === 
</pre>
</div>
<div title="2007-05-23" modifier="Conal Elliott" created="200707040102" tags="2007-05 day">
<pre>* Talked to Paul at OmniVision and with Joseph.  We're going to get mom set up with new modem &amp; service rather than moving the old.  I got the process started.  For now, I set it all up in my name and gave my EJ visa debit card number for the $600 installation.  Call Paul before Friday if I want to tweak anything about billing.  One glitch: I gave him mom's phone number, and I really want mine to be the contact.
* Notes from Jim Lee's sermon on May 6 at Christ Unity church ++++
*  &quot;Despite appearances to the contrary ...&quot;.  Shoot for more: see how the appearances are in fact consistent.
*  Jesus spoke clearly &amp; compellingly.  Idea: form a group for developing clear &amp; compelling expressions of what each member cares about.  Embrace and leverage diverse orientations.
*  See the condition of &quot;unforgiveness&quot; as Right/Wrong thinking.  The cure is not to &quot;forgive&quot; a wrong, but rather to let go of one's belief in the notion of wrong.
*  Heaven is a verb: to rise, to elevate one's perspective.  Heaven isn't &quot;up there&quot;; it's orienting myself in an upward direction, energetically.
  === 
* I got my ICFP reviews back today, beginning the 48-hour response period.  I'm satisfied with the reviewers' understanding, so I won't respond.
* I thought I'd have a Haskell Workshop submission on Phooey, but maybe there's not enough to say.  I love the elegance of the formulation of data-driven computation and of the UI applicative functor.  I'm satisfied with the generalization to flexible layout.  But what else is there to say?  Maybe write a short series of blog posts instead.
* I'm considering making a new Phooey release, without the arrow or monad versions.  Sweet and simple.  Is there a loss?  Maybe do a new spinoff project instead, and leave Phooey as is.  The new system is about &quot;Applicative GUI programming&quot;, so 
</pre>
</div>
<div title="2007-05-25" modifier="Conal Elliott" created="200707040102" tags="2007-05 day">
<pre>* Lennart Kolmodin has a Haskell library, &quot;[[inotify| http://haskell.org/~kolmodin/code/hinotify]]&quot;.   &quot;inotify provides file system event notification, simply add a watcher to a file or directory and get an event when it is accessed or modified.&quot;  Sounds like a good fit for my simple data-driven evaluation library (in [[TypeCompose| http://www.haskell.org/haskellwiki/TypeCompose]]).  Probably Linux only.
* What kind of tools exist for (push-based) notification of changes over the web, e.g., a web page or database element?  I did some searching and came up with a paper: [[Engineering Push-Based Web Services| http://citeseer.ist.psu.edu/brenna06engineering.html]].
</pre>
</div>
<div title="2007-05-31" modifier="Conal Elliott" created="200707040103" tags="2007-05 day">
<pre>* Thought on notifiers (news/subscription services).  Consider |a+a| for a source |a|.  The notifier would be |na `mappend` na| for a notifier |na|.  In my current representation, any subscribing action would get invoked twice.  Try another representation that eliminates redundant invocation.  Could have a map from unique (probably integer) tags to simple notifiers: ++++
\begin{code}
type Notifier = Map Int (IO () -&gt; IO ())
\end{code}
  === 
</pre>
</div>
<div title="2007-06" modifier="Conal Elliott" created="200801120318" tags="2007 June month" changecount="1">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2007-06-01" modifier="Conal Elliott" created="200707040104" tags="2007-06 day">
<pre>* Ideas to pursue ++++
*  In DeepArrow (and its uses), |fmap| generalizes |result| and |second|.  Can I replace them?
*  Express thesis of &quot;functional interfaces&quot; work
*  Explore applications of indexed types ++++
*   Linear maps (derivatives)
*   Eros GUI construction
   === 
  === 
* Put up a paper draft with wiki page [[Applicative data-driven programming| http://www.haskell.org/haskellwiki/Talk:Applicative_data-driven_programming]].
</pre>
</div>
<div title="2007-06-02" modifier="Conal Elliott" created="200707040105" tags="2007-06 day">
<pre>* Wolfgang Jeltsch suggested that the redundant notification problem cannot really arise with UIs.  I think he's right and that the AF interface imposes a linearity on source use.  I wonder if linearity can be exploited in similar applications, say to enable destructive update.
</pre>
</div>
<div title="2007-06-03" modifier="Conal Elliott" created="200707040105" tags="2007-06 day">
<pre>* Sometimes I sense resistance from someone when I shift my focus from their strategy to expore needs.  What's going on?  Perhaps they are afraid that I will push for them accepting a strategy they're not as happy with.  I could express my hunch about their worry.  If the hunch checks out, then I may want to offer reassurance by explaining my intention.  Or maybe explain the intention up front, as soon as I'm uncomfortable with supporting their strategy.  What is this intention?  It's to come to a solution that we're both completely happy with, and in particular that they like at least as well as their current strategy.
</pre>
</div>
<div title="2007-06-04" modifier="Conal Elliott" modified="200707040111" created="200707040106" tags="2007-06 day">
<pre>* I want to get back into some software projects &amp; dreams. ++++
*  Revisit Pajama and improve it. ++++
*   Make the controls easier to discover.
*   Integrate with JavaScript, for image uploading and maybe GUI.
*   Build a commerce app that lets people generate and order hi-res renderings of their Pajama toys.
   === 
*  Eros ++++
*   Reimplement on top of new Phooey and maybe a new TV based on AFs.
   === 
*  [[self-organizing FAQs]]
*  [[HMD-controlled page turning| http://www.3dvisor.com/forum/viewtopic.php?p=3149#3149]]
*  Simple learning project: make a Firefox plugin that shows my remaining Starband bandwidth.  Would the logon be a problem?
  === 
* Yesterday, Holly &amp; I visited the Unitarian Universalist church in Sonora.  While it's not what we're looking for in a church experience (spirit/mystery, great music, youthful energy), there is a lot of interest there in social action.   I phoned the minister (Craig Scott) last night, and we set up a meeting for today.  I want to help shift from the opposition (right/wrong) thinking &amp; energy so people can engage in connecting and //effective// dialogs.

</pre>
</div>
<div title="2007-06-05" modifier="Conal Elliott" modified="200707040110" created="200707040106" tags="2007-06 day">
<pre>* Now that I've simplified Phooey to use AFs instead of arrows (or monads), how to re-do TV? ++++
Currently, @Input@ and @Output@ are indexed by an arrow type &quot;~&gt;&quot;, and I have constructors ++++
\begin{code}
IPrim :: (() ~&gt; a) -&gt; Input  (~&gt;) a
OPrim :: (a ~&gt; ()) -&gt; Output (~&gt;) a
\end{code}
   === 
Instead, I might index by an AF @f@. ++++
\begin{code}
IPrim :: f a -&gt; Input f a
OPrim :: f (a -&gt; IO()) -&gt; Output f a
\end{code}
   === 
Alternatively, add a cofunctor argument @cf@, as well, for @Output@. ++++
\begin{code}
OPrim :: cf a -&gt; Output f cf a
\end{code}
   === 
Or relate @cf@ as an indexed type. ++++
\begin{code}
OPrim :: Co f a -&gt; Output f a
\end{code}
   === 
Can I eliminate the @Input@/@Output@ distinction and say that everything is an input?  Rename &quot;Input&quot; to &quot;Get&quot;. Whence @OLambda@? ++++
\begin{code}
Lambda :: Get f a -&gt; Get f (Co f b) -&gt; Get f (Co f (a-&gt;b))
\end{code}
   === 
What about @OPair@?  Current: ++++
\begin{code}
OPair :: Output (~&gt;) a -&gt; Output (~&gt;) b -&gt; Output (~&gt;) (a,b)
\end{code}
  === 
New: ++++
\begin{code}
OPair :: Get f (Co f a) -&gt; Get f (Co f b) -&gt; Get f (Co f (a,b))
\end{code}
  === 
In contrast, ++++
\begin{code}
IPair :: Get f a -&gt; Get f b -&gt; Get f (a,b)
\end{code}
  === 
Can I reconcile these two types?  Only if @Co f (a,b) == (Co f a, Co f b)@.  Note the resemblence with Manuel Ch's efficient array representation, which motivated the indexed type extension to GHC.  Not quite, though, since the structure of @f@ isn't being used here.
  === 
</pre>
</div>
<div title="2007-06-06" modifier="Conal Elliott" modified="200707040109" created="200707040107" tags="2007-06 day">
<pre>* Is there a useful notion of &quot;applicative //co-//functor&quot;?  I think it would include something like ++++
\begin{code}
liftC2 :: (c -&gt; (a,b)) -&gt; cof a -&gt; cof b -&gt; cof c
\end{code}
which can be defined via the simpler @cozip@ (and @comap@):
\begin{code}
cozip :: cof a -&gt; cof b -&gt; cof (a,b)
\end{code}
  === 
@cozip@ is just what I need for presenting output pairs (@OPair@) in TV.  Not sure it makes sense to call this functionality &quot;applicative&quot;.
* What about @OLambda i o :: Output f cof (a -&gt; b) @?  Since, @accept i :: f a@ and @present o :: cof b@, combine the results with a new function @lam :: f a -&gt; cof b -&gt; cof (a-&gt;b)@.  Maybe @lam@ is a method of a new type class.  Here's a related arrow function, used in TV. ++++
\begin{code}
lam :: Arrow (~&gt;) =&gt; (() ~&gt; a) -&gt; (b ~&gt; o) -&gt; ((a-&gt;b) ~&gt; o)
lam ia ob =
  arr (\ f -&gt; (f, ()))  &gt;&gt;&gt;
  second ia             &gt;&gt;&gt;
  arr (uncurry ($))     &gt;&gt;&gt;
  ob
\end{code}
  === 
The AF version is simpler: ++++
\begin{code}
lam :: Applicative f =&gt; f a -&gt; f (b -&gt; o) -&gt; f ((a-&gt;b) -&gt; o)
lam = liftA2 (\ a snkb -&gt; \ f -&gt; snkb (f a))
\end{code}
  === 
* The version of @lam@ above is probably not what I want for @IO@.  Instead, ++++
\begin{code}
lamIO :: IO a -&gt; (b -&gt; IO ()) -&gt; ((a-&gt;b) -&gt; IO ())
lamIO ioa oib = \ f -&gt; ioa &gt;&gt;= oib . f
\end{code}
  === 
* I've started corresponding with Shahbaz Chaudhary about AFs and algorithmic stock trading.  Some thoughts: ++++
*  Use an AF of data streams, starting with stock market data.
*  Define additional streams, derived from the market data, with things like running aggregates (extrema, sums, averages, etc).  Do as much as possible with just AF operations.  See what else we need.
*  Make a data type of (buy/sell) actions and form action streams via @pure@ &amp; @&lt;*&gt;@ (&amp; @&lt;$&gt;@ &amp; @liftAn@) over data streams.
*  Perhaps use &amp; extend my &quot;DataDriven&quot; library to represent the data streams.
*  Extensions would include scans and filters.
*  Given the huge amount of data, strictness is probably very important, particularly for scans.
*  If we need a performance boost, consider compilation strategies.  We could simply use GHC to compile the Haskell code, perhaps along with some rewrite rules (fusion etc), or maybe something like the Pan compiler.
  === 
</pre>
</div>
<div title="2007-06-07" modifier="Conal Elliott" modified="200707040113" created="200707040112" tags="2007-06 day">
<pre>* Continuing yesterday's ponderings for updating TV to AFs. ++++
*  The type of @lam@ wasn't quite ideal for @IO@.  I could go back to an explicit cofunctor, as on [[2007-06-05]]. ++++
\begin{code}
lam :: (Applicative f, Cof f cof) =&gt; f a -&gt; cof b -&gt; cof (a-&gt;b)
\end{code}
   === 
For @f = IO@, I can use @cof = Flip (-&gt;) (IO ())@.  What is in the @Cof@ class?  Some way to combine @f@ and @cof@.  Look at @lam@ for @IO@. ++++
\begin{code}
lamIO :: IO a -&gt; Flip (-&gt;) (IO o) b -&gt; Flip (-&gt;) (IO o) (a-&gt;b)
lamIO ioa (Flip oib) = Flip (\ f -&gt; ioa &gt;&gt;= oib . f)
\end{code}
   === 
Maybe @lam@ //is// the method for @Co@. ++++
\begin{code}
class Cof f cof where lam :: f a -&gt; cof b -&gt; cof (a-&gt;b)
\end{code}
   === 
  === 
</pre>
</div>
<div title="2007-06-08" modifier="Conal Elliott" created="200707040114" tags="2007-06 day">
<pre>In generalizing TV to work with monads and applicative functors, in addition to arrows, I'm playing with abstract classes one might call &quot;Pair&quot; and &quot;Lambda&quot;.  I'd like to know if anyone has seen these classes and/or may have some ideas for uses &amp; theoretical connections.

The classes:
\begin{code}
class Pair cof where
  pair :: cof a -&gt; cof b -&gt; cof (a,b)

class Lambda f cof where
  lambda :: f a -&gt; cof b -&gt; cof (a-&gt;b)
\end{code}
The reason for the names &quot;f&quot; and &quot;cof&quot; is that typically, @f@ is a functor and @cof@ is a cofunctor.  The @pair@ method makes a consumer of pairs from two consumers.  The @lambda@ method makes a consumer of functions from a producer of arguments and a consumer of results.
</pre>
</div>
<div title="2007-06-12" modifier="Conal Elliott" created="200707040115" tags="2007-06 day">
<pre>* Becky will be moving to Marlenton, WV next month.  I offered to drive with her and give her my car.  Today she called and said that sounds fun to her and she'd like to do it.  Her orientation is in Atlanta, starting on July 24 and going three or four days.  We'll visit Jake on the way.  Perhaps I'll fly back from Atlanta.  Becky suggested that we leave around the 14th.  The driving trip overlaps the WG2.8 meeting in Iceland.  I sent a note to Fosshotel about canceling.  I'll tell Simon PJ also.  I was getting disinclined to go anyway, as Iceland wasn't calling to me, and I don't like long, cramped flights.
* Batteries shipped.
* Bear (Barak) called.  He'll work with us on a vision phase of the project, rather than diving into specific plans.  He bills at $75/hr.  We made an appointment for Friday June 30 at 10am.
* I want to simplify the way UIs are constructed in Eros.  Static typing got in the way of a straightforward implementation.  I want to try again, using indexed types. ++++
Overall plan ++++
*  Recursively process outputs (visualizers) to make GUIs.
*  Pass down and accumulate a description of what to do when the user chooses a sub-output.  Includes the overall TV and &quot;path&quot; (&quot;transformation embedder&quot;, i.e., composition of first, second, result).
  === 
Here's a first cut at some code (adapted from Eros).
\begin{code}
wPutPut :: WPut a -&gt; WPut b -&gt; WPut (a,b)
wPutPut (WPut wpa) (WPut wpb) = WPut wp
 where
   wp tv path c ty = withPanel $ \ pan -&gt;
     do lty &lt;- handleArg c pan ty tv path vfill
        (la,oiA) &lt;- wpa tv (path . first ) c tya pan
        (lb,oiB) &lt;- wpb tv (path . second) c tyb pan
        return ( row 0 [la,lty,lb]
               , \ (a,b) -&gt; oiA a &gt;&gt; oiB b )
     where
      (tya,tyb) = dsPairTy ty
\end{code}
In |handleArg|, extract (from state in |c|) the arrow value |arr| to be applied deeply and make a new TV |tv' = path arr $$ tv|.   The puzzle is how to describe the types of |tv|, |arr|, |path|, and |tv'|.
First try a type class with functional dependencies.
\begin{code}
class Path tv path arr tv' | tv path arr -&gt; tv' where
  xform :: tv -&gt; path -&gt; arr -&gt; Maybe tv'

instance Path tv (forall a. a-&gt;a) 
\end{code}
  === 
</pre>
</div>
<div title="2007-06-13" modifier="Conal Elliott" created="200707040116" tags="2007-06 day">
<pre>* New Eros ++++
*  For an |Output a|, put up a GUI, //and// return an &quot;event&quot; (can be subscribed to) whose occurrence data includes a type representation and a path (transformation embedder).  For an |OPair|, tweak the two events by composing |first| or |second| with the path, and then merge the two results into a single event.  Also merge in the event for picking the pair directly.  Another way to think of the occurrence data is as a function from a type-tagged-arrow to a possible new arrow.
\begin{code}
data Typed  f    = forall a   . Typed  (Ty a) (f a)
data Typed2 (~&gt;) = forall a a'. Typed2 (Ty a) (Ty a') (a ~&gt; a')

type Lifter (~&gt;) a = Typed2 (~&gt;) -&gt; Maybe (Typed ((~&gt;) a))
\end{code}
  === 
</pre>
</div>
<div title="2007-06-14" modifier="Conal Elliott" modified="200707040117" created="200707040116" tags="2007-06 day">
<pre>* Corresponding with David Duke (Leeds) about functional scene modeling, AFs, and Vertigo.
* Haskell note: &quot;Wanted: tricks for conflicting instances&quot;. +++&gt;
In playing with compositions involving functors &amp; cofunctors, I've run into a conflict in the instances I want to provide.  I imagine this sort of problem is well-known, and I'd like to hear what kinds of strategies people apply.

Here's a definition of type composition:
\begin{code}
  newtype O g f a = O { unO :: g (f a) }
\end{code}
and a cofunctor class:
\begin{code}
  class Cofunctor cof where
    cofmap :: (a -&gt; b) -&gt; (cof b -&gt; cof a)
\end{code}
We can compose functors to get a functor, cofunctors to get a functor, and functor &amp; cofunctor in either order to get a cofunctor.
\begin{code}
instance (Functor g, Functor f) =&gt; Functor (O g f) where
  fmap h (O gf) = O (fmap (fmap h) gf)

instance (Cofunctor g, Functor f) =&gt; Cofunctor (O g f) where
  cofmap h (O gf) = O (cofmap (fmap h) gf)

instance (Functor g, Cofunctor f) =&gt; Cofunctor (O g f) where
  cofmap h (O gf) = O (fmap (cofmap h) gf)

instance (Cofunctor g, Cofunctor f) =&gt; Functor (O g f) where
  fmap h (O gf) = O (cofmap (cofmap h) gf)
\end{code}
I've wanted all four of those instances.  The problem is that instance selection (in GHC at least) ignores the contexts.  Without context, the first and fourth instances conflict, as do the second and third.  Thus I statically choose two of the four rules and comment out the other two.  Depending on my application, sometimes I like my choices, and sometimes I don't.

Are there work-arounds to get the flexibility I want out of GHC?

Is it plausible to improve instance selection to use contexts?  I imagine doing so would require some kind of backtracking search.

Thanks,  - Conal 
  === 
* Here's a simple approach to gestural composition.  During GUI construction, produce a path-valued event.  For selecting the current GUI, the path is empty (identity function).  For a composite GUI, additionally merge in fmap'd versions of the sub-GUIs, adding on a first, second, or result.  Very simple idea.  Work out the typing. +++
\begin{code}
type Win = Panel ()

type OI a = a -&gt; IO ()

type WinIO a = Win -&gt; IO (Layout,a)

type WPut a = Ty a -&gt; WinIO (OI a, Event Path)
\end{code}
How to define the |Path| type?  What is its relationship in the definition of |WPut| to the type parameter |a|?  In |wPutPut|, we can compose |first| and |second| only because of the pair type of the |WPut| being constructed.  At every level, the path must be applicable to the GUI type.  More precisely, it must have type |a ~&gt; a'|, for some type |a'| and every deep arrow.  I think we'll need the type a' for use with |WPut|.
\begin{code}
data DeepFrom a =
  forall a'. DeepFrom (Ty a') (forall (~&gt;). DeepArrow (~&gt;) =&gt; a ~&gt; a')
\end{code}
I don't think the deep arrow universality is critical.  It could instead be a type parameter:
\begin{code}
data DeepFrom' (~&gt;) a = forall a'. DeepFrom' (Ty a') (a ~&gt; a')

data TvFunFrom a = DeepFrom' TvFun
\end{code}
Still, I like the universality, so I'll keep it around.
\begin{code}
type WPut a = Ty a -&gt; WinIO (OI a, Event (DeepFrom a))
\end{code}
No, that's not it.  I want not an arrow but a function that takes a &quot;seed&quot; arrow (probably with type annotations) and yields an optional new arrow from |a|.  Optional, because the given seed arrow may have the wrong source type.

Oh -- remember that I want early feedback about whether the current seed arrow is applicable to a sub-gui.  When the seed is chosen, I'd like all compatibly-typed GUIs to highlight.  That could be easy.  During GUI construction, pass in a seed-change event.  Each sub-gui handle adds a subscriber that checks the source type and either enables the sub-gui for composition and highlights it, or un-highlights and disables for composition.  Oh -- then each sub-gui could store an optional compatibly-typed current seed arrow (and result type).  In that case, maybe the events don't have to return the arrow-transforming-function, but rather a transformed arrow, with result type.
\begin{code}
idTD :: DeepArrow (~&gt;) =&gt; Ty a -&gt; Typed ((~&gt;) a)
idTD tya = Typed tya idA

firstTD :: Arrow (~&gt;) =&gt; Ty b -&gt; Typed ((~&gt;) a) -&gt; Typed ((~&gt;) (a,b))
firstTD tyb (Typed tya' a_a') = Typed (pairTy tya' tyb) (first a_a')

secondTD :: Arrow (~&gt;) =&gt; Ty a -&gt; Typed ((~&gt;) b) -&gt; Typed ((~&gt;) (a,b))
secondTD tya (Typed tyb' b_b') = Typed (pairTy tya tyb') (second b_b')

resultTD :: DeepArrow (~&gt;) =&gt; Ty a -&gt; Typed ((~&gt;) b) -&gt; Typed ((~&gt;) (a-&gt;b))
resultTD tya (Typed tyb' b_b') = Typed (funTy tya tyb') (result b_b')
\end{code}
Also, an event signaling the presence of a new seed arrow, tagged by source and result types.  And one signaling a arrow being directed at a given output.
\begin{code}
type NewSeed (~&gt;) = Event (Typed2 (~&gt;))
type Transforming (~&gt;) a = Event (Typed ((~&gt;) a))
\end{code}
Rendering an output requires the new-seed event, the output type and a place to put widget.  It yields an event saying that an arrow is being directed at the output, along with a consumer for output values.
\begin{code}
type WPut (~&gt;) a = NewSeed (~&gt;) -&gt; Ty a -&gt; WinIO (OI a, Transforming (~&gt;) a)
\end{code}
With these definitions, the following code type-checks:
\begin{code}
wPutPut :: WPut a -&gt; WPut b -&gt; WPut (a,b)
wPutPut wpa wpb = wp
 where
   wp newSeed tyab = withPanel $ \ pan -&gt;
     do (lab,evab)     &lt;- handleArg newSeed tyab pan
        (la,(oia,eva)) &lt;- wpa newSeed tya pan
        (lb,(oib,evb)) &lt;- wpb newSeed tyb pan
        return ( row 0 [la,lab,lb]
               , ( \ (a,b) -&gt; oia a &gt;&gt; oib b
		 , evab `mappend`
		   fmap (firstTD  tyb) eva `mappend`
		   fmap (secondTD tya) evb ) )
     where
      (tya,tyb) = dsPairTy tyab
\end{code}
=== 
</pre>
</div>
<div title="2007-06-16" modifier="Conal Elliott" created="200707040118" tags="2007-06 day">
<pre>* Continuing with my Eros re-design from [[2007-06-14]] ++++
*  Automate the layout accumulation via pair AF: @(,) Layout@
*  Ditto for event accumulation, after re-ordering the inner pair: @(,) (Transforming (~&gt;) a)@
*  Automate the layering via type composition: @(,) Layout `O` (,) (Transforming (~&gt;) a)@
*  The @fmap@-s get applied to the accumulated events, so type composition won't automatically route it where I want.
*  Consistently rearrange so that the pair piece comes between the first and second.  Then the final assembly can sequence them all at once.
*  Tweak @oia@ and @oib@ into @(a,b)@-consumers (each discarding half).  Then the consumer construction is just @mappend@.
  === 
</pre>
</div>
<div title="2007-06-19" modifier="Conal Elliott" modified="200707040121" created="200707040120" tags="2007-06 day">
<pre>* Reply to Moreah ++++&gt;
&gt; From a conversation with Elana, my understanding is that she and maybe other TC members have some concerns around ITC not choosing to be more connected with the business of running NCC --- materials, fees, web site, mail, events, library, book sales, answering the phone, etc.

From the March 15 NCC TC proposal:

&gt; I propose that that the Training Circle is composed of Certified CNVC Trainers who want to work together towards the NCC and CNVC mission. 
&gt; ...
&gt; For simplicity, clarity, and integrity, I would like to suggest that NCC exists to support and promote local and visitng CNVC Certified Trainers, trainings and materials.

Given these statements of inclusion/exclusion and of purpose, I don't know why non-cnvc-certified folks would want to invest their life energies in &quot;the business of running NCC&quot;.  I'd expect them instead to invest in personal and community efforts to support and promote their own contribution and learning.

&gt; I SEE the value for ITC of learning and connecting, AND if we want to have the benefits of NCC, now or later, we probably need to consider what we’re contributing to the organization.

I'm guessing there's more reward/punishment motivation here than hungry-duck-feeding joy.  Am I interpreting accurately?

As John Buck taught us, a key part of the sociocratic process (and of Life!) is feedback.  From what I could tell, the TC formation did not follow the spirit and intent of sociocracy.  Specifically, I didn't see misgivings (&quot;niggles&quot;) about exclusion nurtured more effectively, by giving all the time it took to find strategies that would meet all needs fully.  Given what is, there's still a simple, clean and powerful feedback process available: invest your energy in what serves you and withdraw it from what doesn't serve you.  NCC business will be supported or not, and the feedback on NCC purpose and TC membership will be received.

Why am I taking the time to write this note?  I want to see everyone apply their life energy in ways that fulfill their hearts' desires, free of old habits like reward/punishment motivation.  Also, I am deeply inspired with the potential of the Life (vs control) paradigm, and I'd like to see progress in realizing that potential.
=== 
</pre>
</div>
<div title="2007-06-20" modifier="Conal Elliott" modified="200707040133" created="200707040124" tags="2007-06 day">
<pre>* Corresponding with [[Jacob Gotwais| http://humanpotentialarts.com]]. ++++&gt;
I like your TV-vs-NVC distinction very much.  To paraphrase, by &amp; large, people in our culture are much more familiar with television than with NVC.  For that reason they're better equipped to rate presenters of television (TV sets) than presenters of NVC.  Am I tracking your meaning?

I'd like to start with your question

&gt; ... when I get my NVC, how do I know whether it is really NVC?

Can anyone really say what NVC //is//?  Under the surface, is question even meaningful?  Perhaps the question itself rests on an assumption that is at odds with the essence of NVC, namely the assumption that NVC //is// anything at all.  I see all Life (people etc) as process, and so I don't want to use &quot;is&quot; language about living beings.  I see NVC the same way -- alive &amp; evolving.  I mean that historically, when I think of NVC as meaning MBR's personal mental framework &amp; spiritual practice, as they have been evolving for decades.  And I mean it for myself and for you as individuals, as well as the collectively evolving understandings and practices.  NVC has never been a static thing, thank goodness!

I have heard (top-down) certification described as a strategy to preserve the integrity of NVC or of &quot;the NVC process&quot; or of &quot;the NVC teachings&quot;.  Not only do I see this strategy failing (considering some things I've heard from people certified by CNVC), I see an inherent contradiction in the goal itself, aside from any specific strategy.  The contradiction is that, for me, NVC is all about serving Life, and Life isn't into the preserve &amp; protect (or embalm &amp; encase) paradigm.  Rather, Life is into adaptation, evolution and (bottom-up) emergent behavior.

&gt;  ... In other words I'm concerned that a need
&gt; that may not be met without any trusted certification/training processes
&gt; in place is the integrity of NVC itself.

Consider for yourself: could &quot;the integrity of NVC itself&quot; really be a need?  If you mean the current theory and practice of NVC (say, as expressed in MBR's book and other sources), then surely you're talking about a mere strategy, right?  If you mean something deeper that underlies and transcends current theory and practice, then I doubt that the certification process is measuring it.

If we cannot say what NVC &quot;is&quot;, where can we go, and how can we talk about &quot;teaching NVC&quot;, &quot;practicing NVC&quot;, etc?  Must we toss out the baby with the bath water (or toss out [[the sacred place with the raft| http://evolve.awakeningcompassion.com/?p=12]])?  Instead, I'd like to shift attention to the underlying intention, i.e., shift from strategy to needs.  Instead of asking questions like &quot;Is it NVC?&quot; or &quot;Is it good NVC?&quot; (external evaluations), I'd like to ask people questions like the following.
* Did you learn about habits of yours that inhibit compassion in yourself and others?
* Did you get some new perspectives and tools to help you stay connected to the humanity in yourself and in others?
* Do you trust the leader's personal authenticity in relating to you and others?
* Have you been able to more often find your way toward agreements that endure and support goodwill?
* When you apply what you learned, do you feel more peaceful &amp; joyful?
Or replace these questions with ones that better capture the essence of what NVC is striving for, in its essence.  My desire is to give everyone a means of steering their personal practice of connection and the continuing evolution and practice of NVC.  (This steering may enable the &quot;learning community&quot; I hinted at in Emergence.)  Over time, the details of current practice may be very different from what they are today, just as today's are very different from 30 years ago.  If historians want to know what NVC practice used to be, let them read the old books and watch the old video recordings.

Well, there you go.  I'd love to hear your response.

I'll be away from tomorrow (Thursday) morning through Monday night.  Maybe some internet connection and maybe not.

Thanks for the dialog.  Warmly,

  - Conal

&gt; On another note -- I have been thinking of the ideas on emergence.  Here's
&gt; one thought that keeps coming up for me.  Choosing an NVC trainer is a
&gt; little different than buying a TV.  I'm grateful for services like Amazon
&gt; that let me browse TV vendors and products and see people's ratings and
&gt; the ratings of the ratings (actually I don't own a TV but if I did I'd
&gt; feel grateful).  When I get the TV, I will have no doubt that it is a TV
&gt; and I can submit my own rating.  It seems to me that NVC is different in
&gt; that when I get my NVC, how do I know whether it is really NVC?  When I
&gt; first read Marshall's book, I thought I knew what NVC was.  7 years later
&gt; I have a totally different idea of what NVC is, and I don't think it would
&gt; have been possible to explain to me 7 years ago what I know now - I had to
&gt; grow into it.  What if everyone gets something that's not really NVC, they
&gt; all love it and submit great ratings, leading more people to buy it and
&gt; submit more great ratings, etc?  In other words I'm concerned that a need
&gt; that may not be met without any trusted certification/training processes
&gt; in place is the integrity of NVC itself.  Anything you'd like to share
&gt; about what comes up for you, reading that?

&gt; Jake
=== 
* NVC presentation blurb for Tuolomne UU. ++++
Fighting the &quot;Good Fight&quot; is Still Fighting: Peaceful, Effective Alternatives, Parts I and II
Sundays, August 12th and 26th, 10:30 a.m.
Presented by Conal Elliott and Holly Croydon (www.AwakeningCompassion.com)

Join us for a two-part introduction to the consciousness and practice of Compassionate Communication (also called Nonviolent Communication or NVC), where you will learn to
* communicate your concerns in such a way that people really want to hear them, instead of getting turned off and defensive;
* hear the heart of others' concerns and stay connected with their humanity, even when you hear blame, criticism and judgment; and
* nurture peace in your life, work, and world.
=== 
</pre>
</div>
<div title="2007-06-24" modifier="Conal Elliott" created="200707040133" tags="2007-06 day">
<pre>* Eros ++++
*  Consider how to handle some polymorphism in the new Eros.  In particular, the &quot;Tweak&quot; menu.  Instead of passing down a (monomorphic) &quot;seed&quot; arrow, I could pass a function @mkSeed :: Ty a -&gt; Maybe (Typed (~&gt;) a)@.  I already have a way to turn an arbitrary arrow value (fully type-tagged) into a @mkSeed@.
*  Of course I'd like polymorphic functions as well.
*  Remember, after composition, I want the old input values to be transferred to the new hybrid.
*  When rendering an input, generate two events: one means &quot;this input chosen&quot; and has no data; the other means some sub-input was chosen and has the types of the chosen sub-input and residual as data, together with the input extractor.
  === 
* Imagine partitioning computation between (a) remote shared server (not under my control), (b) local machine, and (c) an intermediary server.  Assume that (c) has a high-bandwidth connection to (a), while (b) has low-bandwidth connection to both (a) and (c).  Make sure data reduction happens on (b) and data expansion on (a).  Example: extracting/filtering data (reduction), followed by rendering (expansion).
</pre>
</div>
<div title="2007-06-25" modifier="Conal Elliott" created="200707040134" tags="2007-06 day">
<pre>* Consider a monoid of partial values: @mempty = undefined@, and @mappend = lub@.  Would work nicely for WGet, but I don't think lub can be implemented.  Why not?  It's deterministic and information-monotonic.  I fooled around and came up with the idea of using endomorphisms.  ++++
From {{{Monoid.hs}}}:
\begin{code}
-- | The monoid of endomorphisms under composition.
newtype Endo a = Endo { appEndo :: a -&gt; a }

instance Monoid (Endo a) where
  mempty = Endo id
  Endo f `mappend` Endo g = Endo (f . g)
\end{code}
For my use, the idea is that later endos (@g@) replace information from earlier endos (@f@).  Here's a little library of operations on partial values.
\begin{code}
type Partial = Endo  -- a monoid

inP :: ((a-&gt;a) -&gt; (a'-&gt;a')) -&gt; (Partial a -&gt; Partial a')
inP f = Endo . f . appEndo

valp :: c -&gt; Partial c
valp c = Endo (const c)

pval :: Partial c -&gt; c
pval (Endo f) = f undefined


unFst :: Partial a -&gt; Partial (a,b)
unFst = inP first

unSnd :: Partial b -&gt; Partial (a,b)
unSnd = inP second

unElt :: Functor f =&gt; Partial a -&gt; Partial (f a)
unElt = inP fmap
\end{code}
  === 
</pre>
</div>
<div title="2007-06-26" modifier="Conal Elliott" created="200707040135" tags="2007-06 day">
<pre>* Idea: have source/event subscription return an unsubscribe action.  ++++
\begin{code}
-- Old:
data Event a = Event ((a -&gt; IO ()) -&gt; IO ())

instance Functor Event where
  fmap f = inE (cofmapC (cofmapC f))
-- New:
data Event a = Event ((a -&gt; IO ()) -&gt; IO (IO ()))
\end{code}
Magic: the new @Event@ is still a monoid.  Unsubscribers are automatically combined.
  === 
</pre>
</div>
<div title="2007-06-27" modifier="Conal Elliott" created="200707040136" tags="2007-06 day">
<pre>* Eros implementation musings ++++
*  To implement @wGetPut@ elegantly, I want a @Source a -&gt; OI (a-&gt;b)@ and a @OI b -&gt; OI (a-&gt;b)@.  Then cascading monoid magic cause the two @OI (a-&gt;b)@ values to get @mappend@-ed into a single @OI@.
*  When I get a function, one action is to apply it to the current @a@ value and then consume the resulting @b@.  Another action is to save the function in a variable for use when the input changes.
*  How to separate?
*  Supppose I treat the @WPut b@ as a @WGet (OI b)@.  Then I have a @WGet a@ and @WGet (OI b)@ and need to make a @WGet (OI (a-&gt;b))@.  No problem, if @WGet@ is an AF, but I don't know how it could be.
*  Idea: Reverse the embedding: model @WGet a@ as @WPut (OI (OI a))@ (or @WPut (Event a)@)
*  Oh -- here's the idea I'm looking for.  Combine a //source// of consumers (not just a consumer) with a source of values to get a source of function consumers.++++
\begin{code}
lam :: a -&gt; (b -&gt; o) -&gt; ((a-&gt;b) -&gt; o)
lam a bo f = bo (f a)

lamA :: Applicative f =&gt; f a -&gt; f (b -&gt; o) -&gt; f ((a-&gt;b) -&gt; o)
lamA = liftA2 lam
\end{code}
   === 
I like this change of introducing //sources// of consumers.  I think it would allow me to use a weaker output-only, stateless replacement for @IO@, such as @Image@.  A //source// of visualizations explains why we have more than one visualization.  //Interactive// visualization.
*  Oh, hey.  This clearer model may also show me how to retain input values from old TVs to new compositions.
* There's a problem with @lamA@: I don't know how to make @WGet@ be an AF, since it (a) takes a @Ty a@ argument and accumulates an @a@-dependent event.  I could instead use the @Lam@ class I came up with recently when fooling around with Phooey.  Here's version for values that have to be told their types.
\begin{code}
type T f a = Ty a -&gt; f a

lamTA :: Applicative f =&gt; T f a -&gt; T f (b -&gt; o) -&gt; T f ((a-&gt;b) -&gt; o)

lamTA fa fbo abo = lamA (fa a) (fbo bo)
 where
   (ab,o) = dsFunTy abo
   (a ,b) = dsFunTy ab
   bo     = funTy b o
\end{code}
  === 
* Imagine a delta-oriented file system and editor.  Undo, efficient every-version archiving.
</pre>
</div>
<div title="2007-06-29" modifier="Conal Elliott" modified="200707040142" created="200707040141" tags="2007-06 day">
<pre>* From an email exchange with Erika ++++&gt;
I don't understand how it could be a &quot;need&quot; of yours to &quot;respect their request&quot;.  And I don't see &quot;honoring&quot; someone's strategy as in alignment with the Need-centered consciousness of NVC.  In my understanding of NVC consciousness, requests/strategies are utterly dispensable, while needs are essential.  This principle is for me the central &amp; most powerful insight of NVC.  Not only do I not see how to reconcile &quot;respecting a request&quot; or &quot;honoring a strategy&quot; with NVC (and more importantly, with my heart and reason), I don't know what these phrases could really mean.  Big red flags go up in me when I hear phrases like these, and I suspect these phrases are hiding underlying cultural programming and unconscious assumptions.  I greately admire Marshall's careful reflection on and reshaping of language, to illuminate and help shift out of unconscious cultural programming.  It's a gift I appreciate in myself as well.  I want to see the gift carried further.  There's so much weighty momentum behind language habits, and I want to see us all wake up and make powerful, self-connected conscious choices about the world we're creating.

BTW, I'm with you about the name &quot;Nonviolent Communication&quot;.  &quot;Compassionate&quot; works a bit better for me, but it's still not as descriptive as I'd like.  I like &quot;life-serving&quot; better yet, for describing the goal, though not at all the method, and people have many conflicting strategies for how to &quot;serve life&quot;.  I think it's highly unlikely that any terse &amp; descriptive exists in our language.  And for good reason: we speak a language of domination.  If &amp; when our culture tips over to one in harmony with Life, then eventually the language will evolve to a language that fits it.  Or, more likely, the language and cultural thought patterns will co-evolve.  Maybe it's that tight linking (see http://en.wikipedia.org/wiki/Sapir-Whorf_hypothesis) that make cultural shift so difficult (in other words, that make culture so stable).  Language and thought are like two legs, shackled together at the ankles.  Neither can move much without the other, and so we go stumbling along.  On the other hand, this sort of &quot;negative feedback&quot; (each component resisting change in the other) is essential in Life's strategy of evolution, so that change can eventually happen and yield stability (rather than pure chaos such as cancer).

Given that we don't have a short descriptive name to use in place of &quot;Nonviolent Communication&quot;, I prefer sometimes to use &quot;Nonviolent Communication&quot; if I think people will have some familiarity with the term.  Or I'll choose a more topic-specific title, and mention the connection to NVC in the description.  Another idea that just occurred to me is to call it &quot;The Rosenberg Method&quot;, or &quot;Rosenberg Consciousness&quot;.

&gt; I don't like common words in the English language being trademarked and then off-limits to others' use, so although I'm happy to avoid one term if so requested, I don't think it meets my need for ease in communication for the requested list of words to avoid to grow. 

Despite your first statement above, I really do believe that you're hearing demand rather than request.  If you were hearing a request, your ease couldn't possibly be affected.  If you heard a request, you wouldn't be thinking about trademarks (protecting and enforcing someone's &quot;rights&quot; against your wrongs) and &quot;off-limits&quot; language.  If you heard a request, you'd simply look inside, notice the niggle, compare it with the joy of a small child feeding a hungry duck, and then decline the request.  You'd have sense of complete freedom &amp; lightness in doing so, knowing that the Universe contains infinitely many other strategies because the requested one.  At your leisure, you might be delighted to meditate over other strategies for yourself as well.  And you'd change your own strategy only when you found one you actually prefer.  Joyful, self-ful choice, without any submission or rebellion.
=== </pre>
</div>
<div title="2007-06-30" modifier="Conal Elliott" modified="200707040143" created="200707040142" tags="2007-06 day">
<pre>* Engaging in some dialogs around CNVC's &quot;request&quot; not to use the name &quot;Nonviolent Communication&quot; (or &quot;NVC&quot;).  See [[Using the name &quot;Nonviolent Communication&quot;| http://evolve.awakeningcompassion.com/?p=20]] and [[On &quot;respecting&quot; requests]].
* Eros rewrite ++++
*  I switched to rendering outputs as //sources// of consumers.  Doing so obviated the reference I was using to hold onto function values.  Given @srca :: Source a@ and @oibsrc :: Source (OI b)@, we define @oifsrc :: Source (OI (a-&gt;b))@ simply as @oifsrc = liftA2 lam srca oibsrc@, where @lam a bo = \ ab -&gt; bo (ab a)@.
*  Next puzzle: how to finish rewriting @wGetPut@ (for rendering an @OLambda@) in the simple form as @wGetGet@ and @wPutPut@.  The challenge is how not to render the input and output //independently// and combine the result.  I have a hunch it can be done if I have @WPut@ mimic @WGet@ in using the //partial// values monoid (represented as endomorphims, i.e., @a -&gt; a@).  Embed a @Source (Partial a)@ and a @Source (Partial (b -&gt; o))@, //each// into a @Source (Partial ((a -&gt; b) -&gt; o))@ and @mappend@ the two results.  If it works, it probably works without the @Source@ wrappers, and then use @fmap@ on each conversion, so try without @Source@ first.  I tried Lennart Augustsson's [[Djinn| http://permalink.gmane.org/gmane.comp.lang.haskell.general/12747]] &quot;coding wizard&quot;, which derives inhabitants for types.  It derived @unFst@ and @unSnd@ (for @wGetGet@) but not the two embeddings I'm looking for.  Playing some more, I come up with the the first one. ++++
\begin{code}
-- | Provide in info about a function argument
unArg :: Partial u -&gt; Partial (u -&gt; v)
unArg = inPartial (flip (.))            -- \ uv -&gt; \ u -&gt; uv (uu u)

-- | Provide info about a function result
unRes :: Partial v -&gt; Partial (u -&gt; v)
unRes = inPartial (.)

unSrc :: Partial a        -&gt; Partial ((a -&gt; b) -&gt; o)
unSrc = unArg . unArg

unSnk :: Partial (b -&gt; o) -&gt; Partial ((a -&gt; b) -&gt; o)
unSnk = ???
\end{code}
   === 
I'm not yet seeing how to define @unSnk@.
*  
  === 
* On {{{#haskell}}}, nominolo pointed me to [[Lisp Machine's &quot;presentations&quot;| http://www.lispworks.com/documentation/lw43/CLIM/html/climguide-92.htm#pgfId-383438]], which seems related to Eros.
</pre>
</div>
<div title="2007-07" modifier="Conal Elliott" created="200801120318" tags="2007 July month" changecount="1">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2007-07-01" modifier="Conal Elliott" modified="200707040150" created="200707040149" tags="2007-07 day">
<pre>* More discussion about of the CNVC's request not to use &quot;Nonviolent Communication&quot;.  In response to Laurel. +++&gt;
&gt; The request I am seeing now is to not use Nonviolent Communication, NVC, etc. because those are trademarked in some way.

This is part of what I don't like about the &quot;request&quot; (or demand, as to be determined).  The &quot;because&quot; part doesn't make sense to me in a way that's at all consistent with NVC Consciousness or Method.  I don't see how could someone's trademark could be a life-serving &quot;reason&quot; for me to make a choice not to use it, other than protecting myself against their lawsuit.  It's easy for me to interpret the &quot;because ... trademark&quot; as a threat or a &quot;right&quot;, both of which I see as domination rather than partnership.  I'd really love to connect with genuine Needs behind this request and related ones.  The ones I've heard, I just don't buy.  They sound sort of like needs to me, but just on the surface.

&gt; I have no objection to do this as long as I can use the phrase compassionate communication when advertising and nonviolent communication/NVC in the body of materials &amp; advertising.

Picking up on your phrasing, &quot;as long as I *can* ...&quot; (emphasis mine), I'm guessing you are hearing a demand (as I am) rather than a request.  In other words, I'm guessing that you expect something less pleasant than genuine empathic connection with your needs, if you don't comply.

&gt; I do have some general comments about the request CNVC is making. The request is made on their web site and they do not provide a contact person for further discussion if a person's initial response is &quot;no.&quot; I think making dialogue happen is a two-way street and I would appreciate them providing us with a contact person. In addition, a person who responds no can also contact them for further rounds of negotiation. 

Exactly!  That's a big missing piece for me in this whole &quot;request&quot; thing.  If I make a request and don't demonstrate any interest in hearing your response, how do we giraffe-dance?  I'd have short-circuited the beautiful process that starts with &quot;no&quot; (shorthand for &quot;I have needs also&quot;) and ends in connection and all-needs-met.

&gt;   If this is truly a request, then answering either yes or no would be OK to CNVC. If they don't find it OK, then it's not really a request from their perspective.

Exactly.

&gt; Laurel

I'm encouraged &amp; grateful for your words, Laurel.  So often, I imagine I'm alone in how I see things.  I get especially lonely &amp; hopeless when I believe NVC folks (including most cnvc-certified people I've heard) are picking up some new words but missing the essence of NVC Consciousness (some specifics at http://evolve.awakeningcompassion.com).  I'm craving to see a deep shift and to have community in bringing about such a shift.

Hugs,  - Conal
=== 
* And in reply to Erika +++&gt;
&gt; Hi Conal,

&gt; It's good to hear your &quot;voice.&quot;  Let me try again.  It feels satisfying to imagine I am contributing to CNVC by respecting their request and honoring their preferential strategy - that's my need I was talking about (contribution, imagining this strategy meets needs of ease, reassurance and comfort for them).  

If I understand you, you're saying that you imagine that cnvc's request is somehow life-serving, i.e., it effectively addresses genuine needs.  Right?  If so, that helps me understand our different responses, as I interpret their request quite differently.  Given this difference, saying yes is a life-serving choice for you, and saying no is a life-serving choice for me.

I'd love to co-explore the question of needs met by the cnvc strategy.  I've never been able to believe the ones I've heard offered.  In part, I think my understanding of needs differs from most people's.  For example, I don't see ease, reassurance, or comfort as needs.  If we pursue this question, I bet we'd find much yummier alternatives.  I don't know if you or other people care much about the question of &quot;which needs&quot;, while to me, it's *the* important question.  If we miss the heart of the needs, then the essence will not be addressed by our strategies.  That's exactly what I believe is happening with this and some other cnvc strategies.

&gt;   I guess I'm not having much conflict here but I sense you are so I'd be curious as to your response to Joe's empathy guesses for you.

Yes, I am having conflict with this strategy (and others).  I understand it as not serving my needs, the network's, or humanity's.

&gt; To put it in perspective, before teaching NVC I taught childbirth education through an organization that [...]

Wow -- I can see how cnvc might be a joy to work with in contrast to your other experience.

&gt; I have to admit, I feel some irritation about reading things like &quot;And I suspect that &quot;request&quot; and &quot;needs&quot; language is being used for something that is neither&quot; because i value directness, openness and honesty and wonder if you would be willing to contact someone at CNVC and tell them (if it's true) that you are unwilling to honor their request and wish to discuss a way to meet both their needs and yours (for autonomy?).  Making that request of you meets my needs for integrity, to support reconciliation, inclusion and mutual resolution whether or not you agree to it, though I am curious if you'd be willing to do this or not and what needs are met by your choice.  

I have spoken with a few folks in cnvc, and I intend to do more, though I really don't know who's interested.  I have a nice connection started with John Wiley (presiding over the cnvc board), and I'll see if he knows who'd want to hear my &quot;no&quot; and take up a dance from there.


&gt;     I feel relief just being brave enough to admit that's important to me. The idea of someone deciding on their own not to follow the request without letting the requester know bugs me.  It bugs me less to think of someone telling CNVC they won't follow it, having CNVC refuse to revise or negotiate their request (in which case the assumption of demand would be verified, not merely assumed) and then disregarding the request.  

That last scenario feels better to me as well.

I still suspect their's some Power-Over stuff going on here.  I'd appreciate you joining me in a little thought experiment.  Suppose I place a request on http://awakeningcompassion.com that says I'd like CNVC to stop using the name &quot;Nonviolent Communication&quot; and call it &quot;Rosenberg Consciousness&quot; (because I genuinely prefer the latter), and another to stop and renounce certification (because I genuinely see it as deeply out of alignment with Rosenberg Consciousness), and another to drop their legal ownershop of &quot;NVC&quot;.  I'd include brief descriptions of needs met and then mention the page on a few mailing lists.  Suppose they don't make the changes I request and go about doing as they see best, instead.  Would that bug you in the same way?  If not, why not?

&gt;		I'll tell you a funny story.  When my husband got out of the army, he moved to Seattle and called up his National Guard contact (which he was &quot;supposed&quot; to do).  Rob informed this man that he would not be showing up for any monthly meetings as mandated.  The guy was flabbergasted.  He said many people get out of the army and don't follow through with their monthly commitment thereafter, but no one calls to tell them they won't be doing it! ;-)

I love that story.  Go Rob!, and thanks for the inspiration.

&gt; I like &quot;the Rosenberg Method for Consciousness&quot; ;-)

Hm.  I prefer two separate names, &quot;The Rosenberg Method&quot; (maybe &quot;The *Evolving* Rosenberg Method&quot;, to remind people that it's always evolving) and &quot;Rosenberg Consciousness&quot;.  It's very important to me that people keep these two things clearly separate in their mind, so they'll distinguish between what is essential (the Consciousness) and what merely a (very helpful) strategy and therefore disposable.  I don't see many NVC folks make this distinction.  Ironically, to cling to the NVC &quot;method&quot; or &quot;process&quot; is to contradict the heart of NVC itself, namely focus on needs and release of all attachment to strategy.

&gt; I enjoyed what you said about language and cultural thought evolving together.  It makes me think of readings I did long ago on the Whorfian hypothesis - some cultures do not have certain words in their language (ex. the Italians and &quot;la privacy&quot;) - nor do they really have the concept.  I think this is what Marshall is trying to get across with his descriptions of the Orang-Asli.  It's also nice to think of the slow change in our culture as meeting some need (stability), as I'm frequently discouraged by the slowness of the transition to a more peaceful, inclusive society.

Thanks for that connect.

&gt; Okay, feeling annoyed now: &quot;I really do believe that you're hearing demand rather than request.  If you were hearing a request, your ease couldn't possibly be affected.&quot;  I like to have sovereignty over what I feel or am aware of inside and I'll ask you not to tell me what I feel or think.  

Double-ouch! -- one for you and one for me in reading your response.  It's true that I didn't believe what you said.  That's about me.  I got contradictory info from your note, and I let you know what I believe and why.  Of course, I can't know for sure what's true in you.  And yet I leaned very strongly in one direction.

&gt; I'm not currently aware of hearing not using &quot;nonviolent communication&quot; as a demand.  Are you ?!?  I'd be more interested to hear about that.  Maybe at some point I will have some awareness of that myself but I don't now.  I do have a niggle over the idea of not using the terms compassion or empathy or compassionate communication - but according to my reading of their request, avoiding those phrases has not been asked of us.  To me &quot;nonviolent&quot; isn't really an English word, rather a translation, so I'm much more comfortable avoiding it than a word that is actually part of my everyday language, like compassion.  That's what I was referring to when I said I didn't want common language trademarked.

So I'm still confused about what to believe.  And some of my confusion is connected to my understanding that you don't hear a demand when you're happy to comply anyway (avoiding &quot;nonviolent communication&quot;), but you &quot;have a niggle of irritation&quot; when you imagine them asking you to something you don't want to comply with (avoiding &quot;compassionate communication&quot;).  And my understanding of Marshall's notion of &quot;request&quot; vs &quot;demand&quot; has nothing to do with whether I want to do it.

What might help me understand is this: if you decide that you want to use &quot;nonviolent communication&quot; in your talk title (e.g., for recognition among folks you expect to know that term), would you feel free to use the term, perhaps informing (not asking) cnvc.  And the same question if CNVC added a request that you not use &quot;compassionate communication&quot;, &quot;observation, feelings, needs, requests&quot;, or &quot;empathic listening&quot;.

&gt;  But that is sheer projected fantasy - CNVC has not actually asked that and my feelings are from other organizations that have made demands of intellectual property out of language.  I do have angry feelings over the power (over) that some institutions have given out - without consulting me (for instance, trademarking words or patenting life forms).  I think that's where the tension you heard comes from.  I'm feeling scared and powerless about that, but it's not happening here, in my estimation.  

Gotcha, I think.  The &quot;niggle of irritation&quot; comes from the fantasy.  I'm still confused though, as I understand your irritation (which I interpret as a demand-reaction) tied to whether or not the request interferes with your needs.

&gt; I'm actually, in hindsight, delighted that they asked us to avoid &quot;nonviolent communication&quot; because it has gotten me in touch with why that phrase doesn't really work for me and the richness of alternatives available...I've been more productive at brainstorming than if I had just, for ease and thoughtlessly gone on using &quot;nonviolent communication.&quot;

Hooray!

&gt; You said, &quot;If you heard a request, you'd simply look inside, notice the niggle, compare it with the joy of a small child feeding a hungry duck, and then decline the request.&quot;  I think that would only be true if I had only one need at a time.  But I don't.  I have the need for ease and autonomy, but I also have the need to live in community, contribute to others' wellbeing and work out agreements for behavior that work for all parties.  If the neighbor's house was burning down, I wouldn't say it meets my need to rest.  It has perhaps caused a slight unmet need for ease in me but the pleasure in respecting their request outdoes that for me.  I don't think I would feel pleasure in respecting their request if I didn't feel in choice about it.  I'd sure like to know you heard this.  Would you be willing to tell me briefly what you think I'm saying?

Thanks!  I like this part of your note the best (well -- this and the Rob story), as it gives me some of the community engagement I'm looking for in consciously examining what we're thinking and doing, related to NVC.

I think you're saying that's what's a joyful (or at least &quot;choiceful&quot;) decision for you sometimes (often, I suspect!) involved more than one need.  And so you distrust and disagree with a single-need perspective.  And in any case, it's important to you to know that you've taken the space to make a conscious, centered choice.  How's that?  

Going out on a limb a bit, my hunch is that (like me), it takes you longer to get to that place of knowing you're in choice if you hear a demand, especially when the request doesn't match your preference.  I suspect that's the reason that (if I've understood), you link the question of request-vs-demand with the question of whether you want to do it anyway (triggering my confusion, as mentioned above).  My hunch is that when in this conversation you've said you hear a request or hear a demand, what you mean is that you're in a comfortable space of choice within your self or you're not.  I hope you don't take my previous sentence as criticism or correction.  I actually like that meaning for &quot;hear a demand&quot;, as it gives me my power back.  If I don't want to hear demands, I only have to work on myself, not others.  Whether I hear a demand is thus cleanly separated from whether someone else is &quot;making a demand&quot; in Marshall's sense, namely attachment to their strategy.  And since that attachment is (or isn't) going on inside of them, it can't affect me.

&gt; Gee, I miss your full body presence in Seattle and our practice groups!

I miss you too!  This sort of discussion would be more fun in person, especially over margaritas or something.

&gt; Warmly, Erika

Likewise,  - Conal
=== 
* Wrote blog posts [[A type for partial values | http://conal-elliott.blogspot.com/2007/07/type-for-partial-values.html]] and [[Implementing a type for partial values| http://conal-elliott.blogspot.com/2007/07/implementing-type-for-partial-values.html#links]]
</pre>
</div>
<div title="2007-07-03" modifier="Conal Elliott" modified="200707051550" created="200707040151" tags="2007-07 day">
<pre>:: 2007-07-03 [2007-07 day]
* Playing with variants on the @lam@ function.  Got some help from [[Djinn| http://lambda-the-ultimate.org/node/1178]] ++++
\begin{code}
data O

type Sink a = a -&gt; O

type SSink a = Sink (Sink a)

ssink :: a -&gt; SSink a
ssink = flip ($)   == \ a ao -&gt; ao a


lam1 :: a -&gt; Sink b -&gt; Sink (a-&gt;b)
lam1 a bo = \ ab -&gt; bo (ab a)

lam2 :: SSink a -&gt; Sink b -&gt; Sink (a-&gt;b)
lam2 aoo bo = \ ab -&gt; aoo (bo.ab)
              -- \ ab -&gt; aoo (\ a -&gt; bo (ab a))

{-
   lam2 (ssink a) bo == \ ab -&gt; ssink a (\ a -&gt; bo (ab a))
                     == \ ab -&gt; bo (ab a)
                     == lam a bo
-}

lam3 :: a -&gt; SSink (Sink b) -&gt; Sink (a -&gt; b)
lam3 a booo = \ ab -&gt; booo (\ bo -&gt; bo (ab a))
              -- \ ab -&gt; wb (ab a) booo

{-
   lam3 a (ssink bo) == \ ab -&gt; ssink bo (\ bo -&gt; bo (ab a))
                     == \ ab -&gt; bo (ab a)
                     == lam a bo
-}

lam4 :: SSink a -&gt; SSink (Sink b) -&gt; Sink (a -&gt; b)
lam4 aoo booo = \ ab -&gt; booo (\ bo -&gt; aoo (bo.ab))

lam5 :: SSink (SSink a) -&gt; Sink b -&gt; Sink (a-&gt;b)
lam5 aoooo bo = \ ab -&gt; aoooo (\ aoo -&gt; aoo (bo.ab))

lam6 :: SSink (SSink a) -&gt; SSink (Sink b) -&gt; Sink (a-&gt;b)
lam6 aoooo booo =
  \ ab -&gt; booo (\ bo -&gt; aoooo (\ aoo -&gt; aoo (bo.ab)))
  -- but all of the following type-check as well
  -- \ ab -&gt; aoooo (\ aoo -&gt; booo (\ bo -&gt; aoo (\ a -&gt; bo (ab a))))
  -- \ ab -&gt; aoooo (\ aoo -&gt; aoo (\ a -&gt; booo (\ bo -&gt; bo (ab a))))
  -- \ ab -&gt; booo (\ bo -&gt; aoooo (\ aoo -&gt; booo (\ bo -&gt; aoo (\ a -&gt; bo (ab a)))))
\end{code}
  === 
</pre>
</div>
<div title="2007-07-05" modifier="Conal Elliott" modified="200707312318" created="200707051628" tags="2007-07 day">
<pre>* Still messing with my Eros reformulation. ++++
*  I don't know how to apply the &quot;partial values&quot; trick to &quot;lambda&quot; or pair output.  I think the reason is that although all pair-typed values really consist of first and second halves (pair surjectivity), a similar property does not hold for functions //from// pairs (and similarly for functions from functions).  Given @abo :: (a,b) -&gt; o@, I don't know that @abo@ is some standard function of @ao :: a -&gt; o@ and @bo :: b -&gt; o@.  In fact, I know this property fails, since @abo@ could sum the pair components and convert the result.
*  Dropping partial values for outputs, I used a simple trick for pairs that I don't know how to extend.  I can map each of @OI a@ and @OI b@ to @OI (a,b)@, just by composing with either @fst@ or @snd@, and then sequence the two @OI (a,b)@.  The key is that one can extract @a@ and @b@ from the @(a,b)@.  To play this game with functions, we'd have to extract a @b@ from an @a-&gt;b@, or in some other way, turn an @OI b@ into a @OI (a-&gt;b)@.  For @a@, it's even trickier, since there's no @OI@.  That's where I use the variant @lam2@ from [[2007-07-04]].  Then I'd need to map @OI (OI a)@ to @OI (a-&gt;b)@, perhaps by extracting @OI a@ from @a -&gt; b@.  I think I just need a different approach.
  === 
* More stimulating correspondence with Jacob Gotwals.
</pre>
</div>
<div title="2007-07-09" modifier="Conal Elliott" modified="200707312320" created="200707312319" tags="2007-07 day">
<pre>* A reviewer for my Eros paper wrote ++++&gt;
p3: You call values of type @Output a@ &quot;visualisers&quot;, but don't name values of type @Input a@. Why not use the terms &quot;viewers&quot; and &quot;controllers&quot;, making a connection with the (related) Model View Controller pattern?
 ===
I like that suggestion very much.  Perhaps it's an idea for another paper, &quot;Functional, Composable Model-View-Controller&quot;.  Add &quot;model&quot; for the (immutable) value being visualized.
</pre>
</div>
<div title="2007-07-20" modifier="Conal Elliott" created="200707312322" tags="2007-07 day">
<pre>* Updated web version of TypeCompose to 0.1.  //To do:// update dependent libs.  Which???
* Made Germany flight reservations on AA.  Still to do: reserve accommodations, arrange flight to
Seattle, register for HW, ICFP, and maybe IFL.
* For a home proxy, check out Squid or Apache.
</pre>
</div>
<div title="2007-07-21" modifier="Conal Elliott" created="200707312323" tags="2007-07 day">
<pre>* On road trip with Becky.
* In Chicago. Passenger side mirror on my Accord broke off.   Looking for Honda dealer to replace.  They can all order the part, but it would arrive after we leave for Atlanta.  I got some help locating a part at Curry Honda in Atlanta.  The locator process said it's the only one of that part in stock in a four-state region from here to Atlanta.  $254+labor.  Then I tried car parts stores and found one that could get the part in two hours for only $60, and I could install it myself or get help.  They got the part, and Becky &amp; I installed it.  I didn't know how to get the door panel back on, so I got help at a garage.  Everyone in the process was terrifically helpful.  The experience turned out to be very sweet for me.
</pre>
</div>
<div title="2007-07-24" modifier="Conal Elliott" modified="200707312324" created="200707312323" tags="2007-07 day">
<pre>* I keep running into dead-ends in typing my new, &quot;simplified&quot; Eros implementation.  Haskell's (even GHC's) type checking is pinching.  I think some extensions would make it work much better for me.  Collectively, I think of the extensions as using something like Lambda-Prolog for type checking.  Specifically, ++++
*  Allow conflicting--even equivalent--heads in type class instances.  After matching multiple heads, use backtracking search to find satisfiable clause preconditions.  Example ++++
\begin{code}
instance (Functor g, Functor f) =&gt; Functor (O g f) where
  fmap h (O gf) = O (fmap (fmap h) gf)

instance (Cofunctor g, Cofunctor f) =&gt; Functor (O g f) where
  fmap h (O gf) = O (cofmap (cofmap h) gf)

instance (Functor g, Cofunctor f) =&gt; Cofunctor (O g f) where
  cofmap h (O gf) = O (fmap (cofmap h) gf)

instance (Cofunctor g, Functor f) =&gt; Cofunctor (O g f) where
  cofmap h (O gf) = O (cofmap (fmap h) gf)
\end{code}
   === 
*  Universally quantified goals.  Example ++++
\begin{code}
pairMon :: ((forall a. Monoid (m a)), InPair (O m f)) =&gt; PairTy (O m f)
\end{code}
*  What about higher-order matching or unification?  For instance, eliminate explicit @newtype@ constructors @Id@ and @O@.
*  What about multiple solutions (not just multiple matches, but multiple solutions remaining after satisfying preconditions)?
*  Add a syntax for explicit type abstraction, such as @/\ t. t -&gt; t@.
   === 
  === 

</pre>
</div>
<div title="2007-07-25" modifier="Conal Elliott" created="200707312325" tags="2007-07 day">
<pre>* Back from the cross-country Becky-and-Dad trip.  About 4000 miles for me, including the drive from home to Seattle.  Fun time.  Glad to be home.
</pre>
</div>
<div title="2007-07-26" modifier="Conal Elliott" modified="200707312327" created="200707312326" tags="2007-07 day">
<pre>* Still puzzling over how to drastically simplify my Eros implementation.   ++++
*  Question: can passing of the explicit type representations be somehow avoided?  For instance, could I use something like the @Typeable@ class?  I'd probably need existential types, which I'm now simulating.  And I'm not sure it would help.
*  Even when I get this simplification figured out, I don't have polymorphism.  Could a solution to polymorphism lead to a more elegant solution for monomorphism?
  === 
</pre>
</div>
<div title="2007-07-27" modifier="Conal Elliott" modified="200707312339" created="200707312328" tags="2007-07 day">
<pre>* Maybe I can make the Eros implementation simpler by making the problem harder.  Specifically, take on parametric polymorphism, which is a critical missing piece.  I have a sticky point now (only in my attempts at ultra-simplifying the implementation) of lifting arrows to arrows on pairs and functions.  I know how to do it, but I have to inject the missing type information, which complicates the interface a bit.  When I address polymorphism, I won't have to //be given// the missing type information, because that information will be //universal//!  Consider @firstT@ as example. ++++
\begin{code}
type Convert f a b = f a -&gt; f b         -- ^ A conversion type

data Typed  f = forall a  . Typed  (Ty a) (f a)

type TArr (~&gt;) a = Typed ((~&gt;) a)

type ConvertT f a c = Ty c -&gt; Convert f a c

firstT  :: Arrow (~&gt;) =&gt; ConvertT (TArr (~&gt;)) a (a,b)
firstT  tyab (Typed tya' a_a') = Typed (pairTy tya' (sndTy tyab)) (first  a_a')
\end{code}
  ===  Similarly for @secondT@ and @resutlT@.  Note that in @tyab@, the first part is ignored, and the second part is universal.

</pre>
</div>
<div title="2007-07-29" modifier="Conal Elliott" modified="200707312331" created="200707312330" tags="2007-07 day">
<pre>* Blog post &quot;[[Abundance and Scarcity in the Consciousness and Practice of NVC| http://evolve.awakeningcompassion.com/?p=22]]&quot;
</pre>
</div>
<div title="2007-07-30" modifier="Conal Elliott" created="200707312331" tags="2007-07 day">
<pre>* Oops!  I hadn't noticed that the second Haskell Hackathon will be held in Frieburg, immediately following ICFP.  I'd like to attend, so I'm going to change my plane tickets.
* Found a blog &quot;[[living in reflective practice| http://livinginreflectivepractice.blogspot.com]]&quot;, which comments on one of my &quot;NVC Evolves&quot; posts.  Looks like a lot of content I'll like.
</pre>
</div>
<div title="2007-07-31" modifier="Conal Elliott" modified="200708021823" created="200707312331" tags="2007-07 day">
<pre>* Note to haskell list: &quot;Type class instance selection &amp; search&quot; +++&gt;
I keep running into situations in which I want more powerful search in selecting type class instances.  One example I raised in June, in which all of the following instances are useful.
\begin{code}
instance (Functor g, Functor f) =&gt; Functor (O g f) where
  fmap h (O gf) = O (fmap (fmap h) gf)

instance (Cofunctor g, Cofunctor f) =&gt; Functor (O g f) where
  fmap h (O gf) = O (cofmap (cofmap h) gf)

instance (Functor g, Cofunctor f) =&gt; Cofunctor (O g f) where
  cofmap h (O gf) = O (fmap (cofmap h) gf)

instance (Cofunctor g, Functor f) =&gt; Cofunctor (O g f) where
  cofmap h (O gf) = O (cofmap (fmap h) gf)
\end{code}

My understanding is that this sort of instance collection doesn't work together because instance selection is based only on the matching the head of an instance declaration (part after the &quot;=&gt;&quot;).  I'm wondering why not use the preconditions as well, via a Prolog-like, backward-chaining search for much more flexible instance selection?  Going further, has anyone investigated using Prolog as a model for instance selection?  Better yet, how about [[LambdaProlog| http://www.lix.polytechnique.fr/Labo/Dale.Miller/lProlog]], which generalizes from Horn clauses to (higher-order) hereditary Harrop formulas, including (restricted but powerful) universals, implication, and existentials?  Once search is in there, ambiguity can arise, but perhaps the compiler could signal an error in that case (i.e., if the ambiguity is not eliminated by further search pruning).

My motivation: I've been playing with a programming style in which my type formulation leads to automatic construction of much of the code, thanks to use of Functor, Applicative, Monoid, and type composition.  An example is [[Applicative_data-driven_programming| http://haskell.org/haskellwiki/Applicative_data-driven_programming]], and I'm trying now to do the same to create a much simpler implementation of [[Eros| http://conal.net/papers/Eros]].  I think this programming style is what Conor was alluding to recently as &quot;[[types don't just contain data, types explain data| http://article.gmane.org/gmane.comp.lang.haskell.cafe/26520]]&quot;.  (Conor: I hope you chime in.)  My hunch is that this programming style tends to run up against the head-only instance matching mechanism and would work much better with a more powerful means of selecting instances.
  === 
* And another +++
Some other instances that could work with backward chaining
\begin{code}
instance Monad m =&gt; Applicative m where
  pure  = return
  (&lt;*&gt;) = ap

instance (Applicative f, Monoid a) =&gt; Monoid (f a) where 
  mempty  = pure mempty
  mappend = liftA2 mappend

instance (Applicative f, Num a) =&gt; Num (f a) where
  (+)         = liftA2 (+)
  fromInteger = pure . fromInteger
  -- etc
\end{code}
Currently, I place such instance declarations in comments as boilerplate to be instantiated manually.
  === 
* ''Visualizing polymorphic values'' ++++
I'm pondering how to extend tangible values (see [[TV| http://haskell.org/haskellwiki/TV]] and [[Eros| http://conal.net/papers/Eros]]) to concretely visualize //polymorphic// values, such as the identify function.  Tangible values render as compositions of GUI elements: atomic widgets (sliders, text boxes, graphics canvases), as well as horizontal juxtaposition for pairs and vertical juxtaposition for functions.  I'm looking for a simple, general, and easy-to-guess interface design.

How can one //concretely// visualize a polymorphic value, such as @id :: forall a. a -&gt; a@?  How to present input and output of an arbitrary type (@a@)?  When a values is given for the input and shown in the output, that value will be monomorphic.

Note that an input or output might not be fully polymorphic, e.g.,
\begin{code}
rotate :: forall a. Double -&gt; Image a -&gt; Image a
\end{code}

One idea is for polymorphic inputs &amp; outputs to present the user with a menu of visualizations.  Choosing a visualization implies a (temporary) selection for one or more type variables, which then propagate to other instances of the type variable.  The GUI would dynamically change accordingly.

A variation on this idea is to use explicit type abstraction and require that the user instantiate type variables concretely before choosing visualizations for polymorphic inputs and outputs.  Then the interfaces offered would be much more specific.
  === 
* How to //input// functions. ++++
A function output consists of an argument input and a result output.
\begin{code}
OLambda :: Input (~&gt;) a -&gt; Output (~&gt;) b -&gt; Output (~&gt;) (a-&gt;b)
\end{code}
Currently I have no generic support for function //inputs//.  Idea: simply use the dual of the output representation, i.e., an argument //output// and a result //input//.
\begin{code}
ILambda :: Output (~&gt;) a -&gt; Input (~&gt;) b -&gt; Input (~&gt;) (a-&gt;b)
\end{code}
The idea is that if the system wants a function from the user, it sets up a way to sample the function by presenting argument values to the user and getting result values from the user.

One catch in this idea is that the user may provide different results for the same queried argument.  In other words, a more accurate type for @ILambda@ would yield @Input (IO (a-&gt;b))@.  I could address this possibility by some sort of value-based memoization, with a requirement like @Ord a@.

Hmm: inputs are supposed to be time-varying, so there'd have to be a way for the user to clear out the currently accumulated function data and start a new one.
  === 
* Unifying inputs &amp; outputs ++++
Consider replacing the two GADTs @Input@ and @Output@ with a single GADT, say &quot;@Interface@&quot;, that understands how to both get //and// present values of a given type.

Note: I can now define a @Functor@ instance for @Input@ and a @Cofunctor@ instance for @Output@.  A combined representation would probably require some kind of hybrid of @Functor@ and @Cofunctor@, taking a pair of mappings (which should be inverses).  (Consider possible connection with the paper &quot;[[There and Back Again: Arrows for Invertible Programming| http://citeseer.ist.psu.edu/alimarine05there.html]]&quot;.)
  === 
* Signed up with [[citeulike| http://www.citeulike.org]] as user [[conal| http://www.citeulike.org/user/conal]].  There's now an easy &quot;bookmarking&quot; link on [[CiteSeer| http://citeseer.ist.psu.edu/alimarine05there.html]] pages.  Added my Eros paper bib.
</pre>
</div>
<div title="2007-08" modifier="Conal Elliott" created="200801120319" tags="2007 month August" changecount="1">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2007-08-01" modifier="Conal Elliott" modified="200708020122" created="200708012303" tags="2007-08 day">
<pre>* Changing my domain registrar for conal.net from web.com to 1and1.com (where I have several other domains).
* Haskell list note, &quot;Quantified class constraints&quot; +++&gt;
I'm developing a type constructor class and want the constraint @forall a. Monoid (m a)@ (for @m :: * -&gt; *@), which is neither legal Haskell, nor supported by GHC.

As a work-around, I used the first encoding suggested in [[Simulating Quantified Class Constraints| http://www.citeulike.org/user/conal/article/1529146]] (Valery Trifonov, Haskell Workshop '03).  Add a type class
\begin{code}
class Monoid_f m where
  mempty_f  :: forall a. m a
  mappend_f :: forall a. m a -&gt; m a -&gt; m a
\end{code}
and an instance *schema*
\begin{code}
-- instance Monoid_f f where { mempty_f = mempty ; mappend_f = mappend }
\end{code}
to instantiate manually wherever necessary. For instance,
\begin{code}
instance Monoid_f f where { mempty_f = mempty ; mappend_f = mappend }
\end{code}
For instance,
\begin{code}
instance Monoid_f [] where { mempty_f = mempty ; mappend_f = mappend }
\end{code}

The paper's second approach is to replace the schema and multiple instantiations with a single instance.
\begin{code}
instance Monoid_f f =&gt; Monoid (f a) where
  { mempty = mempty_f ; mappend = mappend_f }
\end{code}
As the paper points out,
&gt; Unfortunately, due to the type variable f in the head of the instance type, this declaration is not in Haskell 98; however, at least two implementations support extensions allowing such declarations.

Sadly, this solution runs into the problem of instance selection based only on head-matching, not back-chaining into constraints.  For instance, I'd like also to use the following &quot;conflicting&quot; declaration.
\begin{code}
instance (Applicative f, Monoid a) =&gt; Monoid (f a) where 
  mempty  = pure mempty
  mappend = liftA2 mappend
\end{code}

What's the state of thinking &amp; doing with regard to universally quantified class constraints?  

Note that hereditary Harrop formulas do include universally quantified goals.  Less ambitiously, I think GHC's type-checker already deals with universally-quantified variables, so perhaps quantified constraints are not a great reach (just guessing).
=== 
* Started reading [[Type Classes With More Higher-Order Polymorphism| http://www.informatik.uni-freiburg.de/~neubauer/papers/icfp02.pdf]] (Matthias Neubauer and Peter Thiemann, ICFP '02), which discusses type lambdas.
</pre>
</div>
<div title="2007-08-02" modifier="Conal Elliott" modified="200708082124" created="200708021824" tags="2007-08 day">
<pre>* Stefan O'Rear pointed out a simple, genuine ambiguity in my example from yesterday ++++&gt;
No quotes - [] is both Applicative and Monoid.  Should [String] [&quot;ab&quot;,&quot;cd&quot;] `mappend` [&quot;ef&quot;,&quot;gh&quot;] give [&quot;ab&quot;,&quot;cd&quot;,&quot;ef&quot;,&quot;gh&quot;] or [&quot;abef&quot;,&quot;abgh&quot;,&quot;cdef&quot;,&quot;cdgh&quot;]?
  === Thus there's no way to expect the compiler to pick one meaning.  Perhaps the whole enterprise of automatic code weaving from instances is bound to run into ambiguity problems.
* Updated my [[publications page| http://conal.net/papers]] to make the entries more uniform and provide only PDFs wherever possible.  Updated my CV correspondingly.
* Back to my Eros re-implementation.
* I could get [[Applicative data-driven programming| http://haskell.org/haskellwiki/Applicative_data-driven_programming]] in shape for [[The Monad.Reader| http://www.haskell.org/haskellwiki/The_Monad.Reader]] in time for its next issue.  The deadline is September 1. I've been wondering what to do with the paper.  I'd add a gentle intro to applicative functors and explain why I chose @Applicative@ over @Monad@ or @Arrow@.  Responded to Wouter Swierstra's &quot;call for copy&quot; email.
* Make sure that [[TV| http://haskell.org/haskellwiki/TV]] is flexible enough that it can synthesize simple GUIs, but also, //interactively composable// versions (Eros).
* My new Eros implementation has both &quot;sources&quot; and &quot;events&quot;?  While @Source@ is an @Applicative@, @Event@ is just @Functor@.  Show both in [[Applicative data-driven programming| http://haskell.org/haskellwiki/Applicative_data-driven_programming]].
* Idea: Have @funFirstT@ (etc) transform type-tagged arrow-generating events into same.  It cannot know what monomorphic type to use for the second half of the pair, so //use partial types//.  After converting two such tagged events, combine the results, @mappend@ing the partial types to combine type info and @mappend@ing the events.  Interesting alternative to polymorphism.  Hm.  Can I somehow pull polymorphism out of a partial type?  Look for a lovely algebraic wrapper.  It may be very simple. +++
\begin{code}
type Convert f a b = f a -&gt; f b         -- ^ A conversion type

newtype (f :*:  g) a = Prod (f a ,  g a)
newtype (f :-&gt;: g) a = Func (f a -&gt; g a)

newtype Typed f = forall b. Typed (Ty :*: f) b


type ConvertT f = Convert (Typed f)

type PTyped f = (Partial `O` Ty) :*: f

type ConvertPT f = Convert (PTyped f)


first :: Arrow (~&gt;) =&gt; (a ~&gt; a') -&gt; ((a,b) ~&gt; (a'b))

-- Arrow tagged with result type
type TArr (~&gt;) a = Typed ((~&gt;) a)

firstPT  :: Arrow (~&gt;) =&gt; ConvertPT (TArr (~&gt;)) a (a,b)
firstPT  (Typed (Prod ptya' a_a')) =
  Typed (Prod (unFstTy ptya') (first  a_a'))

-- TODO: abstract 'first' from 'firstPT'


funFirst   :: DeepArrow (~&gt;) =&gt; (a ~&gt; (d-&gt;a')) -&gt; ((a,b) ~&gt; (d-&gt;(a',b)))

-- Arrow tagged with function result type
newtype TypedFun f = forall d a'. Typed2 (Ty :*: f) (d -&gt; a')

-- | Function extractor tagged with result function type
type TFExt (~&gt;) a = TypedFun ((~&gt;) a)

funFirstPT  :: DeepArrow (~&gt;) =&gt; ConvertT (TFun (~&gt;)) a (a,b)
funFirstPT  (TypedFun (Prod ptya' a_d_a')) =
  TypedFun (Prod (pResultTy #### tyd (pairTy tya' (sndTy tyab)) (funFirst a_d_a')
\end{code}
  === 
* Oh!  Playing with this idea led me to type functions as arrows and as //deep// arrows.  Works out beautifully. +++
\begin{code}
type TyX a b = Ty a -&gt; Ty b

newtype TyFun a b = TyFun { unTyFun :: TyX a b }

inTyFun :: (TyX a b -&gt; TyX a' b') -&gt; (TyFun a b -&gt; TyFun a' b')
inTyFun = (TyFun .) . (. unTyFun)

instance Arrow TyFun where
  first  = inTyFun (inPairTy . first )
  second = inTyFun (inPairTy . second)
  TyFun f &gt;&gt;&gt; TyFun g = TyFun (f &gt;&gt;&gt; g)

instance DeepArrow TyFun where
  result = inTyFun (inFunTy . second)
  idA    = TyFun idA
  dupA   = TyFun (pairTy' . dupA)
  fstA   = TyFun fstTy
  sndA   = TyFun sndTy
  funF   = TyFun $ dsPairTy &gt;&gt;&gt; first dsFunTy &gt;&gt;&gt; \ ((c,a),b) -&gt; 
           c #-&gt; (a #* b)
  ...
\end{code}
  === TODO: explore making @Ty@ a GADT, and make these defs prettier. ++++
\begin{code}
rAssocA  = TyFun $ \ ((a :* b) :* c) -&gt; (a :* (b :* c))
\end{code}
  === On the other hand, I might have to deal with pattern matching failures.
* I indulged in a metalinguistic chat session on #haskell IRC about (a) whether Haskell has verbs and (b) distinguishing between syntax vs semantics.
* Transferred conal.net from web.com to 1and1.com.
</pre>
</div>
<div title="2007-08-03" modifier="Conal Elliott" created="200708082125" tags="2007-08 day">
<pre>* Playing with QuickCheck, starting with @Data.Partial@.  How to generate arbitrary partial values of a given type?  Simply by generating arbitrary endomorphisms.  The cool thing about this approach is that I automatically get random generation of filler for the undefined bits.  Code: +++
\begin{code}
instance Arbitrary a =&gt; Arbitrary (Endo a) where
  arbitrary   = fmap Endo arbitrary
  coarbitrary = coarbitrary . appEndo
\end{code}
where
\begin{code}
class Arbitrary a where
  arbitrary   :: Gen a
  coarbitrary :: a -&gt; Gen b -&gt; Gen b
\end{code}
 === 
* Imagine using partial //visualizations// of typed values.  They could be assembled from parts, and then have the missing parts filled in automatically from a default.
</pre>
</div>
<div title="2007-08-04" modifier="Conal Elliott" created="200708082126" tags="2007-08 day">
<pre>* To run Eros (avoiding problem with hs-plugins on WinXP &amp; ghc-6.6) ++++
*  Create an empty directory {{{O/}}}
*  Recompile modules to make {{{.o}}} files.  Don't bother with main.
*  In shell, hide {{{.o}}} files: {{{mv *.o O/}}}.
*  Start ghci and load app, e.g., {{{:load Main}}}.  Because I hid my {{{.o}}} files, my code gets loaded interpreted.
*  In shell, uhide {{{.o}}} files: {{{mv O/*.o .}}} 
*  In ghci, run the app, e.g., {{{main}}}.  Now {{{hs-plugins}}} finds compiled code when it needs to.
  === 
</pre>
</div>
<div title="2007-08-05" modifier="Conal Elliott" created="200708082127" tags="2007-08 day">
<pre>* I got my polymorphism-via-partial-types scheme written &amp; compiling.  It got very simple when I let go of making my definitions at the level of type-to-type functions.  I haven't put it all together, and now I'm having doubts.  The embedded transformations etc have lots of undefined places.  How will they get filled in?  For instance, ++++
\begin{code}
emb1 :: (c~&gt;c') -&gt; ( (a-&gt;(f,b-&gt;(c,g)),e) ~&gt; (a-&gt;(f,b-&gt;(c',g)),e) )
emb1 = first . result . second . result . first
\end{code}
  === Given a transformation @xf :: c~&gt;c'@, the embedding will yield @emb1 xf@, together with a partial type @(_-&gt;(_,_-&gt;(c',_)),_)@.  I could then apply the underlying endomorphism and apply it to the type of the whole value being transformed, i.e., @(a-&gt;(f,b-&gt;(c,g)),e)@.   Is that choice correct in general?  I doubt it.  Consider embedding a //polymorphic// arrow, such as @swapA :: forall a b. (a,b) ~&gt; (b,a)@.
* Alternative: Represent a polymorphic arrow as a //function// from domain types to range types.  Here's some magic: I discovered recently that my (typed) type of type representations is a deep arrow.  Thus I can simultaneously transform values with their types.  I lose context-based type inference and polymorphic constants.  I already use this sort of type-function in Eros, so I'll just be cleaning them up and using them more centrally.  Hm.  How to formulate my tagged arrows?  With my partial-type idea: ++++
\begin{code}
data TArr (~&gt;) a = forall a'. TArr (ParTy a') (a ~&gt; a')
\end{code}
  === In the type-function idea, I'd want to have @arr :: a ~&gt; a'@ and a @tyf :: Ty a -&gt; Ty a'@. ++++
\begin{code}
data TArr (~&gt;) a = forall a'. TArr (a `TyFun` a') (a ~&gt; a')
\end{code}
  === where @TyFun@ is the deep arrow of type transformations.  Then, for instance ++++
\begin{code}
firstT  :: Arrow     (~&gt;) =&gt; TArrX (~&gt;) a (a,b)
firstT  (TArr ta_a' a_a') = TArr (first  ta_a') (first  a_a')
\end{code}
  === This approach works out brilliantly!
* I switched the typed type representation to a GADT, for convenient pattern matching.  Very nice!  I love the simplicity and clarity of the new @Arrow@ and @DeepArrow@ instances. +++
\begin{code}
instance Arrow TyFun where
  TyFun f &gt;&gt;&gt; TyFun g = TyFun (f &gt;&gt;&gt; g)
  first  (TyFun f) = TyFun $ \ (a :* b) -&gt; (f a :* b)
  second (TyFun g) = TyFun $ \ (a :* b) -&gt; (a :* g b)

instance DeepArrow TyFun where
  result (TyFun g) = TyFun $ \ (a :-&gt; b) -&gt; (a :-&gt; g b)
  idA      = TyFun id
  dupA     = TyFun $ \ a -&gt; a :* a
  fstA     = TyFun $ \ (a :* _) -&gt; a
  sndA     = TyFun $ \ (_ :* b) -&gt; b
  funF     = TyFun $ \ ((c :-&gt; a) :* b) -&gt; (c :-&gt; (a :* b))
  funS     = TyFun $ \ (a :* (c :-&gt; b)) -&gt; (c :-&gt; (a :* b))
  funR     = TyFun $ \ (a :-&gt; c :-&gt; b) -&gt; (c :-&gt; a :-&gt; b)
  curryA   = TyFun $ \ ((a :* b) :-&gt; c) -&gt; (a :-&gt; b :-&gt; c)
  uncurryA = TyFun $ \ (a :-&gt; b :-&gt; c)  -&gt; ((a :* b) :-&gt; c)
  swapA    = TyFun $ \ (a :* b) -&gt; (b :* a)
  lAssocA  = TyFun $ \ (a :* (b :* c)) -&gt; ((a :* b) :* c)
  rAssocA  = TyFun $ \ ((a :* b) :* c) -&gt; (a :* (b :* c))
\end{code}
 === 
* What's next with Eros?  Return to @WGet@ &amp; @WPut@.
</pre>
</div>
<div title="2007-08-06" modifier="Conal Elliott" modified="200708082202" created="200708082133" tags="2007-08 day">
<pre>* Eros: Stitching together the pieces for rendering inputs &amp; outputs.  I notice that there's a lot of commonality to factor out in forming &amp; dissecting pairs &amp; &quot;copairs&quot;. ++++
\begin{code}
class CoPair f where
  coFst  :: f a -&gt; f (a,b)
  coSnd  :: f b -&gt; f (a,b)

coPair :: Monoid_f f =&gt; f a -&gt; f b -&gt; f (a,b)
a `coPair` b = coFst a `mappend_f` coSnd b
\end{code}
 === 
</pre>
</div>
<div title="2007-08-07" modifier="Conal Elliott" created="200708082203" tags="2007-08 day">
<pre>* Wowzers! I have a lot of @Copair@ instances, including partial values and my Eros combinators. ++++
\begin{code}
instance Copair Partial where
  cofst = inPartial first
  cosnd = inPartial second

instance DeepArrow (~&gt;) =&gt; Copair (TArr (~&gt;)) where
  cofst = firstT
  cosnd = secondT

instance DeepArrow (~&gt;) =&gt; Copair (TFun (~&gt;)) where
  cofst = funFirstT
  cosnd = funSecondT

instance DeepArrow (~&gt;) =&gt; Copair (TInp (~&gt;)) where
  cofst = inpFirstT
  cosnd = inpSecondT
\end{code}
  === The other two Eros combinators (@result@ and @funResultT@) are methods on another class, which I could call &quot;@Cofunc@&quot;.  Also, @Partial@ is a @Copair@ instance.
</pre>
</div>
<div title="2007-08-08" modifier="Conal Elliott" created="200708082128" tags="2007-08 day">
<pre>* More ambiguous type class instances. ++++
\begin{code}
-- standard Monoid instance for Applicative applied to Monoid
instance (Applicative (O g f), Monoid a) =&gt; Monoid (O g f a) where
  { mempty = pure mempty; mappend = (*&gt;) }

instance Monoid (g (f a)) =&gt; Monoid (O g f a) where
  { mempty = O mempty; mappend = inO2 mappend }
\end{code}
  === 
* Idea: create an automated build system (like &quot;make&quot;) that maintains the required build actions //incrementally//.  Do it via change listeners.
* Blog note ++++
The @(***)@ operator is very handy for constructing functions (or other arrow things) that map pairs to pairs.  On functions:
\begin{code}
(***) :: (a -&gt; b) -&gt; (a' -&gt; b') -&gt; ((a,a') -&gt; (b',b'))
f *** g = \ (a,b) -&gt; (f a, g b)
\end{code}
Very handy for function of one argument, but sometimes I find myself wanting to do something similar with (curried) functions of multiple arguments.  An example of that sort of pattern is the @Monoid@ instance for pairs (found in [[Data.Monoid| http://darcs.haskell.org/ghc-6.6/packages/base/Data/Monoid.hs]]):
\begin{code}
instance (Monoid a, Monoid b) =&gt; Monoid (a,b) where
    mempty = (mempty, mempty)
    (a,b) `mappend` (a',b') = (a `mappend` a', b `mappend` b')
\end{code}
To look even more like @(***)@, massage that @mappend@ definition as follows:
\begin{code}
    mappend = \ (a,b) (a',b') -&gt; (mappend a a', mappend b b')
\end{code}
Rearranging a bit,
\begin{code}
    mappend == \ (a,b) (a',b') -&gt; (mappend a *** mappend b) (a',b')
            == \ (a,b) -&gt; (mappend a *** mappend b)
\end{code}
We could go further, but the definitions get murky:
\begin{code}
    mappend == \ (a,b) -&gt; (uncurry (***)) (mappend a, mappend b)
            == \ (a,b) -&gt; (uncurry (***)) ((mappend *** mappend) (a,b))
            == (uncurry (***)) . (mappend *** mappend)
\end{code}

To get a prettier formulation, let's start with a variation on @(***)@:
\begin{code}
($*) :: (a -&gt; b, a' -&gt; b') -&gt; (a,a') -&gt; (b,b')
($*) = uncurry (***)
\end{code}
In other words,
\begin{code}
(f,f') $* (a,a') = (f *** f') (a,a')
                == (f a, f' a')
\end{code}
The advantage of @($*)@ over @(***)@ is that it consumes and produces only pairs.  It takes a pair of functions and a pair of arguments and produces a pair of results.  That property lets is cascade nicely where @(***)@ doesn't.

\begin{code}
    mappend = \ (a,b) (a',b') -&gt; (mappend a a', mappend b b')
           == \ (a,b) (a',b') -&gt; (mappend a, mappend b) $* (a',b')
           == \ (a,b) (a',b') -&gt; (mappend,mappend) $* (a,b) $* (a',b')
           == \ p q -&gt; (mappend,mappend) $* p $* q
\end{code}
So
\begin{code}
  p `mappend` q = (mappend,mappend) $* p $* q
\end{code}
  === 
</pre>
</div>
<div title="2007-08-09" modifier="Conal Elliott" modified="200708110216" created="200708102216" tags="2007-08 day">
<pre>* More ambiguous type class instances. ++++
\begin{code}
-- standard Monoid instance for Applicative applied to Monoid
instance (Applicative (O g f), Monoid a) =&gt; Monoid (O g f a) where
  { mempty = pure mempty; mappend = (*&gt;) }

instance Monoid (g (f a)) =&gt; Monoid (O g f a) where
  { mempty = O mempty; mappend = inO2 mappend }
\end{code}
  === 
* Idea: create an automated build system (like &quot;make&quot;) that maintains the required build actions //incrementally//.  Do it via change listeners.
* Blog note +++
The @(***)@ operator is very handy for constructing functions (or other arrow things) that map pairs to pairs.  On functions:
\begin{code}
(***) :: (a -&gt; b) -&gt; (a' -&gt; b') -&gt; ((a,a') -&gt; (b',b'))
f *** g = \ (a,b) -&gt; (f a, g b)
\end{code}
Very handy for function of one argument, but sometimes I find myself wanting to do something similar with (curried) functions of multiple arguments.  An example of that sort of pattern is the @Monoid@ instance for pairs (found in [[Data.Monoid| http://darcs.haskell.org/ghc-6.6/packages/base/Data/Monoid.hs]]):
\begin{code}
instance (Monoid a, Monoid b) =&gt; Monoid (a,b) where
    mempty = (mempty, mempty)
    (a,b) `mappend` (a',b') = (a `mappend` a', b `mappend` b')
\end{code}
To look even more like @(***)@, massage that @mappend@ definition as follows:
\begin{code}
    mappend = \ (a,b) (a',b') -&gt; (mappend a a', mappend b b')
\end{code}
Rearranging a bit,
\begin{code}
    mappend == \ (a,b) (a',b') -&gt; (mappend a *** mappend b) (a',b')
            == \ (a,b) -&gt; (mappend a *** mappend b)
\end{code}
We could go further, but the definitions get murky:
\begin{code}
    mappend == \ (a,b) -&gt; (uncurry (***)) (mappend a, mappend b)
            == \ (a,b) -&gt; (uncurry (***)) ((mappend *** mappend) (a,b))
            == (uncurry (***)) . (mappend *** mappend)
\end{code}

To get a prettier formulation, let's start with a variation on @(***)@:
\begin{code}
($*) :: (a -&gt; b, a' -&gt; b') -&gt; (a,a') -&gt; (b,b')
($*) = uncurry (***)
\end{code}
In other words,
\begin{code}
(f,f') $* (a,a') = (f *** f') (a,a')
                == (f a, f' a')
\end{code}
The advantage of @($*)@ over @(***)@ is that it consumes and produces only pairs.  It takes a pair of functions and a pair of arguments and produces a pair of results.  That property lets is cascade nicely where @(***)@ doesn't.

\begin{code}
    mappend = \ (a,b) (a',b') -&gt; (mappend a a', mappend b b')
           == \ (a,b) (a',b') -&gt; (mappend a, mappend b) $* (a',b')
           == \ (a,b) (a',b') -&gt; (mappend,mappend) $* (a,b) $* (a',b')
           == \ p q -&gt; (mappend,mappend) $* p $* q
\end{code}
So
\begin{code}
  p `mappend` q = (mappend,mappend) $* p $* q
\end{code}
  === 
Rewrite to get to the point more quickly.
* I got the pieces type checking for very modular versions of @pair@ for @WGet@ and @WPut@ for Eros. ++++
\begin{code}
type WGet (~&gt;) = Ty :-&gt;: (WinIO `O` ((Event `O` TInp (~&gt;)) :*: Source))

u :: DeepArrow (~&gt;) =&gt; PairTy (WGet (~&gt;))
u = pair

type PutStuff (~&gt;) o =
  (Event `O` TArr (~&gt;) :*: Event `O` TFun (~&gt;)) :*: (Source `O` Flip (-&gt;) o)

type WPut (~&gt;) o =
  (-&gt;) (Event (TTArr (~&gt;))) `O` (Ty :-&gt;: (WinIO `O` PutStuff (~&gt;) o))

v :: (DeepArrow (~&gt;), Monoid o) =&gt; PairTy (WPut (~&gt;) o)
v = pair
\end{code}
  === Because I couldn't use a single definition of @Pair@ for type composition, I have things like the following. ++++
\begin{code}
type WinIO = (-&gt;) Win `O` (IO `O` LaidOut)

instance Pair f =&gt; Pair ((-&gt;) a `O` f) where pair = apPair
instance Pair f =&gt; Pair (IO     `O` f) where pair = apPair
instance Pair f =&gt; Pair (WinIO  `O` f) where pair = ppPair

-- Standard instances for (h `O` f) when f is applicative
instance Pair Source where pair = apPair
instance Monoid_f f =&gt; Monoid_f (Source `O` f) where
  { mempty_f = O (pure mempty_f); mappend_f = inO2 (liftA2 mappend_f) }
instance Pair f =&gt; Pair (Source `O` f) where pair = apPair
\end{code}
  === 
</pre>
</div>
<div title="2007-08-10" modifier="Conal Elliott" created="200708111845" tags="2007-08 day">
<pre>* Correspondence with Marc Weber, who has Phooey set up in [[Nix| http://nix.cs.uu.nl]], a purely functional package manager.
* Ordered a second GB of RAM for my laptop.
* Bill H installed an air conditioner for our office.  Whew!
* My Eros reformulation is missing the internal handles &amp; handling for pair inputs &amp; ouputs.  Pondering how they might fit into the elegant @Pair@ framework.  When do I want to insert something for the pair along with the two halves?  The handle widgets &amp; their layout, the events they generate when selected, and at an output when a compatibly-typed &quot;seed&quot; arrow is chosen.
</pre>
</div>
<div title="2007-08-11" modifier="Conal Elliott" modified="200708130719" created="200708111845" tags="2007-08 day">
<pre>* Yoiks: [[30 inch LCD monitor with 2560x1600 resolution for $1300| http://www.newegg.com/Product/Product.aspx?Item=N82E16824001098]].  Maybe give Holly my 24 inch monitor.  Oh, oops.  My laptop's GeForce Go 7700 doesn't seem to drive that resolution.
* Idea for a simple, powerful &amp; invisible &quot;make&quot; facility. ++++
*  Treat mutable files (e.g., source code modules) as time-varying &quot;sources&quot; and processing tools (compilers, etc) as pure functions.
*  Use applicative data-driven computation to wire up networks of sources &amp; processors.
*  Use file change notification to integrate the file system into the data-driven framework.
*  Laziness is essential, so that recompilation etc happens only when really required.  Data-driven propagation of thunks.  When accessed &amp; used, the real computation happens.
*  For this laziness trick to work, I guess the file system would have to cooperate.  Could we have a kind of file system that stores thunks and only evaluates them on demand?
*  Here's a nifty use of the applicative functor interface.  Considering the presence of compilers, even tools (code) are sources (variable), so we get to use the @&lt;*&gt;@ operator.  When the tool or its input (argument) changes, the result is recomputed.
*  This idea would eliminate an explicit &quot;make&quot; tool altogether.
*  I'd probably want a more sophisticated implementation of data-driven computation than I have now.
*  Some computation could be done speculatively, when there extra cycles are available.
*  Give the system some clues about when to recompute eagerly, such as opening a source in an editor.
*  Instead of altering a file system, use an &quot;abstract file system&quot; (AFS), layered on top of a conventional file system (CFS).  The AFS may simply be a computation workspace (e.g., Hugs or GHCi top-level sesion).  Make bidirectional adaptors between CFS &amp; AFS. For CFS -&gt; AFS, import a conventional, externally-mutable file as a value source.  For AFS -&gt; CFS, export a value source to a file, so that the file gets written whenever the source changes.
*  Another layer of sophistication: study possibilities for tracking //incremental// changes and corresponding incremental recomputation.   Check out [[Monads for Incremental Computing| http://www.citeulike.org/user/conal/article/1554283]] by Magnus Carlsson and [[Adaptive Functional Programming| http://www.citeulike.org/user/conal/article/1554299]], by Umut Acar, Guy Blelloch and Bob Harper.  In any case, both are relevant to my &quot;[[applicative data-driven computation| http://haskell.org/haskellwiki/Applicative_data-driven_programming]&quot; work &amp; paper (in draft).
*  Improve my data-driven stuff for the case when an input changes but corresponding output (dependent source) doesn't.  Could be a simple wrapper @eqCheck :: Eq a =&gt; Source a -&gt; Source a@.
*  Similarly, add a caching/memoizing wrapper @memo :: Hashable a =&gt; Source a -&gt; Source a@.
  === 
* For my Eros pair-related classes, consider handling @WPut@ differently.  Now I use @Source `O` Flip (-&gt;) o@, and I set up instances so that this type constructor is a @Pair@ type.  I could instead define a function for for sinks. ++++
\begin{code}
opair :: (Functor f, Pair f, Monoid o) =&gt;
         f (a -&gt; o) -&gt; f (b -&gt; o) -&gt; f ((a,b) -&gt; o)
fao `opair` fbo = fmap fo (fao `pair` fbo)

fo :: Monoid o =&gt; (a-&gt;o, b-&gt;o) -&gt; (a,b) -&gt; o
fo (ao,bo) (a,b) = ao a `mappend` bo b
\end{code}
  === But this idea doesn't work out, for two reasons. ++++
*  I don't have a @Functor@ instance for @f :-&gt;: g@.  Tried to fix with a new class. ++++
\begin{code}
class BidirFunctor f where
  bidirfmap :: (a -&gt; b) -&gt; (b -&gt; a) -&gt; f a -&gt; f b

instance (Arrow (~&gt;),Functor f, Functor g) =&gt; BidirFunctor (Arrw (~&gt;) f g) where
  bidirfmap h h' = inArrw $ \ fga -&gt; arr (fmap h') &gt;&gt;&gt; fga &gt;&gt;&gt; arr (fmap h)
\end{code}
   === But I don't have an inverse for @of@.
*  The sink types (@a -&gt; o@, etc) would be propagated in as type arguments, rather than just the domain of the sinks.
  === 
</pre>
</div>
<div title="2007-08-13" modifier="Conal Elliott" created="200708202113" tags="2007-08 day">
<pre>* I'm enchanted with the data-driven build idea from [[2007-08-11]], including build steps as pure functions and using the applicative functor interface.  I'm wondering how to get recompilations not to get backlogged.  For instance, suppose each &quot;save&quot; (or &quot;checkpoint&quot;), or even each keystroke, triggers a recompilation.  In other words, if recompilations get triggered more frequently than they can get executed.  Note that this same issue arises in window-system programming, for mouse and repaint handling.  Mouse and repaint events are coalesced.  Generalize that trick so that it covers recompilation as well.
* Injured my left foot while working outside this morning.  I'm treating it at home for now.
* Correspondence with Marc Weber.  He's interested in project collaboration.
</pre>
</div>
<div title="2007-08-14" modifier="Conal Elliott" created="200708202114" tags="2007-08 day">
<pre>* Making lovely simplifications in Eros.  I want to release a new TypeCompose, but haddock chokes on it.  TypeCompose is holding up Phooey, in which I just fixed some version skew.  Responded to David Waern, whose last year's Summer-of-Code project was ghc.haddock.
* I got de-confused about ghc.haddock vs haddock.ghc.  Use GHC 6.7 and http://darcs.haskell.org/SoC/haddock.ghc.
* I think the pieces are now in place for Eros.  Next, tie it into TV.  I guess I'll want to alter TV, which now assumes an arrow interface.
</pre>
</div>
<div title="2007-08-15" modifier="Conal Elliott" created="200708202115" tags="2007-08 day">
<pre>* On IRC chat, [[ClaudiusMaximus| http://claudiusmaximus.goto10.org]] (Claude Heiland-Allen) mentioned that he's doing functional imaging using arrows.  I never thought of that generalization, and it seems a great idea.  He's doing video with feedback, and so ended up sampling &amp; recomputing lots of previous (continuous) frames.  We got to talking, and I remembered my idea of lazy infinite image pyramids (but infinite in extent, so the word &quot;pyramid&quot; is not quite ideal).  And that gave me the idea that such a thing would be another arrow instance.  I love that idea!  BTW, the pyramid would probably be a zipper, so it could be infinite in extent and detail, and efficiently perusable.
* Claude pointed out that I had some bad html showing up in a Pan gallery.  I fixed dozens of (auto-generated) files.
* Tidbit on Haskell optimization ++++&gt;
&gt; And I have a question:  given that I have a Pentium-M cpu that supports SSE2, what are the best flags to pass to ghc to make use of those? Perfect accuracy isn't an issue, I want &quot;as fast as possible&quot;.
There's been some discussion of this on haskell-cafe recently.  As I understand it, the relevant options are:
{{{
-fexcess-precision -fvia-C -optc-O2 -optc-mfpmath=sse -optc-msse2 -optc-march=pentium4
}}}
  === 
* I installed ghc-6.7.20070810-i386-unknown-mingw32.exe.  Though it runs, I don't know how to get other packages installed, including Cabal.  &quot;ghc-pkg list&quot; tells me that I have only {ghc-6.7.20070810}, rts-1.0.  I asked the cvs-ghc for help.  Meanwhile I backed out to ghc-6.6, so I can keep working.
* Found that 20070802 works, but it seems to have changed the rules about deriving. ++++
Code:
\begin{code}
 -- | Pairing for unary type constructors.
 newtype Pair1 f g a = Pair1 {unPair1 :: (f a, g a)}
   deriving (Eq, Ord, Show)
\end{code}
Error message:
{{{
    src/Data/Tupler.hs:26:0:
	No instances for (Show (g a), Show (f a))
	  arising from the 'deriving' clause of a data type declaration
		       at src/Data/Tupler.hs:(26,0)-(27,25)
	Possible fix:
	  add an instance declaration for (Show (g a), Show (f a))
	When deriving the instance for (Show (Pair1 f g a))
}}}
I sent a note to cvs-ghc.
  === 
* Eros is going great.  It keeps getting simpler &amp; lovelier.  Several pieces along the way that will make interesting blog posts.  What's next? ++++
*  Get haddock.ghc going, so I can make docs again
*  Simplify Phooey as in my &quot;[[Applicative data-driven computation|  http://haskell.org/haskellwiki/Applicative_data-driven_programming]]&quot; draft.  Eliminate the Arrow version. Keep a new Monad version (from the draft) for composing with Source to make the AF version.
*  Change TV to use AF instead of Arrow.  I already have a prototype version in Eros.
*  Map from TV's Input &amp; Output types to Phooey.  Really, just make sure that Phooey implements Pair, Fun, and Title, and there's nothing else to do.   Eliminate the mtl dependence, now that I'm using AF composition instead of monad transformers.
*  Finish Eros, by plugging in some actual widgets.
*  Release it all.
*  Write some blog posts.
  === 
* Phooey work ++++
*  Cloned the project at 1.2.1.  Made a tag &amp; tarball dist ({{{make darcs-tag darcs dist}}}).
*  Changed version number to 2.0 (major).
*  Changes to {{{phooey.cabal}}} ++++
*   Removed {{{mtl, arrows}}} from {{{Build-Depends}}}
*   Removed modules {{{TagT}}}, {{{LayoutT}}}, {{{Monad}}} and {{{Arrow}}} in {{{Graphics.UI.Phooey}}}.  Also {{{Arrow}}} and {{{Monad}}} in {{{Examples}}}
   === 
* Removed {{{mtl}}} line from {{{Makefile}}}
  === 
</pre>
</div>
<div title="2007-08-16" modifier="Conal Elliott" created="200708202115" tags="2007-08 day">
<pre>* Yesterday it occurred to me that my Event representation is a continuation-based computation (e.g., @Control.Monad.Cont@ in the {{{mtl}}} package).  This morning, {{{ski}}} on {{{#haskell}}} said the same thing.  I got intrigued about the connection between events and continuation computations, and how to think about @Cont r@ as a monoid.  Ski said it's &quot;the monoid related to discarding and duplicating the current continuation&quot;, which makes a lot of sense to me after a bit of thought.  I decided to make the plunge and use @Cont@ directly for the general case, and define @Event = Cont (IO ())@ as a special case.  Most of my gestural composition stuff generalizes nicely, and introduced classes @InputHandle@ and @OutputHandle@ with @IO ()@ instances.  Hm.  Doesn't really let me abstract over differences between underlying GUI libs, however, since they'd probably all use @IO ()@.
* I've moved more stuff from Eros into TypeCompose.  Now I split off a new package &quot;DataDriven&quot;.
* ghc-6.7 has broken some of my &quot;deriving&quot; clauses.  I sent a note asking if something has changed and what can be done.  Waiting.
* Misc to do on my Haskell projects: ++++
*  Rename Graphics.UI.Eros.Render to Graphics.UI.Eros.  [done]
*  Rename Graphics.UI.Phooey.Applicative to Graphics.UI.Phooey.  [done]
*  Update TV to work with AFs instead of arrows.  Move Input &amp; Output from Eros.
*  In DeepArrow, use @:*:@ instead of @Prod1@.
*  GuiTV.  Still necessary??
*  Work out how to share widgets between Phooey &amp; Eros.  Maybe a wrapper function that turns a Phooey UI into 
*  How could I make Eros, and maybe Phooey, more restrictive, so that widgets cannot hide state (mumble).
*  Do something with Eros's Partial, PartialTy.
*  Check projects for any darcs-missing files.  See [[darcs tips]]
*  Unix mode
*  Make list of blog posts and start writing.
  === 
</pre>
</div>
<div title="2007-08-17" modifier="Conal Elliott" created="200708202116" tags="2007-08 day">
<pre>* Afterthought from [[#haskell NVC chat| http://tunes.org/~nef/logs/haskell/07.08.15]]: when people struggle with NVC language, trying to &quot;talk around&quot; what they really think, it's because the language and the thinking don't match.  When the thinking transforms to match the language, the talking becomes fluid.  The same is true with imperative programmers who've recently learned the Haskell language, but not yet the thinking of pure functional programming.  Shared these thought and had a [[#haskell-blah chat on NVC| http://conal.net/misc/2007-08-17-haskell-blah.html]].
* [[#ghc chat on web-based links for haddock| Chat on http://conal.net/misc/2007-08-17-ghc.html]]
* Reworking TV.   ++++
*  Switching from arrows to AFs.  I think I need two of type constructor args, @dom@ and @ran@. ++++
\begin{code}
-- | An /Output/ describes a way to present a functional value, perhaps
-- interactively.  It is the user-interface half of a tangible value.
data Output dom ran :: * -&gt; * where
  -- | Output primitive
  OPrim :: ran a -&gt; Output dom ran a
  -- | Visualize a function.  Akin to /lambda/
  OLambda :: Input dom  a -&gt; Output dom ran b -&gt; Output dom ran (a-&gt;b)
  -- | Visualize a pair
  OPair :: Output dom ran a -&gt; Output dom ran b -&gt; Output dom ran (a,b)
  -- | Title/label an output
  OTitle :: String -&gt; Output dom ran a -&gt; Output dom ran a

type TV dom ran = Output dom ran :*: Id
\end{code}
   === 
* How to run a TV?  What to do with a @Output dom ran a@ and an @a@?  Maybe a class. ++++
\begin{code}
type OI a = a -&gt; IO ()

class ToOI ran where ToOI :: ran a -&gt; OI a
\end{code}
  === 
  === 
</pre>
</div>
<div title="2007-08-18" modifier="Conal Elliott" modified="200708202117" created="200708202116" tags="2007-08 day">
<pre>* Pondering different Monoid instances for Maybe. ++++
\begin{code}
instance Monoid (Maybe a) where
  mempty = Nothing
  Nothing `mappend` b = b
  a       `mappend` _ = a
\end{code}
  === vs ++++
\begin{code}
instance Monoid a =&gt; Monoid (Maybe a) where
  mempty           = Nothing
  mb `mappend` mb' = Just (unMaybe mb `mappend` unMaybe mb')

unMaybe :: Monoid a =&gt; Maybe a -&gt; a
unMaybe (Just a) = a
unMaybe Nothing  = mempty
\end{code}
  === The first one is more flexible, while the second is more informative.  See the [[hpaste session| http://hpaste.org/2319]]
* Mark Wassell is [[extending Phooey| http://www.haskell.org/haskellwiki/Extending_Phooey]] for his [[HGene| http://www.haskell.org/haskellwiki/HGene]] project.  He's done a very clever thing, introducing feedback for &quot;persistence&quot;, as needed to make an editor.  Ponder feedback, including how to formulate and implement for AFs.
* TODO: rename &quot;dom&quot; &amp; &quot;ran&quot; to &quot;src&quot; &amp; &quot;snk&quot;.
* Will Phooey fit into my new TV framework?  @src == UI@, but what's &quot;snk&quot;?  Maybe @UI `O` OI@.  (Or maybe more general: @UI `O` Flip (-&gt;) o@ for an arbitrary monoid @o@.)  But then I cannot use the AF application combinator @&lt;*&gt;@ to apply an output to an input.  Hm.  I'd hoped to have just a @src@ parameter, and use @src (a -&gt; o)@ instead of @snk a@, i.e., without the @Flip@.  That pattern works for @IO@ and for Phooey @UI@, but not for Eros, which accumulates different information for inputs vs outputs.
* Hm. Is it possible to eliminate the input/output distinction?  Maybe have only inputs, representing outputs as @Input (a -&gt; o)@?  Add a new type class @OPair@ to augment @Pair@.  Maybe eliminate @Copair@.  Maybe @OPair@ is easily definable without a class.  If this idea can work, I think I'd have to change Eros to collect both input &amp; output information all the time.  Unless there's a unification I haven't seen in the Eros theory.
* Re-reading my Eros paper for inspiration for unification.  Thoughts ++++
*  An |alpha| output is really an |alpha -&gt; o| input.
*  Inputs can be edited.
*  An Eros visualization/output is an alternative view on an |alpha -&gt; o| input.  Flip it over to the other side to see it as an input.
*  Editing that input means providing another way to //visualize// the value, because |alpha -&gt; o| is the visualization function.  For instance, |o == String| or |o == ImageC|.
*  For instance, that's how the user says to change the bounds on a slider.  Or to change from a standard function view to an image view. 
  === 
* Hey -- I thought my @Event@ type was a functor, but //not// an AF.  I just realized that @Event == Cont@ and @Cont@ is a monad and therefore an AF.  What gives? ++++
\begin{code}
newtype Cont r a = Cont { runCont :: (a -&gt; r) -&gt; r }

instance Monad (Cont r) where
    return a = Cont ($ a)
    m &gt;&gt;= k  = Cont $ \c -&gt; runCont m $ \a -&gt; runCont (k a) c
\end{code}
Dropping the @newtype@ wrappers,
\begin{code}
type Cont r a = (a -&gt; r) -&gt; r

return a  c = c a
(m &gt;&gt;= k) c = m (\a -&gt; (k a) c)
\end{code}
For AF, we have @pure = return@ and @&lt;*&gt; = ap@.  For @pure@, I get exactly one invocation of the listener, when it's installed.  What about @&lt;*&gt;@?
\begin{code}
(fab &lt;*&gt; fa) c = (liftM ($) fab fa) c

liftM ($) fab fa = do { ab &lt;- fab ; a &lt;- fa ; return (ab a) }
  == fab &gt;&gt;= \ ab -&gt; fa &gt;&gt;= \ a -&gt; return (ab a)
  == \ c -&gt; (fab &gt;&gt;= \ ab -&gt; fa &gt;&gt;= \ a -&gt; return (ab a)) c
  == \ c -&gt; fab (\ ab -&gt; (fa &gt;&gt;= \ a -&gt; return (ab a)) c)
  == \ c -&gt; fab (\ ab -&gt; fa (\ a -&gt; return (ab a) c))
  == \ c -&gt; fab (\ ab -&gt; fa (\ a -&gt; c (ab a)))
\end{code}
which of course is what I'd expect for function application in a continuation semantics.  What I think this means is that //whenever// @fab@ occurs, its listener adds a new subscriber to @fa@.  The apn's continuation @c@ therefore gets invoked on the cross product of the occurrences of @fab@ and @fa@.  This semantics is like @[]@ (backtracking), while I want something more like the @ZipList@ instance of @Applicative@.  That's what @Applicative@ on @Source@ does.
=== 
</pre>
</div>
<div title="2007-08-19" modifier="Conal Elliott" created="200708202117" tags="2007-08 day">
<pre>* Made arrangements for Germany trip ++++
*  Arranged to stay at the [[Black Forest Hostel| http://www.blackforest-hostel.de]] 25.Sept-08.Oct (12 days), in a six-bed dorm.  I'll probably have to change rooms one of the nights.  Must reconfirm three days before (22 Sept, on Tasha's wedding day) -- 011 _49 761 / 881 78 70.
*  Changed my flight to return on Oct 8 (added $190).
*  Registered for [[Haskell Hackaton| http://www.haskell.org/haskellwiki/Hac_2007_II]] and added two projects (hs-plugins and fast, pure-Haskell image synthesis]].
*  Registered for ICFP, Haskell Workshop, and banquet (460 Euro).
*  Registered for IFL.  Cost is 75 Euro, due Sept 12 by bank transfer.  My bank charges, I think, but maybe Joseph could help.
  === 
* My Phooey users I've heard from so far are using the monadic interface, which I'm in the process of removing.  Keep it instead, with Applicative being a simple layering.  Oh -- wait.  I want to define my applicative UI from simple applicative pieces.  I forgot that I wouldn't get a Monad layer for free.  Hm.
* Mads presented a problem  on the [[Phooey Talk page| http://www.haskell.org/haskellwiki/talk:phooey]].  His example that presents subtotals and a total.  I wrote a response on that page.  Here's my reformulation. ++++
\begin{code}
basket :: UI (Source ())
basket = title &quot;Shopping List&quot; $
         do f          &lt;- fruit
            showFruit  &lt;- title &quot;Fruit&quot;  $ showDisplay f
            t          &lt;- tools
            showTools  &lt;- title &quot;Tools&quot;  $ showDisplay t
            showBasket &lt;- title &quot;Basket&quot; $ showDisplay $ liftA2 (+) f t
            return $
              showFruit `mappend` showTools `mappend` showBasket
\end{code}
  === and another one ++++
\begin{code}
-- Display and pass along an &quot;intermediate result&quot;, following an idea of Mads.
ir :: Show a =&gt; String -&gt; UI (Source a) -&gt; UI (Source a, Source ())
ir str ui = do x &lt;- ui
               showx &lt;- title str $ showDisplay x
               return (x,showx)

basket :: UI (Source ())
basket = title &quot;Shopping List&quot; $
         do (f,showFruit) &lt;- ir &quot;Fruit&quot; fruit
            (t,showTools) &lt;- ir &quot;Tools&quot; tools
            showBasket &lt;- title &quot;Basket&quot; $ showDisplay $ liftA2 (+) f t
            return $
              showFruit `mappend` showTools `mappend` showBasket
\end{code}
  === 

* The example got me thinking.  I don't know how to use a value twice in the applicative interface.  I guess there has to be an explicit dup (as arrows): @pure dup :: UI (a -&gt; (a,a))@.  
</pre>
</div>
<div title="2007-08-20" modifier="Conal Elliott" modified="200708300019" created="200708202118" tags="2007-08 day">
<pre>* More thoughts on Mads's &quot;basket&quot; example from yesterday ++++
*  Note that by swapping @(f,showFruit)@ to @(showFruit,f)@ and similarly with tools, we get what looks like uses of the writer monad (implicit @mappend@).  If I add a @Writer (UI Source)@ to the @UI monad@, the example might come out looking like this. ++++
\begin{code}
basket :: UI ()
basket = title &quot;Shopping List&quot; $
         do f &lt;- ir &quot;Fruit&quot; fruit
            t &lt;- ir &quot;Tools&quot; tools
            title &quot;Basket&quot; $ showDisplay $ liftA2 (+) f t
\end{code}
 === The return type has no @Source ()@, which would be implicitly included in @UI@.
*  Since each source is used just once, this version may lend itself well to an AF formulation. ++++
\begin{code}
basket :: UI ()
basket = title &quot;Shopping List&quot; $
           title &quot;Basket&quot; $ showDisplay &lt;**&gt;
           liftA2 (+) (ir &quot;Fruit&quot; fruit) (ir &quot;Tools&quot; tools)
\end{code}
  === 
* What can we do with @ir@'s definition?  New monadic version: ++++
\begin{code}
ir :: Show a =&gt; String -&gt; UI (Source a) -&gt; UI (Source a)
ir str ui = do x &lt;- ui
               title str $ showDisplay x
               return x
\end{code}
  === Messing about ++++
\begin{code}
   (m &gt;&gt;= \ x -&gt; g x &gt;&gt; return x)
== (m &gt;&gt;= g `mappend` return)
\end{code}
  === So, ++++
\begin{code}
ir str ui = (title str . showDisplay) `mappend` return
\end{code}
  === 
 === 
* I want to address recursion in AF Phooey.  Mark Wassell has a [[nice use| http://www.haskell.org/haskellwiki/Extending_Phooey]] for a table of info.  Mads Lindstroem has some [[other uses in mind| http://www.haskell.org/haskellwiki/Talk:Phooey].  Pick something simple: an event that increments a number.  Since sources are implicit, model events as Maybe-valued sources.  Monadic version: ++++
\begin{code}
counter = do b &lt;- title &quot;press me&quot; $ button 0 1
             let s = liftA2 (+) s incr
             title &quot;count&quot; $ showDisplay s
\end{code}
  === where @button@ makes a button UI with the given values for not pressed &amp; pressed.  Hm.  Really a recursive source, not a recursive UI.  Play with it anyway.  Raises interesting question of recursively defined sources.  What terminates updating?  Checking for equality.  Can't be built-in, since not all types are @Eq@.  Also, there's nothing that says to start at zero.
* Wait a minute!  Counting doesn't have to be recursive. ++++
\begin{code}
counter = do e     &lt;- title &quot;press me&quot; $ button
             count &lt;- eAccum 0 (fmap (const (+1)) e)
             title &quot;count&quot; $ showDisplay count
\end{code}
  === We can hide the event altogether: ++++
\begin{code}
buttonAccum :: a -&gt; (a -&gt; a) -&gt; UI (Source a)
buttonAccum a f = do e &lt;- button
                     eAccum a (fmap (const f) e)

counter = do count &lt;- title &quot;press me&quot; $ buttonAccum 0 (+1)
             title &quot;count&quot; $ showDisplay count
\end{code}
  === In AF form, ++++
\begin{code}
counter = title &quot;count&quot; showDisplay &lt;**&gt; title &quot;press me&quot; $ buttonAccum 0 (+1)             
\end{code}
  === 
* Since AFs hide sources, every UI has to be a single source.  If I expose a &quot;button&quot; UI element, it has to be a source rather than an event.  So, I use the most general form I know for converting an event into a source, namely @eAccum@.
</pre>
</div>
<div title="2007-08-21" modifier="Conal Elliott" created="200708300020" tags="2007-08 day">
<pre>* &quot;Non-coercive communication&quot; is a clearer description than &quot;NVC&quot;.  Look for a positive replace to &quot;non-coercive&quot; and a broader replacement for &quot;communication&quot;.
* Return to reworking TV, started on [[2007-08-17]].  I gave @Output@ two (type constructor) arguments: @dom@ and @ran@, e.g., Phooey's @UI@ and @UI `O` OI@.  Now I have a problem: the @OI@ constructor prevents applying the basic AF application operators @(&lt;*&gt;)@ and (its reversal) @(&lt;**&gt;)@.  Some choices: ++++
*  Add operators @(#)@ and @(##)@ that simply strip off the @OI@ and apply the standard operators.  Use those instead of the standard ones.
*  Use the non-@OI@ types and make an @OI@ adaptor for use with TV.
*  Try replacing @src@ and @snk@ as TV type arguments with @f@ and @o@, where the output type is @f (b -&gt; o)@.  Figure out how to fit Eros into this model, since Eros now has rather different type constructors for input &amp; output.  I don't know how to make that unification work.
  === 
* Compiling wxHaskell for ghc-6.7. ++++
*  Copied some {{{include/wx}}} files.
*  Copied {{{include/gmp.h}}} from an older ghc-6.7.  Missing in the one I'm running.
*  In {{{makefile}}}, removed -fvia-C from {{{WXCORE-HCFLAGS}}} &amp; {{{WX-HCFLAGS}}} and removed {{{-fPIC}}} from {{{WXC-CXXFLAGS}}}.  The former got around a bug in ghc-asm.  The latter eliminated lots of warning messages.
  === 
* Got IO and (applicative) Phooey UI working with new TV.  Next is Eros!  How to introduce widgets to Eros?  Leverage Phooey.
</pre>
</div>
<div title="2007-08-22" modifier="Conal Elliott" modified="200709041906" created="200708300020" tags="2007-08 day" changecount="1">
<pre>* Putting pieces together to make a new Eros top level.
* Changed my @TTArr@ type.  It contained a source type and a matching @TArr@.  Now it just has a function from source types to @TTArr@s.  Works out very well.  Simpler and more general than before.  Amenable to polymorphic values.
* Hm.  Eros @WGet (~&gt;)@ is not a functor, and @WPut (~&gt;)@ is not a cofunctor. ++++
*  I used functor/cofunctor to define @Read@ inputs &amp; @Show@ outputs.
*  The reason @WGet (~&gt;)@ isn't a functor is that it wants type information.
*  Idea: define classes similar to Functor &amp; Cofunctor that includes type transformations: ++++
\begin{code}
class FunctorTy f where
  fmapTy :: (a `TyFun` b) -&gt; (a -&gt; b) -&gt; f a -&gt; f b
\end{code}
   === Hm.  Note similarity with @TArr@: ++++
\begin{code}
data TArr (~&gt;) a = forall a'. TArr (a `TyFun` a') (a ~&gt; a')
\end{code}
   === 
  === 
</pre>
</div>
<div title="2007-08-23" modifier="Conal Elliott" created="200708300021" tags="2007-08 day">
<pre>* More &amp; more pieces coming together &amp; simplifying in the new Eros.
* I don't think there's anything special about TVs, and very little of the system knows about them.  My current definitions: ++++
\begin{code}
-- | Tangible values (TVs).
type TV src snk = Output src snk :*: Id

-- | Arrow on 'TV's
type TVFun src snk = OFun src snk ::*:: (-&gt;)
\end{code}
  === I think the important bit is that @::*::@ lifts deep arrows.  I've been keeping a lot of generality in type signatures.  There's probably more to be gotten.
* I think I can improve on my type of dynamically polymorphic arrows (arrow with computed result type).  Here's some code (type-checks): ++++
\begin{code}
{-# OPTIONS -fglasgow-exts #-}

import Control.Arrow
import Control.Arrow.DeepArrow

import Control.Compose ((::*::))

import Data.Ty

-- Simplify &amp; generalize the representation of arrows with computed result
-- types.  Currently:
-- 
--   data TArr (~&gt;) a = forall a'. TArr (a `TyFun` a') (a ~&gt; a')
-- 
--   firstT  :: Arrow     (~&gt;) =&gt; TArrX (~&gt;) a (a,b)
--   firstT  (TArr ta_a' a_a') = TArr (first  ta_a') (first  a_a')

--  The new idea is to break @TArr@ into two pieces: @TyFun ::*:: (~&gt;)@
-- hiding result parameter.  First hiding of type arguments.

-- | Hide the type parameter of @g@ (which may be a partial application)
data All g = forall b. All { unAll :: g b }

-- | Transformations on 'All' types
type AllX ar u v = All (ar u) -&gt; All (ar v)

-- Now specialize to Arrow &amp; DeepArrow:

-- | Transformations on 'Arrow' 'All' types
type AllXA u v = forall ar. Arrow ar     =&gt; AllX ar u v
-- | Transformations on 'DeepArrow' 'All' types
type AllXD u v = forall ar. DeepArrow ar =&gt; AllX ar u v

firstT' :: AllXA a (a,b)
firstT'  (All p) = All (first p)

resultT' :: AllXD b (a-&gt;b)
resultT'  (All p) = All (result p)

-- Finally, combine with computed result type:

-- | Binary type constructor with computed hidden second parameter.
type TArr (~&gt;) a = All ((TyFun ::*:: (~&gt;)) a)
\end{code}
  === 
* What about @TTArr@ (both parameters hidden)?  Currently, ++++
\begin{code}
data TTArr (~&gt;) = TTArr (forall a. Ty a -&gt; Maybe (TArr (~&gt;) a))
\end{code}
  ===  This definition could generalize as well.  An isomorphic variation: ++++
\begin{code}
type TTArr (~&gt;) = All (Ty :-&gt; Maybe `O` TArr (~&gt;))
\end{code}
  === Though not quite, since @TArr@ is a partially applied type synonym, which GHC spurns, to preserve first-order matching.
* Idea for more convenient GADT-based term rewriting: Add a typed @Literal@ type with a bunch of known constants and a catch-all. ++++
\begin{code}
data Literal : * -&gt; * where
  Literal    :: a -&gt;                    Literal a
  Fst        ::                         Literal ((a,b) -&gt; a)
  Plus       :: forall a. Num a =&gt;      Literal (a -&gt; a -&gt; a)
  Pi         :: forall a. Floating a =&gt; Literal a
  Sin        :: forall a. Floating a =&gt; Literal (a -&gt; a)
  ...
\end{code}
  === Then I think I can write simple, typed simplifiers.  Try it out.
* It's a hassle to carry around the arrow type parameters.  And in the end, Eros really works with arrow-universal things.  So I gave a try at making my transformation embedders, function extractors, and input extractors (@TArr@, @TFun@, and @TInp@) be explicitly universal over DeepArrow types.  The code gets much quieter. ++++
\begin{code}
-- 'DeepArrow'-universal arrow
newtype a :~&gt;: b = UD (forall (~&gt;). DeepArrow (~&gt;) =&gt; a ~&gt; b)

instance Arrow (:~&gt;:) where
  arr f         = UD $ arr f
  UD f &gt;&gt;&gt; UD g = UD $ f &gt;&gt;&gt; g
  first  (UD f) = UD $ first  f
  second (UD f) = UD $ second f
  UD f *** UD g = UD $ f *** g
  UD f &amp;&amp;&amp; UD g = UD $ f &amp;&amp;&amp; g

instance DeepArrow (:~&gt;:) where
  result (UD f) = UD $ result f
  idA           = UD idA
  fstA          = UD fstA
  dupA          = UD dupA
  sndA          = UD sndA
  funF          = UD funF
  funS          = UD funS
  funR          = UD funR
  curryA        = UD curryA
  uncurryA      = UD uncurryA
  swapA         = UD swapA
  lAssocA       = UD lAssocA
  rAssocA       = UD rAssocA

-- I'd love to use these functions above, but I don't know how to get them
-- to type-chedk.
-- 
--   onUD  h (UD f)        = UD (h f)
--   onUD2 h (UD f) (UD g) = UD (h f) (h g)

-- | Arrow with computed result type
data TArr a = forall a'. TArr (a `TyFun` a') (a :~&gt;: a')
\end{code}
  === Combining with my previous idea: ++++
\begin{code}
type TArr a = All ((TyFun ::*:: (:~&gt;:)) a)
\end{code}
  === 
* Hey! Replace my arrow newtypes @TyFun@, @OFun@, etc, with a single @Fun@: ++++
\begin{code}
newtype FunA f a b = FunA (f a -&gt; f b)
\end{code}
  === Then make a single @Arrow@ and a single @FunArr@ instance.  Oh, wait.  @Arrow@ will be tricky.  See @OFun@ &amp; @Ty@ for examples.  What about @FunArr@?  Oh, and make a new type-class to handle @Arrow@.
</pre>
</div>
<div title="2007-08-24" modifier="Conal Elliott" created="200708300021" tags="2007-08 day">
<pre>* More thoughts on the data-driven build idea mentioned on [[2007-08-11]] and [[2007-08-13]]: ++++
*  &quot;Make&quot; systems rely on purely functional build steps.  Otherwise, they couldn't know when to rebuild.
*  Represent each build result as a pair of (a) output, and (b) possible success value. ++++
\begin{code}
type MakeG o = (,) o `O` Maybe

type Make = MakeG String
\end{code}
   === When @o@ is a @Monoid@, @MakeG@ is an AF.  Build messages accumulate in the @o@ part (e.g., @String@ in @MakeG@).  Application (@&lt;*&gt;@) combines messages in any case (via @(,) o@) and combines successes (via @Maybe@), failing (@Nothing@) if function or argument fails.  Nice!  Note that @Nothing/Just@ replaces the Unix tradition of the nonzero or zero return code.
*  Unlike a conventional &quot;make&quot;, there's no way to get the rules wrong.  Dependencies are determined automatically.
*  Static typing: executables are typed functions, and other data are typed first-order values.
*  Implementation question: how to wrap up OS executables as pure functions?  If they work with stdin/stdout, then play with pipes, @unsafePerformIO@, and @read/show@.
*  Compilers are pretty file-oriented.  What to do?
*  C-like languages have the {{{#include}}} directive, which implies a compile dependency.  Some tools automatically extract those dependencies and place them in a makefile.  Instead, describe the program as an explicit application of a parameterized program to those include files.  When an include file changes, the application changes and so gets recompiled.  When an included file {{{#include}}}s another, there's another explicit application.  The applications could simple be concatenations.
*  By decomposing processors (e.g., compilers), we may be able to save some work, re-using earlier results when an intermediate value stays the same.  For instance, if {{{cpp}}} strips out comments, and someone just tweaks a comment, all post-cpp phases are avoided.
*  By decomposing input data (e.g., source code), we may be able to skip a lot of processing.  For instance, make each top-level definition be its own component, composed together.  When one definition changes, just recompile it.  Depends a lot on how the compiler works.
*  I think these last two tricks are what [[Adaptive functional programming| http://www.citeulike.org/user/conal/article/1554299]] is about.  See also [[Monads for incremental computing| http://www.citeulike.org/user/conal/article/1554283]] (done better as an AF).
*  Work out scheduling so that invalidation happens eagerly but actual builds lazily.  May be simple.   Example: suppose a computed value is to get displayed in a widget or written to a file.  If the change listener makes the foreign call, the computed result will get fully evaluated during marshalling.  In the case of a widget, there could be several values written before an actual repaint, depending on repaint scheduling, and a lot of work could be wasted.  Instead, just schedule the thunk in an &quot;update map&quot;, keyed by the widget &amp; property.  In the idle loop or a second thread, execute and empty the update map.  If an entry gets updated twice between executions, the earlier updates are discarded and their computations don't happen.  Maybe use STM.
*  Example: every keystroke, or every save.
*  Lazy output widgets ...  scrolling triggers evaluation.  Maybe by line.  Cf {{{Data.ByteString}}}.
  === 
* Thinking again about an old dream for graphics rendering: a lazy, data-rich representation of infinite and continuous images. ++++
*  Infinite image pyramids.  First idea: each node has one &quot;block&quot; (pixel or array of pixels) and four sub-pyramids for higher resolution.
*  Note there's significant overlap between levels.  Second idea: each level has a stream of progressively more accurate blocks, all of the same resolution.  The first block is a straight sampling (once per pixel).  The rest are formed by element-wise averaging the level's stream elements (starting with the sampling one) with each of the four sub-streams.
*  Next idea: have //bi-infinite// approximation streams.  Besides refining, have a progressively coarsening stream, built out of quarters of the ancenstor head approximation and its coarsenings.  For instance, if I'm am the top-left child of my parent, I extract &amp; coarsen the top-left quarter of my parent's approximation.
*  What about infinite extent?  Have the &quot;pyramid&quot; also be bi-infinite, i.e., infinitely up (zoom out) and infinitely down (zoom in).  What's a bi-infinite tree?  I don't know, but I think it has the same zipper type as a conventional infinite tree.
*  Optimize rendering for a particular block and resolution.  The block lets us cull out &quot;geometry&quot;, and the resolution lets us set level of detail.  These two adaptations counter-balance  -- more work in one means less in the other.
*  Do 3D with @Image (Point,Color)@.
*  How to apply spatial transformations to our representation?  What resolution in for what resolution out?  Depends on the properties of the spatial transformation.   Idea: do IA to bound magnification/minification.
*  For animated and/or interactive imagery, there are arbitrarily many dimensions to the problem, rather than just two.  Do a similar pyramid-zipper for these parameters as well.  Look for a general scheme for representing functions, including arbitrarily curried ones.  May be something like a generalized trie.  To represent a function @f :: a -&gt; b@, make a pyramid zipper indexed by @a@, holding approximations for @b@ values over regions.  If @b@ is a function also, then its approximations are represented via another pyramid zipper.  First work out for @a == R@, and then generalize.  Handle product domains as in generalized tries, using the currying isomorphism.
  === 
* Yesterday I did a bunch of clever stuff with &quot;universal arrows&quot;, but it didn't quite work out in practice.  The problem: when I get a function extractor (ultimately from selecting on input in some lambda), I can &quot;apply&quot; it to the containing TV, to get a function-valued TV, but then I can't re-universalize that TV.
* I have a new Eros working!  As usual, it took a long time to get it to type-check, and then it mostly worked.  Issues: ++++
*  Widgets don't stretch [fixed]
*  There are no default values for Read inputs [fixed]
*  Type-compatibility highlighting works for ints &amp; functions, but not bools.  The logic works the  color-set call happens, but with no visible result.  Hm.  A problem with the checkBox widget, which don't set the background color even when given at initialization.
*  Make some sexy examples.
*  I don't know how someone can tell what's going on.  There's no feedback saying what the TVs are, other than interacting with them.
*  Input state is forgotten during gestural composition, as before.  Think about this one.
*  Consider drag &amp; drop.
*  Outputs can be selected and edited.
*  Make TV inputs/output stop listening to events when they go away.  I don't yet have a mechanism or interface for //removing// a listener.  Idea: Have @subscribe@ take a listener and a stop-listening event.  Pass stop-listening down during UI construction.
  === 
</pre>
</div>
<div title="2007-08-25" modifier="Conal Elliott" created="200708300022" tags="2007-08 day">
<pre>* Nice trick picked up from Saizan on {{{#haskell}}}: Start with @join :: Monoid m =&gt; m (m b) -&gt; m b@ and specialize to functions: @join :: (a -&gt; a -&gt; b) -&gt; (a -&gt; b)@.  So @join f@ applies @f@ to the same argument twice.  A fun use: @join (liftA2 (,)) [0..3]@ produces the cross product of a list with itself.  Here's another, from Cale ++++
{{{
Cale: &gt; map (ap (,) (^2)) [1..10]
lambdabot:  [(1,1),(2,4),(3,9),(4,16),(5,25),(6,36),(7,49),(8,64),(9,81),(10,100)]

ddarius: :t ap (,)
lambdabot: forall a b. (a -&gt; b) -&gt; a -&gt; (a, b)
}}}
  === What about binary operators other than @(,)@, e.g., @(:)@ or @(+)@?  More great stuff at the [[Blow your mind| http://www.haskell.org/haskellwiki/Blow_your_mind]] wiki page.
* Idea: Sorting &amp; parsing are offline algorithms, having the property that no output can be produced until all input is consumed.  For parsing, reasons include errors and operator pair precedence.  Still, a lot of useful results //are// ready long before the input is consumed.  I bet there's a useful perspective shift that would help.  Decompose such functions in a way that the intermediate representation has intermediate info available early.
* Eros thoughts ++++
*  Reverse the order of input/output selection, so that the user chooses the output before the input.  Then the experience is more like conventional interactive apps.  For instance, one selects some text and clicks on ''bold''.  Better yet -- allow both orders.
*  For a more familiar experience, make the new TV //replace// the TV that contained the output.  Maybe also replace the one that contained the input.  Oh -- allow TVs to be &quot;pinned&quot; or unpinned.  An unpinned TV disappears after it's used in a composition.
*  Let users dynamically alter UIs: title add/change/remove, change slider bounds.  Maybe change the widget type altogether, though that change could also be done with a handful of identity-function TVs.
  === 
* Idea for addressing latency in a web browser: if a page (picture, etc) is in the cache, then display it immediately, without checking for a newer version.  Then check for a newer version and update the displayed page.  Further: compute an edit that modifies the shown page, drawing attention to the changes.  Maybe a mode that highlights the revisions in some way.  Could show cross-outs &amp; insertions.
* The [[Amazon Honor System| http://zme.amazon.com]] makes it easy for people to donate money in appreciation of web content &amp; services.  Anyone with an Amazon account can donate $1 or more.  Amazon's cut is 2.9% plus 30 cents per transaction.
</pre>
</div>
<div title="2007-08-26" modifier="Conal Elliott" created="200708300022" tags="2007-08 day">
<pre>* [[Haskell for pluggable apps, with the GHC API| http://programming.reddit.com/goto?id=2izu4]]
* Eros ++++
*  Added image output.  :) !
*  Adding vector input (spatial) for translation &amp; scaling.  Getting deeper into some wxHaskell.  Tried to make a &quot;vector&quot; attribute by mapping over the @on mouse@ attribute.  Doesn't really work.  I want a //filtered// version of @on mouse@.  Oh!  Use my own event algebra, where I have filtering etc.
  === 
</pre>
</div>
<div title="2007-08-27" modifier="Conal Elliott" modified="200708300024" created="200708300023" tags="2007-08 day">
<pre>* Use [[markdown| http://daringfireball.net/projects/markdown]] to write things like {{{TODO}}} and {{{CHANGES}}} files.  Use [[PanDoc| http://sophos.berkeley.edu/macfarlane/pandoc]] to convert from markdown to html, pdf (via latex), etc.  PanDoc has some handy features: smart quotes, dashes, and ellipses, auto-gen'd TOC, ASCIIMathML, footnotes, &amp; more.  I installed PanDoc and converted over my Eros TODO.  To generate {{{TODO.html}}}, just {{{pandoc --toc --smart --standalone -o TODO.html TODO}}}.  Works great!
* Found a [[markdown mode| http://jrblevin.freeshell.org/software/markdown-mode]].  Nice highlighting, but lacks paragraph fill support.  Some bugs.  I fixed some but not all.  Emailed the author.
* Read quickly through Wouter Swierstra's [[Data Types a la Carte| http://www.cs.nott.ac.uk/~wss/Publications/DataTypesALaCarte.pdf]].  Charming &amp; clever solution to &quot;the expression problem&quot;.
</pre>
</div>
<div title="2007-08-28" modifier="Conal Elliott" created="200708300024" tags="2007-08 day">
<pre>* Emacs hacking to streamlining my Haskell hacking workflow. ++++
*  In a source file, {{{f10}}} loads the module into ghci, after cd'ing to the ancestor {{{source}}} directory.
*  In a source file, {{{f11}}} does a {{{make cabal-install}}}, in the ancestor {{{source}}} directory.
*  {{{\C-c\C-j}}} appends the current region to a file in the local called {{{Junk}}} plus the extension of the current buffer.  Use it just before a big modification or deletion.
*  {{{f9}}} does {{{next-error}}} (more convenient for repeated use than {{{M-`}}}).
  === 
* Good progress simplifying my window event stuff.  Will make a nice separate library, between @DataDriven@ and @Phooey@ or @Eros@.
* Puzzling over my image output.  I wrote it such that changing the image changes the {{{on paint}}} method.  Makes sense, but it forces me to resample on every repaint.  Instead, I'd like to compute the sample array as a function of image and window size (in pixels), so whenever either changes, the array would update.  Nice &amp; simple.  The catch: the output panel is at once an output for images and an input for sizes.  Hmm.  Think of it as an output for functions from size to images.  No -- functions from size to arrays (of that size).  Oh!  it's a //source of// image sinks.  In fact, //all// of my outputs are sources of sinks.  This is the only single-widget output that produces a non-static source of sinks.  Yes -- this insight worked out very well.  I separated my image output into an output of discrete (&amp; finite) &quot;images&quot; and a pure function from window size &amp; continuous image to discrete image.  Repainting is super fast, because it's re-using a pre-rendered discrete image.
* Next: figure out why initial size is narrower than I'd expect.  (Probably because the automatic resize during initial layout is missed, and I'm just using the requested size.)  Also, why aren't the sliders or handles stretching?
* Crashing bug: if a control is closed and then another one is opened, Eros crashes.  I suspect the crash comes from setting some state that's been reallocated.
* How to get event listeners to be removed?  In particular, when a control is closed, make sure its listeners go away.  How?  I think I'll have to change the @Event@ representation &amp; interface. ++++
\begin{code}
-- | Event listener.  Consumer and quit event
data ListenerG o a = L (a -&gt; o) (o -&gt; o)

-- | Event, general form.  A means of consuming listeners.
newtype EventG o a = EventG (ListenerG o a -&gt; o)

-- | Event, general form.  A means of consuming listeners 
newtype EventG o a = EventG (ListenerG o a -&gt; o)

-- | Listeners specialized to IO
type Listener = ListenerG Action
-- | Events specialized to IO
type Event = EventG Action

subscribe :: (a -&gt; o) -&gt; (o -&gt; o) -&gt; EventG o a -&gt; o
subscribe sink quit (EventG f) = f (ListenerG sink quit)
\end{code}
  ===  
* Hmm.  Maybe there's only one problem spot: highlighting of candidates for transformation.  I've worked around this problem for now by preventing destruction of any frames.  They get hidden instead of closed.  Look for a better solution. 
</pre>
</div>
<div title="2007-08-29" modifier="Conal Elliott" modified="200709040205" created="200708300024" tags="2007-08 day">
<pre>* Cheering graphic, seen on #haskell: {{{\o| \o/ |o/}}}.
* Very helpful page on [[GHC optimization techniques| http://www.haskell.org/haskellwiki/Performance/GHC]]
* Hm: I just remembered about my [[idea| using TiddlyWiki to view programs]] for converting Haskell programs into tiddlywikis.
* Here's an approach to &quot;limited listeners&quot;: have the @subscribe@ operation return an @unsubscribe@ action. ++++
Currently
\begin{code}
type News o m = m o -&gt; m o
\end{code}
The new definition:
\begin{code}
type News o m = m o -&gt; m (m o)
\end{code}
On the RHS, the first @m@ is the //callback//, the second is the //subscription// action, and the third is the //unsubscription// action.

Now, does @mappend@ do what we want?  Assuming @m@ is an AF (probably a monad),
\begin{code}
n `mappend` n' == \ cb -&gt; n cb `mappend` n' cb
               == \ cb -&gt; liftA2 mappend (n cb) (n' cb)
\end{code}
When @m@ is a monad and @o == ()@, @liftA2@ on @m@ is @liftM2@, and @mappend@ on @m o@ is @(&gt;&gt;)@, so
\begin{code}
n `mappend` n' == \ cb -&gt; liftM2 (&gt;&gt;) (n cb) (n' cb)
               == \ cb -&gt; do unsub  &lt;- n  cb
                             unsub' &lt;- n' cb'
                             return (unsub &gt;&gt; unsub)
\end{code}
Perfect!  Unsubscribers combine automatically.

How about @mempty@?
\begin{code}
mempty == pure (pure (pure mempty))
       == const (return (return ()))
\end{code}

It remains to construct primitive @News@ values.  How to handle subscription and unsubscription?  Here's my current primitive builder:
\begin{code}
mkNews :: (Monoid (m o), RefMonad m r, Monoid o) =&gt;
          (m o -&gt; m o) -&gt; m (m o -&gt; m ())
mkNews setNotify = 
  do  ref &lt;- newRef mempty              -- holds subscribed actions
      setNotify (join (readRef ref))    -- execute combined actions
      return (addL ref)                 -- combiner

addL :: (Monoid (m o), RefMonad m r) =&gt;
        r (m o) -&gt; (m o -&gt; m ())
addL ref = \ cb -&gt; modifyRef ref (`mappend` cb)
\end{code}
  More tightly, 
\begin{code}
addL ref = modifyRef ref . flip mappend cb
\end{code}

This version of @mkNews@ stores an //action// in a ref.  Accumulation happens through @mappend@ (typically @(&gt;&gt;)@).  How to selectively remove actions from the middle of a @mappend@ chain?  Add a bit of indirection, via another ref.  Initialize that new ref to contain the subscribed action, and change to @mempty@ on unsubscription.   
\begin{code}
addL' :: (Monoid (m o), RefMonad m r) =&gt;
         r (m o) -&gt; (m o -&gt; m (m ()))
addL' ref = \ cb -&gt; do ref'   &lt;- newRef cb
                       modifyRef ref (`mappend` join (readRef ref'))
                       return (writeRef ref' mempty)
\end{code}
 === 
* Reading through {{{Data.Source}}}, I have my doubts about the following function. ++++
\begin{code}
-- | Create a source from an initial value and a update-function event.
-- Specialized type:  mkAccumE :: a -&gt; Event (a-&gt;a) -&gt; IO (Source a)
mkAccumE :: (RefMonad cur r, RefMonad f r) =&gt;
            a -&gt; Cont (cur o) (a -&gt; a) -&gt; cur (SourceG (cur o -&gt; cur o) f a)
mkAccumE a (Cont kk) = 
 do ref &lt;- newRef a
    let news act = kk (\ f -&gt; do modifyRef ref f
                                 act)
    return (O (news,readRef ref))
\end{code}
   The installed event listener is not idempotent, as it incrementally modifies @ref@.  For example, construct 
\begin{code}
  do s &lt;- mkAccumE 0 (fmap (const (+1) click)
     return (liftA2 (+) s s)
\end{code}
  The resulting summing source has as its news, @news `mappend` news@, where @news@ is as made by @mkAccumE@.  Therefore, in response to @click@, the ref gets incremented twice.  Conversely, suppose the source @mkAccumE@ source gets made, then several clicks happen, and //then// someone starts using the source.  It won't have been accumulating.  Idea: separate out the ref updating from the news.  
\begin{code}
mkAccumE a (Cont kk) = 
 do ref &lt;- newRef a
    kk (modifyRef ref)
    return (O (\ act -&gt; kk (const act), readRef ref))
\end{code}
  I think it's crucial here that event listeners are executed in the order in which they were registered.  Is that the case?  Oops!  It wasn't, but is now.  (Lesson: watch for excessive cleverness in tersifying code.)
 === 
* How would the registered accumulating listener ever get removed? +++
Have subscription also return an unsubscribe action.  I could add a finalizer on the ref to stop the accumulation. 
\begin{code}
mkAccumE a (Cont kk) = 
 do ref &lt;- newRef a
    kk (modifyRef ref) &gt;&gt;= addFinalizer ref
    return (O (\ act -&gt; kk (const act) , readRef ref))
\end{code}
  Oh -- oops!  The finalizer will never get executed because of the (strong) pointer inside the listener.  Solution: use a weak ref in the listeners.  Historical aside: 
I guess it's no coincidence that weak references are the ticket.  Data-driven evaluation for Fran is what motivated me to collaborate with Simons PJ &amp; Marlow on what became [[Stretching the storage manager: weak pointers and stable names in Haskell| http://citeseer.ist.psu.edu/peytonjones99stretching.html]].  Now I can finally write a paper about GC vs data-driven computation, which was my contribution to &quot;Stretching&quot; but got cut out of the final version.
  Idea: have events save only //weak pointers// to their listeners.  On each event occurrence, dereference the weak pointers and invoke the still-living listeners.  Do the same for the &quot;news&quot; part of sources.  Some possibilities &amp; questions: 
*  Can I hide the weak ref &amp; addFinalizer stuff altogether?  Try!  See below.
*  Finalizers for Eros windows?
*  Weak refs &amp; AFs.
*  Look for a trick for short-cutting past dead weak references, so they don't have to be repeatedly skipped.  Unlike a general reference changing to a value like @mempty@, we know that a dead weak ref will stay dead.
*  Can I make do //entirely// with weak references, in place of returned unsubscribe actions?
*  Write a wonderful paper that shows the various options.
 === 
* Make sources that invisibly handles weak refs &amp; finalization.  ++++
Maybe in the primitives, not the representation.  First try the primitives.  Returning to @mkNews@ above, go back to the simple new representation, and redefine @addL@ to manage weak references. 
\begin{code}
addLW :: Monoid o =&gt; IORef (IO o) -&gt; (IO o -&gt; IO ())
addLW ref = \ cb -&gt; do wcb &lt;- mkWeakPtr cb Nothing
                       try &lt;- tryWeak wcb
                       modifyRef ref (`mappend` try)

tryWeakTo :: o -&gt; Weak o -&gt; IO o
tryWeakTo dflt w = fmap (fromMaybe dflt) (deRefWeak w)

tryWeak :: Monoid o =&gt; Weak o -&gt; IO o
tryWeak = tryWeakTo mempty
\end{code}
  Simple!  Note that (a) @cb@ is no longer used after @mkWeakPtr@, and (b) the weak pointer is only passed into @tryWeak@.  Combine these two functions. 
\begin{code}
weakenTo :: a -&gt; a -&gt; IO a
weakenTo dflt a = mkWeakPtr a Nothing &gt;&gt;= tryWeakTo dflt

weaken :: Monoid o =&gt; o -&gt; IO o
weaken = weakenTo mempty

addLW ref = \ cb -&gt; do cb' &lt;- weaken cb
                       modifyRef ref (`mappend` cb')
\end{code}
  Next note that @cb@ is used only in the first computation.  Rewrite to emphasize this property, use the @(&gt;=&gt;)@ operator.    
\begin{code}
addLW ref = weaken &gt;=&gt; \ cb' -&gt; modifyRef ref (`mappend` cb')
\end{code}
  or simply 
\begin{code}
addLW ref = weaken &gt;=&gt; modifyRef ref . flip mappend
\end{code}
  It turns out that the only change necessary is to prepend @weaken &gt;=&gt;@.  Wow!
 === 
* Now events: +++
\begin{code}
-- | Handy function for making nontrivial events.  Takes a
-- ``|setHandler|'' function that (destructively) assigns a single sink to
-- be invoked upon some system event.  The subscribing sinks are
-- accumulated into a single, sequenced sink.  Specialized type:
--
-- @
--   mkEvent :: Sink (Sink a) -&gt; IO (Event a)
-- @

mkEvent :: (Monoid (m ()), RefMonad m r) =&gt;
           ((a -&gt; m ()) -&gt; m o) -&gt; m (Cont (m ()) a)
mkEvent setHandler = 
  do  ref &lt;- newRef mempty  -- accumulated sink
      setHandler (\ a -&gt; readRef ref &gt;&gt;= ($ a))
      return $ Cont (modifyRef ref . flip mappend sink)
\end{code}
 ===  
* Note: sources &amp; news are handled so similarly, I may want to unify them, via @News o = Cont o ()@.
* I made these changes, including unifying events and &quot;news&quot;.  I'm having a failure, apparently in mkEvent.  When I mappend two events, the earlier one gets lost.
</pre>
</div>
<div title="2007-08-30" modifier="Conal Elliott" modified="200709040206" created="200709040205" tags="2007-08 day">
<pre>* Keeping the result/output type generic in continuation/event functions is pretty handy.  Consider this example. ++++
\begin{code}
-- | 'Cont' value, over every monoid result type
type UCont a = forall o. Monoid o =&gt; Cont o a

-- Some nondeterministic values
ms, ns, ps :: UCont Int
ms = return 3 `mappend` return 4
ns = return 2 `mappend` return 5

ps = liftM2 (*) ms ns

-- We can run these 'UCont's by providing /any/ conversion to a monoid
-- value, e.g., IO () or [Int].

asList :: UCont a -&gt; [a]
asList kk = runCont kk (:[])

asIO :: Show a =&gt; UCont a -&gt; IO ()
asIO kk = runCont kk print
\end{code}
  === Try it out: ++++
{{{
*Main&gt; asList ms
[3,4]
*Main&gt; asIO ms
3
4
*Main&gt; asList ps
[6,15,8,20]
*Main&gt; asIO ps
6
15
8
20
*Main&gt; 
}}}
  === 
* The @ps@ example shows that @mappend@ is working correctly on these simple events.  What else could be going on?
* List of [[Haskell language extensions| http://www.haskell.org/ghc/docs/latest/html/libraries/Cabal/Language-Haskell-Extension.html]] for use in a source file {{{LANGUAGE}}} pragma.
* Converted my projects to use the {{{LANGUAGE}}} pragma where possible.  Some extensions aren't yet covered.
* Switched my {{{CHANGES}}} files over to markdown, for automatically generated html versions.
* Returning to yesterday's bug: @leftUp@ &amp; @leftDown@ work separately, but when I @mappend@ them, the earlier one gets lost.  Here's a theory: the implementation builds two separate mouse events and filters them.  Perhaps the two can't coexist.  Yep, I'm pretty sure that's what's happening.  My @wEvent@ function side-effects the @on mouse@ handler.  The solution might be simple: add on to the current handler.  Yes!!  Augmenting the handler fixed the problem.
</pre>
</div>
<div title="2007-08-31" modifier="Conal Elliott" created="200709040207" tags="2007-09 day">
<pre>* Set up a wordpress blog for Holly: http://hollyc.com/hollosphere
* Thinking about how to preserve input state through composition.  Idea: during &quot;rendering&quot; to a GUI, build in the ability to make a new input or output of the same type, but holding all state.  Leave  open the possibility of a user editing everything about the UI (except type), e.g., slider bounds, title (change/add/remove), widget choice.  Idea: put a @Source (Input WGet a)@ into each @WGet a@ and a @Source (Output WGet WPut a)@ into each @WPut a@.  Note the type circularity.  I'll have to use newtype wrappers.
</pre>
</div>
<div title="2007-09" modifier="Conal Elliott" created="200801120319" tags="2007 September month" changecount="1">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2007-09-01" modifier="Conal Elliott" created="200709040207" tags="2007-09 day">
<pre>* Some progress toward preserving input state across composition.  I separated out the initial value part of widget construction so it can be replaced on reconstruction.
* Changed my @WGetPut@ representations to use @newtype@.  Dropped all the other newtypes.  I'm about to add @CurInput@ and @CurOutput@ sources, which would have required more newtypes.
* I'm not sure about @Adorn@.  It's too powerful sometimes, stripping off my abstractions where I want them.  Wean off of for @WGetPut@.  Define some explicit conversions.  Or: remove the functional dependency and add an identity rule for @Adorn a a@.  Use fully typed.
</pre>
</div>
<div title="2007-09-02" modifier="Conal Elliott" created="200709040208" tags="2007-09 day">
<pre>* Defined a type of bijective arrows, as in [[There and Back Again: Arrows for Invertible Programming| http://www.citeulike.org/user/conal/article/1214009]].  Using it instead of @Adorn@ (defunct).  Give me better control over conversions and still fairly easy.
* Getting an internal compiler error when when compiling @WGetPut@.  I'm trying the latest mingw32 snapshot (20070824).  Rebuilding packages.  Got to Phooey, which needs {{{wxHaskell}}}, which needs {{{time}}}, which is absent (apparently recently unbundled).  Got {{{time}}}, but it requires the cygwin {{{autoreconf}}} program.  Getting that &amp; updating my cygwin packages.  I ran {{{autoreconf}}}, but still no {{{HsTimeConfig.h}}}, so I copied it from my previous, mostly working GHC installation.   Also copied {{{include/gmp.h}}}, as on [[2007-08-21]].  When continuing a compile, {{{rm out/wxc/{,ewxw/}*.d}}}.
* Phooey's {{{Monad}}} interface isn't compiling.  Maybe a change to the {{{forall}}} typing rules.  Taking this opportunity to redo Phooey, with a simpler monadic interface.  Removed {{{TagT}}},{{{LayoutT}}} and {{{Arrow}}} modules from {{{Graphics.UI.Phooey}}} and {{{Examples.Arrow}}} in the cabal file.  Remember to remove them from the darcs repo as well.
* I think I lose stretchiness on a @return@.  Oh!  My identity layout is @empty@, which is not stretchy.  Make it @fill empty@ instead and see what happens.
* Tweaked {{{WGetPut}}} to track sources of gets &amp; puts.  Surprisingly easy.  However, I don't know what to do with the result.  It's the //TV// that gets transformed, not the output derived from it.  Hmm.  Maybe I could build up a source of inputs &amp; outputs instead gets &amp; puts (rendered versions).  Yes, that worked.  I wonder if I could use @Pair@ &amp; @Fun@ instances on @Input@ &amp; @Output@.  Sure enough.  Maybe use those interfaces in place of @ipair@, @opair@, and @oLambda@.  Okay, now the input state of the argument-holding TV is remembered!  Next: the function-holding TV as well.
* I want to start building GHC HEAD from the source repo.  Grabbed the repo and started a build.  I got a build error.  The file {{{includes/GHCConstants.h}}} hadn't gotten filled in with correct values.  I cheated, by copying the file from another installation.
</pre>
</div>
<div title="2007-09-03" modifier="Conal Elliott" modified="200709050449" created="200709040208" tags="2007-09 day" changecount="1">
<pre>* I think I found the magic I need for compiling ghc: ++++
{{{
make distclean
sh boot
./configure --host=i386-unknown-mingw32 --with-gcc=c:/mingw/bin/gcc --with-ld=c:/mingw/bin/ld.exe --includedir=c:/cygwin/usr/include --with-gmp-includes
make
}}}
  === Now {{{includes/GHCConstants.h}}} gets created correctly and {{{gmp.h}}} shows up.  Ran into another problem.  The C compiler thinks there's an unterminated char constant in the following line in {{{ghc/rts/win32/seh_excn.h}}} ++++
{{{
#error Don't know what sort of Windows system this is
}}}
  === Next I noticed hundreds of split object files getting created.  I don't know where to set {{{SplitObjs = NO}}}, other than {{{mk/build.mk}}}, so I did the latter, enabling the &quot;{{{quick test}}}&quot; build.
* Consider some alternatives to @IO@ in Phooey &amp; Eros that expresses and enforces safety.  In particular, an output is represented using a sink, i.e., @a -&gt; IO ()@, which could do anything at all.  In fact, all it does do is tweak the state of a particular widget.  Consider (a) the @ST@ monad and (b) Wouter Swierstra's [[Data Types a la Carte| http://www.cs.nott.ac.uk/~wss/Publications/DataTypesALaCarte.pdf]] ideas.
* Composition idea: when I pick an output, not only highlight the type-compatible inputs, but also have those inputs temporarily take on the value of the chosen output, so that corresponding outputs preview the effect of the connection.  Alternatively, make that preview connection only when I hover over an input.  Here's a puzzle: what about inputs in the same TV as the chosen output.
* Imagine create fixpoint by feeding output into input in the same TV.
* I heard from Wouter Swierstra that he'll delay the next //The Monad Reader// longer, giving me time for the &quot;Applicative Data-Driven Computation&quot; article.  I want to write it up now anyway, as the libraries have improved and will improve more through writing.  Maybe I'd better take a fresh start, since the current version is very implementation-driven.
* Some &quot;[[applicative functor porn utilising STM| http://haskell.org/haskellwiki/Sudoku#Concurrent_STM_Solver]]&quot;.
* Notes on a new &quot;Applicative Data-Driven Computation&quot; article: ++++
*  Simple model of &quot;events&quot;: @type Event f a  = Time -&gt; f a@.  Events are especially useful (as events) when they &quot;occur&quot; (have non-@mempty@ values) only discretely.  When @f a@ is a monoid, @Event f a@ is also, so we have the non-occurring event and event combination.  Examples: @Maybe@, @[]@ (other @MonadPlus@ types), @m o@ for monoid @o@.  It's also easy to define @Event f@ as a functor.  Another operation is filtering, based on @filterG :: f (Maybe a) -&gt; f a@.  Here's a definition. ++++
\begin{code}
filterG :: (Monad f, Functor f, Monoid (f a)) =&gt; f (Maybe a) -&gt; f a
filterG = join . fmap (maybe mempty return)
-- or, with help from ddarius
filterG = (&gt;&gt;= maybe mempty return)
\end{code}
   === 
*  Simple model of &quot;sources&quot; (called &quot;behaviors&quot; in Fran): @type Source a = Time -&gt; a@.  Show the lifting trick.  Point out that the important thing is that @Source@ is an AF.
*  It's easy to see how a demand-driven implementation can work, which is fine for continuously-changing values.  When values change more occasionally, a data-driven implementation becomes much less taxing.
*  Simple idea: represent an event as a means of &quot;subscribing&quot; to it. ++++
\begin{code}
type Event a = (a -&gt; IO ()) -&gt; IO ()
\end{code}
   === A client provides a //listener// (or &quot;callback&quot;) of type @a -&gt; o@, which gets registered and later invoked on each occurrence.  Note that @Event@ looks a lot like @Cont@, which suggests a generalization. ...  What about the basic event operations?  @Cont@ is a monad and hence a functor.  The monoid operations come for free from the representation of @Cont@. (....)
*  Say why we do not use the Cont AF: it's not synchronous.  Cf @[]@ v @ZipList@ AFs.
*  What about sources?  Start with a demand-driven representation AF, which we'll refer to as a &quot;sampler&quot;.  This time, instead of functions of time, we'll use another familiar AF: @IO@.  For instance, given @p, q :: IORef Int@, defined @r = liftA2 (+) p q@.[footnote]  To get a value, @r@ gets values from @p@ and @q@ and adds the results.  Next, rather than frequent polling of @r@, we'd like to know exactly when it changes.  How about use an event?  If @c@ and @d@ are change events for @p@ and @q@, then the change event for @r@ is @c `mappend` d@.  Moreover, the change event for @fmap f p@ is @c@, and the change event for @pure a@ is @mempty@.   In fact, these rules look very like the following standard instances: ++++
\begin{code}
instance Functor ((,) u) where
  fmap f (u,x) = (u, f x)

instance Monoid u =&gt; Applicative ((,) u) where
  pure x             = (mempty, x)
  (u, f) &lt;*&gt; (v, x)  = (u `mappend` v, f x)
\end{code}
   === How might we get the functor and AF operations to not only manage change events, but also perform the functor an monoid operations on our demand-driven representation?  By composition. ++++
\begin{code}
newtype (g `O` f) a = O { unO :: g (f a) }

instance ( Functor (g `O` f) , Applicative g, Applicative f)
    =&gt; Applicative (g `O` f) where
  pure x            = O (pure (pure x))
  O getf &lt;*&gt; O getx = O (liftA2 (&lt;*&gt;) getf getx)
\end{code}
   === We've only used the fact the @Event@ is a monoid and @IO@ is an AF, so our general notion of sources is this simple composition: ++++
\begin{code}
type SourceG change sampler = ((,) change) `O` sampler
\end{code}
   ===  When @change@ is a monoid and @sampler@ is an @AF@, @Source change sampler@ is an AF that simultaneously composes change //and// samplers.  As a common special case, ++++
\begin{code}
type Source = SourceG (Event ()) IO
\end{code}
   === As we'll see, however, most source operators work in a more general setting.
*  More examples.  Each example can introduce some event &amp; function operators.
*  Applicative GUI programming 
  === 
* Make the paper fun to read.  Introduce examples from the start, and motivate definitions from examples.  Ideas for examples: ++++
*  Buttons as unit-valued events.  Use @fmap@ and @mappend@ to combine into a single informative event.  Do something with menus also.
*  Filtering.
*  Accumulation.
  === 
* Come up with demos for Phooey, combining events &amp; sources.  Maybe build the paper around the demos.  Ideas: counter (from [[Structuring Graphical Paradigms in TkGofer| http://www.citeulike.org/user/conal/article/1617415]]), calculator (adapting [[Lightweight GUIs for Functional Programming| http://www.citeulike.org/user/conal/article/1617412]]).
* Something went wrong with uploading my journal to the ZiddlyWiki server, some time over the summer.  Things like {{{\begin}}} turn into {{{\sbegin}}}.  What could have gone wrong?  For now, I've added http://conal.net/journal/index.html, which is a copy of my local journal.  Not a very pretty solution, but it works for now.    Write a note to the tiddlywiki group: +++&gt;
I've been using ZiddlyWiki with the 2.0.11 core and am wondering about my upgrade options.  I haven't tracked this mailing list for months now, and I've lost track of the landscape.  My last memory is of some developments for demand-driven tiddler downloading (ajax-based, I suppose).  I was excited about that direction, as my TW is getting big.  Could someone summarize or point me to a summary of the status of server-based TW, including incremental/demand-driven downloading?
  === 
</pre>
</div>
<div title="2007-09-04" modifier="Conal Elliott" modified="200709081703" created="200709050457" tags="2007-09 day" changecount="7">
<pre>* Got a nice calculator demo program going.  It uses events more than sources, so I don't know how to cast it in the AF interface.  Think about it.  Came up with a lovely trick: use @mconcat@ on event-based UIs to merge their events and their appearance.  Do it twice for 2D layout: ++++
\begin{code}
-- Single calculator key
key :: Char -&gt; UIE Char
key c = button c [ text := [c] ]

-- Row of keys.  Uses the Monoid instances for UI and Event 
row :: [Char] -&gt; UIE Char
row = fromLeft . mconcat . fmap key

-- Rows of keys.
rows :: [[Char]] -&gt; UIE Char
rows = fromTop . mconcat . fmap row

-- The whole keyboard.  Four rows of four keys each
calcKeys :: UIE Char
calcKeys =  rows [ &quot;123+&quot;
                 , &quot;456-&quot;
                 , &quot;789*&quot;
                 , &quot;C0=/&quot; ]
\end{code}
  === 
* Got my journal switched over to the latest version of TiddlyWiki.  I'll try out [[MiniTiddlyServer| http://www.minitiddlyserver.com]] as a server-side solution.  It looks pretty good.  No load-on-demand yet (anywhere, afaict), but it does upload only changed tiddlers.
</pre>
</div>
<div title="2007-09-05" modifier="Conal Elliott" modified="200709101626" created="200709101624" tags="2007-09 day" changecount="3">
<pre>* [[MiniTiddlyServer| http://www.minitiddlyserver.com]] requires PHP 5, and Joseph's server has PHP 4.2.2.  Looking into  upgrading.
* Thinking about Phooey demos.  The calculator demo doesn't //really// need sources.  It could route the event right into the output.
* How to explain sources: start with events.  Give examples.  Then an example combining data from two events (shopping list).  The @Cont@ AF would combine all occurrences of each.  We want something that is to @Event@ as @ZipList@ is to @[]@: synchronous combination.  When one event occurs, combine the value with the most recent value of the other.  So, we need not only an event, but a way to retrieve the most recent occurrence value.  A &quot;source&quot; has these two parts.  Given the value retriever, the event part needn't carry any information.  For instance, @type Source a = (Event (), IO a)@.  (As with events, there's a more general notion.)
* Is there a way to avoid the IO-ness (ref-ness) of creating accumulating events &amp; sources?  Consider @mkAccumE :: a -&gt; Event (a -&gt; a) -&gt; IO (Event a)@.  I guess the reason there has to be an @IO@ is that the result really does depend on when it's called.  Invoking later makes an event in which fewer occurrences get accumulated.  Hm.  Do I really want this notion of event?  Or something that captures //all// occurrences, as in Fran?  Fran's notion was susceptible to time &amp; space leaks, but only in the same way that lists are.
* Now I can do a {{{make}}} command in my {{{~/Haskell}}}, and the command will propagate to all of my projects (listed in the {{{Makefile}}}).  //Very// handy for clean recompilation, etc.
* Tweaked my emacs junk saver so that it adds a mode-specific comment with the origin file of the clip.
* The phrase &quot;peace &amp; justice&quot; got my attention.  It occurs to me that the idea of &quot;justice&quot; presumes right &amp; wrong and so is inherently at odds with peace.
* I could make a UI type parameterized by the value container @f@.  Then  ++++
\begin{code}
Functor      f =&gt; Functor (UI f)
Applicative  f =&gt; Applicative (UI f)
Monoid   (f a) =&gt; Monoid (UI f a)
\end{code}
  === Handy for @f = Event@ and @f = Source@.   Try it!
* How can I generalize the monadic interface to work with events &amp; sources both?  For instance, I might want a text entry input as an event, to provoke an action when a value is entered.  Or maybe keep it a source and use a button event to snapshot.  Source input need initial values, while event inputs don't.
* In Eros outputs, maybe replace @Source `O` OI@ with @OI `O` Source@.  Close to the monadic Phooey interface, rather than the applicative interface.  Could I simplify my output-related type classes to have one constructor parameter instead of two?  For instance, ++++
\begin{code}
class Fun dom ran where
  fun :: forall a b. dom a -&gt; ran b -&gt; ran (a -&gt; b)

class Fun dom where
  fun :: forall a b o. dom a -&gt; (src b -&gt; o) -&gt; (src (a -&gt; b) -&gt; o)
\end{code}
  === I don't think so.
* Note to Wouter Swierstra: +++&gt;
After getting started, my inclination is to release a series of blog posts instead of a single article.  Maybe after the blog posts, I'll better see an article-sized unity, but maybe not.  So I'd suggest going ahead without me.

In addition to the beauty of the general idea in your &quot;a la carte&quot; paper, I got very excited about your application to separating out IO into many pieces and thus giving much more precise information about what kind of effects a computation can do and what it cannot.  I wholeheartedly agree with your &quot;sin bin&quot; comment and often wish the monadic approach to IO hadn't been discovered, to leave more incentive for a solution that is semantically tractable as well as practically convenient.  My hunch is that solution is still waiting to be discovered, but not many folks are looking.

Example: IO-based GUI programming.  I'd like to enforce in the types that some of the IOs can only write to widget state, and moreover only particular widgets.  In the applicative functor Phooey interface, I formulate outputs as having type 
\begin{code}
type OWidget a = UI (a -&gt; IO ())
\end{code}
The idea is that, when rendered, the output UI makes its visible widget and gives a way to write to it (the a -&gt; IO ()).  Then connect an input widget uiA and an output widget uiO, by &quot;uiO &lt;*&gt; uoA&quot; to get the runnable UI (IO ()).  (Hidden is my type of time-varying values with data-driven computation.)  So this very harmless UI has a very scary type.
=== 
* Ideas on accumulating events: ++++
My event examples are using event //accumulation//, which works via  ++++
\begin{code}
mkAccumE :: a -&gt; Event (a -&gt; a) -&gt; IO (Event a)
\end{code}
  === I could purely accumulate the @a -&gt; a@, and even do so very elegantly as the endomorphism monoid (@Endo@), so as not to have to specify the identity (@mempty@) and composition (@mappend@).  Whenever the endomorphism changes, it would get applied to the initial value, which would be frightfully expensive.  In a sense, the approach above exploits associativity of composition for efficiency. 

Mitch Wand used this associativity trick very effectively in his paper &quot;Continuation-Based Program Transformation Strategies&quot;.  He also came up with alternative (data) representations for the continuations.  Oh!  I could do that here.

For instance, I have an example with a pair of buttons, one of which increments and the other decrements.  I @mappend@ the events into a single @Int -&gt; Int@ event and then use @mkAccumE@ (buried in a UI function that absorbs the @IO@).   ++++
\begin{code}
upDown :: Num a =&gt; UIE (a -&gt; a)
upDown = op &quot;up&quot; (+1) `mappend` op &quot;down&quot; (subtract 1)
 where
   op str f = (fmap.fmap) (const f) (smallButton str)

counter :: UI ()
counter = title &quot;Counter&quot; $ fromLeft $
          do -- Apply each increment/decrement cumulatively
             val &lt;- 0 `accumS` upDown
             showDisplay val
\end{code}
  === 
Using Mitch's insight, I note that each of those continuations is adding a number, and so could be represented by a number.  Using the @Sum@ monoid instead of @Endo@ results in an efficient, evaluated representation of that continuation, namely a single number to be added. ++++
\begin{code}
upDown :: forall a. Num a =&gt; UIE (Sum a)
upDown = op &quot;up&quot; 1 `mappend` op &quot;down&quot; (-1)
 where
   op :: String -&gt; a -&gt; UIE (Sum a)
   op str n = (fmap.fmap) (const (Sum n)) (smallButton str)

counter :: UI ()
counter = title &quot;Counter&quot; $ fromLeft $
          (fmap.fmap) getSum (monoidS upDown2) &gt;&gt;= showDisplay
\end{code}
  ===   Works great.

The next example is the calculator.  The transition function: ++++
\begin{code}
cmd :: Char -&gt; (CState -&gt; CState)
cmd 'C' _                 = startCS
cmd '=' (d,k)             = (k d, const (k d))
cmd  c  (d,k) | isDigit c = (10*d + ord c - ord '0', k)
              | otherwise = (0, op c (k d))
\end{code}
  === 
What is a data representation of the subset of state endomorphisms created from compositions of @cmd c@?
  === 
* Tried out {{{haddock.ghc}}}, running without {{{cabal}}}'s help.  Got two errors, and asked David Waern for help.
* Eros composition now remembers the full input state from both composed TVs!  Turned out to be quite simple.  Discovered I was losing my labels during composition.  Fixed.
* Wrote a reply and a post on [[http://evolve.awakeningcompassion.com| NVC Evolves]].
</pre>
</div>
<div title="2007-09-06" modifier="Conal Elliott" created="200709101627" tags="2007-09 day" changecount="1">
<pre>* Blog notes: ++++
I've been noodling about latency in the context of our living-in-the-sticks satellite internet service, compared with our deliriously responsive Seattle cable-based internet access.  Holly told me about the Vudu, which gives you instant access to 5000 movies.  The trick is in the solution to latency, as a complement to download-on-demand.  The Vudu box contains the first 30 seconds of all those movies.  If you start watching one of them, the box will start downloading the rest.  In other words, the box //pre-buffers//, to eliminate the buffering latency.  From there, possibilities abound.  For instance, suppose you start watching a TV series that's not pre-buffered.  Once you watch most of one episode, the software can guess that you'd probably like the following episode pre-buffered.  Or much more sophisticated collaborative filtering.  Instead of just recommending a video, based on statistical patterns, pre-buffer it as well.

Now, where else can we apply this pre-buffering trick?  How about web pages?  And links within those pages.  Especially if the browser (extension) can make good guesses at what you're likely to click on.  For instance, use the currently visible portion of the page, plus a little past.  Even track the mouse motion.  Or use the idea in [[TiddlyWiki| http://tiddlywiki.com]], which encourages and supports microcontent, where there are many fewer choices of links.  Another TiddlyWiki use is pre-buffering lists of microcontent names and their tags (&quot;tiddler metadata&quot;).

Then there's browser cache management.  Instead of the current choice of keeping a whole page or purging it, pare the cached content down to just a pre-buffer.
  === 
* Write about the dual monoids in the event algebra (events &amp; listeners).  Lovely!
</pre>
</div>
<div title="2007-09-07" modifier="Conal Elliott" created="200709101628" tags="2007-09 day" changecount="1">
<pre>* Tweaks to haddock.ghc to compile with ghc-6.7 20070824: ++++
*  Added build-depends: containers, array
*  Still breaking.  Plus one more windows-specific problem.  And now my ghc snapshot dies when linking haddock.  Someday Linux.
  === 
* Yesterday Holly &amp; I had a pow-wow about improving the user experience for Eros, and today I'm figuring out how to do it. ++++
*  Find new terms to replace &quot;input&quot; and &quot;output&quot;, since an output of one TV is used &quot;as input&quot; for another.  Along the same lines, what's input (output) to an interactive program is output (input) to the user.
*  Come up with simple &amp; compelling uses of higher-order composition, i.e., filling in a function-valued input with a function-valued output.
*  Pick the output first (reversing current style).  Compatible inputs highlight.
*  After picking an output, hovering over a compatible input causes the output value to override that input, thus giving a preview of the result of composition.  Moving the mouse out of the input area ends the override.
*  Allow a sort of &quot;temporary&quot; connection to be made, without combining TVs.  In other words, separate out &quot;connect&quot; from &quot;merge&quot;.
*  How to visually denote unmerged connections?  Some possibilities: ++++
*   Visual pathways between TV inputs &amp; outputs.  I don't know how to get graphics into the mix with MDI child frames.
*   &quot;Docking&quot;, i.e., immediate proximity.  I don't know how to handle crowding when there are several adjacent small inputs each connected to large outputs.  Or an input with several connected outputs.
*   Bust out of 2D GUI space and use more freeform 2D or 3D graphics.  Show pathways, preferably animated to suggest flow.
*   Matching patterns of color &amp; rhythm.  Remember that there can be several simultaneous connections.  I can see how this approach could work.
   === 
*  If I pick the output first, how do I deal with &quot;tweaks&quot; (dup, swap, curry, etc)?  Currently, I pick a tweak, and then compatible outputs highlight for choosing.  Kind of cool, but not really user-friendly.  After all, I don't expect the user to just have a hankering to curry something, but rather to have a particular output to curry.  So, a more fitting interface would be to select the output and then see what tweaks are compatible.  Oh!: right-click to pop up a context menu, populated with just the applicable tweaks.  (In wxHaskell, use @windowOnContextMenu@ from @WXCore@.  I haven't found a higher level @WX@ version.)  A context menu will have &quot;connect&quot; followed by the type-compatible tweakers (usually very few).
*  For now I'm reworking the @WPut@ representation (for outputs) so that the source being shown is available for other uses.  In particular, to connect to other inputs for preview or temporary connection.  The redesign is tricky, as currently no information passes between input &amp; output of a lambda GUI.  Instead, the output passes back a source of sinks and the lambda stitches the source &amp; sink together.  I'm playing with a new design in which rendering an output (into a @WPut@) passes in the source that gets output.  Which means that lambda (@fun@) has to work @Monad@-ically, rather than @Applicative@-ly.  Moreover, I'm not yet seeing how to keep the very simple, regular and automatic (via type classes) way that @fun@ now works.
*  Another issue: I think I'll need to create a source of sources and then collapse into a source.  The source of sources would come from selecting an output source to connect.  Or it could be that choosing an output for connection would yield an source-valued event.  Still that event would be turned into a source.  That operation is the @switcher@ combinator from Fran.  I don't think I have now a reasonably efficient way to implement @switcher@, because listeners for no-longer-relevant sources would hang around until they get GCd.  Maybe use the idea of having @subscribe@ return an @unsubscribe@ action ([[2007-08-29]]), instead of or in addition to weak references.  Perhaps @unsubscribe@ could simply invoke @finalize@ on the listener weak ref.  Give a go at the @unsubscribe@-style events.  But first, try switcher with the current representation.
*  Hey!  @switcher@ can be defined via @stepper@ and @join@ (rather than @stepper@ via @switcher@).  I didn't know that.  So, @Source@ as a monad is useful after all.  What about events?  Would @join :: Event (Event a) -&gt; a@ do what I want?  Not with the @Cont@ monad, which remembers //all// occurrences of the outer event.  The occurrences of @join ee@ are all occurrences of all events that come from @ee@.  Hm.  Oh, hey again!  That semantics for @join@ may be exactly what I want in place of my imperative @eventX@ function for creating extensible events.  Instead of merging events in via an explicit sink, have an event-event.  Specifically, there's a @newTV@ event that comes from choosing a TV from the &quot;Parts&quot; menu or doing a composition.  But composition also generates opportunities for more @newTV@ occurrences.  So, massage @newTV@ so that each occurrences contains another @newTV@ event, and @join@ the result.  Now consider a source of sources.  I could simply @join@ the underlying change event and @join@ the @getter@.  However, I think I'd get something that has lots of false change reports, based on changes to no-longer-relevant sources.  I guess a solution is to define a @join@ variation that stops paying attention to occurrences of old events.  Give it a try.
*  Oh -- all I need is a function @once :: Event a -&gt; Event a@ that yields an event whose only occurrence is the first occurrence of the given event.  Then I can say @join (once ee)@.  Okay, how to implement @once@?
*  Hm: see if I can easily define monad instances for various @O@-style compositions, if I think of @join@ instead of @(&gt;&gt;=)@.  Look at @Source@ and then (monadic) @UI@.
  === 
* Emacs idea: have mmm parsing happen automatically in the background.  Learn how the background-processing trick works.  See haskell-mode.
</pre>
</div>
<div title="2007-09-08" modifier="Conal Elliott" created="200709101628" tags="2007-09 day" changecount="2">
<pre>* We're very close to the edge of our 7-day satellite bandwidth limit, so we're taking it easy with our internet use today.  To do: ++++
*  Copy {{{papers/ppdp00/default.htm}}}.  Had a bogus bibtex entry. [done]
*  Look for an Emacs mode for mediawiki markup.
  === 
* Here's an angle on @WGetPut@ to get access to an output's source, while retaining the elegant automatic composition that happens now.  Have the @WPut@ work as now and pass back a function from source that installs a &quot;connect&quot; handler (or the whole context-menu handler).
* Think about today for Eros: ++++
*  HOF example.  Could do @liftA@ &amp; @liftA2@ for regions.  Build intersect &amp; union.
*  Editing titles &amp; bounds.
*  Replace @eventX@ with @join@.
  === 
</pre>
</div>
<div title="2007-09-09" modifier="Conal Elliott" created="200709101629" tags="2007-09 day" changecount="1">
<pre>* I want to play with @join@/@(&gt;&gt;=)@ on events.  Examples: ++++
*  Asteroids:  each collision can break an asteroid into more of them, each of which has to be tracked for more collisions.
*  A chat room has an &quot;enter&quot; event, whose occurrences contain new events like &quot;speak&quot;.
*  In Eros, track operations on TVs.  Compositions yield more TVs to track.
  === 
* More thoughts on the data-driven build (see [[2007-08-24]] and pointers from there): ++++
Functional programming (FP) supports composition well by making data dependencies explcit.  (See John Backus's Turing Award lecture.)  While this property applies FP's &quot;programming model&quot;, it does not apply to the model of programs (source code), in which (syntactic) data dependencies are implicit as with other styles of programming language.  For that reason, source code dependencies have to be explicitly (and imperfectly) analyzed or left unknown.  This incomplete information leads to two problems in the build process: over-compilation and under-compilation, due to over-estimation or under-estimation of dependencies.  (Examples: {{{make}}} rules with missing or extraneous dependencies; use of @import@ or {{{#include}}} triggering recompilation after irrelevant changes.  Others?)

Here's a simple solution: apply the functional model to the manipulation and application of source code.  Make the dependencies totally explicit and purely functional.  Use a simple, general tool for data-driven evaluation of varying values connected by pure functions, such as [[DataDriven]].   Every form of dependency becomes an explicit parameter.  For instance, replace {{{#include foo.h}}} or @import Foo@ with a formal parameter (a lambda) //in// the module source code and an application outside of the source code (in something like a &quot;make&quot; file).  The parameter/lambda has a type like {{{module}}} rather than one like {{{String}}}.  In a CPP-like setting, this application of parameterized code to argument code simply does the job of CPP.  With just a bit more sophistication, one could easily support &quot;pre-compiled headers&quot; (PCHs).  Each PCH is defined as a particular {{{precompile}}} function applied the header source, and then code source is defined as a function applied to some number of PCHs.

This idea applies not only to source code but to object code as well.  The linker is a function that takes object code chunks as arguments and produces executable code as output.  For convenience, there's also the archive function ({{{ar}}}), which combines several pieces (usually object code) into one.  (I'm getting beyond my knowledge here.)

A Haskell module compiles into two results: object code and an &quot;interface&quot;.  Importing a module means applying to the interface part, while linking applies to the object code part.  An &quot;interface&quot; is a dictionary mapping names to types and some other information.  When the @import@ line lists a subset of the exported names, then the actual dictionary is the result of applying a filtering (subsetting) function to the export dictionary.  When the import is &quot;qualified&quot;, the dictionary is further transformed.  These transformations can be described as very simple pure functions applied to a functional dictionary type (@Data.Map@, using @filterWithKey@ and @mapKeys@).

Given such explicit and precise knowledge, it's easy for a data-driven evaluation framework to do better than conventional tools.  For instance, if I change a comment in a header, the PCH won't change, so the source module depending on the PCH won't get recompiled.  Similarly for an interface @import@.

Code processing may be chained.  For instance, a grammar might get compiled into C code that then gets compiled into object code and from there linked into an executable.  With FP, such chains are written as nested applications or directly as function compositions.

Let's call the previous example &quot;first-order chaining&quot;.  There's also a &quot;higher-order&quot; version: the grammar compiler itself is computed by applying {{{compile}}} (&amp; link) to the its own source code, which itself comes from applying parameterized source code to headers (possibly precompiled).  When the grammar compiler's source code or headers change, it must be recompiled, and the resulting function applied to the grammar (and the result recompiled, etc).  Higher-order chaining is directly and powerfully supported in FP as higher-order functions.

Given that both a function and its argument can change, the applicative functor (AF) interface is exactly the right abstraction for tool building.  AFs have two operations in common: one, @pure x@ promotes a pure value to an AF value; and the other, @h &lt;*&gt; a@, applies an AF-style function to an AF-style argument.  You may not have heard of AFs before, but if you know some monads, you already know AFs also, as every monad is an AF (with @pure@ and @&lt;*&gt;@ corresponding to @return@ and @ap@).  As a common case, in place of @pure f &lt;*&gt; a@ for a pure function applied to an AF, there are the equivalent short-hands @f &lt;$&gt; a@ and @fmap f a@.  I'll refer to the particular AF for varying values as @Source@.

So far I've avoided talking about //files//, which are at the center of current source processing.  Files, and particularly reading and writing them, don't have much of a place in a functional paradigm.  Their roles would be (a) interfacing to the world outside of our abstraction, and (b) persistence of defined sources for later use.   

There are two halves of interfacing to the outside world: import &amp; export.  Importing a mutable input file means wrapping it up as a source, e.g., with help from a facility like [[hinotify - Haskell binding to inotify| http://www.nabble.com/ANNOUNCE:-hinotify-0.1-t2384572.html]].  Exporting a source creates two results.  One is a new file, and the other is an active thread that keeps the file up to date with the source's changing value.

How often does the implementation recompute?  Pure data-driven or demand-driven or something else?  With {{{make}}}, one explcitly says to when update ({{{&quot;make&quot;}}}) and over what set of inputs, outputs and dependencies (choice of make file &amp; target).  GUIs toolkits are mostly data-driven, but not fully.  They handle some events differently from others.  Mouse position is a frequently changing input, so typically motion events are filtered so that an application's event-processing code sees only some of the motions.  This special-case hack addresses part of a general problem of assigning finite processing resources to diverse and rapidly changing input.  I'd like to generalize the hack to a more widely applicable solution.

Misc to write about: Connections with [[nix| http://nix.cs.uu.nl]] and with ML functors. Also, incremental/adaptive computation.
  === 
* Wow, what a great idea: [[Mirrorboard: A one-handed keyboard layout for the lazy| http://blag.xkcd.com/2007/08/14/mirrorboard-a-one-handed-keyboard-layout-for-the-lazy]].  Type one-handed on only one half of the keyboard.  Use caps-lock to mirror the key's interpretation, thus simulating the other hand.  The writer also suggests of using smart software to guess the mirrorings, instead of caps-lock.  I love that idea.  Tons of comments at the blog post.
</pre>
</div>
<div title="2007-09-10" modifier="Conal Elliott" modified="200710102039" created="200710102038" tags="2007-09 day" changecount="2">
<pre>* Hm -- suppose an event has no remaining live listeners. ...
* Progress with getting haddock.ghc to compile.  Seems to be a ghc bug in writing a temporary .rc file with single backslashes in path names.  I worked around the bug for now and have a new haddock.exe.  Running into more problems with it.  Asked David Waern for help.
* Tried replacing @ReaderT@ and @WriterT@ with @Monad@ instances for the corresponding type compositions @((-&gt;) r `O` m)@ and @(m `O` (,) w)@.  Doesn't work because these two patterns overlap, and the latter overlaps with other stuff.
* Apparent GHC install bug: my {{{package.conf}}} file lists {{{/usr/local/doc}}} as the documentation root instead of the actual installation location ({{{c:/ghc/ghc-6.8.20070909/doc/}}}).  I worked around the problem with a symlink.
* Updated the wiki pages for [[TypeCompose| http://haskell.org/haskellwiki/TypeCompose]], [[DataDriven| http://haskell.org/haskellwiki/DataDriven]], and [[Phooey| http://haskell.org/haskellwiki/Phooey]].</pre>
</div>
<div title="2007-09-11" modifier="Conal Elliott" created="200710102039" tags="2007-09 day" changecount="1">
<pre>* Eros ++++
*  Now all outputs highlight (even sliders &amp; checkboxes) and do so consistently as a thin frame around the actual control.
* Puzzling over preview compositions: ++++
*  The effect: temporarily show the effect a composition would have.  Pick an input and move the cursor over a compatible output.  (The order of composition choices may change.)  Before committing, the input starts taking its values from the output.  When the cursor moves out of the output area, the temporary connection is broken, and input goes back to normal.
*  Why tricky: an output doesn't currently have access to the source being displayed.  Instead, it returns a source of sinks.  This separation lets me use AF-style, rather than monadic, composition.  Then type composition makes my AFs into AFs.
*  Idea: when I enter the output space, a simple event occurs at that level, delivering a function from the (unknown) source.  The containing lambda transforms that event by applying the (now known) function to the source.
*  Along with the existing @CurrTrans@, there will be a new item coming down each @WGet@ and @WPut@, namely the &quot;source of interest&quot;.  It will be type-wrapped, just like @CurrTrans@.
*  Oh, yeah!  Now I remember the puzzle of how to track this source with reasonable efficiency.  The challenge is that I'll have to switch from one source to another.  I want to make sure listeners on old source change events get dropped when I switch to new sources (@join@ plus efficient @onceE@).
*  Punt ephemeral?
*  Oh!  Here's a simpler way to preview: actually do the composition and make a whole new TV.  The TV only &quot;sticks&quot; if committed, and the parents are removed only in that case.  Otherwise, when the cursor moves out of the counterpart's space, the composition disappears.  Make sure the temporary TV is out of the way of the parents.  Try this approach first, as it's probably a much smaller impact on the current implementation.  For simplicity, don't worry about making the composition only once.  If easier, allow the transient composition to disappear on counterpart exit or connect and then make a new one in the current way.
*  Working on this last idea.  Coming along fine.  Interesting pattern: begin a composition, and either commit or abort/undo.  Sounds kind of like a transaction.  Define: ++++
\begin{code}
type TransactE' fa = Event ((Event (), Event ()), fa)  -- commit, abort, value

type TransactE f = Event `O` ((,) (Event (), Event ()) `O` f) 
\end{code}
   === Or replace the pair of events with a single event that describes how the transaction ends: ++++
\begin{code}
data End = Abort | Commit

type TransactE' fa = Event (Event End, fa)

type TransactE f = Event `O` ((,) End `O` f) 
\end{code}
   === Yeah.  That one.
  === 
* As a teaser, highlight compatible outputs while the cursor is in an input, even without clicking.  The input choice only &quot;sticks&quot; when clicked.
* Give hints in the status bar about what the user might do.  Maybe have a settable chattiness level.
* Imagine Eros in a shared space with lots of people grabbing &amp; connecting.
 === 
* Updated [[TV wiki page| http://haskell.org/haskellwiki/TV]].  I'm increasingly drawn to the idea of describing TV (and Eros) as &quot;composable MVC&quot;.  And to using the terms &quot;controller&quot; and &quot;view&quot; instead of &quot;input&quot; and &quot;output&quot;.  Those terms would give programmers a familiar starting point.  I could say how TV (renamed) is like MVC and how it's unconventional.
</pre>
</div>
<div title="2007-09-12" modifier="Conal Elliott" modified="200710102041" created="200710102040" tags="2007-09 day" changecount="2">
<pre>* Eros: ++++
*  Current transformation (@currXf@, maybe-valued): ++++
*   Tracks the chosen transformation.
*   Offer a new transformation (@Just@) when the @newXf@ occurs.
*   Retract the offer (@Nothing@) when it ends (abort or commit).
   === 
*  New TV: ++++
*   Compose TVs or choose from parts list
*   Close new TV if abort before commit.  How to handle the &quot;before&quot; part?  Use @onceE@ to make sure //end// events can only occur once.
*   Close parent TVs if commit before abort.
   === 
*  Puzzling over events with unsubscription: ++++
*   The approach I like is to use @Cont@, an return @m (m o)@ instead of @m o@, particularly @IO (IO ())@.  The @subscribe@ returns an @unsubscribe@ action. ++++ 
\begin{code}
type EventUndo  m o a = Cont (m (m o)) a
type EventUndo' m o a = (a -&gt; m (m o)) -&gt; m (m o)
\end{code}
   === 
*   Event merging (@mappend@) combines both @subscribe@ and @unsubscribe@ actions.  Cool!
*   A listener has type @a -&gt; m (m o)@.  For what purpose can the return action (@m o@) be used?  My first guess is an &quot;undo&quot;, as with subscribe.  I like that.  Give it a try.
*   Perhaps what I'm exploring here is a monad of reversible computations.
*   Suppose I have a stateful container type whose @add@ operation yielded a @remove@ action to be invoked later.  Such a container could form the basis for @mkEvent@.  (Oh, oops -- in that case, I think I'll have to make @mkEvent@ an IO again.)  I could use a map with a next-free-index.  Is there a simpler way?  For every listener added, make a new listener-valued ref whose value starts out as the listener.  The listener @mappend@-ed is @join (readRef lref)@.  The retured unsubscribe action sets the @lref@ to @mempty@.  The downside is that the dead listeners accumulate over time.  Start simple.
*   Here's an idea for taking @mkAccumE@ out of @IO@.  Do a @join@/@(&gt;&gt;=)@ thing in which each occurrence gets passed into construction of the remainder: ++++
\begin{code}
accumE :: a -&gt; EventU (a-&gt;a) -&gt; EventU a
a `accumE` e = do f &lt;- once e
                  let b = f a
                  return b `mappend` (b `accumE` e)
\end{code}
    === This version waits for the first real occurrence.  Or we could yield @a@ immediately: ++++
\begin{code}
a `accumE` e = return a `mappend`
                 do f &lt;- once e
                    a `accumE` e
\end{code}
    === The general type: ++++
\begin{code}
accumE :: (Monoid (m (m o)), MonadFix m) =&gt;
	  a -&gt; Cont (m (m o)) (a -&gt; a) -&gt; Cont (m (m o)) a
\end{code}
    === Now I think the only @IO@ operation remaining is @refEvent@.  It could take a ref argument, and so put off the @IO@ to the caller, which might absorb it.  Or just don't use @refEvent@.
   ===
*  Eliminated a source of @IO@ in Event: now @mkEvent@ has a pure type.  Several other interfaces followed.  I still have @IO@ in @mkAccumE@.  That one is probably necessary semantically, since the result of accumulation depends on when the accumulating starts.
* My Gaim got into a weird state in which it uses &quot;b&quot; to toggle logging.  I got an answer on {{{#pigin}}}: hover over the menu entry and hit {{{&lt;backspace&gt;}}} to remove the binding.  Or hit another key combo to add/change the binding.  I think it's a GTK thing.
* Meanwhile, I started using the emacs-based IRC client {{{erc}}}, which is awesome.  I'm not going back.
</pre>
</div>
<div title="2007-09-13" modifier="Conal Elliott" created="200710102041" tags="2007-09 day" changecount="1">
<pre>* Eros: ++++
*  I've been wondering how to make and what do do with unsubscribe-friendly listeners (continuations).  They're there for consistency with unsubscribe-friendly subscribers.  With @join@/@(&gt;&gt;=)@, listeners and subscribers come together: the listener creates an event (@Cont@) and subscribes to it.  So now I think I understand the point of the unsubscribers/undoers returned in listeners: stopping any ongoing effects/listeners.  In essence, for killing spawned threads.  Given a subscribing listener @l@, a primitive event @e@ must gather the unsubscribers returned from the listener for of its occurrences.  The unsubscriber returned from @subscribe e l@ must somehow execute those unsubscribers, as well as disconnecting @l@ from @e@.  Where is this mass unsubscribing useful?  With @e &gt;&gt;= f@.  Given a listener @l@, each occurrence @a@ of @e@ leads to a new event @f a@, to which @l@ is automatically subscribed.  Now @l@ loses interest in @e &gt;&gt;= f@ after several such occurrences.  It will have to be removed from all of these events.
*  Maybe this business can be done much more simply, along the lines of ephemeral listeners.  When I want a temporary listener, for whatever reason, wrap it in a way that it can be removed by remote control from all events that get ahold of it.  For instance, wrap in a maybe-valued ref that must be indirected through.  Since listeners are always in a monoid, I could have the ref contain just a listener.  Or, hide the ref in a new listener with exactly the same interface as the original listener.  This trick is what I already do in my event-building primitive, before going to explicit unsubscribe: ++++
\begin{code}
mkEvent :: (WeakM m, Monoid (m o)) =&gt;
	   (Unop (a -&gt; m o) -&gt; m o) -&gt; Cont (m o) a
mkEvent modifySink = Cont (ephemeral &gt;=&gt; modifySink . flip mappend)
\end{code}
   === A benefit and drawback of this @mkEvent@ is that the listenener ephemerality is completely hidden.  Listener tombstoning happens only via GC, not on demand.
*  When do I want to dictate listener removal? ++++
*   The listener writes to state in a subwindow that gets closed.  In wxHaskell, we can get a crash.  (My hack solution is to hide the subwindow, which avoids crashing but defeats ephemerality.)
*   An explicit, semantic operation like @once@ that yields a truncated event.
   === 
*  Consider @fmap@ -- laziness :).  Also @fmap@ and repeated composition for multiple listeners :(.
*  Back to the Eros @TopLevel@. ++++
*   Cursor enters input space (first, for now), triggering @currXf@ (current transformation).  If an abort (cursor exits input space), cancel @currXf@.   Commit makes @currXf@ sticky, i.e., ignore abort.
*   Cursor enters output space, triggering @newTV@.  If abort, close the new TV.  If commit, close the parents.  In this case, I want to know whether abort or commit.
   === 
*  I really do want to switch the order of selection from input (&quot;controller&quot;) first to output (&quot;view&quot;) first.  Each view has a type-specific menu with type-applicable DeepArrow operations (&quot;tweaks&quot;) and &quot;connect&quot;.  If a tweak is chosen, yield the tweak in the @Transforming@ event.  If &quot;connect&quot;, contribute to another event that carries a continuation from a type-compatible transformation.
*  Oops -- I just discovered that the filtered mouse events are write-only.  I count on read/write of handlers so that I don't have to make a new ref in the process of wrapping a wxHaskell event as a DataDriven event, which saves me an @IO@ in the type.  Even with ref &amp; IO, I don't know how to do it.  Okay, I think the ticket is to wrap the //unfiltered// mouse mouse event.  Oh -- I have already wrapped enter, leave, and rightDown.
  === 
</pre>
</div>
<div title="2007-09-14" modifier="Conal Elliott" created="200710102042" tags="2007-09 day" changecount="1">
<pre>* I think my approach to events has a serious flaw, reminiscent of Fran.  An event is stateless, so nothing happens until subscribing.  Here's how event accumulation works: ++++
\begin{code}
accumE, accumE' :: a -&gt; Event (a -&gt; a) -&gt; Event a
a `accumE` e = do f &lt;- once e
                  f a `accumE'` e

a `accumE'` e = pure a `mappend` (a `accumE` e)
\end{code}
  === Nice &amp; simple.  And works fine when the argument event is non-accumulating.  However, feed an accumulation event into @accumE@, and the accumulating starts anew at each @once e@.
* Reworked lots of events &amp; sources stuff accordingly.  My examples aren't as pleasant.  One helpful trick was to write the monadic operations so that they automatically lift to containing monads. ++++
\begin{code}
class Lifts m m' where lifts :: m a -&gt; m' a

instance Lifts m m where lifts = id

instance (MonadTrans t, Lifts m m', Monad m') =&gt; Lifts m (t m') where
  lifts = lift . lifts
\end{code}
  === I think @Arrow@ really //is// the way to go for interactive stuff, since it tightly controls the flow of information in &amp; through components.  Just as Yampa hides &quot;signals&quot; and reveals an arrow of signal transformers, I could hide the stateful stuff.  Hm.  Full circle: Phooey started as an arrow.  To do: consider functional interaction all over again.
* Now I have a type-specific context menu for outputs/views.  It offers the type-specific tweakers plus &quot;compose&quot;.  The latter isn't yet hooked up.  Now I know how: Instead of passing a current transformation (@UFun@) down in output rendering, pass //up// an event whose value is a continuation on transformations: @Event (Sink UFun)@.  At the top level, turn that event into a @Source (Maybe (Sink UFun))@ and pass it back down through outputs into inputs.  Highlight compatible inputs just as I now show compatible outputs.  When one is selected, the continuation is invoked.  Some questions &amp; possibilities: ++++
*  What's in the continuation?  Note input state sampling and child frame stuff.  Maybe a delimited continuation producing a new output.
*  Maybe add in the two frames for closing.
*  Go both ways: input first or output first.
*  Here's a weird idea: transform the tweaks on the way down.  Is @Uarr@ a deep arrow?  It doesn't have the right kind.
*  Pass down the source also on the way down for preview override when in a compatible input.
  === 
</pre>
</div>
<div title="2007-09-15" modifier="Conal Elliott" created="200710102042" tags="2007-09 day" changecount="1">
<pre>* Hunch: output-first is difficult because of my choice of deep application.  There are two of them.  If I recall the other one and go for it, it work out easily.  Then I can support //both// orders usefully, having with //different// results.
* The trick: reverse roles between function and argument.  Given a selected argument (output), deeply apply @flip ($)@ to get an inner //forall b. (a -&gt; b) -&gt; b// and extract the function.  (Note that @flip ($)@ is @pure@ in @Cont@.)  The result is a new transformation that targets functions.
* It might be useful to have support for function transformations more than just as as transformations that apply to functions.  If a function transformation applies to a function of type //a -&gt; b//, then 
A function transformation could be directed at a buried input of type //a//, and it would automatically extract the input and then apply the function transformation.  Examples:  curry, curry' (//flip . curry//) and argument swap.  I don't really see how uncurry and flip could fit in, since they work on uncurried functions, and hence more than one input.
* Could I define wxHaskell attributes at @Pair@ types?
</pre>
</div>
<div title="2007-09-16" modifier="Conal Elliott" created="200710102043" tags="2007-09 day" changecount="1">
<pre>* Trying to get parent retrieval working in Eros.  Hung up on keyboard events.  I get them in my widgets but not the overall panel or frame.  Asked for help.
* Implemented hierarchical menus.
</pre>
</div>
<div title="2007-09-17" modifier="Conal Elliott" created="200710102043" tags="2007-09 day" changecount="1">
<pre>* Reading the &quot;Stream Fusion&quot; paper.  I like this phrase: &quot;Our pipeline of list transformers has now  been transformed into a pipeline of stream transformers&quot; (end of 2.2).  I've been thinking for a while about a representation for infinite continuous images that exploits the caching behavior of lazy data evaluation (unlike the function representation).  The representation would use zippers and bi-infinite quad trees, with zippered bi-infinite sequences of approximations.  I suspect it will be important to fuse some compositions to eliminate the intermediate representations.
* List of Haskell [[language extensions| http://hackage.haskell.org/cgi-bin/haskell-prime/trac.cgi/wiki/HaskellExtensions]]
* Add temporary connections. ++++
*  Interface: ++++
*   In an output context menu, select &quot;start temporary connection&quot;.
*   In an input, select &quot;finish temporary connection&quot;.  Maybe even while hovering.
*   To cancel, choose &quot;cancel temporary connection&quot; in the input.
*   Maybe even &quot;fuse temporary connection&quot;.
   === 
*  What do I need to implement this idea? ++++
*   Access to the //source// being shown in an output.
*   Could pass the source down.  May complicate the wiring.
*   In output rendering, I currently pass up a source of sinks.  Instead pass up a function from sources to action sources.  Then yield an event of type-wrapped value sources, in addition to an action source.  Pass a source of type-wrapped sources down output rendering into input rendering.
   === 
*  I got this approach working.  One glitch: it crashes on filters -- i think due to infinite regress, i.e., stuck in a source updating loop.  How to avoid this loop: ++++
*   Allow the regress but put some kind of limit on it.  How could that work?
*   Try not to let an output influence an input in the same TV.  But how?  I pass up these &quot;new source&quot; events, combine them all into one and pass it back down.
*   Hold off on combining the &quot;new source&quot; events.  Instead, pass them down uncombined, to be combined selectively in each TV.  Give each TV a unique identifier.  Throw that id into the mix.
   === 
  === 
</pre>
</div>
<div title="2007-09-18" modifier="Conal Elliott" created="200710102044" tags="2007-09 day" changecount="1">
<pre>* Notes from &quot;Effective Oral Presentations&quot;: ++++
*  One main message only.  A single sentence for listeners to remember.  Expressed early in the presentation and chosen early in designing the talk.  Focuses the presentation.
*  Parts: opening (motivation &amp; main message), body (selected evidence), closing (restate main message).
*  Opening: Attention getter, need, task, main message, preview
*  Visuals (slides) &amp; spoken text: each conveys the message, wholly and differently.  Minimize text in visuals so as not to compete with speaking for verbal attention.  &quot;Do more with less: give meaning to all visual elements used, eliminate all visual noise.&quot;
*  One short message sentence (with verb) per slide, in lieu of title.  Other text: keywords/labels to allow the visual to stand alone.  Planning: choose the messages, then how to support with visual.
*  Minimize visual noise (fonts, sizes, colors).  Develop in black&amp;white.  Then add color sparingly for emphasis or identification.
*  Face &amp; address the audience the whole time: feet, hips, shoulders.  Constant eye contact.  &quot;Establish a genuine relationship&quot;.
  === 
* I wonder: ++++
*  How to demonstrate the software //and// keep connection with audience?
  === 
</pre>
</div>
<div title="2007-09-21" modifier="Conal Elliott" created="200710102044" tags="2007-09 day" changecount="1">
<pre>* In Seattle for Tasha's wedding.  Leaving for Germany on Monday.
* Thoughts about my ICFP talk: ++++
*  What's my one message?  Ideas: ++++
*   Functional programming can be artist-friendly.
*   Programming can be made much more accessible by mapping parameterization onto interaction.
*   Media authoring (2D, 3D, video, interaction) is more accessible than programming, especially for right-brain creative folks.  Programming is much more expressive.  I'm going to show you a way to combine the strengths of each, by mapping typed functional values into interactive, composable GUIs.
*   Programming is a powerful medium of expression, but largely inaccessible to right-brain creative folks.  For //functional// programming in particular, I'm going to show you a way to bridge the gap, by mapping typed functional values (including functions) into interactive, composable GUIs.
   === 
  === 
</pre>
</div>
<div title="2007-09-28" modifier="Conal Elliott" created="200710102044" tags="2007-09 day" changecount="1">
<pre>* At IFL in Freiburg.
</pre>
</div>
<div title="2007-09-29" modifier="Conal Elliott" created="200710102045" tags="2007-09 day" changecount="1">
<pre>* At IFL.
* Showed Eros to Colin R and got some comments.  Highlights ++++
*  Use a canonical presentation per type, for concreteness.  Same input &amp; output.  Particularly images!  Change my filter examples to have a visual input, even it it's not modifiable.  [Done.  Much nicer!]
*  Think about naming.  Ideas:  Many-to-many relation between names &amp; things.  Name with pictures.
*  Do some thought experiments about fixpoints.  Colin has some ideas &amp; experience from a class experience: interactive mosaic construction.  Come up with some nice fixpoint examples.
  === 
* [[MGS| http://mgs.lami.univ-evry.fr]] looks very neat.  Amorphous computing.  Nice language ideas.  &quot;Transformations of topological collections&quot;.  From home page: ++++&gt;
The goal is to investigate the concepts and tools (programming languages) needed for the modelling and the simulation of dynamical systems exhibiting a dynamical structure. The results are validated by the design and development of an experimental declarative programming language and of some applications (mainly in the area of biological systems modelling). Our approach is based on the use of topological notions to extend the idea of rewriting systems.
And we want to have fun!
  === Also see the [[publications page| http://mgs.lami.univ-evry.fr/PUBLICATIONS/publication.html#Documentation]]
* Working image input -- visual, but not directly editable.  I supply an initial value, which displays in the input widget.  When connecting temporarily, update the received input dynamically.  Do in general, not just with images.
* John O'Donnell's talk &quot;Circuit Parallelism in Haskell Programs&quot;.  Very inspiring!  Generate FPGA code that run with massive parallelism.  In particular, create replicated units, each of which has its own local memory &amp; processing.  Example: interval selection sort (name?).  Each cell (array entry) has a value (unchanging) and an gradually refined interval of indices, saying where the cell is to end up.  Grab a pivot value.  Count the number of values less than the pivot (log n).  Refine the index interval (constant time).  Other operations can sometimes be done without fully sorting: what's value at index i, and what's the index of value v.
* Idea for presentations: point a laser at the screen and get the mouse to move accordingly.  Trick: have a gyro, a calibration step, and a way to tip it back into sync as you go.
</pre>
</div>
<div title="2007-10" modifier="Conal Elliott" created="200801120319" tags="2007 October month" changecount="1">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2007-10-02" modifier="Conal Elliott" created="200710102045" tags="2007-10 day" changecount="1">
<pre>* Second day of ICFP.  My Eros talk was well-received yesterday.  Last night I finally slept well.
* Eros thoughts: ++++
*  Play with some more deep arrow instances to fold in.  Code view (via DeepArrow GADT), explanation.
*  From code view, extract executable code //and// formatted ({{{lhs2TeX}}}).
*  Make a binary distribution.  But first, make Eros easy to use by others (discoverable functionality &amp; UI).
*  Read up on iData &amp; iTask (in Clean, by Rinus P et al).  Probably the work closest to TV.  Uses generic programming for type-driven UIs, including user-defined record points.  (Solves a problem of TV/Eros.)  I think iTask is an application of iData to workflow.  Re-read SAPL paper (fast interpreter).
*  Revisit polymorphism question, relating explicit polymorphism with visualization as parameter.
*  How would
*  Jim McKinna asked how to present &quot;tagged values&quot;, i.e., sum types.  He suggested horizontally juxtaposed sub-guis with all but one greyed out.  I suggested instead to have a label plus the corresponding typed value (constructor argument), //and// dynamically resize the GUI when the label changes.  Try with @Either@
  === 
* I was unsatisifed with last night's dinner conversation about religion.  I realized suddenly that I'd rather be in bed, so I paid &amp; left abruptly.  If I weren't so tired &amp; irritated, I might have been beter able to (a) love what is (as a starting point) and (b) ask for something to help.  Here's a proposal: play a game.  The goal is to optimize everyone's internal state, say heart-openness, enjoyment, curiosity.  In the game, everyone provides honest real-time feedback on their actual state and sometimes makes requests for what would help them shift their state.  Others can help people to clarify their needs &amp; requests.  Keep it collaborative, with a group goal.  Play with this idea, formulating some games and trying them out.  Think of my personal goal as having fun, and stay unattached to strategies and foci for fun.  For instance, intimacy is fun, but so is cleverness &amp; humor.
* Some Scheme links: [[Planet Scheme| http://planet.plt-scheme.org]], [[Untyped blog| http://www.untyped.com/untyping]].
* I often write @(g.).(.h)@ (point-free) or @\ f -&gt; g.f.h@ (pointed) in my code.  Usually, @g@ and @f@ are inverses, so the composition looks like three sides of a commutation diagram.  Example: temporal or spatial transformation of functions.
* Idea: avoid actual tupling/untupling in arrow computations by doing for arrows what Manuel Ch did for parallel arrays.  Apply to time-changing values.  Success means that multiple inputs are seen to update independently.
* Cliff Beshers gave a talk on Linspire experience.  He's thinking along the same lines as I am about typed wrappers aroun files.  &quot;Write expressions on files.&quot;  See if he want to go anywhere with these ideas.  (He's left Linspire.)  &quot;Support files as typed values (TangibleValues?)&quot;.
</pre>
</div>
<div title="2007-10-03" modifier="Conal Elliott" created="200710102046" tags="2007-10 day" changecount="1">
<pre>* Third day of ICFP.  At last night's banquet, Paul H &amp; I received the award for the most influential paper of ICFP 1997.  Very gratifying.
* During lunch, I remembered an old idea for eliminate all explicit use of IO, and I got excited about it again. ++++
*  Interpret IO as data marshalling.
*  Users are pure functions, with user interaction being functions in mutual recursion.
*  What drives evaluation in a lazy language?  Marshalling.
*  The old (Haskell 1.2) style of IO programming is close to this style, but it didn't work out well.  Explain why, and what's different in my new approach.
*  Could old stream style IO work if the values exchanged are FRPish values?
*  Unified view of in-memory computation, inter-language calling (FFI), distributed programming, and user interaction.
*  Maybe deal with lossy marshalling, i.e., incomplete transmission of a value during marshalling.  Or maybe require that marshalling is lossless, in which case some lossy conversion happens &quot;before marshalling&quot;.  Maybe depends on whether/when the choice of marshaller is automatic.  Explore these questions via examples.
*  Use the TV trick of automatically removing matching marshall/unmarshall (output/input) on composition.  Oh -- maybe start with TVs rather than with pure functions.  Not sure.
*  &quot;Eliminate unnecessary conversions&quot; (a quote from Duncan Coutts's &quot;Stream fusion&quot; talk).
*  Examples: games, UIs, backup.
*  Gather examples of marshalling mechanisms: FFI, GpH (or whatever), tty, UI, CGI.
*  Paper title: &quot;IO is marshalling&quot;, &quot;Purely functional users&quot;, &quot;Users are functions&quot;.
  === 
* Start thinking of programs in terms of lots of parallel activity with emergent behavior.  Read up on amorphous computing.
* Stream fusion talk: Johan J suggested tree-like types, and Duncan responded that the &quot;next&quot; (stepper) functions are trickier.
* Revisit my choice of DeepArrow combinators.  Are some there just to avoid polymorphism?
</pre>
</div>
<div title="2007-10-04" modifier="Conal Elliott" created="200710102046" tags="2007-10 day" changecount="1">
<pre>* Still in Freiburg.  CUFP is today.
* Xavier L mentioned that he hates GUI programming and that people are content to use existing non-functional languages for GUIs (C++, Java).  I was surprised to hear that, and I'm guessing behind his comment is the experience and assumption that GUIs are programmed in a very imperative style.  Perhaps now is a good time to make a new version of Fruit, based on arrows &amp; FRP, especially if I could use it to help (re)implement Eros.
* Chatted with Mike Sperber.  He knows the history of Fran implementations, and he did an interestingly different one himself, for drama lighting.  His architecture is very different from what I've considered.  He did polling with blocking and multi-threading.  Polling an discretely changing value means a thread blocks until the next change.  Use {{{select}}} to wait for the first of two values to change.  I want to pursue that approach.  Lots &amp; lots of lightweight threads.  Maybe this is the classic comparison between events &amp; threads.  Time-transformation is important to Mike, and now I remember that it's important to me.  Make sure my new @Source@ stuff can support it.
* Lunch with Leaf Peterson and Anwar Ghuloum from Intel.  (I met Leaf in Seattle.)  We talked about future of CPUs vs GPUs, data prallelism, etc.  They have some projects (particularly graphics) that might be a good fit for me, if funding comes through.  Leaf worked on the TIL compiler and is interested in exploring my data-driven ideas applied to modules.  (He didn't on the spot buy my claim that imports are global variables.  Alter my description.)  In particular, he took the description to mean updating of a module through its import.  Get in touch with them when I'm home, to schedule an Intel visit (Santa Clara).  Leaf lives in Seattle and is in Santa Clara on Thursdays.
* Consider sum types for TVs. ++++
\begin{code}
oEither :: TV a -&gt; TV b -&gt; TV (Either a b)
\end{code}
  === A general pattern for contravariant functors.  Compare with @either :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; (Either a b -&gt; c)@.  Where does &quot;either&quot; belong, algebraically?
* Look up &quot;An event detection algebra for reactive systems&quot;, 2004.  
* Thoughts on &quot;IO is marshalling&quot;: ++++
*  How to start working on ?  Example applications.
*  Is a @TV (a -&gt; b)@ a marshaller for @a -&gt; b@.  Is it //also// a marshaller for a user function of type @b -&gt; a@?  Is there research on algebras of marshallers?  Somehow, it gives the user access to the function, but doesn't it also give the function access to the user?  Hm -- the user has a much richer type than @b -&gt; a@.  What //is// a user's type?  Call it @UserIn -&gt; UserOut@.
*  If user &amp; function are in mutual recursion, what's the result?  I guess it's the conclusion or an ongoing byproduct of interaction.  For instance, the result of &quot;save&quot;, which may be a time-varying value, since one can save many times.
*  Consider a simple editor application.  Define data types for input &amp; output, separated from any human UI.  Define a UI (scrolling, redisplay, etc, text and command input) and a semantic result (e.g., time-varying map from names to strings).
*  
  === 
* Revisit arrow-based Phooey (or Fruit), with more interesting inputs.
</pre>
</div>
<div title="2007-10-05" modifier="Conal Elliott" created="200710102047" tags="2007-10 day" changecount="1">
<pre>* At [[Hac| http://haskell.org/haskellwiki/Hac_2007_II]].
* Thorkil Naur, Peter Naur's son, is there.  Look at P.N's home page: www.naur.com.  See in particular &quot;An anatomy of the human life&quot;.
* [[Slightly Larger Harpy Tutorial| http://uebb.cs.tu-berlin.de/harpy/download/larger-tutorial.pdf]]
* [[Some MGS publications| http://mgs.lami.univ-evry.fr/PUBLICATIONS/publication.html]]
* To do while here and no other collaborative stuff is going on: ++++
*  Record and push my latest package changes, up through Eros.
*  Get Eros talk and notes on the web and linked from my home page.
*  Begin user notes for Eros.  Maybe put on the Haskell wiki.
*  Mock up a TW for browsing source code.  Use DList as a test case.
  === 
</pre>
</div>
<div title="2007-10-06" modifier="Conal Elliott" created="200710102047" tags="2007-10 day" changecount="2">
<pre>* I'm working with [[Russell O'Connor| http://r6.ca]] on an GuiTV interface for applying the [[Kelley Criterion| http://r6.ca/blog/20070820T175938Z.html]] to optimize investments.  To do: ++++
*  Regress my libraries so they run on ghc 6.6.  Done.
*  Make an input for a drop-down list. ++++
\begin{code}
choices :: [String] -&gt; Input UI String
\end{code}
   === Done.
*  Get his &quot;invest&quot; code installed on my machine.  Done.
  === 
</pre>
</div>
<div title="2007-10-07" modifier="Conal Elliott" modified="200710102050" created="200710102048" tags="2007-10 day" changecount="2">
<pre>* [[Haskell Workshop videos| http://web.mac.com/malcolm.wallace/HaskellWorkshop.html]] posted.
* Russell suggested using a zipper/derivative structure for the @choice@ function, since zippers &amp; derivatives  describe a value in a context.  Interesting to imagine when an input is about navigating in a domain and when it's just about selecting.
* Investment GUI works. :)  Next make an input that polls (@IO a@) at regular intervals.  Learn to use wxHaskell timers.  Done.
* [[Haskell for pluggable apps, with the GHC API| http://austin.youareinferior.net/?q=node/29]]
* I've had to recompile wxHaskell each time I switch between ghc versions.  Instead, change my {{{configure}}} options: {{{./configure --prefix=/usr/local/ghc-6.8.0.20071002 --with-opengl}}} .
* I switched to ghc-6.6 so I could make sure Phooey etc work for 6.6.  When switching back to 6.8, I get a strange message from ghci, something like &quot;not built for interactive use&quot;.  I installed the latest mingw snapshot, ghc-6.8.0.20071002.
</pre>
</div>
<div title="2007-10-10" modifier="Conal Elliott" modified="200710161844" created="200710102048" tags="2007-10 day" changecount="11">
<pre>* I'm back home from Germany and so glad to be here.  We got a good dose of rain last night.  The air is clear, and the creek is running.  Bill &amp; crew finished the deck while I was away, and it looks terrific.
* Called Campora Propane (209.736.0449) about our tank, which is now at about 38%.  We have a 150 gallon tank, and they'll come out any time it's ready to take at least 75 gallons.  I think they fill only to 85%, so I'll wait until it reads below 35%.
* Here's an idea that came from a conversation with Cliff Beshers and David Fox in Freiburg. ++++
  While building Linux packages, sometime a missing file is discovered late in the process.  They'd like to detect such failures early on.  The idea is to split each build chunk into one step that finds needed resources and another step that uses the resources.  When composing build chunks, combine the first phases, and combine the second phases. ++++
\begin{code}
-- Build step, building on a monad m
data BuildT m a = forall r. BuildT (m r) (r -&gt; m a)

instance Monad m =&gt; Monad (BuildT m) where
  return a = BuildT (return ()) (\ () -&gt; return a)
  BuildT prep bld &gt;&gt;= f = BuildT ( ... )
\end{code}
  === Oh!  This idea doesn't seem to work with the @Monad@ interface, which allows the preparation step of the second chunk to depend on the result computed by the first step.  Try having the monadic return value come from the prep step instead. ++++
\begin{code}
data BuildT m a = BuildT (m a) (a -&gt; m ())

instance Monad m =&gt; Monad (BuildT m) where
  return a = BuildT (return a) (const (return ()))
  BuildT prep snka &gt;&gt;= f = BuildT (do a &lt;- prep
				      BuildT mb snkb &lt;- f a
				      ...)
                                  ...
\end{code}
  === Doesn't work out either, as it makes the second @BuildT@ too early.

An applicative functor or arrow interface would give the necessary separability.  First AF: ++++
\begin{code}
data BuildF m a = forall r. BuildF (m r) (r -&gt; m a)

instance Functor m =&gt; Functor (BuildF m) where
  fmap f (BuildF prepX bldX) = BuildF prepX (fmap f . bldX)

instance Applicative m =&gt; Applicative (BuildF m) where
  pure a = BuildF (pure ()) (\ () -&gt; pure a)
  BuildF prepF bldF &lt;*&gt; BuildF prepX bldX =
    BuildF (liftA2 (,) prepF prepX) (\ (rf,rx) -&gt; bldF rf &lt;*&gt; bldX rx)
\end{code}
  === Then arrow: ++++
\begin{code}
data BuildA (~&gt;) a b = forall r. BuildA (() ~&gt; r) (r -&gt; (a ~&gt; b))

instance Arrow (~&gt;) =&gt; Arrow (BuildA (~&gt;)) where
  arr f = BuildA (arr id) (const (arr f))
  BuildA prep bld &gt;&gt;&gt; BuildA prep' bld' =
    BuildA (prep &amp;&amp;&amp; prep') (\ (r,r') -&gt; bld r &gt;&gt;&gt; bld' r')
  first  (BuildA prep bld) = BuildA prep (first  . bld)
\end{code}
  === For instance, @(~&gt;) = Kleisli IO@, where ++++
\begin{code}
newtype Kleisli m a b = Kleisli { runKleisli :: a -&gt; m b }
\end{code}
  === 
 === 
* Article: [[It's Time to Stop Calling Circuits &quot;Hardware&quot;| http://www.cs.ucr.edu/~vahid/pubs/comp07_circuits.pdf]].
* At ICFP, Mike Sperber told me a bit about his Lula implementation of FRP.  He used threads and blocking on events, which I'd never considered.  I think he said he used {{{select}}} for event disjunction.
* Thoughts on representing behaviors/sources efficiently: ++++
Represent a behavior as a current value and an event.  Keep current values alive in closures instead of a ref or recomputing.  Switch to one-shot events and maybe blocking.  For @(&lt;*&gt;)@, use @eitherE :: E a -&gt; E b -&gt; E (a + b)@, or @fmap@ and @mappend@.
* First, reactive discrete behaviors.  Represented as an initial value and a way to get more: ++++
\begin{code}
data RB a = RB a (E (RB a))

instance Functor RB where
  fmap f = (pure f &lt;*&gt;)
  -- fmap f (RB a e) = RB (f a) ((fmap.fmap) f e)

instance Applicative RB where
  pure a = RB a mempty
  bf@(RB f ef) &lt;*&gt; bx@(RB x ex) =
   RB (f x) (((&lt;*&gt; bx) &lt;$&gt; ef) `mappend` ((bf &lt;*&gt;) &lt;$&gt; ex))
\end{code}
  ===  Note that this formulation gives automatic value caching without refs.  Current values ride along in the event handlers.
* Next, simple continuous behaviors.  Single out constant functions, for optimization. ++++
\begin{code}
type Time = Double

data CB a = K a | TFun (Time -&gt; a)

-- | As a time function
asTFun :: CB a -&gt; (Time -&gt; a)
asTFun (K a)    = const a
asTFun (TFun f) = f

instance Functor CB where fmap f = (pure f &lt;*&gt;)

instance Applicative CB where
  pure = K
  K f &lt;*&gt; K x = K (f x)
  sf &lt;*&gt; sx   = TFun (tf &lt;*&gt; tx)
   where 
     tf = asTFun sf
     tx = asTFun sx
\end{code}
  === 
* Then reactive, continuous behaviors, simply by composing: ++++
\begin{code}
type CRB = RB `O` CB
\end{code}
  === 
* Think of @RB@ and @CRB@ as a &quot;reactive normal form&quot; (&quot;RNF&quot;) for behaviors.  Define semantics for behaviors; prove properties related to RNF; and then introduce the representations above, justified by the properties.
* I could use one thread per output or one for all outputs, via @liftA2 (&gt;&gt;)@.  The former has more concurrency, while the latter might foster sharing of computation.
* On sharing, consider @g &lt;$&gt; (f &lt;$&gt; e)@ and @h &lt;$&gt; (f &lt;$&gt; e)@.
* I could have a thread per @mappend@ also.  Maybe one per @(&lt;*&gt;)@.  May help with sharing.
* Use @dup@ to track re-use.  Maybe one thread per @dup@.  @Applicative@ and @Arrow@ allow @dup@ detection.  For @Arrow@, drop @arr@.
* Try out various representations, measure performance on examples, and write up the results.
* Go back to one-shot events as primitive.  An occurrence can yield more (unfold-style).  &quot;Subscribe&quot; to one occurrence at a time.  Replace &quot;subscribe&quot; with &quot;block&quot;.
* Play with imperative, multi-threaded blocking style.  Guess: that style allows //efficient// pull-based programming.  Needs something like {{{select}}} for @mappend@.  What exactly?  Oh -- software transactional memory (STM).
* For simple continuous (time-based) segments (@CB@ above), use another thread.  Hide in an output setter.  Implementation involves thread start/stop.
 === 
* For a bit of background on pre-monadic functional IO, see [[Imperative functional programming| http://citeseer.ist.psu.edu/peytonjones93imperative.html]] and its references, especially Section 3.1.
</pre>
</div>
<div title="2007-10-12" modifier="Conal Elliott" modified="200710161847" created="200710161839" tags="2007-10 day" changecount="2">
<pre>* Musing over reactivity.  Principle: an agent can only react to //internal// state, not external state.  In other words, an agent reacts to its senses and what it extracts from its senses.  When an agent is transformed in space or time, its sensory inputs are inversely transformed.
* Tried [[MetaPlug| http://hackage.haskell.org/cgi-bin/hackage-scripts/package/metaplug]], a wrapper around {{{ghc-api}}}.  Doesn't seem to be up to date with ghc 6.8
</pre>
</div>
<div title="2007-10-13" modifier="Conal Elliott" created="200710161840" tags="2007-10 day" changecount="1">
<pre>* Starting to poke around in {{{ghc-api}}} and other bits of {{{ghc}}}.  Pretty complicated, so it will take time to get comfortable.  I'll start preparing to use it by generating a data representation of @DeepArrow@, from which it will be trivial to generate code.
</pre>
</div>
<div title="2007-10-14" modifier="Conal Elliott" created="200710161841" tags="2007-10 day" changecount="1">
<pre>* I've resurrected my @DeepArrow@ data representation, for persistence &amp; compilation.  I don't know quite how I want to apply it, however.  Specifically, when I convert the data type in to a Haskell expression, do I want the expression to denote a pure value, or a whole TV, or what?  For compilation, the value would suffice, while for persistence, I'd want the whole TV.  One tricky bit: how to externalize an output, capturing current input states?
* From Don Stewart, in response to a note I sent about separating IO &amp; logic. +++&gt;
Thank you Conal, for reminding people about this :)

Examples involving more composable IO stuff would be great, if you get
the time, and would help spread the word .

Cheers,
 Don
  === 
* Response to Joe Mitchell: +++&gt;
&gt; I'm wondering if you would be willing to share more about how you use the OFNR steps.  Sounds like your thinking on OFNR is just as a way of lining up the possible elements of a communication.  And then once these elements are lined up, and the person has their heart open, it doesn't make much difference what they say -- their heart will lead the way.  Am I hearing you correctly?

Hi Joe.  I got a smile seeing your name &amp; note.

&quot;And then once these elements are lined up, and the person has their heart open, it doesn't make much difference what they say -- their heart will lead the way.&quot;

I like how you put it, though I'd drop &quot;once these elements are lined up&quot;, since the elements don't matter to me, only the openness.  I like to use the elements where they're measurably helpful and replace them when they're not.

I have stopped teaching &quot;the OFNR steps&quot;, as I believe that any formula or procedure tends to undermine the central intentions of living connection with self &amp; others.  Instead, I see O, F, N, &amp; R as four &quot;tools&quot; (among many) that can be helpful in supporting clarity &amp; connection.  I've also come to see NVC as a mainly *inner* practice, not as a communication method.  For instance, the &quot;observation&quot; tool helps one get re-grounded in reality, dissipating confusions between the known and the imagined.  That clarity is crucial in determining whether to direct requests inwardly or outwardly.  Given that the observed event is in the past, and I like to live &amp; connect in the present, I don't see value in recounting my observation to another person.  Similarly, &quot;feeling&quot; awareness often helps me to get to my needs, so it's a very helpful internal tool.  If I'm going for Connection, then I might ask a person to listen to my feelings &amp; tell me what essence they're getting and what feelings come up for them.  On the other hand, if I want to go for something other than connection, then stating my feelings (especially with more than one or two words) would compete for attention with the needs &amp; request I'm going for.

I especially like your phrasing &quot;their heart will lead the way&quot;, as it captures my newer understandings clearly and poetically.  Language skill can obscure what's made plain by the old plainly-jackal language, namely that one's consciousness is still mired in judgment.  (Some examples at http://evolve.awakeningcompassion.com.)  That's important information!  I'd much rather people speak un-self-consciously, so that language clearly reveals consciousness.  Shift the consciousness, and the language will then shift accordingly.

I'd love to hear your reactions.  Hugs,  - Conal
  === 
* Progress in zipper-based bi-infinite image trees.  Very elegant so far.  A &quot;space zipper&quot; contains information (e.g., image samples) collected densely in a continuous space.  A space zipper is infinite and continuous, like Pan's function-based representation, but does lots of caching, unlike a function.
</pre>
</div>
<div title="2007-10-16" modifier="Conal Elliott" created="200710261904" tags="2007-10 day" changecount="1">
<pre>* More on space zippers: ++++
*  At each node, compute an infinite sequence of refined approximations of a single sample approximating the whole interval.  The zeroth approximation is from a sampling.  The first approximation is the average of the zeroth approximations for the two (or four) sub-intervals, etc.
*  Have also an infinite sequence of coarsening approximations.  The first (or //-1th//) is taken from the parent's zeroth approximation, the second from the parent's first coarsening approximation, etc.
*  For efficient blitting, I think I'll want to make and cache arrays of samples.  Could be one array per interval or a sequence of arrays, having one element, two, four, ....  If a sequence, then make the //i+1//th array by concatenating the //i//th arrays for the sub-intervals.  What about bidirectional sequences here also?  The //-(i+1)//th element has //1/2^(i+1)// samples and comes from halving its parent's //-i//th element.  Taken literally, this is just silly talk, but I bet it hints at something lovely, probably from a relational point of view.  
*  Hmm: lazy relational programming.  Have two values (for instance) and a way to compute each from the other as well as each on its own.  Assume that computing either from the other is cheaper than without the other (but not free).  When a value is demanded and not yet computed, see if the other is computed.  If so, compute from the other.  If not, compute on its own.  Generalize the idea past pairs of related values.  Somehow guarantee that the two means of computation yield the same result, so that the semantics is independent of evaluation order.
*  When it's time to blit some pixels, I could either grab some number of fixed-size arrays, or piece together a variety of sizes.  The latter approach would preserve more laziness.  I'm assuming each array is strict, i.e., elements fully evaluated (and unboxed).
  === 
* On Levenshtein (edit) distance: ++++
{{{
&lt;chessguy&gt; anybody know of a haskell implementation of the levenshtein distance algorithm?
&lt;ddarius&gt; chessguy: lambdabot
&lt;conal&gt; @go levenshtein distance
&lt;lambdabot&gt; http://en.wikipedia.org/wiki/Levenshtein_distance
&lt;lambdabot&gt; Title: Levenshtein distance - Wikipedia, the free encyclopedia
&lt;chessguy&gt; conal, that doesn't have a haskell implementation				      [09:41]
&lt;ddarius&gt; chessguy: lambdabot uses the Levenshtein distance to &quot;fix&quot; &quot;mistyped&quot; commands.
&lt;chessguy&gt; ddarius, yeah, but i bet that's going to be a bear to find
&lt;ddarius&gt; lambdabot isn't that big							      [09:42]
&lt;conal&gt; chessguy: the &quot;@go&quot; was for me.  i didn't know what &quot;Levenshtein distance&quot; is.
&lt;twanvl&gt; See: http://www.cse.unsw.edu.au/~dons/lambdabot/Lib/Util.hs
&lt;chessguy&gt; aha
&lt;conal&gt; I wonder why darcs doesn't use Levenshtein distance.
&lt;chessguy&gt; liyang, nah, there are lots of imperative implementations, most of which could easily be
	   directly translated from that wikipedia page
&lt;ivan`&gt; it's N^something?								      [09:45]
&lt;dankna&gt; because all it gives you is a distance and not the patch to achieve it
}}}
  === 
* [[View patterns: lightweight views for Haskell| http://hackage.haskell.org/trac/ghc/wiki/ViewPatterns]].  Apparently just checked into GHC head.
</pre>
</div>
<div title="2007-10-19" modifier="Conal Elliott" modified="200710261921" created="200710261905" tags="2007-10 day" changecount="3">
<pre>* To do: add {{{-fno-warn-orphans}}} to some of my source files, to supress orphan instance warnings.
* Noticed in {{{Data.Tree}}}: ++++
\begin{code}
instance Applicative Tree where
  pure x = Node x []
  Node f tfs &lt;*&gt; tx@(Node x txs) =
    Node (f x) (map (f &lt;$&gt;) txs ++ map (&lt;*&gt; tx) tfs)
\end{code}
  === Compare with this code from [[2007-10-10]]: ++++
\begin{code}
instance Applicative RB where
  pure a = RB a mempty
  bf@(RB f ef) &lt;*&gt; bx@(RB x ex) =
   RB (f x) (((&lt;*&gt; bx) &lt;$&gt; ef) `mappend` ((bf &lt;*&gt;) &lt;$&gt; ex))
\end{code}
  === 
* Discussion about arrays on {{{#haskell}}}.  Snippet: ++++
{{{
&lt;fasta&gt; conal: I think I would use STArray and then freeze it.				      [15:28]
&lt;fasta&gt; conal: if there are no incremental updates, Array is fine too.
&lt;conal&gt; fasta: thanks.  and can you tell me how STArray &amp; UArray relate?
&lt;fasta&gt; conal: STArray relates to Array
&lt;fasta&gt; conal: STUArray relates to UArray
&lt;conal&gt; and then there's GHC.PArr							      [15:29]
&lt;mrd&gt; \@hoogle runSTUArray
&lt;lambdabot&gt; Data.Array.ST.runSTUArray :: Ix i =&gt; ST s (STUArray s i e) -&gt; UArray i e
&lt;conal&gt; fasta: and the U is &quot;unboxed&quot;?
&lt;fasta&gt; conal: I wasn't aware of that one, but that's for the nested data para. probably?
&lt;fasta&gt; conal: yes
&lt;mrd&gt; &gt; runSTArray (do a &lt;- newArray (1,10) 1; return a)
&lt;lambdabot&gt;   Not in scope: `newArray'
&lt;conal&gt; fasta: thanks.  and yes. PArr is for ndp.
&lt;fasta&gt; conal: is GHC.Arr documented already?						      [15:30]
&lt;mrd&gt; &gt; runSTArray (do a &lt;- Data.Array.MArray.newArray (1,10) 1; return a)
&lt;lambdabot&gt;   Not in scope: `Data.Array.MArray.newArray'
&lt;conal&gt; fasta: i found a bit on the wiki (i forget whether the haskell wiki or ghc wiki)
&lt;conal&gt; i like the look of runSTArray &amp; runSTUArray.					      [15:32]
&lt;fasta&gt; conal: They are just wrappers around runST, I think				      [15:33]
&gt; yes
&lt;mrd&gt; and unsafeFreeze
&lt;mrd&gt; but they do let you omit a type annotation here or there
&lt;mrd&gt; \@wiki SPOJ									      [15:36]
&lt;lambdabot&gt; http://www.haskell.org/haskellwiki/SPOJ
&lt;mrd&gt; I have a little intro to mutable Arrays in there
}}}
 === 
* Discussion about HOpenGL on {{{#haskell}}}.  See [[GL Shaders| http://haskell.org/ghc/docs/latest/html/libraries/OpenGL/Graphics-Rendering-OpenGL-GL-Shaders.html]].
</pre>
</div>
<div title="2007-10-20" modifier="Conal Elliott" created="200710261905" tags="2007-10 day" changecount="2">
<pre>* Stumbled across Intel research blog, including some [[by Anwar Ghuloum| http://blogs.intel.com/research/authors#anwar_ghuloum_]] on data parallelism etc.
* [[Lazy SmallCheck| http://www-users.cs.york.ac.uk/~mfn/lazysmallcheck]]: a very clever idea.  Uses monotonicity to verify properties over infinite input subspaces by applying to //partial// (error-ful) values.
* Space zipper stuff going well.  I now have elegant definitions of intervals, infinite binary trees, infinite streams, infinite bi-streams, 1D &amp; 2D space zippers, 1D bi-infinite dense sampling, and same with infinite approximation bi-streams.  Next: replace samples with streams of sample arrays (1 element, 2, 4, ...).  Do I want an approximation bi-stream of streams of arrays, or a stream of approximation bi-streams of arrays?  I want to have a variety of sizes of arrays, so I can efficiently piece them together when rendering.
</pre>
</div>
<div title="2007-10-21" modifier="Conal Elliott" modified="200710261914" created="200710261905" tags="2007-10 day" changecount="6">
<pre>* I want to write QuickCheck properties (automated tests) for SpaceZip.  How do I do it, considering that my data structures are all infinite?  The same problem arises for functions, and is addressed with a @forAll@ property.  Can I map my types as functions from some kind of index type?  Probably yes.  For instance, @asFun :: BinTree a -&gt; [Dir] -&gt; a@.  Generalize to a type class, and hide the @forAll@ in @(==*)@.  Here are some properties: ++++
\begin{code}
-- BinTree
asFun (fmap f bt) ==* fmap f (asFun bt)

-- BiStream
asFun (fmap f bt) ==* fmap f (asFun bt)
forward . back ==* id
back . forward ==* id

-- Loc (SpaceZip)
(zoomIn (ctxDir (ctx l)) . zoomOut) l ==* l
forAll $ \ dir -&gt; zoomOut . zoomIn dir ==* id

forall $ \ dir -&gt; pan (otherDir dir) . pan dir ==* id
\end{code}
  === 
</pre>
</div>
<div title="2007-10-22" modifier="Conal Elliott" created="200710261919" tags="2007-10 day" changecount="1">
<pre>* Got a project {{{http://code.haskell.org/Eros}}}, with files at {{{conal@code.haskell.org:/srv/code/Eros}}}.  To do: send in requests for other projects.  But oops!  I can't connect with SecureCRT.  My key gets rejected.  Perhaps as {{{ndm}}}, since he connects via a Windows machine.  First, make sure my {{{authorized_keys}}} on {{{conal.net}}} and {{{code.haskell.org}}} are identical, as well as SecureCRT settings.
</pre>
</div>
<div title="2007-10-23" modifier="Conal Elliott" created="200710261919" tags="2007-10 day" changecount="1">
<pre>* Paper title: &quot;Space-time zippers&quot;.  Remember, though, that I want to include many more dimensions, beyond space &amp; time.
* Responded to Joe Mitchell &amp; Anjali Corinne, asking how I teach NVC.
</pre>
</div>
<div title="2007-10-25" modifier="Conal Elliott" created="200710261920" tags="2007-10 day" changecount="1">
<pre>* Installing Python-2.4.4 on Joseph's new server, since moinmoin and ziddlywiki both rely on 2.4 rather than 2.5.  {{{./configure}}}d with {{{--prefix=$HOME/python-2.4}}}.  I'll have to tweak the moinmoin and zope start-up shell scripts accordingly.  Starting up zope, I get   {{{Undefined symbol: PyUnicodeUCS4_AsEncodedString}}}.  The old server is running 2.4.3, so I switched to that one.  Same message.  Maybe there's another change I have to make also.  Instead, work on migrating the data.
</pre>
</div>
<div title="2007-10-26" modifier="Conal Elliott" created="200710282205" tags="2007-10 day" changecount="1">
<pre>* For SpaceZip, I'm using &quot;model-based&quot; testing, as in [[bytestring| http://code.haskell.org/bytestring/]].  The idea is to specify operations in terms of equivalence to the operations on a simpler &quot;model&quot; type.  For bytestring, a model is lists.  For SpaceZip, I'm using functions as models.  For instance, model a bi-directional stream as @Int -&gt; a@ and an infinite binary tree as @[Dir] -&gt; a@.  I started modeling a space zipper as @[Step] -&gt; a@, where @data Step = Up | Down Dir@.  Then @zoomIn dir@ and @zoomOut@ come out //very// simply, but I don't know how to do @pan@.  I like this problem, because it tells me that I don't have a clear semantic basis for what I'm doing.  Perhaps unsurprisingly, I'm also unclear about how I'll use the space zipper.  Misc puzzle pieces: ++++
*  At one level, I'm representing a function over space: @f :: R -&gt; a@.
*  For rendering into discrete, retangular bitmaps, I want to extract finite, approximations of @f@ over intervals.  The approximations are piecewise-constant with regularly spaced constant sub-intervals.  They could easily be piecewise-linear instead.
*  In addition to a moving view interval, I also want variable zoom factor.  In other words, the width of a facet varies.
*  To allow progressive refinement, compute not just one value per facet, but an bi-infinite stream of improving values.
*  Some implementation details: ++++
*   For efficient access, package up sequences of approximation streams into approximation bi-streams of arrays.
*   For laziness, define these arrays as concatenations of shorter (half-size) arrays, in a binary tree.  Given an actual display interval and resolution, construct the display array from as few/big pieces as possible.
*   For re-use, compute and store only power-of-two resolutions.  Dynamically resample during discrete rendering.
*   During progressive refinement at a given resolution, higher resolutions are being computed, as well as contributions to improved versions of lower resolutions.  Work for every resolution contributes to every resolution.
   === 
*  What's the specification, separated from the efficient representation?  Start with generating an approximation bistream for single facet.  How to specify the facet?  Try simply as an interval.  Sample the function once in that interval for the zeroth approximation.  Combine with approximations from the two sub-intervals for the refined approximations.  What about the coarsening approximations?  There isn't enough information to compute them, since we don't know whether a given interval is the lesser or greater half of its parent interval.  I could pass in a stream of either directions or approximations.  Or as an initial simplification, drop the coarsening approximations.
*  Next, extend to arrays of continguous facets.  Approximation stream of arrays.  Arguments: lower bound, facet width, and number of facets.  Easy to implement/specify via the single-facet interface.
*  What allows a data-rich representation of these interfaces with maximal re-use?  Restrict some of the arguments. ++++
*   Facet size (inverse of sampling resolution) must be a power of two (often a negative power).  Approximate other sizes by dynamic resampling.
*   Facet lower bound must be a multiple of the facet size (pixel).
*   Facet array sizes must be power of two and must start at locations friendly to that size.  (Say more.)  Dynamically assemble all others from the standard ones.  What's a friendly start location?  It depends on how the zippers are laid out.  Currently I'm using a funny alternating layout.  Going upward from the initial focus, the intervals are (0,1), (-1,1), (-1,3), (-5,3), (-5,11), (-21,11), ....  (Simpler would be (0,1), (0,2), (0,4), ..., but the negatives wouldn't be covered.  I could have two data structures instead, handling positive and negative numbers separately.)
   === 
*  Track facet size in the @Loc@ (zipper) type, as a third element, along with the @BinTree@ and @Ctx@.  The @pan@ function keeps the facet size unchanged, while @zoomIn@ halves and @zoomOut@ doubles.  Oh -- track the whole interval.
*  Here's how to make an array of sample values for a given (power of two) facet size, lower bound, and number of facets.  Start at some location in the zipper.  Zoom out as necessary to an interval that contains the desired interval.  From there recursively process.  If a given interval is contained in the target interval, add it.  If disjoint, discard.  If overlap, recursively subdivide.  Very parallelizable.  Lesser and greater halves may be optimized separately.  The lower bound of the lesser half is at least the lower half of the target interval, and similarly for the upper bound of the greater half.
*  Each node represents an interval and contains a stream of approximation bi-streams of arrays.  In the outer stream, the //i//th element is a bi-stream of //2^i// element arrays.  The //0//th element is just singleton arrays containing the sample bi-stream.  The //(i+1)//th element comes from concatenating corresponding //i//th elements from the two sub-intervals.
*  Look up Chris Okasaki's article on type-enforced square arrays.
  === 
* Read blog post [[Simple Haskell Web Programming with HAppS| http://bluebones.net/2007/09/simple-haskell-web-programming-with-happs]]
* There still doesn't seem to be an TiddlyWiki that downloads tiddlers on demand.  Start noodling over an elegant Haskell-based TW-like thing.
* In {{{inf-haskell.el}}}, sometimes {{{inferior-haskell-cabal-buffer}}} is bound to a killed buffer.  The symptom is &quot;selecting deleted buffer&quot; when I load a module, and the work-around is {{{(setq inferior-haskell-cabal-buffer nil)}}}.
* To explore also: ++++
*  IA refinement streams
*  Uncurried space zippers (quadtrees, etc)
  === 
</pre>
</div>
<div title="2007-10-27" modifier="Conal Elliott" created="200710282205" tags="2007-10 day" changecount="1">
<pre>* Made http://emergence.awakeningcompassion.com point to a static html file.  Copied the &quot;related documents&quot; into [[other/| http://emergence.awakeningcompassion.com/other]], and made new pdfs there.
* [[Damn Cool Algorithms, Part 1: BK-Trees| http://blog.notdot.net/archives/30-Damn-Cool-Algorithms,-Part-1-BK-Trees.html]].  Exploits the triangle inequality (for metric spaces) to give a data structure for fast searches of near-misses, e.g., spelling errors.
* Considering how to compose approximation streams (ASs).  Suppose I have a sample value //x1// from an interval's midpoint and two ASs, //l1,... and g1,...//  for the interval's halves.  I'd like to make an AS for the interval, in which the //i//^^th^^ element is the average of //i// samples.  Try this for the values to be blended: //[x1], [x1,l1], [x1,l1,r1], [x1,l2,r1], [x1,l2,r2], [x1,l3,r2], [x1,l3,r3], ...//.  Weight according to the subscripts, e.g., //(1*x1+3*l3+2*r2)/6//.  Simpler: produce the sums rather than the averages.  Then //x1+l3+r2//, and do the division as the results are read out.
* Still simpler would be not even add, but rather produce a stream of samples.  Then @x1 &lt;:&gt; (ls `interleave` gs)@.  We may lose some sharing of sum computations.
* Added @scanl@ and @interleave@ to @Data.Stream@, and emailed a darcs patch to Wouter S.
</pre>
</div>
<div title="2007-10-28" modifier="Conal Elliott" modified="200711140516" created="200711101638" tags="2007-10 day" changecount="2">
<pre>* Removing some processes from my startup ({{{msconfig}}}): PDVDServ, NeroCheck, ifrmewrk, EQUWiz, DMEDIA, BatteryLife, PowerForPhone, ACMON, sm56hlpr, 
* Getting started with OpenGL. ++++
*  I don't seem to have the Haskell GLUT package, and I was unable to install it.
*  The wxHaskell contrib GLCanvas sample compiles &amp; works.
*  Looked around for CSG and found [[GTS| http://gts.sourceforge.net]] (&quot;GNU Triangulated Surface Library&quot;).  In compiling it, I need [[pkgconfig| http://www.freedesktop.org/software/pkgconfig]] and GLIB.  Installing pkgconfig seems to have brought along GLIB.  Compiling GLIB fails.  I manually tweaked the config .h files +++
{{{
mv glibconfig.h glibconfig.h-orig
cp glibconfig.h.win32.in glibconfig.h
}}}
   === and continued.  Got further.   Oh!  I think my MinGW is interfering.  I could try a [[MinGW version of pkgconfig| http://www.mingw.org/MinGWiki/index.php/pkg-config]], but it looks hairy.  Instead, shuffle my PATH so that cygwin comes before MinGW.  I got different problems with glib.  Apparently it doesn't work well with cygwin either.  Maybe [[GTK+ (not GIMP) for Windows| http://www.gimp.org/~tml/gimp/win32/downloads.html]] will help.  Oh -- grab pkg-config and glib from [[Cygwin| http://cygwin.com]].  I'm always nervous about cygwin updates, worrying that something will break, completely unrelated to what I'm downloading.  Got pkg-config and gli, allowing GTS config to get a bit further.  Got glib-dev.  Now &quot;./configure&quot; goes through fine.  Also &quot;make&quot;.  &quot;make check&quot; has a some errors.
*  [[Haskell OpenGL tutorial and pointers|  http://blog.mikael.johanssons.org/archive/2006/09/opengl-programming-in-haskell-a-tutorial-part-2]].
*  [[K-3D| http://www.k-3d.org]] is a modeler that uses GTS.
*  [[OpenGL Programming Guide or 'The Red Book'| http://fly.cc.fer.hr/~unreal/theredbook]].  Better formatting [[here| http://cs-sdl.sourceforge.net/index.php/Red_Book_Table_of_Contents]].  More (including the &quot;blue book&quot; reference manual and SDL info) [[here| http://cs-sdl.sourceforge.net/index.php/Main_Page]].
  === 
* Gem from {{{#haskell}}}: ++++
{{{
&lt;EvilTerran&gt; &gt; uncurry $ (***) `on` ((/) `on` fromIntegral)
&lt;lambdabot&gt;  &lt;(Integer,Integer) -&gt; (Integer,Integer) -&gt; (Double,Double)&gt;
}}}
  === 
</pre>
</div>
<div title="2007-10-29" modifier="Conal Elliott" created="200711101638" tags="2007-10 day" changecount="1">
<pre>* Cliff Beshers's [[n-Vision work| http://www1.cs.columbia.edu/graphics/projects/AutoVisual/AutoVisual.html]].
* SpaceZip: ++++
*  What sampling interface do I want for SpaceZip?  Ask for a stream of arrays of samples of a given facet (pixel) size, lower bound, and number of facets.  Require that the pixel size is a power of two (often negative) and the lower bound is a multiple of the facet size.  No restriction on the number of facets.  Hm.  I don't see how to implement that interface, considering my present alternating initial ascending pattern of intervals.
*  How about this interface for a data structure: zoomIn, zoomOut, prev, next, value.  It's like a bistream (prev, next, value), but with zooming in &amp; out to double or halve the value resolution.  Add a constant &quot;init&quot;, which could be a space zipper (new name please) containing a description of the intervals themselves or maybe just their midpoints.  It's also a functor.  And maybe another map-like interface that gives access to information from above (zooming out) or below (zooming in).  Also a &quot;seek&quot; that takes a resolution and lower bound and moves there (efficiently).  And maybe one that extracts an array or (other efficient sequence type) of values, starting with the current value and moving right (next).
*  I thought it would be awkward to have one SpaceZip data structure for the positive numbers and another for the negatives, but now I think that this pair will be a sort of zipper.  Once I allow the two structures, I can have a very simple, non-alternating pattern of interval expansion.
*  Here's a very straightforward representation: a @data@ structure with fields for value, prev, next, in, out.  Tie them all together carefully as in &quot;Weaving a Web&quot;.  Call it &quot;SpaceWeb&quot; or &quot;DenseWeb&quot; or just &quot;Dense&quot;.
  === 
* [[Lazy Functional Quaternions| http://www.citeulike.org/user/conal/article/1837334]] by Bryan O'Sullivan (bos on #haskell).
</pre>
</div>
<div title="2007-10-30" modifier="Conal Elliott" created="200711101639" tags="2007-10 day" changecount="1">
<pre>* I'll be giving a tech talk at Google next week.  Bryan O'Sullivan (bos) helped with the initial connection, and it work out very quickly from there.
* Responded to a recent note from Harry Pearle about his education book etc.  He still plans to use one of my Pan pictures on the cover (my four kids tiled to infinity and contracted to a disk), and maybe more as well.  I pointed him to Daniel Quinn on education.
* Took Holly to the Sacramento airport.  She's going to Seattle for a week for [[various vocal gigs| http://hollyc.com/hollosphere/?p=25]], performing &amp; recording with Michael Stillwater.
* Thinking more about spatial data representations.  One choice is zipper vs [[web| http://www.citeulike.org/user/conal/article/1844316]].  I realized I wasn't clear how to build even a simple 1D web, i.e., bi-infinite doubly linked list.  Came up with this start: ++++
\begin{code}
data BiStreamW a = { prev :: BiStreamW a, value :: a, next :: BiStreamW a }
 
numbers :: forall a. Num a =&gt; BiStream a
numbers = nums'
 where
   nums' = BiStream (back nums') 0 (forw nums')
   -- continue to elements before or after a given one
   back, forw :: BiStream a -&gt; BiStream a
   back n' = s' where s' = BiStream (back s') (focusValue n' - 1) n'
   forw p' = s' where s' = BiStream p' (focusValue p' + 1) (forw s')
\end{code}
 === What about @fmap@? ++++
\begin{code}
instance Functor BiStream where
  fmap (f :: a -&gt; b) (BiStream wp wv wn) = wbs'
   where
     wbs' = BiStream (back wbs' wp) (f wv) (forw wbs' wn)
     -- continue to elements before or after a given one
     back, forw :: BiStream b -&gt; BiStream a -&gt; BiStream b
     back n' (BiStream p v _) = s' where s' = BiStream (back s' p) (f v) n'
     forw p' (BiStream _ v n) = s' where s' = BiStream p' (f v) (forw s' n)
\end{code}
  === Next, generalize @fmap@ so that the given function has access to the previous and next values as well as the current.  Specialize to two versions that ensure well-founded data dependencies.  Redefine @integers@ in terms of this map-like function.
</pre>
</div>
<div title="2007-10-31" modifier="Conal Elliott" created="200711101639" tags="2007-10 day" changecount="2">
<pre>* [[Marshalling arrays| http://haskell.org/ghc/docs/latest/html/libraries/base/Foreign-Marshal-Array.html#v%3AwithArray]] -- probably useful for bitmap graphics.
* [[Core77 design magazine| http://core77.com]]
</pre>
</div>
<div title="2007-11" modifier="Conal Elliott" created="200801120319" tags="2007 November month" changecount="1">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2007-11-01" modifier="Conal Elliott" created="200711101640" tags="2007-11 day" changecount="1">
<pre>* Dense ++++
*  Getting more comfortable with QuickCheck.  Lots of testing and testing tools in place.
*  I re-discovered the problem of regular zoom-out pattern: no negatives.
*  Idea: don't assume that zooming out is well-defined without a specified direction.  Use the initial alternating zoom-out pattern, to cover all of //R//.  Oh, then I can't assume that the lower bound of an interval is a multiple of its width.  That assumption is important because the requests for arrays of pixels will be aligned with the pixel size.
*  Main @Dense@ interface: @fetch@ a stream of arrays of samples (perhaps averaged), given the facet size, lower bound, and count.  Returns the array stream and a repositioned @Dense@.
*  Maybe think of a @Dense@ representation this way: like a @BiStream@ (zipper), with decomposition and coalescing for log-time @seek@.  For instance, to a @next@ would move the current @BinTree@ into the previous context.  ... Oh, hmm.  If I break an tree in two, I have to hang onto the value part in addition to the two halves.
*  Or use a web instead of a zipper.  Give that a try.
  === 
* Tidbit from dons: ++++&gt;
I often use this in my cabal ghc-options:
   {{{ghc-options: -funbox-strict-fields -O2 -fasm -Wall -optl-Wl,-s}}}
the last runs ld's strip automatically.
  === 
* Replied to Joe M on the NVC-cert list, about &quot;giving&quot; &quot;empathy to a person who is using power over strategies to meet their need for security&quot;. +++&gt;
Hi Joe,

Some thoughts:

I'd watch out for any notion at all of &quot;giving&quot; empathy.  The word &quot;giving&quot; suggests that it's for the other person, which is dangerous territory.  In this case, I suspect there's something you're wanting for yourself.  If so, then trying to &quot;give&quot; anything is likely to confuse both of you.  I've sometimes &quot;given&quot; what I've heard aptly called &quot;empathy from Hell&quot;, when I try to use the outward *form* of empathic guesses, when there's really something I want for myself.  Blech!

I don't think your *empathy*, or even your empathic guesses, are triggering them, but rather your *expression* of those guesses to them, verbally.  It helps me to think of empathy as purely an internal state of being.  And one that happens or it doesn't.

Could it be that your desire to do the empathy form is a strategy for self-protection?  I think that's been the case for me.  And no wonder the results stank, given the fundamental incongruence between my inner desire and outer behavior.

I still harbor habitual judgments about &quot;power over&quot; strategies.  If I'm thinking in those terms, the other person is probably not going to enjoy being around me.  In those situations, I usually get scared, and by pathologizing the other person, I can take some of the sting out of what I'm hearing.  I also wonder if anything similar is going on for you.

Finally, the (perhaps pseudo-) needs of &quot;security&quot; and &quot;safety&quot; almost never warm my heart.  Lately I've been noting that warm/cold (open/closed) response in me and using it as a signal to keep looking until my heart genuinely opens.  Or, to choose to disconnect from the person and turn my attention elsewhere.  I don't really believe any of us has security/safety, in the sense that we can get physically, emotionally, financially clobbered at any time.  On the other hand, I do warm to the notion &quot;inner peace&quot;, which people usually seek by piling up conditional security (bank accounts, insurance policies, personal promises/commitments, etc).  I've noticed in NVC language, people often substitute these conditional strategies for deeper, universal needs.  A clue is the placement of a preposition after a Need word, such as &quot;trust that ...&quot; instead of &quot;Trust&quot; or &quot;integrity of ...&quot; instead of &quot;Integrity&quot;.  More on this difference at http://evolve.awakeningcompassion.com/?p=19 and the older posts linked there.

Warmly, - Conal
  === An addendum:  +++&gt;
Hi Joe.  Here's an after-thought:

If your best assessment is that (a) safety/security is up for them, and (b) you saying so will trigger them further into fear/insecurity, then I imagine that the strategy of verbalizing your guess to that person would be counter-productive for both of you.  I think that's what you're saying.   Empathy + silence is probably a better choice.  Or shift from empathy to honesty (carefully -- http://evolve.awakeningcompassion.com/?p=23 ).
 === Joe's message: +++&gt;
Dear NVC people,

I have always found it difficult to give empathy to someone who is in a &quot;power over&quot; strategy.  I'm guessing that the other person's  need is for security and safety.  But it seems like anything that I say that gets even close to identifying their true need as &quot;security &quot; and &quot;safety&quot; only further threatens their sense of security and safety even more and therefore is not heard as empathy but is heard as a suggestion of weakness. It seems to make them cling even more strongly to their power over strategy.

I have one person in my life who seems to use &quot;power over&quot; strategies to get their need for security and safety met.  When I guess that they may be feeling afraid because they want to feel safe and secure, it seems to only make them more adamant about having power.  I can't remember the empathy ever being effective.  I can't remember the empathy ever creating any relief or shift.  I can't remember empathy in this situation ever being welcomed or supportive.

It seems to me that empathy that identifies the need as &quot;security&quot; for a person who is insecure already, is really counterproductive.  The person who is insecure wants to look strong and doesn't want to hear about &quot;security or safety&quot;. I am almost ready to give up any attempt at giving empathy to a person who is in a power over strategy.  Am I missing something here?

I am interested in your comments, reactions, thoughts and theories about how to give empathy that is effective to a person who is using &quot;power over strategies&quot; to meet their basic need for security.
 === 
</pre>
</div>
<div title="2007-11-02" modifier="Conal Elliott" created="200711101641" tags="2007-11 day" changecount="1">
<pre>* Some Internet goodies ++++
*  [[Top 10 Free Video Rippers, Encoders, and Converters| http://feeds.gawker.com/~r/lifehacker/full/~3/177777292/top-10-free-video-rippers-encoders-and-converters-316478.php]]
*  [[Turn Any Action into a Keyboard Shortcut| http://feeds.gawker.com/~r/lifehacker/full/~3/177245342/turn-any-action-into-a-keyboard-shortcut-316589.php]]
*  [[easyVision: Haskell libraries for computer vision| http://alberrto.googlepages.com/easyvision]]
*  [[Frameless Rendering: Double Buffering Considered Harmful| http://www.citeulike.org/user/conal/article/1857392]]. Abstract: +++&gt;
The use of double-buffered displays, in which the previous image is displayed until the next image is complete, can impair the interactivity of systems that require tight coupling between the human user and the computer. We are experimenting with an alternate rendering strategy that computes each pixel based on the most recent input (i.e., view and object positions) and immediately updates the pixel on the display. We avoid the image tearing normally associated with single-buffered displays by randomizing the order in which pixels are updated. The resulting image sequences give the impression of moving continuously, with a rough approximation of motion blur, rather than jerking between discrete positions. 
We have demonstrated the effectiveness of this frameless rendering method with a simulation that shows conventional double-buffering side-by-side with frameless rendering. Both methods are allowed the same computation budget, but the double-buffered display only updates after all pixels are computed while the frameless rendering display updates pixels as they are computed. The frameless rendering display exhibits fluid motion while the double-buffered display jumps from frame to frame. The randomized sampling inherent in frameless rendering means that we cannot take advantage of image and object coherence properties that are important to current polygon renderers, but for renderers based on tracing independent rays the added cost is small. 
  === See also [[this summary| http://www.cs.utah.edu/~shirley/papers/rtrt/node4.html]] and this [[note from Kragen Sitaker| http://lists.canonical.org/pipermail/kragen-fw/2000-April/000201.html]].
  === 
* This Zen story from [[John Sullivan's home page| http://facstaff.elon.edu/sullivan]] touches me: ++++&gt;
A samurai warrior comes up to a little monk and says: Teach me about heaven and hell.  &quot;Teach you?&quot; the little monk replies, &quot;why you are a dirty, smelly, poor excuse for a samurai.  Even your sword is rusty!&quot; Insulted, the samurai, flush with anger, draws his sword and is about to cleave this insolent monk in two. A split second before he strikes, the monk says:  &quot;That's Hell.&quot;  The samurai has a moment of insight.  He realizes that this monk has gone to the very door of death to teach him.  He fills with gratitude, his body relaxes and he sheaths his sword.  At that precise moment, the monk says: &quot;That's Heaven.&quot;
  === The rest of his 9/12/2001 talk on Dante's //Inferno// is wonderful also.
* Dense (SpaceZip): ++++
*  Noodling interfaces.  Work from the outside inward, i.e., from the rendering application to the Dense library.  The app is an interactive viewer of infinite, continuous 2D images (think [[Pan| http://conal.net/Pan]] or [[Pajama| http://conal.net/Pajama]], but could be 3D-based as well).  The user pans and zooms arbitrarily and continuously.  After a model or view change, the client has to access another approximation stream of pixel arrays and start grabbing arrays from it.  The client's ideal pixel size won't generally be available, since Dense stores values only for power-of-two-sized intervals.  So the renderer will have to pick an available resolution and then do resampling.  I want the resampling to be both fast and smooth, probably done by 3D hardware.  Most of the time, we'll be grabbing (and hence lazily computing) more pixels than requested, rounding up to a power of two, and then interpolating.  Maybe the interpolation step is where I can also do sub-pixel shift.  Besides the mismatch between requested resolution and available ones, the requested pixel alignments don't match what's stored.  Since I have to deal with alignment mismatch anyway, maybe the odd alternating ascending zipper pattern is no additional problem.  Provide the specs of the ideal sampling and get back something close from the Dense rep, with a transformation to the ideal.  One transformation holds for all elements in the approximation stream.
*  Question for IRC when OpenGL folks are around: ++++
i'm wondering what sort of 2D image support openGL has. or even how to thing GL'ily about images.  textures on a quad?  other choices?
also, how best to get fast, good-looking image resampling (rescaling), with sub-pixel motion.
i'm working on a new representation for infinite continuous images etc (functions over an infinite continuous domain).
   === 
*  Looked in to OpenGL for image presentation.  I think there are two choices: (a) texture mapping, and (b) @drawPixels@.  From what I've read, the latter does no interpolation on scaling, so texture mapping with bilinear interpolation is the way to go.  (It has mipmapping and //tri//linear interpolation, but I don't think I'd use mipmap.  My approach is sort of infinite, zipper-based mipmaps -- &quot;zipmapping&quot;.  Or maybe mipmapping would be useful with my approach.)
*  3D hardware does other transformations, such as rotation.  Hm.
*  When I write up or talk about Dense, clearly express that it's about approximating the average value of a function over an interval (i.e., integral over size).  That's why I average sampled values.
*  Hm: when the user does a very small change to the view (or model?), do we really want to start over at a coarse approximation?  Doing so would make a visible discontinuity.  Try and see.
*  Hm: &quot;forward&quot; and &quot;back&quot; fit better than &quot;previous&quot; and &quot;next&quot; for bi-streams.  The latter two names sound like element accessors.  Or a counterpart to &quot;tail&quot;.
*  How does user input / space exploration relate to data-driven computation?  
  === 
* Switched to ghc-6.8.1.20071102 snapshot for win32.  Still doesn't come with GLUT, but I was able to build GLUT without problem.  Recompiling wxHaskell.
* Compiled &amp; ran an OpenGL program, after installing OpenGL and FreeGLUT from Cygwin.  Compile line: {{{gcc t1.c -lglut32 -lglu32 -lopengl32 -o t1.exe}}}.  (I found these {{{-l}}} options from building the Haskell GLUT package, which isn't pre-installed on the Windows snapshots.)  The compile line works without also the {{{-lglu}}}, which I found described [[here| http://dri.freedesktop.org/wiki/GLU?highlight=%28CategoryGlossary%29]]: ++++&gt;
Graphics Library Utilities (GLU)
OpenGL is good but doing some common operations is a regular pain in the proverbial. GLU is a platform independent library that can build spheres, perform collision detection, determine if a point is inside a 3D shape, etc. GLU works on top of OpenGL.
  === 
* Problems with GLUT &amp; ghc.  Lots of link-time errors when I ghc-compile.  With ghci, sample programs wedge the session.  Fortunately, the wxHaskell OpenGL demos work just fine.
</pre>
</div>
<div title="2007-11-03" modifier="Conal Elliott" created="200711101641" tags="2007-11 day" changecount="1">
<pre>* The Dense sampling pattern could be any number of sequences.  I could try some randomness.
* [[Chipmunk game dynamics| http://wiki.slembcke.net/main/published/Chipmunk]], which includes links to some nifty dynamics papers, including [[these ones| http://www.beosil.com/publications.html]]
* Thoughts about next week's Eros talks: ++++
*  Usability and composability appear to be at odds.  Perhaps the tension is an illusion.  Usability and composability are both supported by //interfaces// of different styles (IO/GUI vs types).  Look for a unifying notion of interfaces that combines the strengths of each.  Unix pipes is an effective &amp; limited attempt in this direction.  (Discuss.)  Others?
*  Interfaces describe and discipline the composition &quot;components&quot;, which may be software or human (etc), by enabling them to communicate, i.e., exchange information.  For GUIs, the composition is software/human, while for programming libraries, the composition is software/software.
*  Examples: terminal IO, GUIs, typed functions.
*  GUIs show us that interfaces can be user-friendly, while programming languages show us they can compose.  Let's do both!
*  Idea: loose decoupling of content and interface.
*  Give composition to the user
* &quot;Any sufficiently complicated C or Fortran program contains an ad hoc, informally-specified, bug-ridden, slow implementation of half of Common Lisp.&quot; Greenspun's Tenth Rule
  === 
</pre>
</div>
<div title="2007-11-04" modifier="Conal Elliott" modified="200711132008" created="200711101641" tags="2007-11 day" changecount="3">
<pre>* Idea: formally relate my denotational and operational models of events.  Formulate and test properties and equivalence via QuickCheck.
* Working on my new Eros talk.  New material: ++++
*  Usability and composability (applications and software libraries)
*  The Unix philosophy, according to Doug McIlroy.
*  Functional programming as modernized &amp; improved realization of Unix's &quot;principle of composition&quot;.
*  ...
*  What's functional programming?
  === Here's a possible new title: &quot;Tangible functional programming: a modern marriage of usability and composability&quot; or &quot;Tangible values: usable and composable&quot;.  Most programmers probably think of &quot;values&quot; as much less expressive than I mean.
* The Unix solution uses applies one interface style for use and composition.
* &quot;As commonly practiced, programming has a strong bias toward the left-brain creative mode, in that it's abstract, linguistic, and usually sequential.  (The last point applies much less to functional programming.)  Computation is an extremely powerful medium of communication, and the left-brain bias means that only some people have access to that medium.&quot;
</pre>
</div>
<div title="2007-11-10" modifier="Conal Elliott" created="200711132009" tags="2007-11 day" changecount="2">
<pre>* Back from the SF Bay Area, where I spoke at Google (Wed), Intel (Thu), and Apple (Fri).  My talks were well-received.  I could see clear, motivated interest better at Intel &amp; Apple (I&amp;A) than at Google.  Perhaps the difference had to do with having inside connections at I&amp;A, so that my visit was more specifically motivated.  Also, I&amp;A make computers, so they're concerned about parallel programming.  I also got a lot of stimulation from the conversations at I&amp;A.  I came away much more interested in ongoing working relationships.
* Leaf P and I played with an example of imperative code for a text-based interaction.  In rewriting it to functional form (&quot;genuinely&quot; functional, not IO), I tried something close to the pre-monad, stream-function style.  It was awkward.  An approach based on functional events could be simpler and more modular.  I don't remember the example precisely, so here's a variant, translated to Haskell with IO: ++++
\begin{code}
squares :: IO ()
squares = do putStr &quot;next number: &quot;
	     n &lt;- fmap read getLine
	     putStrLn $ &quot;square: &quot; ++ show (n*n)
	     when (n &lt; 100) squares
\end{code}
  === One functional variation would have type @[String] -&gt; [String]@, very like the pre-monad IO style.  The output mixes prompts and squares.  The connections between (a) input numbers &amp; squares and (b) prompt and entered numbers are not obvious.  So how about an FRP approach?  This example is all discrete, so use only events.  There's are output events for the the prompts and squares and one input event for the next entered number.  The prompt is always the same, so doesn't really carry any information.  The type is thus @Num a =&gt; Event a -&gt; (Event (), Event a)@.  Note some substantial improvements implied by this type: ++++
*  Modularity: any number type and any prompt or output labeling may be chosen later.
*  Since the semantics of events includes exact timing info, an event-based formulation will have well-defined timing semantics.
*  Since the type doesn't involve IO explicitly, nor strings, it is composable.
*  Similarly, input &amp; output can work in a variety of settings besides terminal IO, including GUIs and network transport.
  === Idea: use variants of list functions wherever possible for manipulating events, except a different @Monoid@ instance (merge rather than append).  Here's a new version.  ++++
\begin{code}
squares :: Num n =&gt; Event n -&gt; (Event (), Event n)
squares num = (prompt, sq)
 where
   -- Prompt initially and while the request is &lt; 100
   prompt = start `mappend` forget (takeWhile (&lt; 100) num')
   -- Numbers considered (and prompted for)
   num'   = takeUntil (not . (&lt; 100)) num
   -- Squares of those numbers
   sq     = fmap (^2) num'

-- Initialization event.  Occurs once.
start :: Event ()
 
forget :: Functor f =&gt; f a -&gt; f ()
forget = fmap (const ())
\end{code}
  === I'm not content with this code yet, mainly because of the repeated |(&lt; 100)| test.
* Here's another version of @squares@, using a boolean behavior (@running@): ++++
\begin{code}
squares :: forall n. Num n =&gt; Event n -&gt; (Event (), Event n)
squares num = (prompt, sq)
 where
   ok      = (&lt; 100)
   numOk   = fmap ok num
   okNum   = num `suchThat` ok
   prompt  = start `mappend` (forget numOk `whenE` running)
   running = True `stepper` numOk
   sq      = fmap (^2) okNum
\end{code}
  === Types: ++++
\begin{code}
   ok     :: n -&gt; Bool
   numOk  :: Event Bool
   okNum  :: Event n
   prompt :: Event ()
   sq     :: Event n
\end{code}
  ===
* Here's a different tack: use single-occurrence events that yield new events, like what's described for reactive behaviors on [[2007-10-10]].  Unfold a succession of events.  Each outgoing prompt event defines a single corresponding read event.  Each input event defines a corresponding write event and //possibly// a prompt event.  The first time @n &lt; 100@ fails, there will be no further prompt and so no further read or write.  Try it out
* Idea: The type @Occ a@ refers to a single occurrence, including the time.  Semantically, @Occ a = (Time,a)@, but we can't extract generally a precise time value before the event occurs.  The semantics of @Event a@ is @[Occ a]@, subject to the constraint that the occurrence times are monotonically non-decreasing.  One tool for making events: ++++
\begin{code}
unfoldE :: (b -&gt; Occ (a,b)) -&gt; b -&gt; Event a
\end{code}
  === Note the type @unfoldr :: forall b a. (b -&gt; Maybe (a, b)) -&gt; b -&gt; [a]@.  Can I use @unfoldr@ directly?  It's so close, especially if @Event a = [Occ a]@.  I'd need a @(b -&gt; Maybe (Occ a, b)@.  
</pre>
</div>
<div title="2007-11-11" modifier="Conal Elliott" created="200711132009" tags="2007-11 day" changecount="1">
<pre>* On my trip, I got more clear about my quest of eliminating all IO in Haskell programming, and the relationship of that quest to composability.  Make composition the central issue.  Explicit IO interferes with that goal.  Make sure that all IO is completely separated from functionality in an &quot;interface wrapper&quot; that can be altered and/or removed during composition.  In conventional programming style, interface and functionality are entangled in code, so composability is lost.
* Article: [[Computers, Networks and Education| http://www.squeakland.org/school/HTML/sci_amer_article/sci_amer_01.html]], by Alan Kay.  I love Alan's high-level vision and orientation.  And yet, his systems inflict sequentiality and discretness (in time and space).
</pre>
</div>
<div title="2007-11-12" modifier="Conal Elliott" created="200711132010" tags="2007-11 day" changecount="1">
<pre>* Note about equality and fairness to NVC-cert group. +++&gt;
For me, the notions of equality and fairness lack are neither strategies nor needs.  They lack the properties that make strategies and needs useful.  Stategies specify an action.  Needs are directly connected to surviving and thriving and are universal.  Instead, notions like equality and fairness (and most uses of respect and consideration) are closer to externally-rooted moralisms, which I understand as an attempt to survive and thrive through coercion.
 
For instance, if I have no food and you have plenty, I might think in terms of fairness, but really what I want is food.  Similarly, if I don't have the right to vote and you do, I might think I want equality, but really I want to survive and thrive, and I'm more likely to if I have some influence on policy.
 
I've listed many other such popular need-words at http://evolve.awakeningcompassion.com/?p=18 , suggesting that they're typically used as &quot;vague demands&quot;.
 
I don't know how to measure the depth of a need.  For me, some ways of thinking (and associated words) lead my heart to openness, my mind to clarity, and the path to joy &amp; fulfillment more illuminated.  Other ways of thinking leave my heart untouched or constricted, my mind confused, and the joyful path narrowed.  Ideas of equality &amp; fairness are in the latter camp.  They lead me away from living, direct connection with myself or another person, to moralisms and external standards.  On reflection, I don't have any notion of equality or fairness that makes sense to me.  I'd like to hear if anyone else has one that makes sense to them.
 === 
* Another response on &quot;consideration&quot;. +++&gt;
Hi John,
 
I often hear the term &quot;consideration&quot; as a need from people learning or teaching NVC, and always it comes across as a &quot;vague demand&quot; rather than as Life-rooted.  Mainly, I hear it as NVC-speak for &quot;You should focus on what I want you to&quot;, or &quot;You're too self-centered&quot;.
 
If you respond to your significant other's expression of need for &quot;consideration&quot; by guessing other needs, she may hear (and perhaps accurately) &quot;you're doing NVC wrong&quot;.  You might first share some honesty, such as &quot;I'd like to get more connected and inspired here.  Could we explore some more needs and see if that helps me?&quot;
 === 
* Another one, on &quot;racism&quot;. +++&gt;
I haven't been satisfied with any of the suggestions for delving into the beautiful, life-serving core of racism.  Nor have I been inspired to much clarity and connection with the question myself.  Maybe the reason is that the discussion and my own thinking have kept racism at a distance -- in other words seeing it as something going on in other people but not ourselves.  Perhaps getting to the lovely heart of racism will require owning and sharing our own racism.  Here's a go for myself.

This summer I visited my son Jake in Chicago.  He was living in a predominantly poor neighborhood.  I was on edge for the first day or two, worrying about my car getting broken into or getting mugged at night.  And I noticed that almost everyone in the neighborhood looked Mexican.  So what can I say about my own fear and negative expectations in that setting?  I guess I imagine these people struggling for survival while seeing others like myself with much easier lives.  I imagine that after a while, out of desperation, the people struggling give up on the dream of being cared for and supported by society and decide to balance matters by taking care of themselves at others' expense.

So, perhaps racism (classism really, but class &amp; race are correlated) in me is a fear borne of the current out-of-balance society, in which my group's needs get taken care of much better than some others.  Specifically, from fear that a shift toward balance will come at my group's expense.  Going deeper, I notice that I really enjoy giving to those more on the survival edge than I am.  So perhaps my fear is really that I'll be taken from, without choice in the matter.

My request is for you to search yourself for racism and share what you find.
  === 
* Abstract for paper on Dense work: ++++&gt;
Although functional programming languages support programming with functions as first class values, they also penalize the programmer for doing so.  Lazy evaluation caches components of //data structures// but not functions.  One partial solution is automatic memoization of functions, but the memo table is a one-size-fits-all data representation that lacks the efficiency of more specifically targeted representations.  Moreover, memoization is not very useful for functions over continuous domains, in which exact cache hits are rare.  This paper proposes another approach: a countably infinite data structure representing a function by a //dense// collection of samples.  Sampling yields an infinite stream of successive approximations instead of a single precise value.  Where the sampled function is continuous, the stream converges to the function's value at the sample point.  More powerfully, one can sample over an //interval//, yielding an approximation stream converging to the average value over that interval.  This interval interface is particularly useful for rendering images (e.g., from 2D or 3D models) and animations into discrete space and time samples (pixel arrays and frame sequences).  For these uses, interval-based sampling yields visually smooth, anti-aliased results, including motion blur.  In interactive settings, with bounded computation time based on frame rate and machine load, approximation streams enable a simple means of progressive refinement.  An initial rough approximation comes up quickly and is refined to smoother and more accurate versions as time allows.  Moreover, the representation shares a great deal of work between anti-aliasing views and zoomed-in views, as well as between an image and slightly moved or scaled variations, as is common in interactive exploration.
 === Possible working title: &quot;Lazy continuous functions&quot;.  Not entirely accurate, since it applies to non-continuous functions over continuous domains, but makes stronger convergence guarantees about continuous functions.
* More Dense ideas: ++++
*  Progressive accuracy in computation, e.g., fixnum, floats, doubles, bigfloats.
*  Use progressively more terms from a Taylor series.
*  Relax the sampling pattern.  Given an interval //I//, compute (an approximation of) //f(x)// for some //x// in //I//, but not necessarily for the midpoint of //I//.
*  What properties are required of //f// to insure that the interval approximation stream converges to the average value?  For instance, //f// could yield 0 for rational (or algebraic) numbers and 1 for irrational (or transcendental).  In my implementation, every sampling would give 0, although the function is equal to 1 almost everywhere.
  === 
* What's a simple, efficient data structure for an infinite 1D array, i.e., quick index-based access, but sequential access is not important.  One idea: an infinite binary tree.  How to convert an index to a path in the tree?  Use the bits from the number's binary representation.  Except for zero, we can assume that every number has 1 as its msb.  So to encode a natural number n, form the sequence of bits of n+1, drop the msb, and use the result as the tree path.  Let @bits@ computes these bits, starting with the least significant and dropping the msb 1.  Examples: @path 0 == bits 1 == []@, @path 1 == bits 2 == [0]@, @path 2 == bits 3 == [1]@, @path 3 == bits 4 == [0,0]@, @path 4 == bits 5 == [1,0]@.  The tree fills up a level at a time, as the inverse of a breadth-first enumeration.  Is index-based sampling really enough?  I also want to build these indexable streams (infinite arrays) inductively.  Specifically, each interval in my Dense structure will have an infinite array of approximation streams of regular arrays.  The //i//th stream contains 2^^//i//^^-element arrays.  First build a regular inductive stream and then convert to an indexable stream.  How to convert?  Lots of [[discussion on #haskell| http://tunes.org/~nef/logs/haskell/07.11.12]], starting at 19:45:11.
* See chapter 9 of Chris Okasaki's &quot;Purely Functional Data Structures&quot; for related &quot;numerical representations&quot;.
</pre>
</div>
<div title="2007-11-13" modifier="Conal Elliott" created="200711141715" tags="2007-11 day" changecount="1">
<pre>* Dense: ++++
*  Instead of a single 2D array per view, make a bunch of them, all with power-of-two sizes.  Nice match for efficient (required?) power-of-two sizes of OpenGL texture maps.  Simplifies my implementation work as well.  Come up with a scheme for managing texture memory.  Look at computing the textures concurrently.
*  Besides power-of-two size, have the starting position be a multiple of the size (as in my @Data.PInv@ module).
*  Here's an idea for exploiting symmetry.  Change back to the simpler sampling pattern that only covers positive domain values.  Use a two-halved representation: //f x// and //f (-x)// for positive //x//.  Treat symmetric functions specially, by sharing a single zipper.  I guess I'd have to have a flag in there in order to preserve sharing.  Or an alternative constructor with only one zipper instead of two.  For instance, define @abs@ with explicit sharing and then @fmap@ functions over it.  Make sure that @fmap@ and friends (@&lt;*&gt;@) preserve the sharing.  Maybe this trick can be generalized to handle other simple relationships to avoid redundant computation.
*  The progressive approximation arrays for a given image patch (//2^^n^^// by //2^^n^^//) don't have to have all the same size.  I could start with 1-by-1 and continue to subdivide until I get to roughly screen resolution (rounded down to a power of two), and then refine quality at that level.  Probably not worth doing, however.
  === 
* Art Mills fixed the spring today.  Both the overflow pipe, which Joseph &amp; I worked on, and the outflow pipe at the bottom of the cistern were blocked.  The overflow pipe is only about 8 inches long and was jammed into the earth.  I imagine it used to be exposed.  I think Art added some length so it won't get covered up again.  The outflow pipe at the bottom of the cistern was also plugged up.  Art had to cut that pipe in order to get it cleared out, which he accomplished.  Water is now flowing freely.  I'll check the tank level in the morning.  The next steps Art recommended are to (a) clean the cistern well so it doesn't reclog (much easier now that it drains continuously) and (b) replace the rotten framing of the cistern door.  He left the pipes uncovered, so we'll be able to see how it's all put together. 
</pre>
</div>
<div title="2007-11-14" modifier="Conal Elliott" created="200711240419" tags="2007-11 day" changecount="1">
<pre>* Reading up on OpenGL.
* Adding interactive pan &amp; zoom to the Eros image viewer.  Panning was easy.  For zooming, two challenges arise: ++++
*  Distinguish between drag and shift-drag.
*  When zooming, I think I want to zoom around the mouse-down point.  That constraint makes for a somewhat tricky reactive interaction.  I've implemented this interaction before, including in Pan and in the two-handed navigation Fran app.  I'm uncomfortable about going further with the reactivity algebra I have set up.
  === 
</pre>
</div>
<div title="2007-11-15" modifier="Conal Elliott" created="200711240419" tags="2007-11 day" changecount="1">
<pre>* [[Ontology is Overrated: Categories, Links, and Tags| http://www.shirky.com/writings/ontology_overrated.html]], by Clay Shirky.  Quotes: ++++
&gt; One of the problem users have with categories is that when we do head-to-head tests -- we describe something and then we ask users to guess how we described it -- there's a very poor match. 

&gt; The reason we know SUVs are a light truck instead of a car is that the Government says they're a light truck. This is voodoo categorization, where acting on the model changes the world [...].

&gt; It comes down ultimately to a question of philosophy. Does the world make sense or do we make sense of the world? If you believe the world makes sense, then anyone who tries to make sense of the world differently than you is presenting you with a situation that needs to be reconciled formally, because if you get it wrong, you're getting it wrong about the real world.
  === 
* Thinking yet again about reactivity and interactivity.  I can probably get rid of the IO in DataDriven and Phooey if I go to an arrow-friendly, Yampa-like model.  Remember the principle of //internal// reactivity (from [[2007-10-12]]).  (Also revisit the single-occurrence model of events.)  How does the mouse and keyboard get converted into model sensory info?  There are probably two answers: an outer one and an inner one.  The outer answer says how to package up the behavior with an input signal to create an output signal (using Yampa terms).  The inner answer says how to alter the input compositionally.
* Implemented panning &amp; zooming in my Eros image viewer.  Came out elegantly.
* How will composition work in my dense representation?  Compose functions or compose dense samplers?  I could keep the function together with the dense sampler or discard the function.  Idea: discard the function but have rewrite rules that composes the functions. ++++
\begin{code}
dense :: (Double -&gt; a) -&gt; Dense a
{-# RULES
  &quot;dense &lt;*&gt;&quot; forall ff af . dense ff &lt;*&gt; dense af = dense (ff &lt;*&gt; af)  
  #-}

\end{code}
  === What will ghc's rewriter do when a @dense@ application gets used more than once?  Find out.
* Hm.  When defining @&lt;*&gt;@ on @Dense@, I'd like to encode shape-matching in the types.  This issue comes up for the @BinTree@ context (@Ctx@), which records whether a @BinTree@ is the left or right child.  Also with the resolution streams, in which the arrays have matching resolution.
* Recall Chris Okasaki's [[From fast exponentiation to square matrices: an adventure in types| http://www.citeulike.org/user/conal/article/1857246]].  He used a nested type for square matrices of size //2^^n^^// and then extended to general square matrices by encoding the fast exponentiation algorithm into types.  Try to do something similar.  Start with my resolution streams.  Currently: ++++
\begin{code}
-- nth element has size 2^n
type ResStream a = Stream (Array Int a)
\end{code}
  === Here's a variation that statically enforces the size constraint: ++++
\begin{code}
data ResStream a = RS a (ResStream (a,a))
\end{code}
  === 
* Equivalently, here are binary trees using nested types: ++++
\begin{code}
data Pair a = Pair a a

instance Functor Pair where
  fmap f (Pair a b) = Pair (f a) (f b)

instance Applicative Pair where
  pure a = Pair a a
  Pair f g &lt;*&gt; Pair a b = Pair (f a) (g b)

data BinTree a = BinTree a (BinTree (Pair a))

instance Functor BinTree where
  fmap f (BinTree a p) = BinTree (f a) ((fmap.fmap) f p)

instance Applicative BinTree where
  pure a = t where t = BinTree a ((pure.pure) a)
  BinTree f fp &lt;*&gt; BinTree x fx =
    BinTree (f x) (liftA2 (&lt;*&gt;) fp fx)
\end{code}
  === There's a reference to a similar type in [[Perfect trees and bit-reversal permutations| http://www.citeulike.org/user/conal/article/1925076]].  See also [[Numerical Representations as Higher-Order Nested Types| http://www.citeulike.org/user/conal/article/1925085]].  Both by Ralf Hinze.
* Imitating generic tries, define a type family for dense function representations.  Both are efficient data representations of functions.  Is there a common generalization?
</pre>
</div>
<div title="2007-11-17" modifier="Conal Elliott" created="200711240420" tags="2007-11 day" changecount="2">
<pre>* Abstract the pairing out of binary trees.  Top-down and bottom-up: ++++
\begin{code}
data TreeT f a = TreeT a (f (TreeT f a))
data TreeB f a = TreeB a (TreeB f (f a))
\end{code}
  === Binary trees: ++++
\begin{code}
type BinTreeB = TreeB Pair
type BinTreeT = TreeT Pair
\end{code}
  === The @Functor@ and @Applicative@ instances are exactly the same for @TreeT@ and @TreeB@.  For instance, ++++
\begin{code}
instance Functor f =&gt; Functor (TreeT f) where
  fmap h (TreeT a p) = TreeT (h a) ((fmap.fmap) h p)

instance Applicative f =&gt; Applicative (TreeT f) where
  pure a = t where t = TreeT a ((pure.pure) a)
  TreeT f fp &lt;*&gt; TreeT x xp =
    TreeT (f x) (liftA2 (&lt;*&gt;) fp xp)
\end{code}
  === See [[De Bruijn Notation as a Nested Datatype| http://www.citeulike.org/user/conal/article/1930769]].  We can also simplify the instances by using explicit type composition. ++++
\begin{code}
data TreeT' f a = TreeT' a ((f `O` TreeT' f) a)

instance Functor f =&gt; Functor (TreeT' f) where
  fmap h (TreeT' a p) = TreeT' (h a) (fmap h p)

instance Applicative f =&gt; Applicative (TreeT' f) where
  pure a = t where t = TreeT' a (pure a)
  TreeT' f fp &lt;*&gt; TreeT' x xp = TreeT' (f x) (fp &lt;*&gt; xp)
\end{code}
   === Similarly for @TreeB'@.  We could do many more variations:  ++++
\begin{code}
-- Rose trees: top-down &amp; bottom-up
type RoseT = TreeT' []
type RoseB = TreeB' []

-- Possibly finite, binary trees:
type FinBinT = TreeT' (Maybe `O` Pair)
type FinBinB = TreeB' (Maybe `O` Pair)
\end{code}
  === 
* Goal: make a version of bottom-up binary trees with low-level arrays representing the levels, in exactly the format that OpenGL can consume for efficient texture generation.  Idea: use the @binary@ library.  Another idea: type families. 
* See Chris Okasaki's [[Purely Functional Random-Access Lists| http://citeseer.ist.psu.edu/okasaki95purely.html]] and Ralf Hinze's [[Bootstrapping One-sided Flexible Arrays| http://citeseer.ist.psu.edu/hinze02bootstrapping.html]].  Maybe I could use one of them as the core piece of my dense representation. 
</pre>
</div>
<div title="2007-11-19" modifier="Conal Elliott" created="200711240422" tags="2007-11 day" changecount="1">
<pre>* Remember sjanssen's paste: [[a lazy trie| http://hpaste.org/3839]].
* Reply to Leaf P on separating IO and pure computation: +++
Here's a re-rendering in Haskell, to make the pure-vs-IO disinction clearer.  I've generalized a bit, to work on any readable input type and any showable output type.
\begin{code}
computeIO :: (Read i, Show o) =&gt; (i-&gt;o) -&gt; (i -&gt; Bool) -&gt; IO ()
computeIO f done = loop
 where
   loop = do putStr &quot;next value: &quot;
	     i &lt;- fmap read getLine
	     putStrLn $ &quot;result: &quot; ++ show (f i)
	     unless (done i) loop
\end{code}
I'd like to get at an essence behind the imperative code, that is more composable, has no accidental sequentiality, and from which the imperative code can be derived as a sort of compilation or trace.

A functional event/stream model seems promising to me.  I suggested one on the whiteboard, namely a function from one lazy list to another, but neither of us was really satisfied.  A more composable approach would perhaps be to add timing info to the stream model, yielding functional events (as in functional reactive programming).  The user produces an event stream of integers, and the code produces two event streams: ready (prompt), and a computed square.  Thus the type:
\begin{code}
computeE :: (i-&gt;o) -&gt; (i -&gt; Bool) -&gt; EStream i -&gt; (EStream (), EStream o)
\end{code}
Semantically, an EStream is just a stream of time-stamped values.

Note that this compute interface is substantially more composable than the imperative version:
* The prompt and output labeling are factored out and may be chosen later.
* Because we're using values (i and o) instead of human-oriented encodings (strings), we can compose conveniently and efficiently with other producers &amp; consumers.
* Because we've eliminated IO, these compositions can be fused (deforested), eliminating intermediate streams.
* For the same reason, input &amp; output can work in a variety of settings besides terminal IO, including GUIs and network transport.

There's also an isomorphic type that joins the prompt &amp; compute events streams into a single sum-valued stream:
\begin{code}
computeE' :: (i-&gt;o) -&gt; (i -&gt; Bool) -&gt; EStream i -&gt; EStream (Either () o)
\end{code}
which is suggestive of a high-level abstraction of stream processors:
\begin{code}
  computeSP :: (i-&gt;o) -&gt; (i -&gt; Bool) -&gt; StreamP i (Either () o)
\end{code}
</pre>
</div>
<div title="2007-11-20" modifier="Conal Elliott" created="200711240423" tags="2007-11 day" changecount="2">
<pre>* [[OpenGL masking tutorial| http://www.zeuscmd.com/tutorials/opengles/23-Masking.php]]
* My Google techtalk is up [[on YouTube| http://www.youtube.com/watch?v=faJ8N0giqzw]]
* newsham pointed me to [[Rc -- The Plan 9 Shell| http://plan9.bell-labs.com/sys/doc/rc.pdf]] and [[Reaktor| http://en.wikipedia.org/wiki/Reaktor]] as related.
* Installing Ubuntu on my old laptop.  Misc notes: ++++
*  My wireless card is recognized but isn't connecting to my wap
*  Installing emacs.  There are several choices, including &quot;emacs22&quot; and &quot;emacs22-gtk&quot;.  Trying the first one (&quot;sudo apt-get install emacs&quot;).  Try the second one later.
*  [[Ubuntu 7.10 (Gutsy Gibbon) guide (wiki)| http://ubuntuguide.org/wiki/Ubuntu:Gutsy]]
*  Edited my list of repositories, via the [[manual method| http://ubuntuguide.org/wiki/Ubuntu:Gutsy#Manual_Method]].  Now I see I could have used the [[Menu Method| http://ubuntuguide.org/wiki/Ubuntu:Gutsy#Menu_Method]].
*  Yoiks!  My satellite bandwidth monitor shows I slurped 507MB today.  The graph looks like I'm over my 7-day 1GB limit, which is punishable by dial-up speed.  The rolling summary says I've used only 481MB for the last 7 days.  Hm.  I really have to watch it.
  === 
* I posted note for my technical blog about the techtalk, and dons [[posted it to prog.reddit| http://programming.reddit.com/goto?id=6135x]].</pre>
</div>
<div title="2007-11-21" modifier="Conal Elliott" created="200711240423" tags="2007-11 day" changecount="1">
<pre>* OpenGL: ++++
*  Found [[this note about texture caching| http://www.geocities.com/SiliconValley/Park/5625/opengl]]: &quot;in version 1.1 and higher of the OpenGL spec, we can use a method for creating texture objects, which in most good drivers, should be cached and uploaded/downloaded from card memory automatically. The days of manual texture caching are over.&quot;
  === 
* Performance study (-ddump-simpl) &amp; tuning on my OpenGL-based Pan-like code.  I eliminated boxing of number parameters.  Still had lots of allocation, which turned out to be from the &quot;floor&quot; function.  I defined my own, using truncate, which rewrites to a primitive for Float-&gt;Int, and I got a ghc panic.  Narrowed down the problem and reported as ghc bug ticket #1916.

</pre>
</div>
<div title="2007-11-22" modifier="Conal Elliott" created="200711240423" tags="2007-11 day" changecount="1">
<pre>* Starband smack-down!  While getting Ubuntu updates and watching my Google tech talk, I went 500MB over my 1GB 7-day rolling download limit.  Now I'm dropped to 100Kbps (from 512Kbps max) until I get down to 750MB, which will be three or four days if I'm very frugal.  I tried calling to beg, but they're closed for Thanksgiving.
* When I have more bandwidth, check out [[Don't fear the Monads! (functions, composition, monoids, monads)| http://programming.reddit.com/info/617p6]].
* GHC bug #1916 (see [[2007-11-21]]) got fixed quickly.
</pre>
</div>
<div title="2007-11-23" modifier="Conal Elliott" modified="200711241808" created="200711241807" tags="2007-11 day" changecount="3">
<pre>* I called Starband tech support about having gone over my limit and getting bounced down to 100kbps.  I talked with Mario, explained best I knew what had happened, and he reset it for me.  He also told me about down2home, made by [[JITServ| http://jitserv.coolfreepage.com]], which monitors and presents data on download &amp; upload.  Will be very helpful.
* Reply to a blog post by Osfareman, [[Haskell snippet - recursive average| http://osfameron.vox.com/library/post/haskell-snippet---recursive-average.html]] +++
Related problem: calculate a list of the averages so far. Now make sure it works for infinite lists. You'll probably want a one-pass algorithm. :)

Extra twist: assume fairly low precision arithmetic, and keep the computed numbers all within the range of sizes of the values seen, to avoid overflow or accuracy loss. Particularly, make sure that if the input numbers are all non-negative, then the auxiliary values are also.

These requirements come up in graphics computations, where pixel values are often represented as three or four 8-bit fixed point, non-negative numbers (24-bit color with optional transparency). Anti-aliasing can be done by sampling the underlying continuous image at several points within a pixel and averaging the results. By calculating a stream of averages-so-far, the results can be shown as they come available. That way, rough results come up quickly and then get nicely smoothed as you watch. For example, see [[Pajama| http://conal.net/Pajama]].
 === 
* [[Postmaster ESMTP Server| http://postmaster.cryp.to]]: a super-configurable mail server in Haskell.
* Progress with OpenGL.  I'm very happy with the pixel sampling loops.  With the image @const True@, I get 100 Mpix/sec.  With @rings@, I get 2 Mpix/sec.  It does square roots and allocates, due to @floor@.  I'll stop using @floor@ when I get a fixed GHC that doesn't panic on @truncate@ with optimization.
* Dense:  ++++
*  I don't know if I can get good performance if I start with single-pixel arrays and recursively combine into larger.  Try something very simple: use textures of a fixed array size, say 128x128 or 256x256.  For each sampling resolution, have an @IntMap@ (Patricia tree) of @IntMap@s of approximation streams of blocks.
*  Patricia trees may well be a sub-optimal data structure, considering how restrained an interface I use.  I think I have a sort of comprehension (@:: (Int -&gt; a) -&gt; IntMap a@) and the inverse (@:: IntMap a -&gt; (Int -&gt; a)@).  Hm.  Really, I use the composition of these two, which is just an @Int -&gt; a@ memoizer, @intMemo :: (Int -&gt; a) -&gt; (Int -&gt; a)@.  I could even extend to @Integer@ or something polymorphic.  I could even use the generic @memo@ or a trie.
*  For basic sampling, make a function that takes an image and renders a unit-square section of it (from (0,0) to (1,1)) at a fixed resolution.  For the different sections and resolutions, just scale and translate the image and pass into the unit sampler.  Make sure that samplings never use the same points, so that each level contributes new information for anti-aliasing.  How?  Sample at the centers of the squares within the unit square.
  === 
* [[Creating a basic compiler for numeric expressions in Haskell| http://reddit.com/goto?rss=true&amp;id=t3_6189y]].
* [[Efficient tree data structure for maps from Int to somewhere| http://haskell.org/haskellwiki/Memoization]].  Infinite binary tree indexed by little-endian binary representation.
</pre>
</div>
<div title="2007-11-24" modifier="Conal Elliott" modified="200711261527" created="200711251742" tags="2007-11 day" changecount="3">
<pre>* [[Moebius Transformations Revealed| http://www.youtube.com/watch?v=JX3VmDgiFnY]].  Lovely!  And note the [[music source| http://www.musopen.com]].
* Here's a simpler way to think about my Dense representation: write as a recursive function, and then memoize (@memoFix@).  The function takes an integer size exponent //r//, integer coordinates of a square //(i,j)// (with lower-left corner //(2^^r^^*i,2^^r^^*j)//), and samples a given function //f//.  I'd been thinking of my approach as an alternative to memoization for functions of continuous domains.  I like that it can work via memoization over a related discrete domain.
* Oops: there's a conflict in my current plan.  I want to compute largish blocks at a time (say 128x128), //and// i want each new sampling for the approximation stream to take about the same time to produce.  My previous plan had been to produce sample blocks of size //2^^r^^// square for //r = 0, 1, ...//, for each sub-square.  The //(r+1)^^th^^// block comes from combining the //r^^th^^// block for each of the four sub-squares.  In this scheme, only the //0^^th^^// blocks, with only one sample each, are sampled from the function itself.  On the other hand, it does give me a regular succession of resamplings for anti-aliasing.
* Here's an idea for resolving this dilemma.  Stick with a fixed block size, but reduce the block size to something like //32x32// pixels.  Small enough that we needn't bother avoiding computing some extra.  Oh.  Doesn't really solve the problem.  With a fixed block size, I don't know how to get the gradual anti-aliasing //and// share computation with the subdivided squares.</pre>
</div>
<div title="2007-11-25" modifier="Conal Elliott" modified="200712020148" created="200711261528" tags="2007-11 day" changecount="3">
<pre>* Besides Dense, what other ideas/projects do I have going? ++++
*  Alternative to IO.
*  FRP with modular interaction
*  Data-driven without IO (probably related to previous)
*  FRP via threads &amp; blocking (RNF)
*  Eros: ++++
*   How to animate fusion?
*   Code generation
*   Polymorphism
*   Recursion
*   Editing
   === 
  === 
* A new idea for my Dense dilemma.  Compute my samplings differently, depending on whether inspection happens bottom-up or top-down (i.e., whether we render a square before or after its sub-squares).  Note that the second through fifth samplings for a square are closely related to the first samplings for each of the four sub-squares.  They're rearrangements of each other.  The problem is that I don't know which one to compute directly and which indirectly, in terms of the other.  If I'm working top-down, I'll want to compute samplings 2-5 and rearrange them into samplings of the four sub-squares.  That way, I get intermediate results at regular intervals for the square being rendered.  Each of four sub-squares will get its first sample very quicky, by rearrangement.  On the other hand, if I'm working bottom-up, I'll want to compute just the visible squares, not all squares in the parent, so compute samplings 2-5 and rearrange them into samplings of the four sub-squares.  Now here's the idea.  Define an encapsulation that holds two lazy values, each described (a) directly, and (b) cheaply as a function of the other.  Internally, whichever value is accessed first is computed directly, and the other indirectly. ++++
\begin{code}
vp :: a -&gt; b -&gt; (b-&gt;a) -&gt; (a-&gt;b) -&gt; (a,b)
vp a b af bf = unsafePerformIO $
  mdo refa &lt;- mk a b af bf refa refb
      refb &lt;- mk b a bf af refb refa
      return ( unsafeRead refa
	     , unsafeRead refb )
 where
   unsafeRead = unsafePerformIO . readIORef
   mk :: c -&gt; d -&gt; (d-&gt;c) -&gt; (c-&gt;d) -&gt; IORef c -&gt; IORef d -&gt; IO (IORef c)
   mk c d cf df refc refd =
     newIORef $ unsafePerformIO $
	        do writeIORef refc c
                   writeIORef refd (df c)
                   return c
\end{code}
  === Alternatively, I could do a purely functional implementation with a different interface.  Make an opaque pairing, and have the two accessors return a new pairing as well as value.
* [[Shape Modeling and Computer Graphics with Real Functions| http://www.hyperfun.org/F-rep.html]]
* When people adopt a new programming languages, it's usually because either (a) the language fits their inclinations, or (b) the language works well for an app they care about.  What would the latter be for NVC?  We say it's joyful giving and deep needs met fully.  What's a more concrete app or a more concrete expression of that app?
* [[Plugging a Space Leak with an Arrow| http://www.cs.yale.edu/~hl293/download/leak.pdf]]
</pre>
</div>
<div title="2007-11-26" modifier="Conal Elliott" created="200712020148" tags="2007-11 day" changecount="1">
<pre>* Here's another angle on my Dense puzzle. ++++
Each 2D sampling array can be built in a five different methods: ++++
*  Directly sample the function
*  Stick together four lower-resolution arrays for the child intervals
*  Extract one quarter of a higher-resolution sampling of the parent interval
*  Weave together four lower-resolution, offset arrays for the given interval
*  Extract one quarter of the unweavings of a higher-resolution sampling of the given interval.
  === 
Assign a dynamic cost estimate to each method, in a data-dependency network (e.g., using [[DataDriven| http://haskell.org/haskellwiki/DataDriven]]).  The cost of one of these multi-way values is (dynamically) the minimum of of the costs of the methods, plus a bit for overhead.  Extract values greedily, i.e., use the current minimum-cost method.  When a value gets computed, the multi-way cost changes to zero (or a small epsilon), resulting in recomputation of all related costs.  Some questions: ++++
*  Does cost refer to the cost of reducing to WHNF?
*  How to combine these costed values?  Can I use @Applicative@?  Assuming a strictness, the cost of @f a@ is the sum of the costs of @f@ and @a@, and the cost of application.  The latter cost would depend on some static information about @f@ and @a@.  In particular, array size determines the cost of splitting &amp; combining, and influences the cost of sampling.
*  For sampling, the function being sampled has a bounded cost per sample, and the overall cost is the single-sample cost times the size of the array, plus some overhead.  We might measure the per-sample cost as we go, or construct the cost while constructing the function itself.
*  Maybe I could use the @DeepArrow@ algebra to build up costs, along with functionality, types, code, UI, etc.  Importantly, the cost of @dup@ is nearly zero.
*  How to even talk about 
   === 
Maybe also manage memory costs of keeping values in computed form.
  === 
* Try something simple for now with my images: a memoized function from resolution and region index to a single texture block.  That much is already better than what I have in Eros.  I can even do some anti-aliasing simply by choosing bigger textures than necessary and shrinking them down.
* OpenGL manages texture memory automatically, so I don't have to.  See OpenGL &quot;red book&quot;, chapter 9. +++&gt;
If texture objects have equal priority, typical implementations of OpenGL apply a least recently used (LRU) strategy to decide which texture objects to move out of the working set. If you know that your OpenGL implementation has this behavior, then having equal priorities for all texture objects creates a reasonable LRU system for reallocating texture resources.
  === 
* How to render from sampled chunks: ++++
*  Given: cumulative scale &amp; translation, window width &amp; height (in pixels).
*  Return: a composite rendering action, combining texture &amp; and quads.
*  Use direct coordinates everywhere.  No transformations.  Except, perhaps, for moving the origin to the center of the window.
*  How to enumerate the relevant 2D intervals?
  === 
</pre>
</div>
<div title="2007-11-27" modifier="Conal Elliott" created="200712020149" tags="2007-11 day" changecount="1">
<pre>* Starting a new Haskell project: &quot;Piq&quot;.  It's functional images yet again.  I want it to be as fast as possible while using GHC compilation and my new approach to infinite, continuous images. ++++
*  Description: //Piq// is a yet another take on continuous, infinite images, in the spirit of [[Pan| http://conal.net/Pan]].  Unlike Pan, Piq (a) relies on a Haskell compiler for optimized compilation, and (b) uses a lazy infinite /data/ representation, in order share lots of work between views.
*  Use @Complex Float@ rather than @(R,R)@ or @Vector@.  Play with the many operations that come along with @Complex@, particularly the numeric instances.  @Complex@ keeps its components unboxed.
*  Yum -- using @Complex@ works out //very// nicely in simplifying basic definitions. ++++
\begin{code}
-- Warp an image by /the inverse/ of a warp
warpIm :: Warp -&gt; Filter a
warpIm w = inImage (. w)

translate :: C -&gt; Filter a
translate d = warpIm (subtract d)

uscale :: R -&gt; Filter a
uscale s = warpIm (^/ s)

rotate :: R -&gt; Filter a
rotate theta = warpIm (cis (-theta) *)
\end{code}
   === Oh!  Better yet: ++++
\begin{code}
rotC :: R -&gt; C -&gt; C
rotC theta = (cis theta *)

translate = warpIm . (+)  . negate
uscale    = warpIm . (*^) . recip
rotate    = warpIm . rotC . negate
\end{code}
   === Hah!  Lovely!  Other parameterized spatial filters can follow the same formula.  Hm.  Maybe there's a nice abstraction to be teased out.
  === 
* Haskell programming tip: use {{{ghc --supported-languages}}} to get the list of supported {{{LANGUAGE}}} pragma options.
* Note on needs: +++&gt;
Hi Matthew,

Thanks for sharing your experience with us.  I'm especially touched with the exchange in the section your called &quot;Dancing between empathy and expression&quot;.

Of the four needs you listed, I connect with and believe safety.  The others I hear more as in the realm of strategies or even &quot;vague demands&quot;.  (Please see &quot;Distinguishing needs from vague demands&quot; and related posts at the &quot;NVC Evolves&quot; blog -- http://evolve.awakeningcompassion.com/ .)  I suspect that the others (&quot;to be heard&quot;, &quot;understanding&quot;, and &quot;Trust&quot;) all are your strategies to address safety and perhaps some other of your needs not listed.  I wonder if &quot;to be heard&quot; and &quot;trust&quot; are really NVC-sounding ways to avoid saying you wanted prompt obedience, and I wonder if you might like prompt obedience in order to serve your needs for safety, with enough of your energy and focus left over to meet your needs for making life wonderful for yourself and those around you.

About &quot;trust&quot; in particular, I'm guessing you mean what I call &quot;trust that&quot;, as opposed to &quot;Trust&quot;.  The former is a conditional strategy, while the latter is unconditional state of presence &amp; peace.  Please see &quot;Trust vs Trust that ...&quot; and &quot;Trust that ...&quot; in the NVC Evolves blog for more description.  

I'd love to hear back from you (Matthew) and others.  For instance, do you get more easily into a state of clear mind and open heart with the &quot;safety&quot; issue, and more of a muddle and a constriction with the other three (as do I)?  Do you find that there were some old authority/domination habits masqueraded by NVC language?

Warmly &amp; gratefully,  - Conal
 === 
</pre>
</div>
<div title="2007-11-28" modifier="Conal Elliott" created="200712020151" tags="2007-11 day" changecount="2">
<pre>* Hm -- maybe move my @Image@ type from namespace @Graphics@ to @Data@.  After all, I want people to think of images as values.  Really -- everything could go into @Data@ for this same reason.  Maybe save it for things with simple semantics.
* From the GHC.Float.hs: ++++
\begin{code}
instance RealFrac Float where
    ...
    floor x = case properFraction x of
		(n,r) -&gt; if r &lt; 0.0 then n - 1 else n
\end{code}
 === This code is not unboxing-friendly, as it uses @properFraction@, which returns a pair of numbers.   Even if the pair itself gets unboxed, its elements don't.  How about this code instead: ++++
\begin{code}
instance RealFrac Float where
    ...
    floor x = if x &lt; 0 then n else n-1 where n = truncate x
\end{code}
 === Likewise for @ceiling@.  I'm new at Haskell optimizing, so I might be missing something subtle.  Although @truncate@ is also defined via @properFraction@, there's a rule that replaces the definition: ++++
\begin{code}
{-# RULES &quot;truncate/Float-&gt;Int&quot; truncate = float2Int #-}
\end{code}
 === 
* Lots of discussion [[today on #haskell| http://tunes.org/~nef/logs/haskell/07.11.28]]: using DataDriven (extended to an language of evaluation policies) for managing software (9:36); simplicity &amp; generality in design (10:43); pedagogy &amp; &quot;the IO monad&quot; (20:43).
* Reply to sigfpe's post [[ The IO Monad for People who Simply Don't Care| http://sigfpe.blogspot.com/2007/11/io-monad-for-people-who-simply-dont.html]]: ++++&gt;
Hm.  I think the &quot;command/expression distinction&quot; is a confusion of semantics &amp; syntax.  I'd say that Haskell &quot;expressions&quot; are used consistently to denote a wide variety of (immutable) values, from booleans &amp; numbers to streams &amp; trees to imagery &amp; animation, to &quot;commands&quot; (aka &quot;computations&quot;, &quot;stateful computations&quot;, &quot;actions&quot;, &quot;commands&quot;, IO values) &amp; beyond.  All are denoted (expressed) via expressions, and all are immutable values.  The only essential difference between IO and, say, list is that the semantic interpretation we give IO is much more complicated (intractably so) than the one we give lists.

I also have a quibble with the common practice of referring to IO as &quot;the IO monad&quot;.  Monadness is no more essential to the IO type (constructor) than to list.  Bringing in monads is just a convenient structuring technique.  The idea of capturing imperative computations in a type of (immutable) values is lovely.  And so is the general pattern we call &quot;monad&quot;.  I'm worried that people won't understand that these lovely ideas can be used separately, and that (like infinite lists), they happen to be usable together.
 === 
* Added fractional (@RealFrac@) sliders to Phooey &amp; TV.
</pre>
</div>
<div title="2007-11-29" modifier="Conal Elliott" created="200712020154" tags="2007-11 day" changecount="1">
<pre>* Very long #oasis chat with vincenz and rici.  Saved.  One bit from me: ++++&gt;
For me (what I care about), syntax and implementation are always in service of semantics.  I form expressions in order to denote, and I want implementations so i can get a more direct glimpse of the denotations.
  === And here's a story from rici:+++&gt;
there's a famous canadian story about a baseball tournament between various original nations of ontario (i.e. indigenous groups).  now, some of these are traditionally hunter-gatherers, and others are traditionally pastoralists. there's a big difference between the social norm with respect to dinner which has to do with the fact that agricultural products are stored.
now, in some cultures the host is //obliged// to put more food on the table than the guests wish to consume, in order to demonstrate that arbitrary consumption is invited.
in other cultures, the guest is //obliged// to eat everything which is presented, in order to demonstrate that it was good.
clearly, these two cultural values are incompatible.
so the night before the tournament, the hosts (of persuasion A) threw a dinner party for the visitors (of persuasion B).
consequently, the visitors were required to gorge themselves on an abundance of food which stretched the resources of the hosts.
the next day, the visitors got clobbered, since they were all suffering from overconsumption, and they took it up with the tournament organizers, claiming that they had been, in effect, poisoned.
meanwhile, the hosts had complained to the tournament organizers, claiming that they had been put out of pocket by the massive greed of the visitors.
now, there is no right or wrong to any of this. everyone did what came naturally to them, and it was only a problem because they didn't understand each others' rules.
 === 
</pre>
</div>
<div title="2007-11-30" modifier="Conal Elliott" created="200712020154" tags="2007-11 day" changecount="1">
<pre>* Found the source of my Piq crashing bug: i was changing texture maps in the middle of a @renderPrimitive@ call.  I guess that's taboo.
* Getting close with the graphics details.  But the memoizing trick isn't working.  It just gets stuck, and I don't yet know why.  Oh -- negative numbers!!  Fixed.  I'm still recomputing, and I think I know why: sources don't cache automatically.  Given @f &lt;$&gt; a &lt;*&gt; b@, if @b@ changes, @f &lt;$&gt; a@ will get sampled, which means //re-applying// @f@.  Oog.
</pre>
</div>
<div title="2007-12" modifier="Conal Elliott" created="200801120319" tags="2007 December month" changecount="1">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2007-12-01" modifier="Conal Elliott" modified="200712071752" created="200712020155" tags="2007-12 day" changecount="5">
<pre>* On taxonomy ++++
*  Reply to the Yampa list on ontology: +++&gt;
I don't know that there's a clear distinction to make between DSELs and other types.  That's the point of the &quot;E&quot; in DSEL.  One might well call Data.List and (especially) IO DSELs.

While Arrow &amp; Monad (and Applicative) were placed into Control, I don't agree that they fit there, as they're equally applicable to Data.  The very general nature of type classes makes it inevitable that they will cut across our top-level categories of Control, Data, Graphics, etc.  So I'd suggest moving them to a new top-level namespace &quot;Class&quot; (with forwarding modules).

I've come to think of &quot;Data&quot; and &quot;Control&quot; as meaning &quot;functional&quot; and &quot;imperative&quot;, respectively.  Or perhaps as &quot;tractable (denotational) semantics&quot; and &quot;intractable semantics&quot;.  Or as having lots of useful properties and composability vs not.  If Yampa fits those descriptions, then Data.Yampa.

Or maybe give up on taxonomy, which is probably an unworkable proposition anyway [1], and go with the package name as the namespace name, plus Hackage tags for more description.

[1] Ontology is Overrated: Categories, Links, and Tags http://www.shirky.com/writings/ontology_overrated.html
  === 
*  A related note, unused: +++&gt;
I've been feeling increasingly uneasy about Haskell's hierarchical module system.  It's become &quot;the elephant in the room&quot; for me, and I wonder for whom else.  The elephant is a big one, namely: taxonomies don't usually work, and particularly in highly expressive languages such as Haskell.  See [[Ontology is Overrated: Categories, Links, and Tags| http://www.shirky.com/writings/ontology_overrated.html]].

Until we find a working alternative to taxonomy, I suggest the following scheme:
* A new top-level category called &quot;Class&quot; for type classes.  Move Monad, Applicative &amp; Arrow there, and probably many others.  Create forwarding modules for backward-compatibility.
* Interpret Data as &quot;Functional&quot; and Control as &quot;Imperative&quot;.  In deciding whether to place a data type into Data or Control, ask the question of whether the type's denotational semantics is as complicated as IO.  (For instance, is IO visible in its external interface.)  If so, place it in Control, and if not into Data.  Maybe IO isn't the best cut-off point.

I'd like to open up an exploration to get more clarity of what problems hierarchical modules solve whether there are alternatives that work as well for those problems without the problems that come with taxonomy.

Tagging seems to be a great alternative to taxonomy in email (gmail), social bookmarking (del.icio.us etc), and blogging (Wordpress etc).  But tagging works //with// ambiguity, yielding sets of results, while I think we're looking to 
 === 
*  Another, sent to the Yampa list, in reply to Henrik: ++++&gt;
&gt; I could thus certainly live with a top-level Yampa! :-) But if not, I would, after having thought a bit more, prefer something like &quot;edsl.yampa&quot; to both &quot;control.frp.yampa&quot; and &quot;edsl.frp.yampa&quot;.
Of those four choices, &quot;yampa&quot; is the only non-arbitrary one, i.e., the only one that avoids crowning one of many aspects of Yampa as if it classifies the whole.  it's simple and direct and adds no ambiguity on top of that imposed by the flat package namespace.  It's also inconsistent with the common practices, but those practices are highly questionable.

I'm going to experiment with using tags instead of categories in packages &amp; modules.  Cabal already has multiple tags (unfortunately called &quot;categories&quot;) per package.  We could start (multi-)tagging modules as well, via an informal pragma (stylized comment).  The &quot;ontology is overrated&quot; article describes an evolutionary path from rigid taxonomy to flexible folksonomy (social tagging).

Oh -- it occurs to me that the flexibility and friendliness of social tagging comes from decentralizing the tagging.  Maybe better that the tags are external to content (Cabal specs and module sources).
  === 
*  It also occurs to me that the use of name paths (&quot;Foo.Bar.Baz&quot;) for uniquely identifying modules is poor man's hyperlinks.
*  Another reply to Henrik: ++++&gt;
&gt; Instead, leave that to the author's of a module or family of modules: if they think it is useful to think of their work as an EDSL, and the EDSL view is a view they wish to push, well, then why not? Who's in a better position to judge?
That's a traditional viewpoint.  Shirky's ontology article offers a rebuttal that is for me very compelling.  See his sections on [[&quot;Mind Reading&quot; and &quot;Fortune telling&quot;| http://www.shirky.com/writings/ontology_overrated.html#mind_reading]].
   === 
  === 
* Events and data-driven computation: ++++
[[Yesterday| 2007-11-30]], I realized that my clever memoization trick is deftly foiled by @Source@'s lack of caching.  Which gets me back to [[a recent idea for reactivity| 2007-10-10]] that caches for free.  I think I'd want single-occurrence events, so here are so thoughts. ++++
An event occurrence is, semantically, a time/value pair: @semantics Occ a = (Time,a)@.  But the time &amp; value are often not knowable until (slightly after) that time.  In other words, an occurrence describes information that may come from the future.  I'll adopt the term [[&quot;future&quot;| http://en.wikipedia.org/wiki/Futures_and_promises]] for now (though [[perhaps &quot;promise&quot; is a better fit| http://en.wikipedia.org/wiki/Futures_and_promises#Distinction_between_futures_and_promises]]).

What can one do with a future? ++++
*  //Force// it, which blocks until the future's time &amp; value are known. ++++
\begin{code}
force :: Future a -&gt; (Time,a)
\end{code}
   === Note the purity of @force@ (lack of @IO@).  Also note that @force@ is the semantic function for futures.
*  Ask whether the future's time is earlier than a specified time.  May block if the specified time is in the future. ++++
\begin{code}
earlierThan :: Future a -&gt; Time -&gt; Bool
\end{code}
   === 
*  @Functor@ instance: ++++
\begin{code}
force (fmap f fut) = second f (force fut)
\end{code}
   === Hm.  Note the similarity to the @Functor@ instance for @(,) Time@.
*  @Applicative@ instance: ++++
\begin{code}
force (pure x) = (minBound,x)
force (fmap futf futX) = (tf `max` tx, f x)
 where
   (tf,f) = force futf
   (tx,x) = force futx
\end{code}
   === Wow -- looks just like @Applicative@ for @(,) Time@, if ++++
\begin{code}
type Time a = Max a

instance (Ord a, Bounded a) =&gt; Monoid (Max a) where
  mempty = Max minBound
  Max a `mappend` Max b = Max (a `max` b)

instance (Ord a, Bounded a) =&gt; Monoid (Min a) where
  mempty = Min maxBound
  Min a `mappend` Min b = Min (a `min` b)
\end{code}
   === 
  === 
*  @Monoid@ instance.  I'd have guessed that I want the //earlier// occurrence, for a sort of @select@-like semantics: ++++
\begin{code}
force mempty = (Max maxBound, error &quot;it'll never happen, buddy&quot;)
forall f. f `earlierThan` mempty == False

force (futa `mappend` futb) | ta &lt;= tb  = pa
                            | otherwise = pb
 where
   pa@(ta,_) = force futa
   pb@(tb,_) = force futb
\end{code}
   === Or do I want the //later// occurrence, as in the @Applicative@ instance?  Hm.  Since @mempty@ must be the identity for @mappend@, a max-based monoid's mempty would have to occur at @minBound@.  That occurrence time would suggest that the value could be accessed at any real time, which is not the case.
*  @Ord@ instance, giving an answer of &quot;both&quot; to the previous question, without the troubling need for @mempty@ in the max case.  Use @min@ for the earlier occurrence and @max@ for the later.  We probably want @&lt;=@ as primitive.  Unfortunately, there isn't an @Eq@ instance of the expected kind (without adding @Eq a@ to the context, which I don't want for the @Ord@ instance), and @Ord@ is set up as a subclass of @Eq@.
*  The @Monoid@ instance //does not// match the monoid instance for @(Time,a)@, so it breaks the trend set by @Functor@ and @Applicative@.  Since we have @min@ instead, maybe punt @Monoid@.
  === 
 === 
* An enchanting chat with rici on #oasis, including bi-directionality of time, which I wrote about on the plane on the way back from ICFP just a few weeks ago.  Saved.  I ordered two books he recommended: &quot;Maps and Dreams&quot; and &quot;Dancing with a Ghost&quot;.
* Chatted with Ken Greenebaum about djVu and scanning.  The [[Fujitsu S510| http://www.amazon.com/Fujitsu-Scansnap-Color-Image-Scanner/dp/B000RUOW66]] looks pretty sweet, and there's a $50 rebate until December 31^^st^^.  The main drawback I see is lack of network-based scanning.
</pre>
</div>
<div title="2007-12-02" modifier="Conal Elliott" created="200712071753" tags="2007-12 day" changecount="2">
<pre>* Started working on a &quot;semantic prototype&quot; for futures that leverages existing instances.
* Submitted two library proposals.  Both came up in my &quot;semantic prototype&quot; for futures. ++++
*  [[Add &quot;writer&quot; Monad instance (,) o to Control.Monad.Instances| http://hackage.haskell.org/trac/ghc/ticket/1951]].
*  [[Max and Min for Monoid| http://hackage.haskell.org/trac/ghc/ticket/1952]]
  === 
</pre>
</div>
<div title="2007-12-03" modifier="Conal Elliott" created="200712071753" tags="2007-12 day" changecount="1">
<pre>* Response to Wolfgang J: ++++&gt;
&gt; &gt; It really is about a particular approach to programming. Hence the name! Well, that's my opinion at least.

&gt; It is about a particular approach to programming reactive sytems.  And reactive systems are about control.

I agree with the first statement, but not the second.  I'd instead say that //imperative// reactive systems are about control, as with most other kinds of imperative systems, and //functional// systems, including reactive ones, are about values, i.e., data.

By the way, I distinguish between (a) functional programming and (b) imperative programming in a functional language.  For instance, using lists or FRP is the former, while using IO is the latter.  I'm not sure all Haskell users make this distinction.
  === 
* Note to Paul H: ++++&gt;
By the way, I realize that I'm co-opting this Yampa list thread to for my own agenda of raising awareness of this taxonomy question.  I'm doing something similar in the #haskell IRC channel.  I decided to start pointing out elephants wherever I spot them.  My other favorite right now is the inherent problems of IO, namely abandoning tractable (denotational) semantics and composability.  I get the impression that many people think that the monad trick some lets one think and program imperatively and get the benefits of functional programming.

P.S.  If you're interested, perhaps we could collaborate this taxonomy thing as it relates to Haskell programming.
  === 
* Response to Henning Thielemann, asking what I want to do with my floating point infinities: ++++&gt;
I'm using them for event occurrence times.  Or, from another angle, for times associated with when values can become known.  Pure values have time minBound, while eternally unknowable values (non-occurring events) have time maxBound.  Hm.  Now that I put it that way, I realize that I don't want to use existing minBound and maxBound if they're finite.  (My event types are temporally polymorphic.)  I'm mainly interested in Float/Double times, which have infinities in practice but apparently not guaranteed by the language standard.  I guess I'll either (a) bake in Double (temporally monomorphic) and rely on infinities not guaranteed by the standard, or (b) keep temporal polymorphism and add infinities to time parameter.
  === 
* More exchanges with Wolfgang J and with Paul H.
* Noodling over how to implement functional futures.  The [[old IVars| http://www.haskell.org/ghc/docs/3.02/users_guide/users_guide-4.html]] seem pretty close.  I did a simple implementation via STM.  Could a future be just an IVar?  To implement @fmap f iv@, make a new IVar @iv'@, spin a new thread that asks for the value @x@ of @iv@ and writes @f x@ to @iv'@.  Immediately return @iv'@.
</pre>
</div>
<div title="2007-12-04" modifier="Conal Elliott" created="200712071754" tags="2007-12 day" changecount="2">
<pre>* Ontonology discussion:  +++
*  Reply to Henrik: ++++&gt;
&gt; Wolfgang suggests FRP as the top-level for all things FRP.

&gt; [...] At least it is consistent with the story
&gt; we've been telling for a long time with FRP being used as the umbrella
&gt; term, and Yampa etc. as instances.

&gt; Of course, as Conal pointed out, it's never going to be perfect,
&gt; but hopefully good enough.

Good enough for what?  How about we get clear on our goals for this decision and *then* implement them.  Here are some possibilities I've heard so far in related discussions on #haskell, as well as in this thread:
(a) Unambiguous for import from a client program
(b) Descriptive
(c) Browsable
(d) Consistent with other libraries
Please suggest more if you think of any.

For myself, (a) is a very strong goal and probably the only requirement.  I'm also very interested in (b) and (c), and for reasons Shirky describes, taxonomy/hierarchy is ineffective at best, compared with the alternatives of links, tags, and search.  And for those considerations, I see (d) do more harm than good.
   === 
*  Reply to Wolfgang: ++++&gt;
&gt; Am Dienstag, 4. Dezember 2007 10:30 schrieb Henrik Nilsson:
&gt; [...]
&gt; &gt; but if it succeeds in grouping together all things FRP, including
&gt; &gt; Grapefruit, which Wolfgang didn't feel was a (E)DSL, and perhaps similar
&gt; &gt; cases, then yes.

&gt; Good!  However, note that I wouldn’t want to place all of Grapefruit’s GUI and
&gt; graphics stuff under FRP.Grapefruit.  FRP.Grapefruit would be for
&gt; Grapefruit’s FRP core and for GUI and graphics things which are closely tied
&gt; to the core (like graphic signals which are used to describe animations and
&gt; are closely tied to the ordinary signals of the FRP core).  Modules which
&gt; provide specific kinds of widgets like buttons, labels and treeviews, would
&gt; go under Graphics.UI.Grapefruit.
Or you could just as well flip over the hierarchy and use Grapefruit.FRP and Grapefruit.Graphics.UI, since after all, FRP and UI are two aspects *of* Grapefruit.  In other words, Grapefruit is as much a sub-category of FRP as FRP is a sub-category of Grapefruit.  Each can be viewed as an aspect of the other.  Similarly for *all pairs of categories* in the two paragraphs above ((E)DSL, FRP, Graphics, UI, Grapefruit).  But &quot;can be viewed as an aspect of&quot; is not the same as &quot;is exclusively contained in&quot;.  That difference is why tagging and linking works, and hierarchy doesn't.  Tagging and linking embody the multitude of relationships we find both in reality and in theory, particularly including relationships that emerge over time.  Hierarchy embodies only one relationship, which is containment, and that one relationship turns out to be fictitious in most circumstances.  Again, I highly recommend the Shirky article.  See particularly -- [[The Parable of the Ontologist, or, &quot;There Is No Shelf&quot;|http://www.shirky.com/writings/ontology_overrated.html#parable_of_the_ontologist]].
   === 
*  Another to Wolfgang: ++++&gt;
On Dec 4, 2007 9:45 AM, Wolfgang Jeltsch &lt;eu8lewwp@acme.softbase.org&gt; wrote:

&gt; Am Dienstag, 4. Dezember 2007 18:22 schrieb Conal Elliott:
&gt; &gt; Or you could just as well flip over the hierarchy and use Grapefruit.FRP
&gt; &gt; and Grapefruit.Graphics.UI, since after all, FRP and UI are two aspects
&gt; &gt; *of* Grapefruit.

&gt; I don’t want to do this.  In the current module hierarchy, the top-level
&gt; modules denote topics, not libraries.  Grapefruit isn’t a topic.  

I agree with this description of the current modules hierarchy: it's about topics.  Unfortunately, topics are exactly what hierarchies do badly and links, tags, and searching do well.  (See &quot;When Does Ontological Classification Work Well?&quot; in Shirky's article.)  On the other hand, I don't see a problem with a quite flat hierarchy rooted in package names.  Moreover, package names must be unique anyway, so non-ambiguity is covered.  Within a package name, there could be just a flat collection of modules or additional structure, as the package authors decide.  What's currently topics would be moved to multiple tags in the Cabal file.  Additional tags could go into source files via a new &quot;TAGS&quot; comment/pragma, as desired.  Links as well, as already supported by Haddock.

&gt;								    It’s just a
&gt; library which started as a monolithic thing and is now becoming a collection
&gt; of multiple packages which deal with different topics.  Some of them can be
&gt; useful outside Grapefruit, like the FRP core.

I'm glad to hear it.  Go, reusability!  I've doing the same sort of refactoring (of Eros), leading to DataDriven, DeepArrow, Phooey, TV, and GuiTV, and more in progress.

&gt; &gt; In other words, Grapefruit is as much a sub-category of FRP as FRP is a
&gt; &gt; sub-category of Grapefruit.  Each can be viewed as an aspect of the other.
&gt; &gt; Similarly for *all pairs of categories* in the two paragraphs above ((E)DSL,
&gt; &gt; FRP, Graphics, UI, Grapefruit).

&gt; True in general.

&gt; &gt; But &quot;can be viewed as an aspect of&quot; is not the same as &quot;is exclusively
&gt; &gt; contained in&quot;.

&gt; The Grapefruit FRP core (which is rooted at FRP.Grapefruit or Grapefruit.FRP)
&gt; is exclusively contained in the set of all FRP implementations and it is also
&gt; exclusively contained in the set of all Grapefruit packages.

Hm.  Maybe a language disconnect.  By &quot;*exclusively* contained in&quot;, I meant &quot;contained in and only in&quot;.

&gt; &gt; That difference is why tagging and linking works, and hierarchy doesn't.

&gt; Hierarchy works (to a certain degree) if there is an order on the aspects
&gt; which says which aspects should be at a higher place in the hierarchy than
&gt; others.  For example, an order which says that topics should go higher than
&gt; library names.  Then you would just collect all aspects of a package, order
&gt; them according to this order and would get a path for the module hierarchy.

I don't know where this order of &quot;which aspects should be at a higher place in the hierarchy&quot; can possibly come from, beyond the simple case you mentioned (topic vs library).  (See &quot;Great Minds Don't Think Alike&quot; and &quot;Of Cards and Catalogs&quot;.)

&gt; &gt; Tagging and linking embody the multitude of relationships we find both in
&gt; &gt; reality and in theory, particularly including relationships that emerge
&gt; &gt; over time.  Hierarchy embodies only one relationship, which is containment,
&gt; &gt; and that one relationship turns out to be fictitious in most circumstances.
&gt; &gt; Again, I highly recommend the Shirky article.  See particularly -- The
&gt; &gt; Parable of the Ontologist, or, &quot;There Is No Shelf&quot; [1].
&gt; &gt;
&gt; &gt;[1]http://www.shirky.com/writings/ontology_overrated.html#parable_of_the_ontologist

&gt; This sounds reasonable.  What about discussing this on the libraries list?

Yes, this discussion fits the libraries list.  Knowing that hierarchy is a deeply ingrained a mental habit, I prefer testing the waters in a specific &amp; reality-grounded setting like this FRP &amp; Yampa list.

&gt; My current problem is that I need a solution now.  This solution won’t be
&gt; perfect but I want more or less the best solution we can achieve with the
&gt; current system.  I don’t want to wait with the first Grapefruit release until
&gt; we have tagging and linking. :-(

&gt; So your ideas are definitely important in the long term why I’m searching for
&gt; a short-term solution.

Me too!  I suggest PackageName.WhateverYouWant.MoreYetIfUseful plus tagging.
   === 
*  Another to Henrik: ++++&gt;
On Dec 4, 2007 10:40 AM, Henrik Nilsson &lt;nhn@cs.nott.ac.uk&gt; wrote:

&gt; Hi Conal,

&gt;  &gt; Good enough for what?  How about we get clear on our goals for this
&gt;  &gt; decision and *then* implement them.  Here are some possibilities I've
&gt;  &gt; heard so far in related discussions on #haskell, as well as in this
&gt;  &gt; thread:
&gt;  &gt;
&gt;  &gt; (a) Unambiguous for import from a client program
&gt;  &gt; (b) Descriptive
&gt;  &gt; (c) Browsable
&gt;  &gt; (d) Consistent with other libraries
&gt;  &gt; Please suggest more if you think of any.

&gt; Well, (a). I thought that was pretty obvious, as that's the only
&gt; intrinsic role I was aware of for the present Haskell module names.

Me too.  I heard the others in a #haskell discussion.

&gt; I disagree with you on (d). When working with others, I think it's
&gt; important to strive for consistency to the extent possible. I'd
&gt; probably go as far as saying that having two, or more, competing
&gt; conventions in any one context is worse than one, even if that
&gt; one is broken in certain aspects.

Today, we continue to perpetuate hierarchy because others did yesterday.  Tomorrow still others will do so because we did today.

&gt; While I agree that hierarchical classifications are inadequate
&gt; (and have thought so even before this discussion), I have yet to
&gt; be convinced that the current hierarchical Haskell module name
&gt; space is populated in such an awfully inconsistent way that there
&gt; is not even possible to try to fit in with what is there.

&gt; Again, maybe I am wrong. I'm willing to be convinced by concrete
&gt; evidence.

I see examples in Data &amp; Control, which is perhaps a clear distinction in imperative programming, but not nearly so clear in functional programming.  Why is list data and not control?  Why is Monoid in Data, while Monad, Applicative, and Monad (and now Category) in Control?  Why are some instances of Control classes in Data?  Why is UI under Graphics, although there are non-graphical UIs?  Why isn't Text under Data?

I don't know whether you'll find these examples compelling or not.  Some people do, and some don't

&gt; As to

&gt; (b) Descriptive
&gt; (c) Browsable

&gt; they are interesting, but I think that can be addressed through other
&gt; means than the module name.

I agree and add that they're addressed *more* effectively through other means, as the Internet shows.
   === 
  === 
</pre>
</div>
<div title="2007-12-05" modifier="Conal Elliott" created="200712071755" tags="2007-12 day" changecount="1">
<pre>* Taxonomy: ++++
*  Response to Antony C: ++++&gt;
Thanks, Antony.  I'm glad to have another voice in this conversation.

&gt; 2.  I have always assumed that &quot;Control&quot; meant &quot;Control Flow&quot;.  FRP is
&gt; most certainly about a certain approach to control flow, namely one
&gt; where control flow is determined implicitly from data flow
&gt; dependencies and the flow of time.  (Telling someone, &quot;think about
&gt; data flow rather than control flow&quot; is still a statement about control
&gt; flow (among other things).)

I didn't realize anyone was thinking of FRP as an approach to control flow.  I think of it as an *alternative* to control flow.

For me, behaviors (reactive or otherwise) are very like lists and functions.  Where an imperative program would use control flow, a functional program would use lists, functions, or behaviors.

When I look at base/Control/*, the common thread I see is type classes whose most popular current applications happen to be imperative programming.  (Hopefully that will change.)  I think that's the sense of &quot;Control&quot; being used: imperative programming.

If you really want to use the hierarchy in a conventional taxonomic way, I'd say ask whether you're exposing an imperative or functional semantics.  If imperative use Control.Reactive.*, and if functional use Data.Reactive.*.


&gt; The hierarchical module system is just a simple structuring tool to
&gt; avoid name clashes.  

As much as that's the case, the choice of PackageName.* (with deeper levels if you want) is simpler, more predictable, and more effective at avoiding name clashes than the currently common practice.  For instance, there were recently three packages with Data.Stream.  Two were merged, leaving two compelling and incompatible modules.  My naming suggestion guarantees the absence of clashes, since package names are already required to be distinct.

&gt;      We all seem to agree it is based on an
&gt; intellectually flawed organizational model.  Since bucking the
&gt; conventions won't fix the flawed model

Bucking convention contributes a little toward change, just as following convention adds still more inertia.  Neither choice has much effect by itself.

&gt;					, just suck it up and follow the
&gt; existing convention so users can spend more time thinking about their
&gt; applications and FRP and less time thinking about the hierarchical
&gt; namespace.

Won't another choice give users just as much time to think about FRP and their applications?


&gt; 4.  The only wrong choice of where to put Yampa in the hierarchical
&gt; namespace is not providing a conveniently packaged release of Yampa
&gt; because we're too afraid of making the wrong decision about where it
&gt; fits in the hierarchical namespace.  Please just pick something
&gt; arbitrary but conventional for namespace and get Yampa itself packaged
&gt; up and out there for others to experiment with with minimal hassle or
&gt; installation overhead.

I agree with the recommendation to get Yampa &amp; Grapefruit released in a way that avoids name clashes, which as you've mentioned is the purpose of the hierarchical module system.  I'm not sure where conventionality helps or unconventionality hinders making conveniently packaged releases.  I do see where the unconventional approach I've suggested helps: simplicity, predictability, and uniqueness (guaranteed absence of name clash).
   === 
* Long &amp; involved [[#haskell IRC chat| http://tunes.org/~nef/logs/haskell/07.12.05]] (10:38 -- 12:20).
  === 
* Made plane reservations for Charlotte &amp; Audrey to visit Dec 30 -- Jan 6.
</pre>
</div>
<div title="2007-12-06" modifier="Conal Elliott" modified="200712090703" created="200712071755" tags="2007-12 day" changecount="3">
<pre>* Reply to Kristopher Blom on the Yampa list: ++++&gt;
Hi Kristopher,
I'm delighted to hear that temporal continuity is important to you.  It's one clear that functional programming can do elegantly that imperative programming is inherently unfriendly to.  Continuity -- in time, space, or whatever -- is more nicely compositional than discreteness.

My original name for this paradigm was &quot;reactive behaviors&quot;, and indeed Fran was called RBMH -- reactive behavior modeling in Haskell -- until shortly before submitting for publication (or maybe even just before camera-ready revision).  The &quot;reactive&quot; part was indeed alluding to the discrete aspect (events) and the &quot;behaviors&quot; part to the continuous aspect (&quot;flows&quot;, or functions of time).  Until reading (really, re-reading) your note, I didn't realize that we'd lost the continuous aspect in renaming to Fran and then FRP.  And not just the continuous aspect, but the *autonomous* aspect as well.  The most beautiful thing to me about the Fran combinators was exactly the interplay between the continuous and discrete, with switcher to turn events into behaviors and snapshot to turn behaviors into events.

I liked the term &quot;reactive&quot; until your note jogged my memory.  Now I'd say it's just one aspect of FRP, and not the more distinguishing, and certainly not the hybrid nature.  Of course the paradigms of (a) taxonomy and (b) follow-the-pack will press us to pick one aspect to elevate over the others.  Whether and how much we succumb to those pressures is up to us.
  === 
* Long collaborative discussion with Duncan Coutts about applicative software management (recompilation etc).  Starting with the ideas I talked about in Freiburg: time-varying compilers &amp; source code.  
</pre>
</div>
<div title="2007-12-07" modifier="Conal Elliott" modified="200712072014" created="200712090704" tags="2007-12 day 2008-01" changecount="2">
<pre>* Reply on the nvc-cert list: ++++&gt;
&gt; It dawns on me that the concepts are observations in regards to balance
&gt; in relating. Do we need balanced relating? Could that be at the root of
&gt; the feeling of urgency I got in relation to these words? That we, even
&gt; in a hierarchically structured society, need balanced relating on some
&gt; level and with some people. And that there is a tendency to regard those
&gt; with which I have such a balanced relating as &quot;people like myself&quot;. The
&gt; very notion of friendship. The need for balance and reciprocity in some
&gt; way and on some level so that it &quot;evens out&quot;. 
I'm guessing that balance, reciprocity, and especially evens-out here are are still attaching to the same energy as fairness and equality.  &quot;Mutuality&quot; is another NVC word I typically hear this way.  A common thread for me is an entanglement of my choice to give to someone with their choice to give to me.  When I'm making all of my giving choices joyfully (what Marshall calls living *self-fully*), they're all for me not for the other person, and so the other person can't possibly get into debt to me.  Whenever I get grumpy and start thinking about balance or fairness, I know I've been playing Loan Shark again.

When my needs are met, I have no interest in abstractions like fairness &amp; balance.  When my needs are unmet, those abstractions will only get me stuck in strategy attachment (entanglement).  Worse, others will recognize the weapon I'm wielding (coercive moralism) and will resist their natural impulse to connect with me openly.
  === 
* Misc tweaks to my Haskell libs.  I'm now using @g :. f@ and @f :$ a@ in place of @g `O` f@ and @App f a@.</pre>
</div>
<div title="2007-12-08" modifier="Conal Elliott" created="200712090704" tags="2007-12 day" changecount="1">
<pre>* My new Reactive stuff is shaping up well.  Where to go next with it?  Do I rebuild all of DataDriven and then Phooey, GuiTV, and Eros?  While I'm at it, what about switching to an Arrow interface, attempting to get rid of the IO stuff in DataDriven?  Start with defining the combinators in DataDriven.
* Added the DataDriven combinators to Reactive.  They all came out beautifully, and I was able to remove //all// IO!
* New [[Reactive wiki page| http://haskell.org/haskellwiki/Reactive]].</pre>
</div>
<div title="2007-12-09" modifier="Conal Elliott" modified="200801072013" created="200712092143" tags="2007-12 day" changecount="5">
<pre>* Voluminous Discussion on haskell-cafe, which I renamed to &quot;Do real programs need IO&quot; +++
*  Reply to Lennart A: ++++&gt;
&gt; IO is important because you can't write any real program without using it.
Ouch!  I get awfully discouraged when I read statements like this one.  The more people who believe it, the more true it becomes.  If you want to do functional programming, instead of imperative programming in a functional language, you can.  For instance, write real, interactive programs in FRP, phooey, or TV.  And if you do, you'll get semantic simplicity, powerful &amp; simpler reasoning, safety and composability.
   === 
*  Reply to Daniel F: ++++&gt;
On Dec 9, 2007 10:07 AM, Daniel Fischer &lt;daniel.is.fischer@web.de&gt; wrote:
&gt; Interactive programmes without using IO? Cool :)
And how!
&gt; I think you misunderstood Lennart.
Thanks for checking.  In this case, I think I understood Lennart fine and that he was saying what you're saying.
&gt; Would you deny that any useful programme has to do at least some of the following:
&gt; -accept programme arguments at invocation
&gt; -get input, be it from a keyboard, mouse, reading files, pipes...
&gt; -output a result or state info, to the monitor, a file, a pipe...
If by &quot;programme&quot;, you mean the code I write, then I'm happy to deny that my programme has to do these things.  Examples below.  If you include a stateful RTS, then no I don't deny it.
&gt; I think Lennart was referring to that, you HAVE to know a little IO to write programmes, at least getArgs, getLine, putStr(Ln), readFile, writeFile, appendFile. And therefore some use of the IO monad has to be taught relatively early.
Explicit imperative programming is just one way to deal with input &amp; output, not the only way.  As proof, see FRP, Pan, or TV programs, which contain uses of none of these functions.  (Nor could they, as these libraries are functional, having IO-free types and semantics.)  Moreover, use of imperative programming sacrifices some of the semantic simplicity &amp; composability that makes FP so appealing.  That's why I'd like to see this belief in its necessity dispelled.

That said, I don't think the existing functional (non-IO) approaches to interaction are quite there yet with the flexibility of imperative programming.  It will take more work to get them there, and that work is mostly likely to be pursued by people who doubt the necessity of IO for writing &quot;real programs&quot;.  In that sense, Lennart's and your statements are self-fulfilling prophechies, as are mine.

BTW, if you haven't seen it already, please check out [[TV|http://haskell.org/haskellwiki/TV]].  The TV (tangible values) approach includes a simple algebra of interfaces (input/output) and keeps separable from the core computation.  The separability allows the interface parts to be composed in parallel with the core part.  For instance, when two function-valued TVs are composed, the interfaces are peeled off, so that the core functions can be composed directly.  The output half of one interface and the matching input half of the other are discarded.  The remaining input and output halves are recombined into a new interface, which is used as the interface of the composed TV.  The core interface algebra can be used for text stream i/o, GUIs, and many other possible styles of information passing.

I mention TV, because it's an example of combining the purity &amp; composability I love about FP with the usability a &quot;real&quot; app.  For more about this combination, please see my Google tech talk [[&quot;Tangible Functional Programming: a modern marriage of usability and composability&quot;| http://conal-elliott.blogspot.com/2007/11/tangible-functional-programming-modern.html]].  That talk focus on end-user composability, but the essential points apply as well to explicit programming.  As I mentioned before, TV (a) is currently less flexible than imperative/IO programming, and (b) has the composability, guaranteed safety, and amenability to reasoning of pure functional programming.
   === 
*  Unused bit: ++++&gt;
I can get access to all of this info //without// using IO (examples in my previous note and below), just as I can write any pure function without mixing in imperative (IO) code to read arguments and write results.  Argument reading and writing (like thunk evaluation) happen at the implementation level (in the RTS) without complicating the semantics.
   === 
*  Reply to Daniel F: ++++&gt;
Thanks for the clarification.
&gt;AFAIK, the only way to get input and produce output is via the IO monad
Now you know something different, don't you?  FRP, Pan, TV.  Also Grapefruit, functional forms, and others I'm not thinking of or don't know about.

As for your example, mixing the IO with the functional, as you have interferes with composing the result.  I can think of two alternatives.  One is to move reading &amp; printing from the definition to the uses, as with Unix stream filters.  Still convenient, and much more flexible.  Of course, Unix programs were written in C and so use explicit I/O instead of lazy functional streams.  (Though Doug McIlroy, who invented Unix pipes, knew that pipes were equivalent to coroutines and to lazy evaluation.  See my &quot;modern marriage&quot; talk (the video I mentioned) for more about Unix and TV.)

A second alternative is to use TV to explicitly capture the interface (I/O), which could look like this:
\begin{code}
coolTV :: TV (String -&gt; String)
coolTV = tv (olambda (fileIn &quot;Data.txt&quot;) defaultOut)
	    performAwfullyCoolFunctionalStuff
\end{code}
where
\begin{code}
tv :: Output src snk a -&gt; a -&gt; TV src snk a
\end{code}
The type parameters src &amp; snk are for various interface styles.  Then coolTV can then be used on //either// side of a TV-style pipe, resulting in the removal of the reading or writing half.

And yes, there are //some// uses of IO for which I'd be hard pressed at this point to offer you an alternative.  Which is a far cry from IO being necessary for all &quot;real&quot; programs, even today.

Given this state of affairs, I'd prefer the Haskell community to point newbies away from IO and toward purely functional programming for things like UIs and graphics and help them change their way of thinking.  Let's also admit that we haven't yet figured out how to apply our functional paradigm as flexibly or broadly as we'd like, and so meanwhile we have thi monadic IO trick that let's them write nicely factored imperative code that can call into the functional pieces.
   === 
*  Another to Daniel F: ++++&gt;
I'm glad you got to check out TV and like what you found.  Sorry for the missing haddock docs.  I'm waiting for hackage to catch up with haddock 2.0.

TV can use the IO &amp; OI types for output &amp; input, and it was convenient for me to do so.  It would make  a stronger &amp; clearer point if I'd buried IO more into the implementation (RTS) of an O type and an I type.  Maybe there's also a cleaner &amp; safer implementations of O &amp; I.

If you look at GuiTV, you'll have to dig more deeply through layers implementation before you find IO.  If you want to dig yet further past GuiTV's RTS into GHC's RTS, you'll find yet more mutable state.

The original question, as I understood it, was whether real programs need IO.  People can write real GuiTV programs and not see a bit of IO.   Yes, I did mean the library as part of app-writers' RTS, in the sense that the app writer sees and writes no IO.  That part of the RTS happens to be implemented in Haskell.  And I'm very glad Haskell still has IO, because I don't yet know how implement some of those layers functionally. 

BTW, I think TV core and GuiTV themselves are purely functional.  The OI/IO specialization is separable, but I didn't bother.  The generality and purely functional nature of TV would probably be made clearer by factoring out another library for text I/O.

The layers beneath GuiTV (including wxhaskell) also illustrates another point, which is that there are things I don't yet know how to implement in Haskell without IO.  So I'm glad it's there (for a subset of &quot;real programs&quot;).

If you specialize TV to the OI/IO instance, then your description of it is another partial truth: TV a library that supports &amp; enforces separation of algorithm and IO.  And in doing so, it restores composability.  Ditto for algorithm &amp; GUI, and probably many other kinds of interfaces to the algorithmic heart of a program.
   === 
*  And to Lennart: ++++&gt;
&gt; You can't write any program in Haskell without using IO, because the type of main involves IO.
It so happens that Haskell currently insists on main :: IO ().  That's simple to fix, however, and with great pay-off.  Suppose instead main :: TV a (where I'm omitting the other TV type args for simplicity.)  Then a program could not only be run, but also composed with other programs.  They could even be composed by the end-user *while running*, as in Eros.

Similarly, ghci implicitly inserts &quot;print&quot; when given a non-IO type.  We could make that mechanism a little more general, and allow implicit insertions of other kinds of renderers, for purely functional images, music, 2D &amp; 3D geometry &amp; animation, interactive GUIs, etc.
   === 
* The heart of the matter for me is not whether IO happens somewhere, but how it affects composition.  For instance, IO is not part of how I think about and compose numbers.  Before I do my computation, however, I'd like to get a number from somewhere, and after I get my result, I'd like to show it to someone.  So IO is handy on the outside of numeric composition.  Similarly for other functional data types.  We could design IO into the semantics of our pure data types, but doing so would interfere with the simple semantics 
  === 
</pre>
</div>
<div title="2007-12-10" modifier="Conal Elliott" created="200801072014" tags="2007-12 day" changecount="1">
<pre>* Reactive: ++++
*  My implementation is massively multi-threaded (via STM).  Will I run into trouble with wxHaskell and/or OpenGL?  I'm not sure I need real multi-threading.
*  I probably also want some guarantees on order of response for events, and STM will probably not be able to make those guarantees.
*  Started to roll my own monad for interleaved computation, with simple IVars for scheduling.
  === 
</pre>
</div>
<div title="2007-12-11" modifier="Conal Elliott" modified="200712292020" created="200712312015" tags="2007-12 day" changecount="2">
<pre>* Reactive: ++++
*  On reflection, perhaps there's a strong correspondence between programming with (a) threads &amp; blocking or (b) events &amp; call-backs.  When a thread blocks on an input that's not yet ready, the scheduler places the thread's continuation into a queue associated with that input.  When an input becomes available, the scheduler resumes all threads waiting on that input.  Correspondingly, an event can have call-backs registered with it, to be executed when the event occurs.  One difference is that typically event registration happens once for several call-back invocations, while thread continuations must get repeatedly suspended in order to be repeatedly resumed.  The difference is a trade-off between convenience and flexibility.  A contribution of FRP is to wrap this sort of machinery in a purely functional interface.
*  STM has @orElse@.  For repeated invocation, the event approach can just registers the same callback twice.  Single invocation is probably doable, but a bit trickier: have the call-back remove itself from both client queues.  I wonder if STM does something like that.
*  Here's a simple model and implementation for multi-threading with cooperative scheduling.  A computation takes (as argument) a queue of runnable threads and yields an IO (more generally, a monadic value).  @fork@ adds queues a new thread (or queues the current thread and switches to the new one).  IVars are represented by an ref that contains either a value or a queue of continuations to perform once the value becomes known.  Reading an empty IVar causes the current continuation to get added to the IVar's queue and the next queued thread to get removed from the thread queue and run.  If the thread queue is empty, then raise a deadlock exception.  Writing a empty IVar causes all of the IVar's continuations to get applied to the new value and the resulting threads enqueued.
  === 
* Idea on functional programming &amp; perception: ++++
Consider types like numbers, booleans, lists, pairs, etc.  If someone  types an expression of the former types into hugs/ghci and see a result, with no visible IO.  They mean &quot;print&quot; (an action) and want that implicit action executed, but they like not having to say it.  

Now consider types like images, animations, GUIs, etc.  Print is based on Show, and strings don't work well for this second variety of types.  The trick of the implicit print command doesn't work, and one instead has to use an explicit command, and IO is made plain.

Perhaps people conclude (consciously or unconsciously) that the difference is in the types themselves, rather than in the surface characteristics of their interpreter's REPL.

So here's a simple idea: introduce another class with a more flexible and modern method for presenting values.  For instance,
\begin{code}
class Present a where present :: a -&gt; IO ()
\end{code}
The important piece in influencing perception is to teach Haskell REPLs about the Present class.  When someone enters an expression e of type t, if t has a Present instance, then do &quot;present e&quot;.  Otherwise, do &quot;show e&quot;.  Either handle IO expression as a third case, or give IO a Present instance (present == id).  I've ignored a possible return value b :: t' for present, but we could add it in by showing the result or (more fun) starting the analysis all over again.  (Consider whether t' has a Present instance, ....) 

While the Present class is clearly expressive enough, one might object that present can do arbitrary IO, while print can only do putStrLn.  It might be worth formulating safer but still fairly flexible ways of presenting values than the IO type.  We might also want to use a nicely compositional approach to presenting values, such as the TV algebra (oprim, opair, olambda, iprim, ipair).

When IO semantics are genuinely present as part of understanding a type, I'd like that information to be prominent.  Where the present idea appeals to me is for types that have much simpler and safer semantics than full-blown IO (which includes way more than I/O), such as images, animations, 3D models, GUIs, and file processors.  
  === 
* Title: &quot;Toward composable Haskell programs&quot;.  Haskell functions, particularly pure ones, are highly composable, but Haskell //programs// are not.  The reason is simply that a program is defined by its @main :: IO ()@, and values of that type can only communicate through side-effects.  One weak form of composition remaining is Unix-style piping of byte streams.  [Note limitations &amp; inconsistencies, as in my &quot;modern marriage&quot; talk: monomorphism, parsing &amp; unparsing, linear chains.]
* Nice [[blog post| http://www.etoy.com/blog/archive/2007/11/26/tangible-functional-programming.html]]  about my &quot;modern marriage&quot; Google tech talk.
</pre>
</div>
<div title="2007-12-12" modifier="Conal Elliott" modified="200712292020" created="200712192016" tags="2007-12 day" changecount="3">
<pre>*  Playing with an idea for relaxing the type of @main@, following TV: ++++
\begin{code}
class Presentable a where present :: a -&gt; IO ()

class Acceptable  a where accept :: IO a

instance Presentable (TV a) where present = runTV

instance Presentable String where present = putStr -- putStrLn ?
instance Acceptable  String where accept  = getContents

instance Presentable (IO ()) where present = id

instance (Acceptable a, Presentable b) =&gt; Presentable (a -&gt; b) where
  present f = accept &gt;&gt;= present . f
\end{code}
  === Hm.  @Presentable (a -&gt; b -&gt; c)@ wants to @getContents@ twice.
* Is there an @Acceptable@ instance for @(a -&gt; b)@, dual to the @Presentable@?  I don't see how to define it.  If there's no dual with the types of 'present' &amp; 'accept', then perhaps there are other types to use.
</pre>
</div>
<div title="2007-12-14" modifier="Conal Elliott" modified="200712292020" created="200712192017" tags="2007-12 day" changecount="2">
<pre>* Here's a simple way to implement reactive values.  Gather up all of the primitive source events into one (including keyboard &amp; mouse).  Take the first occurrence and feed it into the reactive value, to get a list of consequent IO occurrences and a residual reactive value.  Repeat.  This idea is very like some of the old reactive behavior representations, so review them.  Next, consider an arrow version, so as to hide the signals.
</pre>
</div>
<div title="2007-12-16" modifier="Conal Elliott" modified="200712292020" created="200712192018" tags="2007-12 day" changecount="2">
<pre>* Some thoughts on Reactive: ++++
*  Have the wxHaskell callback overwrite itself.
*  Each input control type has its own type of event/flow content.  Maybe make some classes parallel to wxHaskell's classes.
*  Have mouse position and slider values be //behaviors//, not events.  Pull, don't push.  Use on/off events to trigger listening vs ignoring.  Distinguish logically discrete events from simulation of logically continuous behaviors.  One clue in distinguishing is whether the window system automatically discards some of the &quot;event&quot; occurrences.  If so, it's likely to be logically a behavior implemented as an event.
*  Use snapshot to throttle down rapidly changing output values.  More accurately, to switch from continuous (behaviors) to discrete (events).
*  Use arrow //recursion// (@loop@) for stateful reactive values.
*  Have one or more idle/tick events.  Use for event detection, integration, and output snapshot.
*  Replace down/up and enter/leave with isDown and isIn boolean behaviors reactive values.  Similarly for sliders (isDragging).  What about buttons?  Maybe a transition from False to True, followed immediately (at the same time) with a reverse transition.
*  For mouse motion, try the type @Reactive (Maybe (Behavior Point))@.  Drop isIn, or if useful, define isIn via the maybe-valued mouse motion.
*  Something puzzles/troubles me: I want to use an arrow style programming interface, but Arrow seems very inflexible.  For instance, types like @a ~&gt; b ~&gt; c@ aren't typically useful for an arrow @(~&gt;)@.  Am I confusing levels (to use Robert Johnson's phrase)?  How do I reconcile TV's approach, parameterized by arbitrary types, including functions, with the Arrow style, which always has one input type and one output type?  Maybe to really do the arrow style for GUIs, I would do a lot of redesign to how widgets are specified and composed, as in Fruit.  Then there would be just a single, simple UserInput type, which includes mouse &amp; keyboard behaviors &amp; events.  Without an arrow approach, I don't know how to get an simple &amp; efficient implementation of function over reactive values (RVs).  Noodle over that one.
*  The arrow I've been thinking of is very like the Yampa's SF (and like my old &quot;residual behaviors&quot; representation): a function from RVs to RVs (signals to signals) is represented as a function that takes a time &amp; value and yields a list of output values for that time and a new function from RVs to RVs.  (Unlike Yampa, (a) there's a list of output values rather than one, and (b) the implementation is data-driven.)
  === 
* Bit of prose for conversation on #haskell:  One thing i've been thinking about lately is the idea of &quot;composable programs&quot;.  The type of Haskell's &quot;main&quot; prevents them from being nicely composable.  TV suggests an alternative, by keeping the interface part and the pure core combined but separable.  Composition automatically modifies the interface part, which is not possible in typical IO-style Haskell programming.  I'd like to revive the original beautiful Unix vision of composable apps, but in a modern, workable way (unlike Unix's strategy).  That's what the &quot;modern marriage&quot; Google tech talk is about.
</pre>
</div>
<div title="2007-12-17" modifier="Conal Elliott" modified="200712292020" created="200712192018" tags="2007-12 day" changecount="2">
<pre>* I want to test out my STM/Ivar-based Reactive implementation.  What's a simple test harness?  Start with a wxHaskell program.  Did it.  Died with &quot;atomically was nested&quot;, as I feared it would.
* Try to implement my IVar type (with Monoid, Functor, Applicative, and Monad) on top of Concurrent Haskell &amp; MVars instead of STM and TVars. ++++
*  @takeMVar@ blocks, waiting for an MVar to become full.  When the blocking thread awakes, the MVar becomes empty.  There's also @readMVar@, which leaves the MVar full (combining @takeMVar@ &amp; @putMVar@).  I'll want that variant.
*  @putMVar@ blocks, waiting for the MVar to become empty.  I'd like an error instead, so use @tryPutMVar@, a non-blocking variant that returns a boolean.
*  What to use in place of @orElse@ for IVar @mappend@?  Given two MVars, make a third that fills when either of the given two fills.  Fork two threads, each of which does a @tryPutMVar@.  I could have the winner also kill the loser, but I don't know that it matters.
  === 
* Got a bunch of help on #haskell with my ubuntu wireless card problem, especially from shachaf.  He suggested [[ndiswrapper|http://ndiswrapper.sourceforge.net]], which looks like more than i want to get into today.  I suspect that the problem is specific to my wap.  Get another and see what happens.  Or take my computer to Starbuck's or in town, just to see if I can pick up a signal.
* Consider this definition: @type Parser = [Token] -&gt; (ParseTree, [Token])@.  It's sort of similar to a signal function representation.
* Found in the [[Concurrent Haskell docs| http://www.haskell.org/ghc/docs/latest/html/libraries/base/Control-Concurrent.html#v%3AthrowTo]]&gt; ++++&gt;
@throwTo@ does not return until the exception has been raised in the target thread. The calling thread can thus be certain that the target thread has received the exception. This is a useful property to know when dealing with race conditions: eg. if there are two threads that can kill each other, it is guaranteed that only one of the threads will get to kill the other.
  === 
</pre>
</div>
<div title="2007-12-18" modifier="Conal Elliott" modified="200712292020" created="200712192019" tags="2007-12 day" changecount="2">
<pre>* Uploaded TypeCompose 0.3 to hackage.
* Simplified IVar.hs and renamed Future.hs
* Converting Phooey from DataDriven to Reactive.  To do: @before@, @timedPoll@, event @Applicative@ and @Monad@.
</pre>
</div>
<div title="2007-12-19" modifier="Conal Elliott" modified="200712292020" created="200712192019" tags="2007-12 day" changecount="2">
<pre>* Reactive: ++++
*  Implemented @Monad@ &amp; @Applicative@ instances for @Event@.
  === 
</pre>
</div>
<div title="2007-12-20" modifier="Conal Elliott" modified="200712292021" created="200712292019" tags="2007-12 day" changecount="2">
<pre>* We had lots of erosion on the driveway after the rain.  Mark &amp; Susie Duncan came out to look.
</pre>
</div>
<div title="2007-12-21" modifier="Conal Elliott" created="200712292021" tags="2007-12 day" changecount="1">
<pre>* Conversation (saved) with vincenz (Cristophe Poucet) on #oasis about future values.  Take-away: ++++
*  He had a pretty entrenched assumption that the &quot;times&quot; I talked about were execution times, as in when values are received or computed.  His assumption was reinforced by my prototype implementation.
*  The term &quot;futures&quot; has a strong connotation for him of an implementation with nondeterministic semantics.  I might instead use &quot;future values&quot; and relate/contrast with &quot;futures&quot;.  In fact, my current implementation //is// a nice implementation of nondeterministic futures.  Instead of fixing mine, perhaps I could build a deterministic notion on top of it.
  ===   
</pre>
</div>
<div title="2007-12-23" modifier="Conal Elliott" created="200801072022" tags="2007-12 day" changecount="1">
<pre>* My video card stopped working.  I called Ivan at PortableOne (800-650-4006).  He said the GPU is replaceable, and recommended that I send it in rather than try to replace it myself.  Something about their thermal protection process.  I'll have to wait for folks to return to work on the 26th.  Meanwhile, VGA mode works, and I can display at full resolution on my 24-inch monitor.
* Read Baker &amp; Hewitt's //The Incremental Garbage Collection of Processes// (1977).  The topic is &quot;eager beaver&quot; evaluation (spawning a process per function argument), and the key question is how to prevent the useless threads from consuming resources.  For instance, start up various evaluation methods for a problem and use the first result.  The other methods are then useless, and some might consume resources forever.  One technique is to kill the losers.  Baker &amp; Hewitt suggest instead using garbage collection.  I wonder how I might use Baker &amp; Hewitt's idea.  I currently use the kill-process approach.  
* To automatically {{{strip}}} executables (reducing exe size), use {{{ghc ... -optl -s}}}.
* Linux: ++++
*  Remapped caps-lock to control, using [[these directions| http://www.columbia.edu/~djv/docs/keyremap.html]].
*  Installed darcs (with apt-get).
*  Installed ghc-6.6 with apt-get.  Needed for compiling ghc-6.8.2 from sources.
*  I have to be very careful with my bandwidth use.
*  darcs-got latest cabal, for use with cabal-install..
*  downloaded ghc-6.8.2 src and extra-libs
*  Built &amp; installed ghc-6.8.2!  (Symlinks in /usr/local/bin, shadowing the symlinks ghc-6.6 in /usr/bin.)
*  Installing cabal-install, which requires Cabal-1.3.2, zlib, and HTTP.  Install of zlib failed, due to missing zlib.h.  apt-got zlib1g-dev, thanks to tips from shachaf. ++++
{{{
&lt;conal&gt; shachaf: that one was found.  how did you come up with zlib1g-dev?
&lt;shachaf&gt; conal: sudo apt-get install zlib&lt;tab&gt;&lt;tab&gt;, and guess. :-)			      [22:28]
&lt;shachaf&gt; conal: Then apt-cache show to verify.
&lt;shachaf&gt; conal: In general, .h files are in -dev packages.
&lt;Cale&gt; More general solution: apt-file search zlib.h
&lt;conal&gt; shachaf: thanks for the tips!
&lt;shachaf&gt; Cale: Well, this is usually faster. :-)
&lt;Cale&gt; It appears to be in zlib1g-dev
&lt;shachaf&gt; Cale: Since I already have the apt-get install typed in.
}}}
   === 
  === 
</pre>
</div>
<div title="2007-12-24" modifier="Conal Elliott" created="200801072023" tags="2007-12 day" changecount="1">
<pre>* Correspondence on thread GC: +++&gt;
Thanks, Simon.  If I understand the mechanism you're describing, it discards readers of an empty MVar when there are no other references to the MVar *because* the MVar can never get written.  And if there are other readers but no writers, then I'm guessing GC wouldn't know that, and none of the readers get discarded.  Is that so?

I think Baker &amp; Hewitt's trick was analogous to discarding writers of an already full MVar when there are readers (readMVar) but no takers (takeMVar).  (Though not quite, since readMVar is implemented via takeMVar &amp; putMVar.)  I guess that effectively means IVars instead of MVars.

In either direction (blocked reader or blocked writer), the interface of MVars (or IVars) would seem to prevent an accurate analysis, since GC wouldn't know whether a Var reference was for reading or writing.  Right?  A simple solution might be to hide the Var itself and instead expose reader and writer halves.  If there's an analysis problem at all, does that solution make sense?
  === 
</pre>
</div>
<div title="2007-12-25" modifier="Conal Elliott" created="200801072023" tags="2007-12 day" changecount="1">
<pre>* Hm.  My graphics card started working again.  I bought it on Feb 1, so assuming a 1-year warranty, I have about five weeks left.
* Piq:  ++++
*  Working great with //reactive// used in place of //DataDriven//, but only when interpreted.
*  When I run compiled with {{{-O2}}}, my textures get made &amp; reclaimed over &amp; over.  Also, the initial image set in imageDisplay gets used.  I'd had it undefined, and giving it a definition required adding a @defaultColor@ method to @ToPixel@.
*  If I compile with (-O), no texture churn, but it runs very slow.
*  Maybe the problem stems from my use of @unsafePerformIO@ in Reactive's @Data.Future@.  Adding some @NOINLINE@ pragmas.
  === 
* These problems start to show up even when I use just the //reactive// examples.  Interpreted works, and compiled doesn't.
</pre>
</div>
<div title="2007-12-26" modifier="Conal Elliott" created="200801072024" tags="2007-12 day" changecount="1">
<pre>* Tracking down the problem with compiled //Reactive//.  Perhaps it's about laziness vs unsafePerformIO.
* Finally found a solution: compile with {{{-threaded}}}.  See docs on [[Haskell threads and Operating System threads| http://www.haskell.org/ghc/docs/latest/html/libraries/base/Control-Concurrent.html#10]].  Speculation: ghci itself is compiled with {{{-threaded}}}.  Without {{{-threaded}}}, I get improved reactivity but not perfect if I explicitly @yield@ immediately after the @putMVar@.  In that case, output is always one step behind input.  I'd rather solve the problem with @yield@ than rely on {{{-threaded}}}.2
* Similarlity: ++++
\begin{code}
Data.Maybe.catMaybes :: [Maybe a] -&gt; [a]
Data.Event.justE     :: Event (Maybe a) -&gt; Event a
\end{code}
  === Is there a common generalization?  Yes, thanks to oerjan on IRC: ++++
\begin{code}
joinMaybes :: MonadPlus m =&gt; m (Maybe a) -&gt; m a
joinMaybes = (&gt;&gt;= maybe mzero return)
\end{code}
  === Filtering also: ++++
\begin{code}
filterMP :: MonadPlus m =&gt; (a -&gt; Bool) -&gt; m a -&gt; m a
filterMP p e = joinMaybes (liftM f e)
 where
   f a | p a       = Just a
       | otherwise = Nothing
\end{code}
  === Alternatively (thanks to oerjan again): ++++
\begin{code}
filterMP p m = m &gt;&gt;= guarded p
 where
   guarded p x = guard (p x) &gt;&gt; return x
\end{code}
  === or even @filterMP = (=&lt;&lt;) . guarded@ (thanks to lambdabot).
</pre>
</div>
<div title="2007-12-27" modifier="Conal Elliott" created="200801072024" tags="2007-12 day" changecount="1">
<pre>* Tracking down the problem with compiled //Reactive//.  Perhaps it's about laziness vs unsafePerformIO.
* Finally found a solution: compile with {{{-threaded}}}.  See docs on [[Haskell threads and Operating System threads| http://www.haskell.org/ghc/docs/latest/html/libraries/base/Control-Concurrent.html#10]].  Speculation: ghci itself is compiled with {{{-threaded}}}.  Without {{{-threaded}}}, I get improved reactivity but not perfect if I explicitly @yield@ immediately after the @putMVar@.  In that case, output is always one step behind input.  I'd rather solve the problem with @yield@ than rely on {{{-threaded}}}.2
* Similarlity: ++++
\begin{code}
Data.Maybe.catMaybes :: [Maybe a] -&gt; [a]
Data.Event.justE     :: Event (Maybe a) -&gt; Event a
\end{code}
  === Is there a common generalization?  Yes, thanks to oerjan on IRC: ++++
\begin{code}
joinMaybes :: MonadPlus m =&gt; m (Maybe a) -&gt; m a
joinMaybes = (&gt;&gt;= maybe mzero return)
\end{code}
  === Filtering also: ++++
\begin{code}
filterMP :: MonadPlus m =&gt; (a -&gt; Bool) -&gt; m a -&gt; m a
filterMP p e = joinMaybes (liftM f e)
 where
   f a | p a       = Just a
       | otherwise = Nothing
\end{code}
  === Alternatively (thanks to oerjan again): ++++
\begin{code}
filterMP p m = m &gt;&gt;= guarded p
 where
   guarded p x = guard (p x) &gt;&gt; return x
\end{code}
  === or even @filterMP = (=&lt;&lt;) . guarded@ (thanks to lambdabot).


:: 2007-12-27 [2007-12 day]
* Poking around at my threading issue.  //Two// yields after each @putMVar@ suffice for a simple example, but not a slightly more complex example.  I guess I'll stick with {{{-threaded}}}.  Unfortunately, I think each client executable must be compiled (linkled) with {{{-threaded}}}.  Oh well.
* I released (on Hackage) phooey-1.4 (on DataDriven), reactive-0.0, and phooey-2.0 (on reactive).  Emailed yampa-users about reactive, asking for comments.
* {{{ghc-pkg}}} was getting bogged down.  Fixed with {{{make unreg}}} in {{{~/Haskell}}}.
* Asked about double-buffering.  Svrog on IRC offered to help me with opengl stuff.
</pre>
</div>
<div title="2007-12-28" modifier="Conal Elliott" created="200801072024" tags="2007-12 day" changecount="1">
<pre>* Reply to &quot;NVC and Christianity&quot;.
* Wireless stopped working on my new computer.  It turned out that I accidentally turned off the antenna while fiddling with boot settings when my GPU stopped working.  Now I wonder if something similar happened on my linux computer.
* Stumbled across [[Linux on the Acer TravelMate 800LCi| http://bernd-wurst.de/linux/tm800.php]].  Points to a [[Intel® PRO/Wireless 2100 Driver for Linux| http://ipw2100.sourceforge.net]].
* I found the [[Acer TravelMate 800 user's manual| http://www.acersupport.com/library/tm800ug.pdf]].  The wifi on/off button is right of the two silver buttons on the front.  For a bit, both routers showed up with strong signals, though I still didn't get on the internet.  Rebooted.  Waited a bit, and it works!
* Something is going badly with //Piq// on //Reactive//.  Responsiveness slows down quite a lot with interaction.  I wonder if it has to do with starting so many threads.  In the Piq examples, I'm dragging the mouse around.  Each &quot;motion&quot; event occurrence leads to a number of new threads.  I'd expect sliders to be similar, and yet the slider examples in Reactive and Phooey have no trouble keeping up.  Also, when compiled, I get a lot of unexpected computation.  When I cover &amp; uncover the display window, the contents all get recalculated.  When I pan around, everything gets recomputed on every move.  Wow -- now I see that the objects (index wrappers) are getting reclaimed immediately after displaying.  Whether this happens depends on which modules are compiled with -O (or -O2) and which compiled without optimization, or are just interpreted.  I think the crucial module is Display, which contains the memoization.  Sure enough -- when I mark that module with {{{-Onot}}}, I stop losing my textures too soon.  However, in that case, my textures never get finalized.  Hm.  I retried and got different results.
</pre>
</div>
<div title="2007-12-30" modifier="Conal Elliott" created="200801072339" tags="2007-12 day" changecount="1">
<pre>* Got a note from Mads Lindstroem about Reactive.  He pointed out that wxHaskell is not thread-safe, and that I invoke it from many threads.  Did a bit of searching: ++++
*  [[FFI and callbacks| http://www.haskell.org/pipermail/haskell-cafe/2005-August/011042.html]].  Tidbits: ++++
*   A GUI toolkit's main event loop blocks, so either (a) use {{{-threaded}}}, or (b) set up a timer with a call-back that does a frequent @yield@.
*   &quot;It may appear [safe to call wxHaskell GUI functions from several threads at once] at first and then mysteriously fail. I don't think wx is thread safe (since the underlying gui libs are not thread safe either). I don't believe that wx does it's own per-widget locking, but I may be wrong.&quot;
*   From the [[wxWidgets manual| http://www.wxwidgets.org/manuals/2.4.2/wx494.htm]] +++&gt;
If you do decide to use threads in your application, it is strongly recommended that no more than one thread calls GUI functions. The thread sample shows that it is possible for many different threads to call GUI functions at once (all the threads created in the sample access GUI), but it is a very poor design choice for anything except an example. The design which uses one GUI thread and several worker threads which communicate with the main one using events is much more robust and will undoubtedly save you countless problems (example: under Win32 a thread can only access GDI objects such as pens, brushes, &amp;c created by itself and not by the other threads).
    === 
   === 
  === 
* Ubuntu: ++++
*  {{{dpkg -L &lt;pkg-name&gt;}}} to list the contents of a package.
*  {{{/usr/share/emacs/22.1/}}}
*  [[Jabber IM in Emacs| http://www.emacswiki.org/cgi-bin/wiki/JabberEl]]
  ===
* Interested in Vertigo revival: Ivan Tomac (svrog, tomac,pacific.net.au), jsnx (Jason Dusek, jsn,rtc0.net).
</pre>
</div>
<div title="2007-12-31" modifier="Conal Elliott" created="200801072339" tags="2007-12 day" changecount="1">
<pre>* Reactive: ++++
*  I tried the @yield@-in-a-timer approach.  It works fine, with an interesting artifact: if I drag a slider around, the output takes several iterations to catch up.  Adding in {{{-threaded}}} eliminates the artifact.  I think it's because the various threads get scheduled //fairly//, which means the main thread (with the event loop) is scheduled as often as the reactive threads.  Without {{{-threaded}}}, the event loop blocks.  I can get fairly zippy performance by setting the timer interval for 10ms (100/sec).  However, there's an interesting remaining problem: //all// of the motion events get processed.  The slider threads finish their work very quickly, and the consequences of those inputs pile up and all get executed eventually.
*  Is there literature somewhere on the practice of discarding occurrences of motion &quot;events&quot;?
*  Idea: have each output save its latest value in a ref.  Thanks to laziness, overwritten values won't actually get computed.  Each output also has a timer, which grabs the most recent value and sends it out.  Make the ref be Maybe-valued, and reset to Nothing after output.  Better yet, turn off the timer after output and turn back on when a value arrives.  That way, outputs won't eat cycles when they quiesce.  Tried out this idea.  Work well with a Maybe-valued ref and a timer or idle that keeps going, but not with a timer that turns on &amp; off.  I don't know why.
*  Pushed new versions of Reactive and Phooey.  Piq still acts weirdly.  Maybe because of multi-threading and OpenGL.
*  I think I'm okay with the texture allocation &amp; drawing done under @forkR@.  They won't really get evaluated until they're pulled on by display, which happens in an idler (an @on idle@ handler).
*  On the other hand, the texture finalizers are now happening outside of the main thread, which is probably problematic.
*  When I drag around an image, it starts out fast and slows down dramatically, even when there's no more allocation going on.
  === 
* Consider [[UIST| http://www.acm.org/uist]] 2008, October 19-22, 2008 in Monterey, CA.  The submission date is not yet posted, but last year's was March 30.
* Looking into multi-monitor support for Ubuntu on my Acer 800lci.  The card is an ATI mobility Radeon 9000.
* Trying to get multi-monitor to work in Linux.  Got jabber account on chat.seereason.org.  Getting help there.  Installed {{{grandr}}}, which crashes.  Found ATI linux drivers.  Wait until I have more bandwidth.
</pre>
</div>
<div title="2008" modifier="Conal Elliott" created="200801120320" tags="year" changecount="1">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2008-01" modifier="Conal Elliott" created="200801120319" tags="2008 January month" changecount="1">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="2008-01-01" modifier="Conal Elliott" created="200801072340" tags="2008-01 day" changecount="1">
<pre>* 2008!
* Various chats on #haskell related to TV/Eros and the idea of composable apps.  Spin-off conversation with [[yaxu| http://yaxu.org]] (saved).  He pointed me to this [[livecoding demo| http://homepage.mac.com/digego/study_in_keith.mov]].  Wow.
* Wondering about the weird Piq behavior of progressively slowing when dragging.  It effects both zoom &amp; pan.  In contrast, changing the image itself doesn't have that problem.  For testing, I defined a widget that just computes a cumulative pan/zoom, with no opengl stuff.  It has the same slow-down, including a fast-growing space leak.  The memory stays allocated even after I quit the app. Now I believe I'm closer to finding the source of the problem.  Whew!
* Leak occurs with @motionDiff'@.
* Stimulating exchanges on NVC-cert about Christianity and about &quot;rights&quot;.
* Thought: Here's an interpretation of whatever Jesus said what got translated as &quot;Judge not, that you be not judged.  For with the judgment that you pronounce you will be judged .....&quot;.  Perhaps he meant that when we think we're judging others, we're really judging our shadow selves.
</pre>
</div>
<div title="2008-01-02" modifier="Conal Elliott" created="200801072340" tags="2008-01 day" changecount="1">
<pre>* To allow IRC messages from unregistered users: {{{/msg nickserv set unfiltered on}}}.
* Finally i found a mouse example that does not space leak.  The crucial difference seems to be absence of @joinMaybes@ (previously called @justE@). ++++
\begin{code}
-- | Pass through @Just@ occurrences.
joinMaybes :: MonadPlus m =&gt; m (Maybe a) -&gt; m a
joinMaybes = (&gt;&gt;= maybe mzero return)
\end{code}
  === Space-leak also with this specialization: ++++
\begin{code}
justE :: Event (Maybe a) -&gt; Event a
justE = inEvent (h =&lt;&lt;)  -- note =&lt;&lt; instead of &lt;$&gt;
 where
   h (Just a  `Stepper` e') = return $ a `stepper` justE e'
   h (Nothing `Stepper` e') = eFuture (justE e')
\end{code}
  === Time to look at the @Monad@ instance. ++++
\begin{code}
instance Monad Event where
  return a = Event (pure (pure a))
  e &gt;&gt;= f  = joinE (fmap f e)

joinE :: forall a. Event (Event a) -&gt; Event a
joinE = inEvent q
 where
   q :: Future (Reactive (Event a)) -&gt; Future (Reactive a)
   q futre = futre &gt;&gt;= eFuture . h
   h :: Reactive (Event a) -&gt; Event a
   h (ea `Stepper` eea) = ea `mappend` joinE eea
\end{code}
  === Hm.  Could the space-time leak be from increasingly many active threads?  If the scheduler is playing round-robin with them, then a linearly growing set of threads would slow down about as I'm seeing.  But these threads would all have to be runnable, rather than terminated or blocked on empty MVars.  First simple test: take the non-leaking example and apply @(&gt;&gt;= return)@ to an event.  Now it leaks.  What happens in @(e &gt;&gt;= return)@? ++++
\begin{code}
e   :: Event a
fut :: Future (Reactive a)
get :: IO (Reactive a)

merge :: Future (Reactive a) -&gt; Future (Reactive a) -&gt; Future (Reactive a)

e = Event fut
fut = Future get

e &gt;&gt;= return
Event (Future get) &gt;&gt;= return
joinE (fmap return (Event (Future get)))
joinE (Event ((fmap.fmap) return (Future get)))
Event (q ((fmap.fmap) return (Future get)))
Event ((fmap.fmap) return (Future get) &gt;&gt;= eFuture . h)
Event (fmap (fmap return) (Future get) &gt;&gt;= eFuture . h)
Event (future (fmap (fmap return) get) &gt;&gt;= eFuture . h)

h (return a `Stepper` eea)
return a `mappend` joinE eea
Event (pure (pure a)) `mappend` joinE eea
Event (pure (a `stepper` mempty)) `mappend` joinE eea
Event (Future (return (a `stepper` mempty))) `mappend` joinE eea
Event (Future (return (a `stepper` mempty)) `merge` unEvent (joinE eea))

a `stepper` Event (mempty `merge` unEvent (joinE eea))
\end{code}
  === So what happens with @mempty `merge` fut@?  Since @merge@ cannot know that @mempty@ will never occur, it has to carry the @mempty@ around indefinitely.  In the case of @joinMaybes@, there are a lot of @mempty@s.  They all pile up.  Fix: make a special representation for never-occuring futures so they can be recognized.   ++++
\begin{code}
data Future a = Future (IO a) | Never
\end{code}
  === Did it.  Works out //very// nicely.  Allows many optimizations, such as: ++++
\begin{code}
Future getf &lt;*&gt; Future getx = future (getf &lt;*&gt; getx)
_           &lt;*&gt; _           = Never
\end{code}
  === 
</pre>
</div>
<div title="2008-01-03" modifier="Conal Elliott" created="200801072341" tags="2008-01 day" changecount="1">
<pre>* Journal of [[Visual Mathematics| http://www.mi.sanu.ac.yu/vismath/pap.htm]]
* Replied to James McCartney (father of [[SuperCollider| http://supercollider.sourceforge.net]]), who wrote me asking about fusion and its applicability  to algorithmic music.
* Replied to David Duke about functional graphics and TV.  I'm delighted with his question of the denotational domain for 3D scenes with internal interaction.  That's exactly the central question in my design process.  And one that I almost never hear asked.
</pre>
</div>
<div title="2008-01-06" modifier="Conal Elliott" modified="200801092008" created="200801072341" tags="2008-01 day" changecount="3">
<pre>* Reactivity: ++++
*  I want to do a third representation of reactive behaviors, to go with the listerner algebra version and the multi-threaded, future-based version.  This third one is similar to my old &quot;residual behaviors&quot; and the Yampa representation.  In those two representations, sampling returned a value and a new behavior (or signal function).  I'm thinking of something similar, but instead of sampling, it's about event occurrences.  The heart is a way to represent a subset of @Event a -&gt; Event b@: ++++
\begin{code}
-- event occurrence
type Occ a = (Time,a)
-- represents Event a -&gt; Event b
newtype EF a b = EF (Occ a -&gt; ([b], EF a b)
\end{code}
  === 
*  The catch is that I want to represent not just simple functions types like @Event a -&gt; Event b@, but also @Event a -&gt; Event b -&gt; Event c@.  Also, pairs and non-functions.  My idea is to transform all cases into the form @Event a -&gt; Event b@, possibly tupled with other such types.  For instance, ++++
\begin{code}
    Event a -&gt; Event b -&gt; Event c
=~= (Event a, Event b) -&gt; Event c
=~= Event (Either a b) -&gt; Event c
\end{code}
   === A non-function, @Event a@ can be converted to @Event () -&gt; Event a@, and fed with the never-occurring event (@mempty@).  Given a pair on the rhs of @-&gt;@, split into two functions.
*  What about reactive values?  Take apart the reactive value into initial value and event.
*  Look at Fudgets again.  I think [[Fudgets| http://www.md.chalmers.se/Cs/Research/Functional/Fudgets/publications.html]] used sums on communication channels.  Yes, for parallel composition: ++++
\begin{code}
(&gt;+&lt;) :: Fudget a b -&gt; Fudget a' b' -&gt; Fudget (Either a b) (Either a' b')
\end{code}
   === 
*  Generalized for arrows: ++++
\begin{code}
class Arrow a =&gt; ArrowChoice a where
  ...
  (+++) :: a b c -&gt; a b' c' -&gt; a (Either b b') (Either c c')
\end{code}
   === See also [[ProdArrows -- Arrows for Fudgets| http://www.cse.ogi.edu/~magnus/ProdArrows]] (talk slides).
  === 
</pre>
</div>
<div title="2008-01-07" modifier="Conal Elliott" created="200801092009" tags="2008-01 day" changecount="1">
<pre>* TV has visualizers for base (really any) types, pairs, and functions.  In particular, functions have //interactive// visualizations.  I can think of a GUI as visualizing a function of type @Int -&gt; String@ (for instance), or as visualizing a @Reactive Int -&gt; Reactive String@.  These functions on reactive values are of a restricted form, such as @fmap f@ where @f :: Int -&gt; String@.  Perhaps I can loosen up the form to involve other reactive forms as well, specifically (a) accumulation and (b) events. 
</pre>
</div>
<div title="2008-01-08" modifier="Conal Elliott" modified="200801092150" created="200801092009" tags="2008-01 day" changecount="2">
<pre>* Simplifying insight about GUIs: ++++
*  Start with the TV MVC insight: There are two kinds of GUIs: controllers &amp; views (input &amp; output).  Each has atomic and composite forms.  In particular, a //function view// combines an argument  controller and a result view.
*  The new insight: //every// view (not just atomic) has a &quot;value&quot; attribute.  For a function view, the attribute is function-valued.  When the value attribute of //either// the function view //or// the contained controller is changed, the result view's value attribute is set to the latest function value applied to the latest argument value.
*  Often, the situation isn't quite so simple.  The views might not be simply showing a static value, say a function mapped over one or more varying inputs.  Instead, it could be a more general function involving reactive values and events.  For instance, there could be continuous and/or discrete forms of accumulation (e.g., integration or event-counting).  In that case, use a &quot;stateful&quot; kind of function, such as the @EF@ notion from [[2008-01-06]].
  === 
* Instead of merging multiple inputs via @Either@, use a curried approach.  Using @(~&gt;)@ (right-associative) for @EF@, ++++
\begin{code}
a ~&gt; b ~&gt; c == a -&gt; ([b ~&gt; c], a ~&gt; b ~&gt; c)
	    == a -&gt; ([b -&gt; ([c], b ~&gt; c)], a ~&gt; b ~&gt; c)
\end{code}
  === A view for @a ~&gt; b ~&gt; c@ has two parts: an controller for @a@ and a view for @b ~&gt; c@.  When @a@ arrives, do what we always do: if the resulting @[b ~&gt; c]@ is nonempty, then install the last element.  In any case, carry on with the new @a ~&gt; b ~&gt; c@.  In other words, curried functions needn't have any special treatment.
* GUIs have dynamic values //and// dynamic views.  For instance, consider a TV for @f :: a -&gt; b -&gt; c@.  The outermost TV (@:: TV (a -&gt; b -&gt; c)@) has a static value (@f@) and a doubly-dynamic view (dynamic in the controllers for @a@ and @b@).  The next inner one (@:: TV (b -&gt; c)@) has a singly-dynamic value and a singly-dynamic view (@b@).  The innermost one (@:: TV c@) has a doubly-dynamic value (@a@) and a static view (@c@).
</pre>
</div>
<div title="2008-01-09" modifier="Conal Elliott" modified="200801102203" created="200801101919" tags="2008-01 day" changecount="5">
<pre>* Try out my @a ~&gt; b ~&gt; c@ idea from [[yesterday|2008-01-08]] on an accumulation example, e.g., two buttons and a display of the sum of presses.
* Started writing blog posts about [[Functional futures]] and [[Another take on functional reactivity]].  Got to wondering why futures aren't just lazy values.  I had thought I couldn't then implement the current @mappend@ operation, which yields the earlier of two futures.  My thinking was that I'd have to force the values to WHNF prematurely.  On reflection, I think that forcing wouldn't happen until the WHNF was demanded of them anyway.  I simplified the implementation, though keeping the explicit data type and a @Never@ constructor.  Old representation: ++++
\begin{code}
data Future a = Future (IO a) | Never
\end{code}
  === New representation: ++++
\begin{code}
data Future a = Future a | Never
\end{code}
  === The implementation simplifies accordingly.  For instance, instead of  ++++
\begin{code}
Future getf &lt;*&gt; Future getx = future (getf &lt;*&gt; getx)
\end{code}
  === I have simply ++++
\begin{code}
Future f &lt;*&gt; Future x = Future (f x)
\end{code}
  === The other cases (involving @Never@) remain as is.  By eliminating @IO@ fm the representation, the uniqueness of value is perfectly clear.  It works for all of my examples in Reactive, Phooey, and GuiTV, but not Piq.  Hm!
* Why not eliminate the @Future@ type altogether, in favor of using lazy values directly?  ++++
*  The @Never@ optimizations are very important (see [[2008-01-02]]).
*  A precise &amp; deterministic semantics requires more information than just the value.  It needs an associated time as well, or at least some kind of temporal total ordering.
  === 
* Discussion on #haskell about how to simply &amp; cheaply block an IO thread forever.  I was using @newEmptyMVar &gt;&gt;= takeMVar@.  sjanssen pointed out that it will throw a &quot;thread blocked&quot; exception, as will @atomically retry@.  I tried various incantations, but the only one that worked was sjanssen's @forever $ threadDelay maxBound@.</pre>
</div>
<div title="2008-01-10" modifier="Conal Elliott" created="200801120304" tags="2008-01 day" changecount="1">
<pre>* Realization about the problem of blocking forever mentioned [[yesterday|2008-01-09]]: if I use CPS, then I can simply terminate.  Suppose I have a continuation @k :: a -&gt; IO o@ to run after an @IO a@.  Then blocking forever would mean @k@ doesn't get run, so all I have to do is nothing.
* Think again about a correct (and hence deterministic) implementation of functional futures. ++++
*  What kind of thing is the //time// value that accompanies a regular lazy value?  It has to support a total ordering and have a lazy structure of its own.
*  Define a type of partial information about times. ++++
\begin{code}
data TimeInfo t = Exactly t | AtLeast t
\end{code}
   === Represent an &quot;improving time&quot; (from Warren Burton's &quot;improving values&quot;) as an action for computing the latest known @TimeInfo@.  The action may return different time-infos, but the answers must be monotonic, w.r.t the information ordering.
*  For improving times @t@ and @t'@, to determine whether @t &lt;= t'@, first spin two threads running race to force the exact values of the two times.  Whichever thread wins the races kills the other thread and then asks the question of how the loser compares to the winner's exact value.
*  There are really two different questions.  If @t@ wins, with an exact value @et@, then the question is whether @t' &gt;= et@.  If @t'@ wins, with an exact value @et'@, then the question is whether @t &gt; et'@ (note //strictly// less than).
*  The primitives we need then are @geT, gtT :: ITime t -&gt; t -&gt; Bool@.  These primitives are //semantically pure// in that they give the same result for the same arguments.  They may block for a while if the answer isn't yet knowable.
</pre>
</div>
<div title="2008-01-11" modifier="Conal Elliott" created="200801131815" tags="2008-01 day" changecount="1">
<pre>* Fixed my darcs problem on conal.net.  The darcs executable is in my {{{~/bin}}}, which was added to {{{PATH}}} in my {{{.bash_profile}}}.  That file only gets used for login shells, hence not for ssh-based commands.  The fix (thanks to shachaf on #haskell): set {{{PATH}}} in {{{.bashrc}}} instead.  Success!  Now I have my journal under darcs control, so the server copy gets updated incrementally.
</pre>
</div>
<div title="2008-01-12" modifier="Conal Elliott" created="200801131816" tags="2008-01 day" changecount="1">
<pre>* I've been noodling over how to handle pair-valued input conveniently.  I thought I wanted to use sum types, as in Fudgets, denoting an event in the first half or one in the second half of a pair.  On the other hand, I want a //pair//, not a sum, for initialization.  Magnus Carlsson looked into the mismatch between arrows and fudgets in [[ProdArrows -- Arrows for Fudgets| http://www.cse.ogi.edu/~magnus/ProdArrows]].  Here's a new idea I like a lot.  Think of the sum as encoding a way to //edit// a pair.  Then @Left a@ represents @\ (_,b) -&gt; (a,b)@ and @Right b@ represents @\ (a,_) -&gt; (a,b)@.  In other words @first (const a)@ and @second (const b)@.  This latter rewriting suggests a nice generalization.  Instead of streams of values, each //replacing// the previous, consume and produce streams of edit functions, each //modifying// the previous.  And define the edit functions compositionally, e.g., using [[DeepArrow| http://haskell.org/haskellwiki/DeepArrow]].  If this idea works out, its efficiency benefit could go much further than just protecting unchanging tuple members from changing tupler members.  Even for a single atomic value, I might be able to get incremental computation.  &quot;Compositional incremental computation&quot;.
</pre>
</div>
<div title="2008-01-13" modifier="Conal Elliott" created="200801172013" tags="2008-01 day" changecount="1">
<pre>* Getting a better ATI video driver installed on my Ubuntu computer. ++++
*  Downloaded a big driver set-up from ATI, but it [[didn't work| http://lists.debian.org/debian-user/2007/08/msg00868.html]].  
*  Trying the [[The Radeon open-source driver (ati)| https://help.ubuntu.com/community/RadeonDriver]] instead.
*  [[Removed the proprietary fglrx driver| https://help.ubuntu.com/community/RadeonDriver#head-229f59879c2a2b6c6635d1e189706d97f836b879]]
*  Experimented with [[xrandr| http://wiki.debian.org/XStrikeForce/HowToRandR12]] settings.  Found this combination: ++++
{{{
xrandr --auto
xrandr --output VGA-0 --left-of LVDS
xrandr --output VGA-0 --rotate left
}}}
   === That basically does what I want, but the quality is terrible.  My external monitor shows streaky text, and update is very slow.  Try again later.  Even with just a single head, 3D graphics runs considerably slower.  Experiment with driver settings to see if I can improve the performance.  If not, consider switching back to the proprietary ATI driver.
  === 
</pre>
</div>
<div title="2008-01-14" modifier="Conal Elliott" created="200801172014" tags="2008-01 day" changecount="1">
<pre>* More blog writing. ++++
*  Using [[Markdown| http://daringfireball.net/projects/markdown]].
*  I gave up on Blogger, where I've been keeping my [[technical blog| http://conal-elliott.blogspot.com]].  It removes one leading space per line of pre-formatted html on every edit/preview cycle.
*  Set up a [[new blog| http://conal.net/blog]] with WordPress.
*  Found a post on [[Syntax highlighting with Markdown in WordPress| http://www.dougalstanton.net/blog/index.php/2007/12/15/syntax-highlighting-with-markdown-in-wordpress]].  It uses a combination of [[PHP Markdown Extra| http://michelf.com/projects/php-markdown/extra]] and [[GeSHi| http://qbnz.com/highlighter]] (Generic Syntax Highlighter), plus a small extension to specify which language for a block of code.  It works great.  I tweaked the PHP code to make the default language be Haskell instead of txt.  The GeSHi-decorated code even has links to library documentation, which I love.
*  I had a bit of trouble along the way and got help on the #wordpress IRC channel.  It turned out that I hadn't followed the installation directions for PHP Markdown Extra, which say to move markdown.php out of its directory directly into my plugins directory.  Once I knew to look in the Apache error log, it was pretty easy to track down the problem.
*  Still to do: ++++
*   Better blog name &amp; url.
*   Different theme.  I like horizontally stretchy ones.
*   Learn how to add documentation links to GeSHi.
*   When I want to go public, get Haskell Planet to point to the new blog.
   === 
  === 
</pre>
</div>
<div title="2008-01-15" modifier="Conal Elliott" created="200801172015" tags="2008-01 day" changecount="1">
<pre>* Blog obsession: ++++
*  I think I like this permalink structure: {{{/%year%-%monthnum%/%postname%}}}.  Then URLs are fairly informative, and I don't have to worry much about unique titles.
*  [[WordPress 2.3| http://codex.wordpress.org/Version_2.3]] has both //tags// in addition to //categories//.  I've been using categories liberally as tags.  Some themes show tags, and some don't.  Find one that does.  There's a category-&gt;tag converter under Manage/Import.  Be careful not to convert &quot;Uncategorized&quot;.
*  There doesn't seem to be a command to rename a mysql database.  To delete it, do {{{drop database &lt;dbname&gt;}}}.
*  Christophe P (vincenz) has a fairly nice [[Haskell blog| http://notvincenz.blogspot.com/2007/07/higher-order-zippers.html]] in Blogger.  He writes straight html into a .lhs, pastes math bits in from [[wikybox| http://goessner.net/articles/wiky]], and run the result through hscolour.
*  On WP's Options/Reading: &quot;Note: If you use the {{{&lt;!--more--&gt;}}} feature, it will cut off posts in RSS feeds.&quot;
*  [[How To Add Wordpress 2.3 Tags To Your Current Theme| http://richgilchrest.com/how-to-add-wordpress-23-tags-to-your-current-theme]].  I added a tag list and (for now) hid the categories in index.php and single.php, in the fluid-blue-10 theme.  I also tweaked the sidebar widget list in Presentation/Widgets.
  === 
* Exchanged email with Levi Stephen, who's implementing a web-server (in part) with my Reactive library.  I simplified &amp; cleaned up his code.  Still some more fundamental rethinking to do.
* Talk title: &quot;Rescuing Functional I/O&quot;.  (Also &quot;rescuing&quot; &amp; &quot;rehabilitating&quot;.)  Simple idea: return to the old stream model for I/O, but using functional events in place of streams.  Benefit over monadic I/O: tractable semantics for reasoning.  Benefit over old stream I/O: static typing, clarity, ease of use, composability.  (Guesses.)

</pre>
</div>
<div title="2008-01-16" modifier="Conal Elliott" created="200801172015" tags="2008-01 day" changecount="1">
<pre>* Ivan Tomac sent a bug report for Reactive.  switcher gave an infinite loop.  I'd suspected my definition wasn't well-founded, but I guess fooled myself into thinking it was tested.  I broke the definition cycle with an elegant definition of join for Reactive, and did a darcs push as well as releasing a new version (0.2) on hackage.  The definition: ++++
\begin{code}
-- Reactive 'join'
joinR :: Reactive (Reactive a) -&gt; Reactive a
joinR ((a `Stepper` Event fut) `Stepper` e'@(Event fut')) =
  a `stepper` Event fut''
 where
   -- If fut  arrives first, switch and continue waiting for e'.
   -- If fut' arrives first, abandon fut and keep switching with new
   -- reactive values from fut'.
   fut'' = fmap (`switcher` e') fut `mappend` fmap join fut'
\end{code}
  === 
* NVC-Cert note: &quot;Out Beyond Certification ...&quot;.
* Emacs-futzing for markdown editing (mmm).
* What do I really want to say in blog posts about reactive values? ++++
*  Working title &quot;Reactive values from the future&quot;
*  Briefly explain the meaning of reactive values and events.
*  Informally explain class instances for @Reactive@ and @Event@.
*  Stepper and Switcher.
*  Continuous reactive behaviors.
*  Reactive normal form.
  === 
* Blogging: Fixed the [[You don't have permission to do that| http://blog.fyais.com/2007/04/15/you-don%E2%80%99t-have-permission-to-do-that-another-solution/]] problem.
</pre>
</div>
<div title="2008-01-17" modifier="Conal Elliott" created="200802111833" tags="2008-01 day" changecount="1">
<pre>* NVC-cert note &quot;Getting past helplessness -- a co-creative opportunity&quot;.
* sjanssen used kolmodin's hinotify to make [[a small mail notification script| http://hpaste.org/5070]].  His version is imperative throughout.  I bet it could be given an elegant functional formulation using Reactive.
</pre>
</div>
<div title="2008-01-18" modifier="Conal Elliott" created="200802111834" tags="2008-01 day" changecount="1">
<pre>* Replied to Pierre-Evariste Dagand about his FRP+arrow-based network overlay paper.
</pre>
</div>
<div title="2008-01-19" modifier="Conal Elliott" created="200802111835" tags="2008-01 day" changecount="1">
<pre>* Finished draft of blog post &quot;Reactive values from the future&quot;.  It's rather long, and I think I'd like to split it into one on interface &amp; implementation and a second one on the implementation, which is also what I did for future values.
* Replied to Levi Stephen about functional reactive web programming.  An excerpt: ++++&gt;
I'm looking for applications of the Monad interface to events.  I think it's a very powerful tool for doing dynamic/branching things, and I strongly suspect there are compelling network applications.  In particular, join handles event-valued events.  For instance, the event of forming a connection to a web server might yield a new event for each new connection.  Each new event corresponds to the stream of requests for a given connection.  I haven't thought much about networking, and I'm wondering what kinds of applications would take multiple requests per connection.  Maybe I'm mixing up &quot;connections&quot; and &quot;sessions&quot;.  And maybe I'm thinking too specifically here about one &quot;connection&quot;.  Perhaps another example is user registration, which then yields a new user-specific event (stream of requests from that particular user).
  === 
* Think about a session example, say a multi-step interaction with cumulative &quot;state&quot; (which, btw, was John Hugues's prime motivating example for arrows). ++++
*  A little HTML UI with a button and a display saying how many times the user has pressed the button.  Of course, each user has a separate counter.
*  Add a display for the current average across all users.
*  Replace the counter with a thumbs-up/thumbs-down control (+1/0/-1) and a running total across all users, as in reddit.
  === 
* Replied to Pierre-Evariste about his &quot;functional-reactive overlays&quot; work.
* Working on my reactive value blog posts.  I discovered a lovely pattern in the denotational semantics of functional reactivity.  The meanings of the class methods is very simply defined in terms  of the same methods on the meanings of the method arguments. ++++
\begin{code}
me :: Event a -&gt; ([] :. (,) Time) a

instance Functor Event where
  me (fmap f e) = fmap f (me e)

instance Applicative Event where
  me (pure a)    = pure a
  me (ef &lt;*&gt; ex) = me ef &lt;*&gt; me ex

instance Monad Event where
  me (return a) = return a
  me (join ee)  = join (fmap me (me ee))

mr :: Reactive a -&gt; (Time -&gt; a)

instance Functor Reactive where
  mr (fmap f r) = fmap f (mr r)

instance Applicative Reactive where
  mr (pure a)    = pure a
  mr (rf &lt;*&gt; rx) = mr rf &lt;*&gt; mr rx

instance Monad Reactive where
  mr (return a) = return a
  mr (join rr)  = join (fmap mr (mr rr))
\end{code}
  === This spec is structured after Haskell instance declarations, but it isn't legal Haskell code.  Note the somewhat obscure reformulation of @(Time,a)@ in order to leverage the instances for type compositions.  To do: make a new module @Data.SReactive@ and a set of QuickCheck properties that relate the implementation to the semantics.
* For the semantics of events, try replacing the list of futures with something like @newtype SEvent a = SEvent (Future (a, SEvent a))@.  I think then I'll get the time-sorting by construction instead of by constraint.
</pre>
</div>
<div title="2008-01-20" modifier="Conal Elliott" modified="200802111836" created="200802111835" tags="2008-01 day" changecount="2">
<pre>* Mulling over yesterday's realization about the structure of semantics for events and reactive values.  Suppose I have a @Semantics@ type class to capture the pattern.  Or one class per arity of type constructor. ++++
\begin{code}
class Semantics rep sem | rep -&gt; sem where
  meaning :: rep -&gt; sem

class Semantics1 rep sem | rep -&gt; sem where
  meaning1 :: forall a. rep a -&gt; sem a

-- ...
\end{code}
  === Require meaning functions to be homomorphic over standard class methods.  Here's a spec based on instance declarations. ++++
\begin{code}
instance (Semantics rep sem, Monoid sem) =&gt; Monoid rep where
  meaning mempty           = mempty
  meaning (r `mappend` r') = meaning r `mappend` meaning r'

instance (Semantics1 rep sem, Functor sem) =&gt; Functor rep where
  meaning (fmap f r) = fmap f (meaning r)

instance (Semantics1 rep sem, Applicative sem) =&gt; Applicative rep where
  meaning (rf &lt;*&gt; rx) = meaning rf &lt;*&gt; meaning rx

instance (Semantics1 rep sem, Monad sem) =&gt; Monad rep where
  meaning (return a) = return a
  meaning (join rr)  = join (meaning . meaning rr)
\end{code}
  === I could write these specifications as Haskell rules and/or QuickCheck tests.  Perhaps there's also a nice connection with the [[wrapper/worker transformation| http://unsafeperformio.com/paper.php?id=13]].  The instance specs above say that whenever the semantics is an instance, the representation must be also.  A weaker requirement would be that *if* the semantics and representation are both instances class, *then* the homomorphisms hold for the class's instances.
* What about @(&gt;&gt;=)@?  Calculate it: ++++
\begin{code}
meaning (r &gt;&gt;= f) = meaning (join (fmap f r))
		  = join (fmap meaning (meaning (fmap f r)))
		  = join (fmap meaning (fmap f (meaning r)))
		  = join (fmap (meaning.f) (meaning r))
		  = meaning r &gt;&gt;= meaning . f
\end{code}
  === Or calculate in reverse: ++++
\begin{code}
meaning (join rr) = meaning (rr &gt;&gt;= id)
		  = meaning rr &gt;&gt;= meaning . id
		  = meaning rr &gt;&gt;= meaning
		  = join (fmap meaning (meaning rr))
\end{code}
  === I like the look of the @meaning (r &gt;&gt;= f)@ definition and of the derived meaning of @join@ in terms of @(&gt;&gt;=)@.
* The @Monoid@ and @Monad@ specs for @Event@ don't work, because the semantic domain lacks the required @Monoid@ and @Monad@ instances.  Conjecture: there's a better semantics that does have the required instances, and those instances do exactly the right thing.  Start with @Monoid@.  If the model is a list, then @mempty@ (i.e., @[]@) will work fine but @mappend@ (i.e., @(++)@) won't at all be what I want.  How about some kind of @MergeList@ or @MergeStream@ that presumes ordered elements?  Or maybe just @Stream@, which doesn't have a @Monoid@ instance.  Or maybe I want a different structure.  Instead of a stream of time/value pairs, where a stream is an element and a stream, perhaps have a time and a value+stream. ++++
\begin{code}
newtype Event a = Future (a, Event a)
\end{code}
  === Or simply ++++
\begin{code}
newtype Event a = Future (Reactive a)
\end{code}
  === as in my current representation.  Hm.  While @Future@ is a monoid, it's not the monoid I want.
* Have another go at a semantically direct representation for events: as a list of future values.  Not quite a list, but rather a *merge-list*, a @newtype@-wrapping around a list, with a @Monoid@ instance that merges. ++++
\begin{code}
instance Monoid (Event a) where
  mempty  = Event mempty
  Event fut `mappend` Event fut' = Event (fut `merge` fut')

-- | Merge two 'Future' streams into one.
merge :: Future (Reactive a) -&gt; Future (Reactive a) -&gt; Future (Reactive a)
Never `merge` fut   = fut
fut   `merge` Never = fut
u     `merge` v     =
  (onFut (`merge` v) &lt;$&gt; u) `mappend` (onFut (u `merge`) &lt;$&gt; v)
 where
   onFut f (a `Stepper` Event t') = a `stepper` Event (f t')
\end{code}
  === 
</pre>
</div>
<div title="2008-01-22" modifier="Conal Elliott" created="200802111836" tags="2008-01 day" changecount="1">
<pre>* Some Reactive thoughts: ++++
*  My @Future@ type is like @Maybe@ and could probably be replaced by @Maybe@, with @Never@ replaced by @Nothing@.  Check the instances.
*  The @Never@ (or @Nothing@) could be moved out of @Future@ into @Event@.
  === 
</pre>
</div>
<div title="2008-01-23" modifier="Conal Elliott" created="200802111836" tags="2008-01 day" changecount="1">
<pre>* A bit more correspondence about certification &amp; needs.
</pre>
</div>
<div title="2008-01-25" modifier="Conal Elliott" modified="200802111851" created="200802111837" tags="2008-01 day" changecount="6">
<pre>* Title: &quot;Can functional programming be liberated from the von Neumann style?&quot;.  Perhaps as a co-title with &quot;Rescuing functional I/O&quot;.
* Working on my Reactive blog posts.  Notes: ++++
*  Talk about adaptive, data-driven evaluation as opposed to demand-driven.
*  Think about special monoid-related functions.  Combine reactive values with @mappend@.  When values quiesce to @mempty@, remove them.
*  References must come before the {{{&lt;!--more--&gt;}}}, or they'll be lost to the teaser.
*  The feed came out in a truncated, text-only form.  Yuck.  I changed the RSS config from &quot;summary&quot; to &quot;full text&quot;.  I hope that fixes the problem.  It did!
  === 
* I meant to write about @joinMaybes@ in a blog post.  Did it: [[A handy generalized filter| http://conal.net/blog/posts/a-handy-generalized-filter/]].
* I think I can reformulate my event and reactive value types in a more straightforward way, as I was exploring last week.  Represent an event as a list of time/value pairs, in which the times are monotonicity non-decreasing.  Use list finiteness rather @Never@ for non-occurring events.  The one tricky question is how to compare the times without forcing them.  Feed primitive events from Concurrent Haskell channels, using @getChanContents :: Chan a -&gt; IO [a]@.  Can [[mergeIO| http://www.haskell.org/ghc/docs/latest/html/libraries/base/Control-Concurrent.html#v%3AmergeIO]] help?
* I also want to get past this basic model of events &amp; reactive values to an explicit arrow approach.  I think the multi-threading and indeterminacy will vanish.  The interesting bit is probably curried arrows.  Puzzle: do I have something like both events and reactive values or just one?
</pre>
</div>
<div title="2008-01-26" modifier="Conal Elliott" created="200802111837" tags="2008-01 day" changecount="1">
<pre>* Thinking about Levi's suggested example of a simple blog server.  How could one be formulated in a very functional way? ++++
*  The blog database is a varying value, defined in terms of a stream of modification requests and sampled via streams of queries.
*  The modification stream results from the interleaving of many streams.
*  The individual streams might correspond to sessions or to users.
*  Consider a query stream as containing functions to be applied to the varying blog.  It's a combination of @snapshot@ and function application: @uncurry ($) &lt;$&gt; (query `snapshot` blog)@.  It's a very important implementation detail that the function application happen on the server, to reduce transmission.
*  What about privacy?
  === </pre>
</div>
<div title="2008-01-27" modifier="Conal Elliott" created="200802111838" tags="2008-01 day" changecount="1">
<pre>* Thoughts on simpler Reactive implementation: ++++
*  My goal is for the implementation to match the semantics as closely as possible: a future is a time/value pair, and an event is a list of futures.
*  The remaining puzzle is how to compare a future time with a concrete time value, without having to force the future time.
*  Idea: have the representation of a future time include a function that compares with a concrete time value.  For a primitive event (from @mkEvent@), the comparison function would first see if the actual time is known.  If so, it uses that time and does a regular comparison.  Otherwise, it uses its current notion of time.  If its current time is later than the concrete query time, then it can answer immediately.  Otherwise, it blocks until it can answer.  How does an event get a notion of current time?  It delegates to a shared clock.
*  Hm.  Still doesn't sound quite as simple as I'd like.
  === 
* Get to work on the next version of reactivity, based on some transformation types (probably arrows). ++++
*  One possibility is as a function that reacts to an input by producing zero or more outputs and a residual reactive transformation. ++++
\begin{code}
newtype ETrans a b = ETrans (a -&gt; ([b], ETrans a b))
\end{code}
   === Or drop the new residual: ++++
\begin{code}
type ETrans' a b = a -&gt; [b]

type ETrans = Kleisli []
\end{code}
   === With this latter definition, we get the arrow for free.  Is the residual @ETrans@ just an optimization?  I've forgotten.  Could it be layered on as some kind of arrow transformer, or perhaps an alternative to @Kleisli@?
*  I think @ETrans a b@ is an implementation of a commonly used subset of @Event a -&gt; Event b@.  What about @Reactive a -&gt; Reactive b@, or isomorphically, @(a,Event a) -&gt; (b,Event b)@?  The initial @b@ would depend only on the initial @a@.  I'm not sure about the event part.  Try limiting it to depend only on the source event. ++++
\begin{code}
data RTrans a b = RTrans (a -&gt; b) (ETrans a b)
\end{code}
   === Hey!  This arrow is a pair of arrows: ++++
\begin{code}
type RTrans = (-&gt;) ::*:: ETrans
\end{code}
   === @TypeCompose@ defines @(::*::)@ and its @Arrow@ instance.  Note in particular that @arr f@ is exactly what I want: apply @f@ to the initial value and to each new value.
*  Add residuals as an arrow transformer: ++++
\begin{code}
newtype Resid (~&gt;) a b = Resid (a ~&gt; (b, Resid (~&gt;) a b))

instance Arrow (~&gt;) =&gt; Arrow (Resid (~&gt;)) where
  arr h = r where r = Resid (arr (\ a -&gt; (h a, r)))
  first (Resid f) = Resid $
    first f &gt;&gt;&gt; arr (\ ((b,r),c) -&gt; ((b,c), first r))
  Resid f &gt;&gt;&gt; Resid g = Resid $
    proc a -&gt; do
      (b,rab) &lt;- f -&lt; a
      (c,rbc) &lt;- g -&lt; b
      returnA -&lt; (c, rab &gt;&gt;&gt; rbc)
\end{code}
   === 
*  Next, tweak to use //optional// residuals: ++++
\begin{code}
-- Add optional residual.  A Nothing means that the old arrow value didn't change.
newtype ResidMb (~&gt;) a b = ResidMb (a ~&gt; (b, Maybe (ResidMb (~&gt;) a b)))

instance Arrow (~&gt;) =&gt; Arrow (ResidMb (~&gt;)) where
  arr h = ResidMb (arr (\ a -&gt; (h a, Nothing)))
  first (ResidMb f) = ResidMb $
    first f &gt;&gt;&gt; arr (\ ((b,mbr),c) -&gt; ((b,c), fmap first mbr))

  ab@(ResidMb f) &gt;&gt;&gt; bc@(ResidMb g) = ResidMb $
    proc a -&gt; do
      (b,mbrab) &lt;- f -&lt; a
      (c,mbrbc) &lt;- g -&lt; b
      returnA -&lt; (c, rebuild2 (&gt;&gt;&gt;) ab bc mbrab mbrbc)

rebuild2 :: (a -&gt; b -&gt; c)
         -&gt; a -&gt; b
         -&gt; (Maybe a -&gt; Maybe b -&gt; Maybe c)
rebuild2 _  _ _ Nothing Nothing = Nothing
rebuild2 f a b mba mbb =
  Just (f (fromMaybe a mba) (fromMaybe b mbb))
\end{code}
   === 
*  Now some simple GUIs.  
  === 
</pre>
</div>
<div title="2008-01-28" modifier="Conal Elliott" created="200802111838" tags="2008-01 day" changecount="1">
<pre>* Wrote [[blog response| http://conal.net/blog/posts/blending-continuity-into-reactive-values/#comment-25]] about synchronous computation in Reactivity.  The main point: &quot;While my push implementation looks like it performs unnecessary recomputation, it needn’t, thanks to laziness.&quot;
</pre>
</div>
<div title="2008-01-29" modifier="Conal Elliott" created="200802111838" tags="2008-01 day" changecount="1">
<pre>* Idea for a nice FRP demo: something related to [[dynamic social networking relationships in IRC| http://files.codersbase.com/haskell/haskell-current.png]].
* Wrote [[another blog response to Vladimir| http://conal.net/blog/posts/blending-continuity-into-reactive-values/#comment-27]].  Contains some thouhts on integration: ++++
*  Integrate piecewise, i.e., integrate each non-reactive time function, and keep a running sum of the results.  As you noted, we have to know when the switch happens.
*  Exploit the `Fun` representation to integrate exactly in the special case of constant functions.  Probably extend the representation so additional cases can be integrated exactly.  Perhaps univariate polynomials.
*  What numeric integration method to use?
*  Adapt step size to available cycle.  For instance, give each integral a thread that repeatedly takes a step and `yield`s.  Each time delta would be measured as the current (thread wake-up) time minus the time of the previous step.
*  I wonder how integration threads would interact with my idle trick.  Currently, my threads are all blocked most of the time, but the new integration threads simply yield while still runnable.  Would the new active threads over-compete with the single GUI thread handling all of the outputs?
  === 
* Recursive rebuilding (as in optional residue): ++++
*  @rebuild2@ from [[2008-01-27]] took in @a@ and @Maybe a@ but only used the @a@ if the @Maybe a@ was @Nothing@.  Ditto for @b@.  So instead, pass in a value and a flag saying whether the value is old or new.  I'd like to see how to make an applicative functor, so try application: ++++
\begin{code}
data RBld a = RBld a Bool  -- Bool is whether new.
rebuildApp :: b -&gt; RBld (a -&gt; b) -&gt; RBld a -&gt; RBld b
rebuildApp b (RBld _ False) (RBld _ False) = RBld b     False
rebuildApp _ (RBld f _    ) (RBld a _    ) = RBld (f a) True
\end{code}
   === Still not quite in the form of an applicative functor, because the passed in @b@.  Hm.  What if I computed @b@ even when we could use the old one?  Oh well.  Keep tinkering.  Try a little rewriting application.
  === 
* Reactive transformations.  ++++
* First an arrow transformer that adds a residual.  (There's a variation with an optional residual.) ++++
\begin{code}
newtype Resid (~&gt;) a b = Resid (a ~&gt; (b, Resid (~&gt;) a b))
\end{code}
  === Then event transformation.  Isomorphic to a -&gt; [b] plus residual.  Each input yields zero or more outputs and a residual. ++++
\begin{code}
type ETrans = Resid (Kleisli [])
\end{code}
  === Then simply pair up for a reactive value transformation.  Transforms initial value and events independently. ++++
\begin{code}
type RTrans = (-&gt;) ::*:: ETrans
\end{code}
  === Lovely!  
*  Next, what can I build?  Work toward a simple GUI with one input and one output.  Then add more inputs, both paired and curried.  My current TV guis are all on pure values, including pure functions, so I don't need any of the fancy stuff above.  Do an example with state.  A button that increments a displayed counter.  Hm.  That example is neither @ETrans@ nor @RTrans@, but rather something in between.  Oh -- have it take an initial counter value instead of wiring in zero.  Oh, oops -- the initial value will influence the first reaction, so the neat separate above (@(::*::)@) won't work.
*  Instead, I want the initial input to influence both the initial output and the @ETrans@. ++++
\begin{code}
newtype RTrans a b = RTrans (a -&gt; (b, ETrans a b))
\end{code}
  === 
*  Hmm.  This new @RTrans@ is //awfully// close to @ETrans@.  The only difference is that exactly one output is generated from the initial input.  I could unify them by relaxing the @b@ to @[b]@.  Then I'd have the unification I've been puzzling about between events and reactive values.  That way I don't have to have two kinds of transformations and two kinds of interfaces to them.  Try that.  No more @RTrans@.  Then simply ++++
\begin{code}
type ETrans = Resid (Kleisli [])
\end{code}
   === or @ResidMb@ in place of @Resid@.
*  Back to the example, now as an @ETrans@.  Where does the counter state live?  Invisibly in the @ETrans@, which is why I'll need residuals in this example. ++++
\begin{code}
-- handy utilities
etrans :: (a -&gt; ([b], ETrans a b)) -&gt; ETrans a b
etrans = Resid . Kleisli

etrans_ :: ([b], ETrans a b) -&gt; ETrans a b
etrans_ = etrans . const

-- simple counter
counter :: Int -&gt; ETrans () Int
counter next = etrans_ ([next], counter (next + 1))
\end{code}
   === Must I use a parameter?  Could I get the state to somehow ride along in the inputs and outputs?  Could I define a @ArrowLoop@ instance and somehow use @loop@? ++++
\begin{code}
class Arrow (~&gt;) =&gt; ArrowLoop a where
    loop :: (b,d)~&gt;(c,d) -&gt; b~&gt;c
\end{code}
   === In particular, @loop :: ((),Int)~&gt;(Int,Int) -&gt; (()~&gt;Int)@.
*  How would I want @loop@ to work?  Probably take in the previous @d@ output as the new @d@ input.  But then what about the first @d@ in?  Maybe some kind of primer.  Without, we have ++++
\begin{code}
counter :: ETrans () Int
counter = loop $ etrans $ \ ((),n) -&gt; first pure (dup (n+1))
\end{code}
   === Hm.  Come back to this question later.
  === 
</pre>
</div>
<div title="2008-01-31" modifier="Conal Elliott" modified="200802111840" created="200802111839" tags="2008-01 day" changecount="4">
<pre>* The [[arrows page| http://www.haskell.org/arrows]] has examples, including stream transformers, simple automata, and Fudgets-style stream processors.  About automata, &quot;another model of dataflow languages uses the type&quot;: ++++
\begin{code}
newtype Auto b c = Auto (b -&gt; (c, Auto b c))
\end{code}
  === 
* Curried (&quot;higher dimensional&quot;?) automata relates to livecoding.  Given @a :-&gt; b :-&gt; c@, when @a@ occurs, I want a new @b :-&gt; c@, and I want it to start running where the old @b :-&gt; c@ left off.
* I think of @a :-&gt; b@ as an efficient representation of @[(Time,a)] -&gt; [(Time,b)]@.  Explicitly state the interpretation of @a :-&gt; b@ and then look at curried examples.  Hm -- there's no notion of time in @a :-&gt; b@.  I could add it.  Or find a more abstract variant of @(Time,a)@.  Semantic function: ++++
\begin{code}
meaning :: (a :-&gt; b) -&gt; [(t,a)] -&gt; [(t,b)]
meaning _ [] = []
meaning (Resid (Kleisli h)) ((t,a) : tas) =
  map (t `pair`) bs ++ meaning etr' tas'
 where (bs,etr') = h a
\end{code}
  === 
* Aside from possible use in continuous behaviors, time is just for ordering event occurrences.  In particular, it gives us a way to merge multiple input or output streams.  Still, it may be unnecessary, unnatural, and unimplementable in general.  We physical beings resolve the problem of multiple input streams by having the streams transmit across a (complex) medium.
* What classes have instances for @[(t,a)] -&gt; [(t,b)]@ and which for @a :-&gt; b@?  Require the latter instances to be consistent with the former (via the @meaning@ function).  Monoid &amp; Functor look easy enough.  How about Applicative?  What would @pure b@ be?  In the semantic model, @pure b = (pure.pure) (minBound,a)@.  I don't think that meaning can be expressed in the implementation model, since it &quot;reacts&quot; without any stimulus.  What about @(&lt;*&gt;)@?  Easy in the semantics, but I how in the implementation?  I guess I could accumulate all function occurrences and all argument occurrences as I go.  When a function occurs, yield applications of it to all arguments so far.  When an argument occurs, yield applications of it by all functions so far.  I think that'd work.  Monad?  Same problem for @return@ as @pure@.  I think @join@ would work out fine but require remembering the entire past input stream to feed to the new bots.  Hm -- what semantics do i want?  I could decide that new bots respond only to input events since their creation.  But then I doubt that @ap == (&lt;*&gt;)@.  Hm.  I'd like to keep the expressiveness of the @Event@ monad, and I don't see how.
* Okay, so @a :-&gt; b@ represents (some of) @Event a -&gt; Event b@?  What about @Event a -&gt; Event b -&gt; Event c@, or other combinations like @(Event a, Event b) -&gt; Event c@?  I know that @(Event a, Event b) =~= Event (a + b)@, and so @Event a -&gt; Event b -&gt; Event c =~= Event (a + b) -&gt; Event c@.  How do I use those facts?
* How to kick an IRC spammer: +++
{{{
&lt;conal&gt; Cale: would you mind telling me what steps you took to kick AngelinaJolie26?  i have the op
	permission but not the know-how.						      [23:20]
&lt;conal&gt; Cale: or maybe point me to a how-to page
&lt;Cale&gt; I did /cs op #haskell
&lt;Cale&gt; which in my IRC client gives me ops
&lt;Cale&gt; (the /cs command is bound to sending chanserv a message)
&lt;shachaf&gt; conal: (/msg chanserv could also work.)					      [23:21]
&lt;Cale&gt; and then  /mode #haskell +b AngelinaJolie26
&lt;dblhelix&gt; couldn't it be that she's just interested in Haskell? ;-)
&lt;Cale&gt; That's just a nick ban, so it could change its nick and get back in, but it's unlikely to do
       that.
&lt;Cale&gt; (seeing as it looks like a crapflooding robot, given the quits due to excess flood)    [23:22]
&lt;jua&gt; nick!ident@host ? is . * is .*
&lt;jua&gt; wouldnt the bot almost surely hcange its name? heh
&lt;Cale&gt; Most bots are not that smart :)							      [23:23]
&lt;dblhelix&gt; regarding policy: what about bots written in haskell? shoud we cut those some slack or
	   what? ;-)
&lt;conal&gt; Cale: and to release ops?
&lt;Cale&gt; Well, I usually do that through the menus in my client, but it's /mode #haskell -o Cale
&lt;conal&gt; Cale: thanks.  notes stashed.
}}}
  === 
</pre>
</div>
<div title="2008-02-01" modifier="Conal Elliott" created="200802111841" tags="2008-02 day" changecount="1">
<pre>* Cool web post from Feb 2007: [[Haskell and Web Applications| http://www.defmacro.org/ramblings/haskell-web.html]].  Uses the @Data@ class to automate rendering of Haskell data types into html.
* It's my birthday.
* Arrow-styled reactivity: ++++
*  Maybe I can use @[i] -&gt; [o]@ after all, with the assumption that each input triggers exactly on eoutput.  Or really @Stream i -&gt; Stream o@.  Use the inherited monoid, which requires @o@ to be a monoid.   Then, e.g., @o@ could be @Maybe b@ or @[b]@.  For convenience, perhaps wrap up the composition into a new type, deriving almost all of its implementation.
  === 
* Writing NVC Evolves post &quot;Distracted by faux needs?&quot;
</pre>
</div>
<div title="2008-02-02" modifier="Conal Elliott" created="200802111842" tags="2008-02 day" changecount="1">
<pre>* Infix expression hack: +++
{{{
&lt;ddarius&gt; conal: I'm sure you are aware of the various &quot;infix expressions&quot; hacks
&lt;EvilTerran&gt; f &lt;|fmap.first.fmap|&gt; x
&lt;conal&gt; i'd forgotten.  i like the look of it.  what are the defs &amp; fixities?
&lt;EvilTerran&gt; infixl 1 &lt;|, |&gt;; (&lt;|) = flip ($); (|&gt;) = ($) -- this works
&lt;conal&gt; EvilTerran: thanks.  i'll try it out in my programming.  i have a lot of things like (fmap.fmap).
&lt;EvilTerran&gt; if you make 'em infixr and tweak the definitions a bit, you can make &quot;right sections&quot; work too
&lt;EvilTerran&gt; (with that version, only left sections work)				      [12:45]
&lt;conal&gt; EvilTerran: btw, who came up with that nifty hack?
&lt;EvilTerran&gt; (as in, (f &lt;|fmap.fmap) does what you expect, but (fmap.fmap|&gt; x) doesn't)
&lt;EvilTerran&gt; er... me, as far as i know :)
&lt;ddarius&gt; conal: It was on the mailinglist many many years ago.
&lt;conal&gt; EvilTerran: thx for the warning
&lt;EvilTerran&gt; but someone else almost certainly thought of it first
}}}
  === 
* &quot;Console FRP&quot;.  How can someone write a console program (text in &amp; out) with FRP style and semantics?
* Hm: ++++
\begin{code}
class Arrow (~&gt;) =&gt; ArrowApply (~&gt;) where
  app :: (b ~&gt; c, b) ~&gt; c
\end{code}
  === 
* Here's an example ++++
{{{
&lt;Saizan&gt; conal: first example i could think of: f xs = &quot;Insert a string:\n&quot; ++ 
         let s = takeWhile (/= '\n') xs in seq (length s) 
	 &quot;Here is your string in uppercase:\n&quot; ++ map toUpper s ++ &quot;\n&quot;
&lt;conal&gt; Saizan: thx.									      [13:58]
&lt;conal&gt; Saizan: btw, why the seq?  does it correspond to something implicit in an imperative
	formulation?
&lt;Saizan&gt; conal: with no seq &quot;Here is your string in uppercase:&quot; would be printed before the user
	 inserted the string, also, each character would be immediatly repeated in uppercase
&lt;Saizan&gt; conal: having to tweak this things with seq it's most of the weirdness
&lt;conal&gt; Saizan: ah!!  tricky!  thanks again.  :)
&lt;conal&gt; Saizan: exactly the kind of thing i'm looking for.
* shachaf remembers reading about Lazy K having the same problem.
}}}
  === 
* Oh, hey!  The @Applicative@ semantics for event-bots (stream transformers and ouput+residual) has become synchronous in both reps.  I didn't realize that.  With just events, I couldn't align functions and arguments, so I did a cross product.  With my current bots (transformations), the alignment is in the representation.  I guess I'll have the stream elements themselves be lists, and I'll form the cross-products of corresponding pairs of lists.  If either is empty (non-occurrence), the product is empty.  If both are singletons (unique), the product is.
* Oh.  The listy bot representation doesn't do what I thought.  Definition: ++++
\begin{code}
newtype Resid (~&gt;) a b = Resid (a ~&gt; (b, Resid (~&gt;) a b))

type (:-&gt;) = Resid (Kleisli [])
\end{code}
  === I wanted one input to generate a list of outputs and exactly one residual.  Instead, I get a list of output/residual pairs.  Oh hey, I think I get a nondeterministic bot, with branching at every transition.
</pre>
</div>
<div title="2008-02-03" modifier="Conal Elliott" created="200802111842" tags="2008-02 day" changecount="1">
<pre>* Blog post: [[Distracted by faux needs?| http://evolve.awakeningcompassion.com/?p=24]].  Note to NVC-cert group.
* The residual transformer is in {{{Control.Arrow.Transformer.Automaton}}}.  Ross has lots of functionality there, including @ArrowLoop@ and @ArrowCircuit@.  The latter introduces @delay@. ++++
\begin{code}
class ArrowLoop (~&gt;) =&gt; ArrowCircuit (~&gt;) where
  delay :: b -&gt; (b ~&gt; b)
\end{code}
  === Hm.  Is there anything left to do after @Automaton@?
</pre>
</div>
<div title="2008-02-04" modifier="Conal Elliott" created="200802111843" tags="2008-02 day" changecount="1">
<pre>* newsham on #haskell pointed me to [[a video| http://video.google.com/googleplayer.swf?docId=-7171501518308861626]] on [[MathMap| http://www.complang.tuwien.ac.at/schani/mathmap/]], which has some similarity to Pan &amp; Eros.  It's sort of like Gerard Holzmann's language (Digital Darkroom) and like Filter Factory, but with a boxes-and-arrows editor for composition.  Seems to work pretty well.  The [[language| http://www.complang.tuwien.ac.at/schani/mathmap/language.html]] and interface look pretty ad hoc, in treating images specially rather than just one type within a general, consistent design.  For instance, there's a &quot;filter&quot; keyword and special identifiers &quot;xy&quot;, &quot;r&quot;.  I think the only types are booleans, numbers, tuples, and images.
* My &quot;faux needs&quot; post has generated some attention, as has Emergence.
* Idea for arrows &amp; reactivity post: introduce the stream-function rep, and then explain the correlation problem as motivation for the residual-bot rep.
* Ross's arrows library also has a stream arrow transformer: ++++
\begin{code}
newtype StreamArrow a b c = Str (a (Stream b) (Stream c))

instance Arrow a =&gt; Arrow (StreamArrow a) where
	arr f = Str (arr (fmap f))
	Str f &gt;&gt;&gt; Str g = Str (f &gt;&gt;&gt; g)
	first (Str f) =
		Str (arr Stream.unzip &gt;&gt;&gt; first f &gt;&gt;&gt; arr (uncurry Stream.zip))
\end{code}
  === which is equivalent but more general than I'd written (replacing @(-&gt;)@ with an arbitrary arrow).
* Post: [[Literate Haskell Blogging| http://olsner.se/2008/02/05/literate-haskell-blogging/]].  I folded in olsner's patch to {{{markdown.php}}} and removed one comment character, to remove the leading &quot;{{{&gt; }}}&quot;.
* Instead of &quot;residual bots&quot;, call them &quot;mutant bots&quot;, because they mutate after each reaction.
</pre>
</div>
<div title="2008-02-05" modifier="Conal Elliott" created="200802111843" tags="2008-02 day" changecount="1">
<pre>* I just discovered that @Monoid@ and @MonadPlus@ work differently on @Maybe@ values.  Monoid requires that the type parameter be a monoid also. ++++
\begin{code}
&gt; Just &quot;foo&quot; `mappend` Just &quot;bar&quot;
Just &quot;foobar&quot;
&gt; Just &quot;foo&quot; `mplus` Just &quot;bar&quot;
Just &quot;foo&quot;
\end{code}
  === I was explaining that the @Maybe@ monoid does a biased choice for choosy bots, but that's not the case.  EvilTerran noted that &quot;MonadPlus Maybe matches up with Monoid (First a)&quot;.  I switched from @Maybe@ to @First@ for choosy-bots.
* At I(An)Ok's reminding, sent a reply to Margo P about certification.
* What else do I want to say in my blog post (or follow-ons)? ++++
*  Reactive stuff: accumulation, filtering, snapshot.  For snapshot, I think I'll want a notion of varying values.
*  Examples in graphics or guis.
  === 
* Here's a thought on prompt&amp;input text interfaces: the human user is the reactive system.  Prompts are the inputs and the user's responses are the outputs.  Consider a classic Mealy automaton, unwound: ++++
\begin{code}
a -&gt; (b, a -&gt; (b, a -&gt; (b, ...)))
\end{code}
  === After one input, we get a single output and a residual automaton: ++++
\begin{code}
(b, a -&gt; (b, a -&gt; (b, ...)))
\end{code}
  === However, we can also think of this latter type as a prompt and a way to process the input.  So, let's refactor a bit: ++++
\begin{code}
newtype GetPut a b = Get (a -&gt; PutGet a b)
data    PutGet a b = Put  b   (GetPut a b)
\end{code}
  === 
* Compare these @Get@ and @Put@ with stream processors as described on [[the arrows page| http://haskell.org/arrows/]]: +++&gt;
''Fudgets-style stream processors'': These are processes that can decide whether to input or output at each step:
\begin{code}
data SP a b = Put b (SP a b) | Get (a -&gt; SP a b)
\end{code}
These may be cast as arrows, but are usually used as dual arrows. 
  === The difference is that Fudgets-style stream processors can either get or put at each step, while I'm requiring a strict alternation.  Consider Saizan's examples from [[2008-02-02]]: ++++
\begin{code}
f xs = &quot;Insert a string:\n&quot; ++ 
         let s = takeWhile (/= '\n') xs in seq (length s) 
	 &quot;Here is your string in uppercase:\n&quot; ++ map toUpper s ++ &quot;\n&quot;
\end{code}
  === Now with monadic IO: ++++
\begin{code}
f = do putStrLn &quot;Insert a string:&quot;
       s &lt;- getLine
       putStrLn $ &quot;Here is your string in uppercase:\n&quot; ++ map toUpper s
\end{code}
  === The @SP@ and separated @Get@/@Put@ formulation are identical: ++++
\begin{code}
\ k -&gt; Put &quot;Insert a string:&quot; $
       Get $ \ s -&gt;
       Put (&quot;Here is your string in uppercase:\n&quot; ++ map toUpper s) $
       k
\end{code}
  === The @k@ argument is a continuation of type @GetPut String String@ or @SP String String@.	In this case, I'm not allowing it access to the string @s@.
* Perhaps @GetPut@ is to events as @PutGet@ is to reactive values.  In Reactive, a reactive value is a value plus an event.
</pre>
</div>
<div title="2008-02-06" modifier="Conal Elliott" created="200802111843" tags="2008-02 day" changecount="1">
<pre>* Wordpress: ++++
*  {{{wp-includes/query.php}}} lists (URL) query types in the fill_query_vars function.  (Thanks to fitztrev for the tip.)  There are also [[some query types on the codex| http://codex.wordpress.org/Linking_Posts_Pages_and_Categories]].  The query {{{?p=*}}} gives all posts.
  === 
* Correspondence with Peter V about Eros &amp; related.
* The @GetPut@ and @PutGet@ types from yesterday are applicative functors. ++++
\begin{code}
newtype GetPut a b = Get (a -&gt; PutGet a b)
data    PutGet a b = Put  b   (GetPut a b)

instance Functor (GetPut a) where
  fmap f (Get h) = Get (fmap f . h)

instance Applicative (GetPut a) where
  pure b = Get (const (pure b))
  Get h &lt;*&gt; Get k = Get $ \ a -&gt; h a &lt;*&gt; k a

instance Functor (PutGet a) where
  fmap f (Put b g) = Put (f b) (fmap f g)

instance Applicative (PutGet a) where
  pure b = Put b (pure b)
  Put f pf &lt;*&gt; Put x px = Put (f x) (pf &lt;*&gt; px)
\end{code}
  === We could also write @GetPut@ instances in a more general form, working when @(-&gt;) a@ (function from @a@) is replaced by an arbitrary applicative functor: ++++
\begin{code}
instance Functor (GetPut a) where
  fmap f (Get h) = Get ((fmap.fmap) f h)

instance Applicative (GetPut a) where
  pure b = Get ((pure.pure) b))
  Get h &lt;*&gt; Get k = Get $ liftA2 (&lt;*&gt;) h k
\end{code}
  === Oh -- now the implementations look very familiar indeed.  This code always crops up when two functors or two applicative functors are composed.  If we make the composition explicit, then we get the @Functor@ and @Applicative@ instances automatically.  We could write ++++
\begin{code}
type GetPut a = (-&gt;) a :. PutGet a
\end{code}
  === What about @PutGet@?  If we cross our eyes, we can almost see two @fmap@ applications for @fmap@ and two @(&lt;*&gt;)@ applications for @(&lt;*&gt;)@.  To really see it, replace @b@ with @Id b@.  For a more standard form, use pairing instead of a two-argument constructor. ++++
\begin{code}
type PutGet a b = (Id b, GetPut a b)
\end{code}
  === Now we can rewrite as pairing of type constructors: ++++
\begin{code}
type PutGet a = Id :*: GetPut a
\end{code}
  === By making the type constructor pairing explicit (as we made composition explicit in @GetPut@), we can now get the @Functor@ and @Applicative@ instances for free, from those instances on @f :.: g@.  One hitch is that we now have mutually recursive type synonyms.  I though I could introduce @newtype@ wrappers and use an explicit @deriving@ to promote our class instances, but I haven't been able to come up with a variation that GHC will swallow.
</pre>
</div>
<div title="2008-02-07" modifier="Conal Elliott" created="200802111844" tags="2008-02 day" changecount="1">
<pre>* On #emacs: ++++
{{{
&lt;conal&gt; how in emacs do i get my buffers to be saved on quitting &amp; restored on start-up?  i used to
	do it many years ago, and i've forgotten.
&lt;lawrence&gt; ,desktop									      [14:49]
&lt;fsbot&gt; DeskTop is, like, [0] at http://www.emacswiki.org/cgi-bin/wiki.pl?DeskTop
&lt;fsbot&gt; [1] see http://www.emacswiki.org/cgi-bin/wiki/SessionManagement
&lt;proqesi&gt; conal: M-x desktop-save
&lt;conal&gt; proqesi: thanks :)
&lt;proqesi&gt; and M-x desktop-read
&lt;jstanley&gt; conal: and add a quit hook for that, etc, to automate it
&lt;conal&gt; jstanley: simple enough.  thx.							      [14:50]
}}}
  === 
* Working on a blog post &quot;Functional reactive partner dancing&quot; about the @GetPut@ and @PutGet@ types from yesterday.  I renamed them to @Follow@ and @Lead@.
* I've been following my nose for a while.  What am I aiming for? ++++
*  Get a robust &amp; efficient basis for FRP for my various projects, including Phooey, TV, Eros, and piq.
*  Reconcile the type-flexibility of TV with the simplicity/robustness of Bot.
*  Inspiration for writing blog posts &amp; conference papers.
  === 
* One of the puzzles I've had about arrow-based reactivity is how to distinguish between events and reactive values.  Perhaps the Lead/Follow dance suggests an answer.  Here are the definitions. ++++
\begin{code}
newtype Event b = Future (Reactive b)
data Reactive b = Stepper b (Event b)
\end{code}
  === 
An event starts out in waiting mode, until it becomes (catches up with) a reactive value.  A reactive
value, initially has a value and then acts like an event.  These two definitions are very like my @Follow@ and @Lead@.  They use futures where the arrow-based formulations have explicit inputs (of type @a@).
* How to get type-flexibility with an arrow interface?  Try some simple types for events and varying values with an implementation that maps them into bots.  The mapping exploits some isomorphisms -- currying and pair/either.  
</pre>
</div>
<div title="2008-02-08" modifier="Conal Elliott" created="200802111844" tags="2008-02 day" changecount="1">
<pre>* I just realized that my @ChoosyBot@ representation might not be what I really want.  Here's the definition, from [[Invasion of the composable Mutant-Bots| http://conal.net/blog/posts/invasion-of-the-composable-mutant-bots/]]  ++++
\begin{code}
newtype ChoosyBot i o = Choosy (MutantBot i (First o))

newtype First a = First (Maybe a)  -- (in Data.Monoid)

type MutantBot = Automaton (-&gt;)
\end{code}
=== In that version, when there is no output for a given input, the bot mutates anyway.  Perhaps I'd like to allow mutation only when there really is an output.  That way perhaps there would be nothing to propagate or remember on non-responses.  I think change simplifies the code: ++++
\begin{code}
newtype ChoosyBot = Automaton (Kleisli First)
\end{code}
  === which is isomorphic to @ChoosyBot a b = a -&gt; First (b, ChoosyBot a b)@.
* On the other hand, if I did a similar trick for chatter-bots (with @[]@ in place @First@), then I'd have a list of mutants.  I don't know what I'd do with them.
* Experiment: program a simple curried TV on top of Bot.  Then see how I might extract that behavior automatically from a TV spec.  Example: product of two numbers entered by sliders, showing the result textually.  I can make the bot statically and then dynamically attach it to the input &amp; output widgets.  Since there are two @Int@ inputs, my bot has type @Either Int Int :-&gt; Int@.  In addition to the change events, there will be initial input values and an initial computed product. ++++
\begin{code}
chatter :: (a -&gt; (b, a :-&gt; b)) -&gt; a :-&gt; b
chatter f = Chatter (Automaton ((pure *** unChatter) . f))

prod :: Int -&gt; Int -&gt; (Int, Either Int Int :-&gt; Int)
prod a b = (a*b, chatter next)
 where
   next (Left  a') = prod a' b
   next (Right b') = prod a b'
\end{code}
  === Refactoring a bit: ++++
\begin{code}
prod2 :: (Int,Int) -&gt; (Int, Either Int Int :-&gt; Int)
prod2 (a,b) = (a*b, chatter (prod2 . next))
 where
   next (Left  a') = (a',b)
   next (Right b') = (a,b')
\end{code}
  === I think I could refactor more, abstract out the pattern of a reactive pair of values.  Then @fmap (uncurry (*))@ over the pair bot.  How might i write @prod@ more elegantly?
</pre>
</div>
<div title="2008-02-09" modifier="Conal Elliott" created="200802111844" tags="2008-02 day" changecount="1">
<pre>* How does @Either Int Int@ relate to @(Int,Int)@?  Idea: the former is an encoding of (a subset of) changes to the latter.  @Left a@ represents @first (const a)@, and @Right b@ represents @second (const b)@.
* Blog post [[Accumulation for functional reactive ChatterBots| http://conal.net/blog/posts/accumulation-for-functional-reactive-chatter-bots/]].
* Chat with Ivan T (svrog) about Reactive.
</pre>
</div>
<div title="2008-02-10" modifier="Conal Elliott" created="200802111844" tags="2008-02 day" changecount="1">
<pre>* Here's an elegant way to turn encodings of pair modifications into a stream of pairs: ++++
\begin{code}
updPair :: Either c d -&gt; (c,d) -&gt; (c,d)
updPair = (first.const) `either` (second.const)

-- updPair (Left  c') (_,d) = (c',d)
-- updPair (Right d') (c,_) = (c,d')

editPairL :: (c,d) -&gt; Either c d :&gt;- (c,d)
editPairL = leads.pure &lt;*&gt; editPairF

editPairF :: (c,d) -&gt; Either c d :-&gt; (c,d)
editPairF cd = updPair ^&gt;&gt; accumF cd
\end{code}
  === 
* Working on a blog post &quot;Functional reactive partner dancing&quot;.  Now I'm wondering if Fudgets-style stream processors (@SP@) are better than my Lead/Follow model.  For instance, I think I'll need three different flavors of sequential composition: follow/follow, follow/lead, and lead/follow.  Maybe even the fourth: lead/lead.  Stream processors get by with only one that handles all cases.  Consider also examples like prompt/input/response, which don't seem to fit lead/follow naturally.  One significant (I think) advantage of strict lead/follow (put/get) alternation is that it enables a useful @Applicative@ instance, and hence @Monoid@.
* Hm -- try to do something like  ++++
\begin{code}
a:&gt;-Int -&gt; a:&gt;-Int -&gt; a:&gt;-Int
\end{code}
  === where @a@ is the environment from which the two input &quot;events&quot; are extracted.  I think then I can program in a @Reactive@ style.
* Tomorrow make a first software release (darcs only) with @Bot@ and @LeadFollow@, so that people can look at the code.
</pre>
</div>
<div title="2008-02-11" modifier="Conal Elliott" created="200802241537" tags="2008-02 day" changecount="1">
<pre>* Put my new Bot project on the web.  Made a [[Bot wiki page|http://haskell.org/haskellwiki/Bot]].
* Posted [[Functional reactive partner dancing| http://conal.net/blog/posts/functional-reactive-partner-dancing/]].
</pre>
</div>
<div title="2008-02-12" modifier="Conal Elliott" created="200802241537" tags="2008-02 day" changecount="1">
<pre>* Check out [[link| http://www.cs.mu.oz.au/~dmo/se-litreview/thesis.html]] from Christophe P (vincenz).  It's timing out now.
* Reply on nvc-cert: ++++&gt;
Here are my thoughts on using NVC in debate settings:
* Let go of any idea that anyone is right and anyone is wrong.  Utterly abandon your position.
* Release any desire to win or persuade.
* Focus your curiosity on the beautiful underlying motivations (needs) behind all of the expressed positions.
* Connect with gratitude for the person whose position you had opposed, since they helped to carry part of a shared creative tension that you didn't want to carry.
  === 
* Bots: ++++
*  Thinking about the idea from [[2008-02-10]]: ++++
\begin{code}
a:&gt;-Int -&gt; a:&gt;-Int -&gt; a:&gt;-Int
\end{code}
   === Maybe I can program in my old (non-arrow) style but with these polymorphic types.  What does this shift in formulation give me?  I think it's a clear &amp; implementable semantics, including deterministic merging.  With &quot;chatty&quot; bots, the common input stream gives a simple basis for merging.  
*  Oh, oops!  I started thinking of leads (@a :&gt;- b@) as like @Reactive b@, but the @Applicative@ instances do correspond.  For leads, @f &lt;*&gt; x@ outputs only when *both* @f@ and @x@ output.
*  Idea: represent a varying value as an initial value plus a stream of future *edits* (functions).  The @Reactive@ representation is an value plus stream of future *values*, and it's tricky to do pairing.  I could even use a @const@ edit initially. ++++
\begin{code}
newtype a `EditL` b = EditL (a `Lead`   Endo b)
newtype a `EditF` b = EditF (a `Follow` Endo b)
\end{code}
   === I don't have to add anything for empty or multiple, since @Endo b@ is already a monoid under @id@ and @(.)@.  Here's an @Arrow@ instance.  I run into trouble with sequential composition.  ++++
\begin{code}
instance Arrow EditF where
  arr h = EditF $ (Endo . const) &lt;$&gt; arr h
  first (EditF fol) = EditF $ 
    -- first fol :: (a,c) `Follow` (Endo bf, c)
    first fol &gt;&gt;^ \ (Endo bf, c) -&gt; Endo (bf *** const c)
  EditF ab &gt;&gt;&gt; EditF bc = EditF $
    ab &gt;&gt;&gt; arr (`appEndo` error &quot;no initial value&quot;) &gt;&gt;&gt; bc
\end{code}
   === Can I use a lead instead?
*  Another possibility is to consume @Endo a@ instead of @a@, i.e., map edit streams to edit streams.  Then I'm ready by default to compute incrementally.  @first@ and @(&gt;&gt;&gt;)@ are easy, but I don't see how to do @arr@.  Again, I'm missing an initial value.  What would it take for @arr@ to work out?
  === 
* Blog post: [[Applicative bots| http://conal.net/blog/posts/applicative-bots/]].
</pre>
</div>
<div title="2008-02-13" modifier="Conal Elliott" created="200802241537" tags="2008-02 day" changecount="1">
<pre>* Correspondence with Pierre-Evariste.  He's ported his &quot;functional reactive overlay&quot; stuff from OCaml to Haskell (at my suggestion) and incorporated an arrow style.
* Correspondence with Ross Paterson about arrow lib stuff.
* What next?  I have plenty of blog ideas.  How about getting my new bot stuff running, instead of just compiling?  Oh -- fitting it to TV.  Now I remember why I did the &quot;Applicative bots&quot; post.  Because the @Applicative@ instance for @((:&gt;-) a)@ didn't do what I wanted.  Now it does.  Again, ++++
\begin{code}
add :: a:&gt;-Int -&gt; a:&gt;-Int -&gt; a:&gt;-Int
add = liftA2 (+)
\end{code}
  === How do I hook up @add@ to my GUI?  How to synthesize the arguments?  What's the ultimate source (@a@)?  In theory, it's buried way in the window system and already diced up by the time individual widget event handlers get access.  If I were designing a GUI toolkit from the bottom up, I'd make the source be the raw, global-coordinate events.  Building on another platform, I guess I have to assemble a new source from parts and then divvy up the result.  Wonk?!  
* (Continuing...)  What's the point?  I think it's about being able to separate out events, mess with them (@fmap@ etc), and put them back together.  Filtering drops values but puts in blanks, so as to re-correlate later.  Similarly, merging can press simultaneous values into a single slot, again for correlation.  But the point really is correlation, isn't it?  Previously I've used a shared notion of //time// in the semantics (e.g., in Fran and Reactive).  I haven't quite seen how to implement time comparison when some of the times aren't yet known precisely.  In a sense, the bots use a unary/Peano representation of time ordinals, in which the blanks represent @Succ@.  Or maybe a trie, indexed by unary times.
* Another reason for explicit inputs is to allow modular transformation of a reactive system, transforming output and (inversely) input.
* If there's a single source of inputs, the notion of &quot;time&quot; can be simply an input ordinal.  Not really related to time -- just for ordering.
* On the other hand, any notion of time may be unnatural for reactivity.  Maybe I want something more like dependency or cause &amp; effect, which is more like the Bot formulations.
</pre>
</div>
<div title="2008-02-14" modifier="Conal Elliott" created="200802241537" tags="2008-02 day" changecount="1">
<pre>* In the morning, try http://haskell.org/gtk2hs/win32/gtk+-dev-2.10.14-win32.tar.bz2 .  First, retry the .zip &amp; .gz I already downloaded.  I wonder if a virus tweaked my machine.  I got a warning today.
* Right/wrong discussions on NVC-cert
</pre>
</div>
<div title="2008-02-15" modifier="Conal Elliott" created="200802241538" tags="2008-02 day" changecount="1">
<pre>* Tweaking Bot to work with Ross's new arrows lib.  He added some instances so I wouldn't have to host orphans.
</pre>
</div>
<div title="2008-02-17" modifier="Conal Elliott" created="200802241538" tags="2008-02 day" changecount="1">
<pre>* Try out [[Console| http://sourceforge.net/projects/console]]: ++++&gt;
Console is a Windows console window enhancement. Console features include: multiple tabs, text editor-like text selection, different background types, alpha and color-key transparency, configurable font, different window styles.
  === Saw on [[Magnus Therning: Haskell on Windows| http://therning.org/magnus/archives/338]].
* Posted [[Pairs, sums, and reactivity| http://conal.net/blog/posts/pairs-sums-and-reactivity/]].
</pre>
</div>
<div title="2008-02-18" modifier="Conal Elliott" created="200802241538" tags="2008-02 day" changecount="1">
<pre>* I think I can generalize my bot accumulation combinators to any @ArrowCircuit@, which is a subclass of @ArrowLoop@ that adds @delay :: a -&gt; a ~&gt; a@.
</pre>
</div>
<div title="2008-02-19" modifier="Conal Elliott" modified="200802241539" created="200802241538" tags="2008-02 day" changecount="2">
<pre>* I think in Yampa inputs are tupled instead of summed.  There's no way to capture changes to part of the input, and so unnecessary recomputation happens.  A possible improvement is to take in a representation of change to part of the input.  One way to represent partial changes is via sums.  For instance, a change to @(a,b)@ could be a new first or second element, signified by @Left a@ or @Right b@.  However, @a@ and @b@ can be structured as well, so we have to nest sums.  A general notion of change is endomorphisms, but, being functions, endomorphisms are opaque.  I could use an explicit data type for representing endomorphisms.  For instance, ++++
\begin{code}
data Change a :: * -&gt; * where
  Konst  :: a -&gt; Change a                       -- arr.const
  Idy    :: Change a                            -- arr id
  First  :: Change a -&gt; Change (a,b)            -- first
  Second :: Change b -&gt; Change (a,b)            -- second
  ThenCh :: Change a -&gt; Change a -&gt; Change a    -- (&gt;&gt;&gt;)
\end{code}
  === These constructors all correspond to functions on arrows, so they can be used in a more general setting than endomorphisms.  Maybe add in @Result@ as well (requires deep arrows).  Instead of using @Left a@ to encode a changed first element, use @First (Konst a)@.  This @Change@ type is more flexible than sums.  I don't have to decide on change granularity up front.
* Another interpretation of @Change@ is as [[partial values| http://conal-elliott.blogspot.com/search/label/partial%20values]].
* So, how about a change/edit-based Bot type?  I don't know how to implement @fmap@ or @arr@.
* IRC channel #radeon topic &quot;Support and development for open-source ATI driver - for fglrx use #ati&quot;.  cjb and quicksilver are on #haskell and #radeon.  Maybe I could get help there.
* Here's a simple way to implement reactivity: represent event as a lazy zip-list of maybes or lists, as in choosy-bots or chatter-bots.  Assume/require/arrange that all such lists are synchronized.  How?  Derive every event and reactive value as a map or scan/accum over the same base stream.  Using @ZipList@ means I get the @Applicative@ instance I want.  How do I make these streams?  Also, i'm not crazy about all the blanks.  The more events I have, the more blanks in all of them.  Keep noodling.
* See about implementing @Data.Future@ deterministically and correctly (consistent with my simple denotational semantics).  Define a &quot;future time&quot; abstract data type.  Here's the heart of deterministic temporal merging: ++++
\begin{code}
merge :: [(Time,a)] -&gt; [(Time,a)] -&gt; [(Time,a)]
[] `merge` qs = qs
ps `merge` [] = ps
ps@(p@(s,_):ps') `merge` qs@(q@(t,_):qs')
  | s &lt;= t     = p : (ps' `merge` qs )
  | otherwise  = q : (ps  `merge` qs')
\end{code}
  === Hm.  Not quite.  We might not know whether we've run out of occurrences.
* Try the bot style again for GUIs.  Work out how to build up the composite (sum or Change/Edit) input type.  Use the Event pair/sum isomorphism.
* Oh -- maybe the whole sum/edit thing is just an optimization of a simpler Fruit/Yampa-like model, in which full input come in and full outputs go out on every step.  With the optimization, we get the full in &amp; out initially and then just edits.
* As in Fudgets and Fruit, define a higher level arrow that hides user input and visual output from the types.  Use the simple bot model: ++++
\begin{code}
type (:-&gt;) = Automaton (-&gt;)
\end{code}
  === or ++++
\begin{code}
type (:-&gt;) = StreamMap
\end{code}
  === Then add the UI layer ++++
\begin{code}
newtype a :~&gt; b = (User,a) :-&gt; (Pic,b)
\end{code}
  === where @User@ is the whole state of the user input (mouse position, keyboard state, button state) and @Pic@ is the whole of the visual appearance.  Oh!  This is exactly Fruit's model.
* Hm.  Why didn't Fruit's GUI model catch on?  I posed that question on the yampa mailing list.
</pre>
</div>
<div title="2008-02-20" modifier="Conal Elliott" modified="200802241541" created="200802241539" tags="2008-02 day" changecount="3">
<pre>* I think the @Monad@ interface thwarts retained-mode presentation, but @Applicative@ and @Arrow@ don't.  In particular, GUI libs are retained mode, in that widgets are stateful and reused.  Another advantage of @Applicative@ and @Arrow@ over @Monad@ is that duplication is explicit, which may help for destructive optimization.
* [[A Simple Haskell Web Server| http://reddit.com/goto?rss=true&amp;id=t3_69758]]
* [[New Features for Perpubplat and Ruminations on Service APIs for the Web| http://reddit.com/goto?rss=true&amp;id=t3_69738]]
* I re-read &quot;[[Genuinely functional user interfaces| http://www.apocalypse.org/pub/u/antony/work/pubs/genuinely-functional-guis.pdf]]&quot; last night.  I like the simple &amp; clear functional model.  Could one use a mainstream GUI lib underneath and //still// have clear GUI semantics?  Can one have TV-like composability?  I'd like to use Fruit as a starting point for 3D GUIs.
* I suspect that my Reactive stuff (or something like it) could benefit dynamic web content generation.  Example: I installed wp-latex recently, so I could have latex-formatted bits on my blog.  I also tweaked the PHP code a bit.  Similarly, I have markdown rendering, also tweaked a bit.  Now I wonder: when does all this stuff execute?  What if I tweak (a) post content, (b) markdown plugin code, (c) wp-latex plugin code, (d) markdown or wp-latex plugin settings?  Does it all happen on every page download?  I think wp-latex does some caching.  I guess it'd have to have smarts about when the cache becomes invalid (when some or all plugin settings change).
* Consider a yampa-like (signal transformer) model but optimized so that input &amp; output values are represented differentially.  (Be sure to re-read &quot;[[Dynamic Optimization for Functional Reactive Programming using Generalized Algebraic Data Types| http://www.cs.nott.ac.uk/~nhn/Publications/icfp2005.pdf]]&quot;.)  Derive an efficient push-based implementation that works with edits, i.e., some limited incremental/adaptive computation.  Perhaps represent a flow (reactive value) as a value and a stream of timed edits.  Sometimes (often) we'll have to compute actual values, accumulated from edits.  Probably worth caching full values right into the stream, for sharing, and rely on laziness to allow them to go uncomputed when unused.  Instead of stream functions, I could use an automaton, to regulate the back-and-forth, correlating outputs &amp; inputs.  Plain old stream functions or automata would suffice, rather than choosy or chatty bots, since edits can be empty (identity) or compositions.
* What kind of incremental computation can I do?  The signature of @fmap@ doesn't leave much room for optimization.  I can do @Idy@ (no change), but that's it.  What specialized optimizable patterns are there?  How about @first f@ applied @second g p@? ++++
\begin{code}
first f . second g == second g . first f
                   == f *** g
                   == \ (a,b) -&gt; (f a, g b)
\end{code}
  === 
* There was a [[chat today on #haskell| http://tunes.org/~nef/logs/haskell/08.02.20]] (15:08 to 16:10) about evolving haddock. ++++
The goal is to get the full functionality of a general purpose, programmer-friendly markup language like markdown.  One example is image embedding.  Another is friendly links (no visible url).  The idea is to make a future haddock be a *preprocessor* that generates [[pandoc| http://johnmacfarlane.net/pandoc/]]'s extended markdown (or some such).  Documentation would be mostly markdown, with very few extensions for code documentation ('foo' and &quot;Foo.Bar&quot;, maybe a bit more).  Most of the doc would simply be passed through untouched.  The code-doc extensions would get rewritten into standard markdown and mixed in with the rest.

Pandoc could then take the generated markdown and produce HTML, LaTeX, DocBoook XML, etc.

Perhaps there will be ways in which markdown falls short in expressiveness.  If so, I'm guessing the shortcomings wouldn't be specific to the task of code documentation, and so could be approached as improvements to markdown/pandoc (which is written in Haskell).

Since the old and new doc languages would be quite incompatible, we might want to specify in a .cabal file which language to use.  
  === I sent these notes to haskell-cafe for comments.
</pre>
</div>
<div title="2008-02-21" modifier="Conal Elliott" created="200802291758" tags="2008-02 day" changecount="1">
<pre>* Correspondence: ++++
*  Emergence
*  Refactoring Haddock.
  === 
</pre>
</div>
<div title="2008-02-22" modifier="Conal Elliott" created="200802241540" tags="2008-02 day" changecount="1">
<pre>* Correspondence on haddock/markdown, Fruit, and Yampa.
* Ivan T pointed me to [[andLinux| http://www.andlinux.org]], which is &quot;a complete Ubuntu Linux system running seamlessly in Windows&quot;.  Also to [[Johnny Chung Lee| http://www.cs.cmu.edu/~johnny]], who has a bunch of neat stuff, including wii remote projects.
* Chat with Ivan T about haskell graphics stuff.
</pre>
</div>
<div title="2008-02-23" modifier="Conal Elliott" created="200802241540" tags="2008-02 day" changecount="1">
<pre>* Playing again with applying Warren Burton's &quot;improving values&quot; idea to event occurrence times. ++++
*  Here's a first shot: ++++
\begin{code}
-- | Progressive information about a value (e.g., a time)
data Improving t = AtLeast t (Improving t) | Exactly t

instance Ord t =&gt; Ord (Improving t) where
  Exactly s `compare` Exactly t = s `compare` t
  AtLeast s u' `compare` v@(Exactly t) =
    if s &gt; t then GT else u' `compare` v
  u@(Exactly s) `compare` AtLeast t v' =
    if s &lt; t then LT else u  `compare` v'
  u@(AtLeast s u') `compare` v@(AtLeast t v') =
    -- move forward where we know less
    if s &lt;= t then
      u' `compare` v
    else
      u  `compare` v'
\end{code}
  === Similarly for @min@.  How would I construct these improving values?  One possibility is from a list of occurrence/non-occurrence times (say @[(Bool,t)]@).  That list could come from a channel fed regularly with non-occurrences.  But then I'd be back to doing lots of busy work when nothing is going on.  I don't know where else to go with this ideas as is.
*  Here's a variation on the previous idea.  Define a //non-recursive// type of partial info about ascending values: ++++
\begin{code}
data PartialT t = AtLeast t | Exactly t
\end{code}
   === Now, represent our times via a ref that holds a @PartialT@ and a way to update it.  Wrap @unsafePerformIO@ around its uses.  To ensure referential transparency, make sure that extractable information content is always monotonically increasing.  How?  The successive ref value increase in information, and queries use information from the ref values, fetching more information as needed.  In a GUI setting with a main &quot;event loop&quot;, I can have the updater action ask the time of the last event  occurrence.  One more thing: when comparing times, I might have an @Exactly s@ for a //future// @s@, and an @AtLeast t@ for a past or present @t@.  (Example: the first event is a timer.)  In that case, I want to simply block until the comparison can be made, i.e., until time @s@ is passed or the second time somehow becomes known.
*  Oh -- here's a more systematic way to think about the problem.  I want to know whether @s &lt;= t@.  There are a few different ways to answer the question: ++++
*   Compute @s@ and @t@ exactly and compare.
*   Compute @s@ exactly and prove that @t &gt;= s@ (without having to know @t@ exactly).
*   Compute @t@ exactly and prove that @s &gt; t@.
   === To determine @s &lt;= t@, combine these three methods.  Spin off one thread per method and go with whichever answer comes back first.  Since all successfully terminating methods are guaranteed to agree, I don't care about determinism.  I suspect Warren Burton's &quot;improving values&quot; papers are about this idea.  I've found one but not the other.  The first method is applicative, i.e., it combines two independent inquiries into the future (@s@ and @t@).  The second and third are monadic, in that the second half of the inquiry depends on information from the first half.
*  How do I prove that @t &gt;= s@ for a known @s@ and an unknown event occurrence time @t@?  I find the source of @t@ and ask it to wait until all occurrences by time @s@ are known and then check that @t@ is still unknown.  If @t@ is associated with a central event loop, then see if @s@ has already happened for that source (the usual case, I expect).  If not then sleep until the event loop gets to @s@.  After the possible sleep.
* I could represent these inquiries as @IO a@ or @IO (Maybe a)@ (cheap and deterministic, e.g., reading an @MVar@).  Represent failure as nontermination or @return Nothing@, respectively.
* Idea: have the @Future@  monoid use this parallel-or operator, in which successfully terminating arguments must agree.  My current @Future@ @mappend@ does not expect them to agree.
* Where does this waitable &quot;source&quot; come from?  Suppose I have the @mappend@ of two events (not futures) with different event sources?  I guess each future has this sleep ability.  The &quot;earlier&quot; operator combines the sleepers.
  === 
</pre>
</div>
<div title="2008-02-24" modifier="Conal Elliott" created="200802291759" tags="2008-02 day" changecount="1">
<pre>* Ordered books on chaos and fuzzy logic for Luke, via abebooks.com.
* Check out [[zedenem's citeulike| http://www.citeulike.org/user/zednenem]]
* Suppose I define and use a &quot;Tactic&quot; monad with future times. ++++
\begin{code}
exactT :: FTime -&gt; Tactic Time
(*&lt;=), (*&lt;), (*&gt;=), (*&gt;) :: FTime -&gt; Time -&gt; Tactic Bool
(&lt;=*), (&lt;*), (&gt;=*), (&gt;*) :: Time -&gt; FTime -&gt; Tactic Bool
alt :: Tactic a -&gt; Tactic a -&gt; Tactic a
\end{code}
  === To decide whether @sf &lt;= tf@ for @sf, tf :: FTime@, try three queries in parallel.  The first tactic evaluates both times and compares.  Each of the other two determines one value exactly and then tries to prove how the other relates. ++++
\begin{code}
       liftA2 (&lt;=) sf tf
`alt` (exactT sf &gt;&gt;= (&lt;=* tf))
`alt` (exactT tf &gt;&gt;= (sf *&lt;=))
\end{code}
  === How to implement @sf *&lt;= t@?  Ask @sf@'s source to wait until @t@ and then verify that @sf@ is not known.  If @sf@ is known, the tactic fails.  In that case the first tactic can succeed.
* Perhaps @Tactic@ is a wrapper around @STM@ that caches computation results.
* Here's another angle on change-based FRP: ++++
*  Follow the signal-function model.  The input type is a nested tuple, combining various external sources.
*  For each input source, construct a state update function.  Justify semantically &amp; algebraically.
*  Extra credit: implement state update destructively.  Warning: tricky (overwrites).
*  What is the state?  More than just the ultimate output.  First approximation: the values of all of the pieces of the computation.
  === 
* Type of &quot;parts&quot; (e.g., of an input): ++++
\begin{code}
data Part :: * -&gt; * -&gt; * where
  IdP     :: Part a a
  FirstP  :: Part c a -&gt; Part (c,b) a
  SecondP :: Part c b -&gt; Part (a,c) b
\end{code}
  === This type is like an explicit representation of (some of) composable references.  Here are the realizations of sub-value extraction and editing: ++++
\begin{code}
extract :: Part c a -&gt; (c -&gt; a)
extract IdP         = id
extract (FirstP  p) = extract p . fst
extract (SecondP p) = extract p . snd

change :: Part c a -&gt; ((a -&gt; a) -&gt; (c -&gt; c))
change IdP         = id
change (FirstP  p) = first  . change p
change (SecondP p) = second . change p
\end{code}
  === and composition ++++
\begin{code}
comp :: Part c b -&gt; (Part b a -&gt; Part c a)
comp IdP         = id
comp (FirstP  p) = FirstP  . comp p
comp (SecondP p) = SecondP . comp p
\end{code}
  === with specification ++++
\begin{code}
extract (comp p q) == extract q . extract p
change  (comp p q) == change  p . change  q
\end{code}
  === I really only wanted constant @a@ values for @change@, but I like how the definition mirrors @comp@'s in this slightly more general setting. Also, @extract@ and @change@ relate @Part@ to composable references.  Specializing: ++++
\begin{code}
subst :: Part c a -&gt; (a -&gt; (c -&gt; c))
subst p = change p . const
\end{code}
  === Because of the way I've defined @change@ and @subst@, the &quot;syntactic&quot; analysis of parts is done once rather than at each substitution.  The extra parentheses in the type signature serve as a reminder.
* Parts separate out the //shape// of an edit from the particulars.  Every input source has a corresponding //part// of the input.  We can apply @subst@ to each of those parts to get an input-changing event, merge (@mappend@) the results all together, and @accumE@ the result with the initial value.  Instead, I want to turn each part into function that updates state, using the static description of the part and the bot.
* Playing with this example: @\ ((a,b),c) -&gt; a*b + b*c@.  I can break down the example into arrow form, but applicative may be more convenient: ++++
\begin{code}
liftA2 (+)
  (liftA2 (*) (fst&gt;&gt;&gt;fst) (fst&gt;&gt;&gt;snd))
  (liftA2 (*) (fst&gt;&gt;&gt;snd) snd)
\end{code}
  === 
</pre>
</div>
<div title="2008-02-25" modifier="Conal Elliott" created="200802291800" tags="2008-02 day" changecount="1">
<pre>* Replied to Ian P about Emergence.
* FRP: ++++
*  Given a bot and an input &quot;part&quot;, generate a function that turns a corresponding input value into a state transformer.
*  What's the state?  It must contain the output value, but also intermediate values used in incrementally recomputing the output.
*  Pattern state structure after @Applicative@. ++++
\begin{code}
-- | Applicative state.  @AState c a@ is state of type @a@ for input of
-- type @c@.
data AState :: * -&gt; * -&gt; * where
  PureS :: a -&gt; AState c a
  AppS  :: AState c (a -&gt; b) -&gt; AState c a -&gt; AState c b
  PartS :: Part c a -&gt; AState c a
\end{code}
   === 
*  Updating then might have type ++++
\begin{code}
updater :: Part i a -&gt; (a -&gt; AState i o -&gt; AState i o)
\end{code}
   === 
* Started writing post &quot;Change-driven functions&quot;.
  === 
</pre>
</div>
<div title="2008-02-26" modifier="Conal Elliott" modified="200802291803" created="200802291801" tags="2008-02 day" changecount="2">
<pre>* Wiki page: [[Practical web programming in Haskell| http://www.haskell.org/haskellwiki/Practical_web_programming_in_Haskell]].
* Updated [[NVC Evolves| http://evolve.awakeningcompassion.com/]] blog to WordPress 2.3.3.
* In writing &quot;Change-driven functions&quot;, I realized that I'll also want some kind of &quot;let&quot; or &quot;dup&quot; or something, to allow more than one use of a computed value.  And then I expect this stuff to be difficult/ugly to use.  Hm.  Discouraged.
</pre>
</div>
<div title="2008-02-27" modifier="Conal Elliott" modified="200802291813" created="200802291804" tags="2008-02 day" changecount="2">
<pre>* [[From Power Up To Bash Prompt| http://reddit.com/goto?rss=true&amp;id=t3_6a2gz]], from November 2000.  &quot;This is a brief description of what happens in a Linux system, from the time that you turn on the power, to the time that you log in and get a bash prompt. Understanding this will be helpful when you need to solve problems or configure your system.&quot;
* From [[Why don’t we have a word for it?| http://reddit.com/goto?rss=true&amp;id=t3_6a1nf]]  &quot;yosefk’s Semantical Decay Theorem: all useful terms which are not completely neutral become meaningless.&quot;
* Installed Webroot //AntiVirus and AntiSpyware//, with two-year license.
* Note to yampa-users about change-driven evaluation: ++++&gt;
My sense at this point is that the obstacle to efficient change-driven evaluation is partly the arrow interface but more the current translation from arrow notation to combinator form.  Specifically, that translation uses the arr method quite a lot, which prevents analysis.  For instance, in Neil's example below, all of the arr-wrapped functions are simply manipulations of nested pair, but those manipulations are hidden in a function.

Suppose we define a superclass of Arrow with all of Arrow's methods except for arr and with some methods that can now be expressed in terms of arr, including fstA and sndA.  Make sure we have everything necessary to define the default methods for all of the current Arrow class's defaults (except for the arr/pure default cycle).  Now tweak the translator for arrow notation so that it targets the new superclass when possible.  In &quot;p &lt;- a -&lt; exp&quot;, if the expression exp is built up from variables and pairing, no arr would generated  Neil's example is one such case. For change-driven evaluation, the implementation of fstA &amp; sndA would know to ignore changes to only the snd or first half of a pair (and similarly with compositions).  For other expressions, the translation would still use fstA &amp; sndA and minimize information flowing into arr's, and the arrow implementation could then exploit the static knowledge of what information does not get into the arr's.
  === 
* Think about data-driven FRP in terms of of static analysis and either code generation or very efficient interpretation.  Use the @Applicative@ interface.
* Created [[&quot;NVC Evolves&quot; google group| http://groups.google.com/group/nvc-evolves]].
</pre>
</div>
<div title="2008-02-28" modifier="Conal Elliott" created="200802291813" tags="2008-02 day" changecount="1">
<pre>* Although I don't know why my Reactive library sometimes crashes, I want to go ahead with writing a paper on it.  Perhaps in the process of writing, I'll get some new insights and fix the problem.  This approach worked for me with Eros.  I didn't know how to do input extractors when I started the paper.  So, what's in the paper: ++++
*  Reactive normal form.
*  Composing reactivity and functions to get reactive behaviors.
*  Simple, hybrid push &amp; pull implementation.
*  Simple, formal semantics.
*  More extensive use of type classes
*  Proving correctness of the implementation with respect to the semantics, perhaps via the. worker-wrapper transformation.
*  Functional futures.
*  Multi-threading.
*  Compile-time rewriting to remove some threads &amp; M-vars.
  === 
* Announced [[&quot;NVC Evolves&quot; google group| http://groups.google.com/group/nvc-evolves]] on the nvcresearchworkgroup listserv.
</pre>
</div>
<div title="2008-02-29" modifier="Conal Elliott" created="200803050117" tags="2008-02 day" changecount="2">
<pre>* [[A Pro-Thought Manifesto| http://reddit.com/goto?rss=true&amp;id=t3_6a5cl]].  I'd like to write a follow-up blog post inviting and inspiring people to go beyond manifestos and moral positions (like the idea of a &quot;moral duty&quot; and the existence of &quot;good&quot; or &quot;bad&quot; ways to be).  Some nice bits on [[the author's home page| http://www.chiark.greenend.org.uk/~sgtatham/]].
* I just remembered this idea for Reactive, described on [[2008-02-23]] and  [[2008-02-24]]: restrict @mappend@ on futures so that it requires its arguments to agree when they succeed.  Then the operational indeterminacy is compatible with semantics determinacy.  This insight is a direct application Warren Burton's idea of &quot;indeterminate behavior with determinate semantics in parallel programs&quot;, and in particular his notion of &quot;improving values&quot;.
* Wrote to Warren Burton.
* Also this one: somehow work the data dependencies to preserve order in Reactive (mumble).
* Easy way to (a) back up a wordpress blog and (b) make a new copy (e.g., for fearlessly upgrading): ++++
*  Export from old, yielding an xml file.  Save locally.
*  Note widget set-up.  Mine: ++++
*   Calendar
*   Recent Posts
*   Recent Comments
*   Archives
*   Categories 1 (will change to CTC)
*   Text 1, with {{{&lt;b&gt;&lt;a href=&quot;?p=*&quot;&gt;Browse all posts&lt;/a&gt;&lt;/b&gt;}}}
*   Links
*   Meta
   === 
*  Note Blogroll.  Mine: ++++
*   [[Emergence of NVC| http://emergence.awakeningcompassion.com/]]
*   [[//NVC Evolves// google group| http://groups.google.com/group/nvc-evolves]]: 
   === 
* Note Blog sub-title.  Mine: &quot;Explorations in evolving the understanding, living, and teaching of Nonviolent Communication&quot;.
*  Create new, empty wordpress blog.
*  Set up widgets, blogroll, and blog sub-title the way I had them before.
*  Import posts from the local .xml file.  The import process will offer to transfer authorship to existing users or to create new users with the given names.  If created, tweak user permissions.
*  Activate plugins and enter Akismet API Key
*  And a few other fiddly bits, like plugin settings.
*  Okay, maybe not such an easy way.
  === 
* Got permalinks working for [[NVC Evolves| http://evolve.awakeningcompassion.com/]].
* Oops -- I just discovered that my emergence-of-nvc mail was bouncing.  It's fixed now.  I had thought there was no activity recently.  Banned some spammers, deleted some off-topic mail.  There was a note from [[Emma| http://emmamccreary.com]] asking about project activity.
</pre>
</div>
<div title="2008-03-01" modifier="Conal Elliott" modified="200803050120" created="200803050117" tags="2008-03 day" changecount="7">
<pre>* Do another version of @Future@ with functional improving values.  From there look at an efficient,
referentially transparent, side-effecting version.  It was trivially easy to plug improving times into
my event library, since I'd already parameterized over the time type, and I only require @Ord@.
* Here's an idea for improved merging with improving times: instead of asking which of two leading values is smaller, perform a &quot;pair sort&quot;, yielding a pair.  The pair sort allows more work to be retained.  Here's what I mean.  First, the comparison-based merge, showing only the non-empty/non-empty case: ++++
\begin{code}
us@(u:us') `merge` vs@(v:vs') =
  if u &lt;= v then
    u : (us' `merge` vs )
  else
    v : (us  `merge` vs')
\end{code}
  === Now the pair-sort-based merge: ++++
\begin{code}
(u:us') `merge` (v:vs') = a : insert b (us' `merge` vs')
 where
   (a,b) = sortPair (u,v)
\end{code}
  === Hm.  That insert bit may be awkward, and it will lead to some unnecessary comparisons.  Another angle is a comparison operation that yields a boolean and improved values of @u@ and @v@. ++++
\begin{code}
(u:us') `merge` (v:vs') =
  if uLeq then
    u' : (us' `merge` (v':vs'))
  else
    v' : ((u':us') `merge` vs')
 where
   (uLeq,u',v') = u `leq` v
\end{code}
  === On the other hand, if I represent improving times efficiently, updating the approximations in place, the simpler definition will work fine.
* Who provides these lower bounds?  Consider a GUI setting.  Each occurrence has an improving time and a value ...
* Idea: instead of parameterizing over a time type, parameterize over a future type constructor.  One candidate is @(,) (Time t)@ for @t@ in @Ord@, e.g., @Improving Double@.  Another candidate would have the value nested inside of improving times, like @AtLeast t0 (AtLeast t1 (Exactly t a))@.
* I'm bouncing around among various ideas.  Pick one and focus on it.  My favorite is the &quot;tactics&quot; idea from [[2008-02-24]].  Use concurrency to try multiple tactics for answering a single query.  The tactics must agree where they succeed, so that the behavioral nondeterminism doesn't compromise the semantic determinism.  Specifics: ++++
*  Represent a future value via an MVar that holds a best-yet-known approximation.  These mvars can change, but only by increasing information content, to preserve referential transparency.  
*  I could have a process that eagerly and frequently improves approximations, but doing so would burn cycles.  What to do instead?  Wait until comparisons are demanded.
*  To resolve whether @s &lt;= t@, try two different tactics.  One computes @s@ exactly and compares the exact result to the possibly unknown @t@.  The other tactic does the reverse.  (As mentioned on [[2008-02-24]], there's a three-tactic alternative.)  Each tactic can have pure functional interface and semantics if I handle failure with nontermination.  I expect that using pure interfaces will help with simple result sharing, as usual.
*  Operations on future values or times: ++++
\begin{code}
exact :: Improving a -&gt; a
(*&lt;=), (*&lt;), (*&gt;=), (*&gt;) :: Ord a =&gt; Improving a -&gt; a -&gt; Bool
(&lt;=*), (&lt;*), (&gt;=*), (&gt;*) :: Ord a =&gt; a -&gt; Improving a -&gt; Bool
\end{code}
   === I've elimanted the explicit @Tactic@ notion here, in favor of pure values.  To try different &quot;tactics&quot;, use an @unamb@ function, which has the precondition that its arguments must agree when non-bottom, and is thus semantically unambiguous.  (Looking for another name.) ++++
\begin{code}
unamb :: a -&gt; a -&gt; a
\end{code}
   === Then to test @si &lt;= ti@ for IVs (improving values) @si@ and @ti@: ++++
\begin{code}
(exact si &lt;=* ti) `unamb` (si *&lt;= exact ti)
\end{code}
   === 
*  How to represent IVs and implement these @exact@ and comparison primitives?
  === 
* Look up Don S's &quot;Holy Shmoly&quot; posts and read about concurrency mechanisms.
</pre>
</div>
<div title="2008-03-02" modifier="Conal Elliott" created="200803050120" tags="2008-03 day" changecount="1">
<pre>* Learning about feedburner.  Got set up with nvc-evolves (http://feeds.feedburner.com/nvc-evolves and .../comments-for-nvc-evolves).  To do ++++
*  Add my techie blog (done: conal, conal-comments)
*  Ask to get the link switched on haskell planet
*  See about changing the rss link on my blogs.
  === 
* 95249 is latitude 38.192823, longitude -120.642852
* my hscolour'ing is broken.  i think it's not finding the css
* Got help from Cale on monad composition: +++
{{{
&lt;conal&gt; Cale: i added monad composition to TypeCompose (darcs version), and i'd like your comments. The new bit is [[here| http://darcs.haskell.org/packages/TypeCompose/doc/html/Control-Compose.html#t%3ADistribM] (see source link).
&lt;Cale&gt; Cool :)
&lt;Cale&gt; http://en.wikipedia.org/wiki/Distributive_law_between_monads -- this lists the axioms
       required, but in CT notation.
&lt;Cale&gt; so, translating...
&lt;Cale&gt; join . fmap distriM . distribM = distribM . fmap join
&lt;conal&gt; Cale: so l == distribM
&lt;Cale&gt; yeah
&lt;Cale&gt; fmap join . fmap distribM . distribM == distribM . join
&lt;Cale&gt; then...
&lt;Cale&gt; distribM . fmap return == return
&lt;Cale&gt; and
&lt;Cale&gt; distribM . return == fmap return
&lt;Cale&gt; That'll be it :)
&lt;conal&gt; Cale: thx
&lt;Cale&gt; conal: It might be interesting to know if these translate in any nice way into a set of
       conditions on bind.
&lt;conal&gt; Cale: sure.  i'm going to walk through your translations and the diagrams and see if get the
	process.
&lt;Cale&gt; I'm not sure, but if there was anything written about it, I'm pretty sure I've seen a paper
       which was more CS-oriented regarding these distributive laws.			      [12:26]
&lt;Cale&gt; I'll see if I can find it.
&lt;conal&gt; Cale: that'd be cool.  and if not, i can work with the diagrams.
&lt;conal&gt; Cale: do you know if anyone has explored replacing the monad transformer libraries with a
	type-composition approach?  it sure seems more modular.				      [12:28]
&lt;Cale&gt; conal: Well, there was a short article about it... Monad transformers are more general --
       some of them arise from pre or post compositions, but some, like State, are something else
       altogether.
&lt;Cale&gt; conal: It was on Reddit a while back.
&lt;conal&gt; Cale: glad to know.  if you run across the article, please let me know.
&lt;Cale&gt; okay, I'll have a look
&lt;Cale&gt; http://sneezy.cs.nott.ac.uk/fplunch/weblog/?p=84 -- ah, here it was
&lt;lambdabot&gt; Title: FP Lunch » Blog Archive » Monad Transformers
&lt;Cale&gt; I'm not altogether certain about its claim for Cont, but the rest seems okay to me.
&lt;conal&gt; Cale: super.  thanks!  :)
&lt;Cale&gt; conal: I'll keep looking for that paper I was thinking of.
&lt;Cale&gt; CiteSeer is annoyingly down.
&lt;conal&gt; Cale: one thing i'd like to do is go back and simplify GUIs in Phooey.  i had a very lovely
	formulation via type composition, which i used for Functor &amp; Applicative, but i didn't think
	i could use it for Monad.  i'll try again.
&lt;Cale&gt; conal: That would be interesting. The really nice thing about Applicative of course is that
       you don't have to add any extra information to say how things compose, but perhaps the
       appropriate distributive laws are available to make what you have into a monad :)      [12:37]
&lt;conal&gt; Cale: exactly!  i hadn't thought of that possibility until recently.		      [12:38]
pdx.edu/~mpj/pubs/composing.html -- ah, I think this might be it.
&lt;lambdabot&gt; Title: Composing Monads
&lt;Cale&gt; It's a little hard to find, given that it doesn't appear to refer to the distributive laws as
       such.
&lt;conal&gt; Cale: ooh -- i'd forgotten about that paper.  looks very applicable.  thanks again.   [12:40]
}}}
  === 
* Title idea: &quot;Simply classical FRP&quot;
* Reconstructed quite a lot of Reactive on top of the simple semantic @Future@, using @Event a = [Future (Maybe a)]@, though more nicely structured as a type composition.  Still to do: a way to create low-level events, something like @mkEvent :: IO (Event a, Sink a)@.  Or maybe switch to another @Future@ implementation, so that @Event a = [Future a]@ is practical or back to @Event a = Future (Reactive a)@. ++++
\begin{code}
data Future a = AtLeastF (Time t) (Future a) | ExactlyF (Time t) a
\end{code}
  === or isolate the &quot;improving&quot; bit to time: ++++
\begin{code}
data T = AtLeastF (Time t) T | Exactly (Time t)
\end{code}
  === or, refactoring, ++++
\begin{code}
data T = T (Time t) (Maybe T)
\end{code}
  === 
</pre>
</div>
<div title="2008-03-03" modifier="Conal Elliott" modified="200803050121" created="200803050120" tags="2008-03 day" changecount="2">
<pre>* Do another version of @Future@ with functional improving values.  From there look at an efficient, referentially transparent, side-effecting version.  It was trivially easy to plug improving times into my event library, since I'd already parameterized over the time type, and I only require @Ord@.
* Here's an idea for improved merging with improving times: instead of asking which of two leading values is smaller, perform a &quot;pair sort&quot;, yielding a pair.  The pair sort allows more work to be retained.  Here's what I mean.  First, the comparison-based merge, showing only the non-empty/non-empty case: ++++
\begin{code}
us@(u:us') `merge` vs@(v:vs') =
  if u &lt;= v then
    u : (us' `merge` vs )
  else
    v : (us  `merge` vs')
\end{code}
  === Now the pair-sort-based merge: ++++
\begin{code}
(u:us') `merge` (v:vs') = a : insert b (us' `merge` vs')
 where
   (a,b) = sortPair (u,v)
\end{code}
  === Hm.  That insert bit may be awkward, and it will lead to some unnecessary comparisons.  Another angle is a comparison operation that yields a boolean and improved values of @u@ and @v@. ++++
\begin{code}
(u:us') `merge` (v:vs') =
  if uLeq then
    u' : (us' `merge` (v':vs'))
  else
    v' : ((u':us') `merge` vs')
 where
   (uLeq,u',v') = u `leq` v
\end{code}
  === On the other hand, if I represent improving times efficiently, updating the approximations in place, the simpler definition will work fine.
* Who provides these lower bounds?  Consider a GUI setting.  Each occurrence has an improving time and a value ...
* Idea: instead of parameterizing over a time type, parameterize over a future type constructor.  One candidate is @(,) (Time t)@ for @t@ in @Ord@, e.g., @Improving Double@.  Another candidate would have the value nested inside of improving times, like @AtLeast t0 (AtLeast t1 (Exactly t a))@.
* I'm bouncing around among various ideas.  Pick one and focus on it.  My favorite is the &quot;tactics&quot; idea from [[2008-02-24]].  Use concurrency to try multiple tactics for answering a single query.  The tactics must agree where they succeed, so that the behavioral nondeterminism doesn't compromise the semantic determinism.  Specifics: ++++
*  Represent a future value via an MVar that holds a best-yet-known approximation.  These mvars can change, but only by increasing information content, to preserve referential transparency.  
*  I could have a process that eagerly and frequently improves approximations, but doing so would burn cycles.  What to do instead?  Wait until comparisons are demanded.
*  To resolve whether @s &lt;= t@, try two different tactics.  One computes @s@ exactly and compares the exact result to the possibly unknown @t@.  The other tactic does the reverse.  (As mentioned on [[2008-02-24]], there's a three-tactic alternative.)  Each tactic can have pure functional interface and semantics if I handle failure with nontermination.  I expect that using pure interfaces will help with simple result sharing, as usual.
*  Operations on future values or times: ++++
\begin{code}
exact :: Improving a -&gt; a
(*&lt;=), (*&lt;), (*&gt;=), (*&gt;) :: Ord a =&gt; Improving a -&gt; a -&gt; Bool
(&lt;=*), (&lt;*), (&gt;=*), (&gt;*) :: Ord a =&gt; a -&gt; Improving a -&gt; Bool
\end{code}
   === I've elimanted the explicit @Tactic@ notion here, in favor of pure values.  To try different &quot;tactics&quot;, use an @unamb@ function, which has the precondition that its arguments must agree when non-bottom, and is thus semantically unambiguous.  (Looking for another name.) ++++
\begin{code}
unamb :: a -&gt; a -&gt; a
\end{code}
   === Then to test @si &lt;= ti@ for IVs (improving values) @si@ and @ti@: ++++
\begin{code}
(exact si &lt;=* ti) `unamb` (si *&lt;= exact ti)
\end{code}
   === 
*  How to represent IVs and implement these @exact@ and comparison primitives?
  === 
* Look up Don S's &quot;Holy Shmoly&quot; posts and read about concurrency mechanisms.
</pre>
</div>
<div title="2008-03-04" modifier="Conal Elliott" created="200803052037" tags="2008-03 day" changecount="1">
<pre>* Chat with Christophe P (vincenz) about how to help a troll.  Saved.
* Chat on #oasis (vincenz et al) about what to call @unamb@ and what it means.
* There's a problem with the approach I've been pursuing with @(&lt;=*)@ etc.  The result is a @Bool@, which means it cannot give me any partial information.  In contrast, the result of @min@ is @Improving t@, which can start producing partial information (lower bounds) right away.  On the other hand, I don't know how to use @min@ and not @(&lt;=)@ simply and elegantly, to do merging.
* (Continuing.)  //Idea:// return to my previous formulation of an event as a single future reactive value.  Here's merging: ++++
\begin{code}
instance Monoid (Event a) where
  mempty  = Event mempty
  mappend = inEvent2 merge

merge :: Future (Reactive a) -&gt; Future (Reactive a) -&gt; Future (Reactive a)
u `merge` v     =
  (onFut (`merge` v) &lt;$&gt; u) `min` (onFut (u `merge`) &lt;$&gt; v)
 where
   onFut f (a `Stepper` Event t') = a `stepper` Event (f t')
\end{code}
  === (There's also a @Never@ event constructor, for optimization.)  The @min@ here is on futures.  Semantically, ++++
\begin{code}
Future (s,_) &lt;= Future (t,_) = s &lt;= t

fa `min` fb = if s &lt;= t then fa else fb
\end{code}
  === The @min@ definition here is a generic default for ordered types.  The drawback is that it cannot provide any partial information until @s &lt;= t@ can be determined.  The following alternative can provide as much partial time information as the time type allows. ++++
\begin{code}
Future (s,a) `min` Future (t,b) =
  Future (s `min` t, if s &lt;= t then a else b)
\end{code}
  === A payoff for this change from @(&lt;=)@ to @min@ comes when considering merging three events.  If we compare two initial occurrences using @(&lt;=)@, we won't be able to produce any info that could show that the third initial occurrence comes first.
* This @min@ definition may have some redundant computation, considering how related @min@ and @(&lt;=)@ are.  If improving values are implemented functionally as lists or nested bound structures, then @s `min` t@ is making progress through both @s@ and @t@, but then @s &lt;= t@ starts over.  The result is a space-time leak.  More helpful would be an operation that both computed the minimum and said which one it was. ++++
\begin{code}
minI :: Ord a =&gt; Improving a -&gt; Improving a -&gt; (Improving a,Bool)
\end{code}
  === Then ++++
\begin{code}
Future (s,a) `min` Future (t,b) = Future (u, if c then a else b)
 where
   (u,c) = s `minI` t
\end{code}
  === Unfortunately, this definition breaks temporal polymorphism.
* Conclusion: define events as future reactive values, define @min@ on futures as above (not the default in terms of @(&lt;=)@).  Use futures (and hence events and reactive values) over improving times.  Then all I have to implement carefully is @min@ on improving values (IVs).  If I want temporal polymorphism, I'd better implement IVs imperatively (which has additional performance benefits).
* Warren Burton sent me pointers to some of his papers.
* Remember: when using &quot;{{{wget --recursive}}}&quot;, be sure to add &quot;{{{--no-parent}}}&quot;.  Otherwise, I'll get the //whole domain//!
</pre>
</div>
<div title="2008-03-05" modifier="Conal Elliott" created="200803060350" tags="2008-03 day" changecount="1">
<pre>* Filled out the Anygma job inquiry form Peter V mailed. +++
Desired software tasks: ++++&gt;
any or all of: architect, visionary, lead dev, co-dev, problem-solver, consultant, mentor, teacher, mediator.
   === 
Other comments: ++++&gt;
I've been exploring this reactive multi-media &amp; graphics deeply since 1990 and have designed, implemented and used several similar systems.  With this experience and insight, I'm in a unique position to see and communicate the ramifications and importance of many, many design choices the project will encounter along the way.

About salary and other terms of employment: I'm interested in a thoroughly collaborative role in Anygma, from beginning to end and at all levels and functions, so that our interests are aligned.  I've had enough involvement with organizations and projects whose members are at cross purposes, and I'm ready to shift gears.  Face-to-face discussions would probably be most effective start.  I'm available to visit after the April 2 ICFP paper deadline.

Warm regards,  - Conal
   === 
  === 
* Efficient improving values (IVs): ++++
*  The two necessary operations seem to be (a) extracting an exact value, and (b) comparing with a given exact value.  So, represent an IV //as// that pair of operations. ++++
\begin{code}
data Improving a = IV a (a -&gt; Ordering)
\end{code}
   === The IV for a known value @x@ is @IV x (compare x)@.  How do I implement @minI@ from [[2008-03-04| yesterday]]? ++++
\begin{code}
minI :: Ord a =&gt; Improving a -&gt; Improving a -&gt; (Improving a,Bool)
IV u uComp `minI` IV v vComp = (IV uMinV wComp, uLeqV)
 where
   uMinV = if uLeqV then u else v
   -- u &lt;= v: Try @v `compare` u /= LT@ and @u `compare` v /= GT@.
   uLeqV = (vComp u /= LT) `unamb` (uComp v /= GT)
   -- (u `min` v) `compare` t: Try comparing according to whether u &lt;= v,
   -- or go with either answer if they agree, e.g., if both say GT.
   minComp = if uLeqV then uComp else vComp
   wComp t = minComp t `unamb`
	     assuming (uCompT == vCompT) uCompT
    where
       uCompT = uComp t
       vCompT = vComp t

-- Yield a value if a condition is true.  Otherwise wait forever.
assuming :: Bool -&gt; a -&gt; a
assuming c a = if c then a else hang
\end{code}
   === 
*  What's left?  How do I make an improving value for the times of primitive events?
  === 
</pre>
</div>
<div title="2008-03-06" modifier="Conal Elliott" created="200803111530" tags="2008-03 day" changecount="1">
<pre>* How does my @Improving@ type relate to Warren B's?  Consider other names.
* Next for Reactive: how to package up external events (e.g., in a GUI) via @Improving@?  How to represent occurrences of these external events?  The key bit is the comparison part (the @a -&gt; Ordering@ field).  We'll want some way to to query the event loop (generating monotonic times) and find out its current time.  If the current time is past the query time and the occurrence hasn't arrived, then the answer is @GT@.  Otherwise, ask to be notified when that time passes.  Take care with thread-safety and race conditions.  Idea: the query and notification works by immediately returning a pure boolean value, which is made from an IVar.  The IVar gets written by the event loop either immediately or in the future.  The writing happens in the event loop's thread and does the time comparison.  mumble.
* Hm: maybe I don't really ever have to sleep.  Here's my thinking: suppose I choose for the type parameter of @Improving@ an artificial notion of time, namely an incrementing counter with an opaquifying @newtype@ wrapper.  Then I can never have such a time in hand unless it's already arrived.  The @newtype@ wrapper prevents times from being created in advance.  Drawbacks: ++++
*  I can't have predictable occurrence times, e.g., for synthetic events (e.g., timers).  I'd have to simulate them, which would interfere with possible optimizations.
*  I don't know how to interesting different events based on different external sources, e.g., GUI, file system, and networking.
  === 
* To simplify conversion from my current Reactive implementation, try to match the interface, especially @mkEvent :: IO (Event a, Sink a)@.
</pre>
</div>
<div title="2008-03-07" modifier="Conal Elliott" created="200803111530" tags="2008-03 day" changecount="1">
<pre>* Reactive: ++++
*  Idea: augment my @Improving@ implementation with a best-so-far approximation.  Hide it inside the comparison closure.
*  Try out one of the simple, sequential, functional implementations of Reactive.  Get it working, and use it in my other projects.  It would pump a lot of non-occurrences through but wouldn't re-compute and re-render unnecessarily, so it's still an improvement over other FRP implementations.  Compose in time functions and stop and start threads (or feed and starve channels) for constant and non-constant time functions.
*  Here's one way to create events.  Make a channel of time/@Maybe@ pairs.  Start a thread that pumps @Nothing@ values into it.  For each actual occurrence, also add in a @Just@ value.  What about times?  I have to make sure the times are monotonic.  Oh, don't use a thread.  Use a GUI timer call-back instead, to exploit the single-threaded nature of the main event loop.  Convert the channel into a list with [[getChanContents| http://www.haskell.org/ghc/docs/latest/html/libraries/base/Control-Concurrent-Chan.html#v%3AgetChanContents]].  Given the list, I can map to different event representations, where @DoubleI = Improving Double@. ++++
*   @Event a = [FutureG Double (Maybe a)]@
*   @Event a = [FutureG DoubleI a]@
*   @Event a = FutureG DoubleI (Reactive a)@
   === I already have all three of these implementations.  Given my list of time/@Maybe@ pairs, conversion to the first representation choice is trivial.  For the other two, ++++
\begin{code}
-- | Interpret 'Nothing' values as lower bounds
improveMbs :: [(t, Maybe a)] -&gt; [(Improving t, a)]
improveMbs = foldr f []
 where
   f (t,Just a ) qs = (Imp [t],a) : qs
   f (t,Nothing) ((Imp ts', a) : qs') = (Imp (t:ts'), a) : qs'
   f (_,Nothing) [] = error &quot;improveMbs: input ends in a Nothing&quot;

-- | Convert a temporally monotonic list of futures to an event
listToEvent :: Ord t =&gt; [FutureG t a] -&gt; EventG t a
listToEvent = foldr (\ fut e -&gt; Event ((`stepper` e) &lt;$&gt; fut)) mempty
\end{code}
    === 
  === 
</pre>
</div>
<div title="2008-03-08" modifier="Conal Elliott" created="200803111530" tags="2008-03 day" changecount="1">
<pre>* Finally found the bug that made event occurrences have all the same time.  It was in @withTimeE@.
* Warning!  In the @Ord@ instance for @AddBounds@ (in Future), @min@ might be be defaulted and hence using @(&lt;=)@ instead of @min@ on @NoBound@.  If so, I'm we@re going to lose the ability to get partial information back from @min@ on @AddBounds@.  If that's the case, define my own @Ord@ instance instead of deriving.
* I'm still having a problem with held-back reactions.  Without @mappend@, no problem.  With @mappend@, I don't get a reaction to one until I have an occurrence of the other.  For instance, with @a `mappend` b@, if @a@ occurs three times, no reaction.  Then when @b@ occurs, all of the @a@ reactions happen (with the correct times).  Hm.  That sounds like what would happen if I were //not// padding event occurrences.  It would also be explained by using @(&lt;=)@ instead of @min@ in @mappend@.  Oddly, that may well have been happening before I fixed the definition of @AddBounds@.  Hm.  There's another layer as well, which is @Max@. ++++
\begin{code}
type Time t = Max (AddBounds t)

newtype Max a = Max { getMax :: a }
	deriving (Eq, Ord, Read, Show, Bounded)
\end{code}
  === But @Max@ is a @newtype@, so @min@ is just @min@ on @a@, i.e., @AddBounds (Improving Double)@.
* Most things work now.  After I fixed the @AddBounds@ issue, the remaining problem is in event tracing itself.  I can get the times, but block on the values.
* I'm getting a neat bug now.  I have a counter example.  Starts zero and increments whenever I hit the button.  It's incrementing before the event actually occurs.  I think it's because there is nothing to force the time.  The answer is correct in anticipation.  My execution thread consumes the reactive value as fast as it can.  When there are two different events, I don't get this race-ahead.  I think because then the first output really does depend on the time of first input.  Funny -- I wonder why it doesn't keep counting forever, in repeated anticipation.  Maybe because the definition of @improveMbs@ can't produce a second cons until it finds it's first actual occurrence. ++++
\begin{code}
improveMbs :: [(t, Maybe a)] -&gt; [(Improving t, a)]
improveMbs = foldr f []
 where
   f (t,Just a ) qs = (Imp [t],a) : qs
   f (t,Nothing) ~((Imp ts', a) : qs') = (Imp (t:ts'), a) : qs'
\end{code}
  === I could rewrite @improveMbs@ to be more productive, if I wanted.
* Made second google account, this time using my conal.net email address.
</pre>
</div>
<div title="2008-03-09" modifier="Conal Elliott" created="200803111531" tags="2008-03 day" changecount="1">
<pre>* @traceE@/@traceR@ as a simple @fmap@.  No times.  Simply @fmap (liftA2 (trace.shw) id)@.  Oh!  That tracer applies to arbitrary functors.
* Consider once again representing events as temporally ordered lists of occurrences.  Compose from a sorted-list functor and @FutureG t@.  Oh!  Now I remember why that idea didn't work out: I can't define @Applicative@ or @Monad@ instances simply because of the @Ord@ constraint on the type parameter.  Instead, I could use lists of pairs, sorted by the first value: ++++
\begin{code}
newtype AscendK k v = AscendK [(k,v)]  -- with Ord k
\end{code}
  === Now to make this work out prettily, I'd like the @k@ type to be in @Ord@, @Bounded@, and @Monoid@.  I can ensure these constraints via adding the type wrappers @AddBounds@ and @Max@, in other words, my @Time t@ type.
* Maybe I want to pick more general terms to replace &quot;Time&quot; and &quot;Future&quot;.
* Given this @Ord@ constraint, why not represent events as an efficient balanced a tree form, as in @Data.Map@ or even finger trees.  Then I could get reasonably fast random access.  But, oops: how would one balance an infinite sequence?
* New NVC Evolves post [[Beyond rules and guidelines| http://evolve.awakeningcompassion.com/posts/beyond-rules-and-guidelines/]].
* Added an interface to time sync'ing, so my outputs won't predict the future.
* Got Reactive and Phooey mostly working.  There are still a few funny timing problems with output getting delayed, particularly in dragging.
* Switched back to the representation of events as lists of future values.  Now I'm right there with the semantics, where I want to be.  Broke a lot of my examples, however.  Probably due to insufficient laziness.
</pre>
</div>
<div title="2008-03-10" modifier="YourName" created="200803271746" tags="2008-03 day" changecount="1">
<pre>* Various &quot;NVC Evolves&quot; correspondence, including with Jim Manske on [[Using the name &quot;NVC Evolves&quot;| http://groups.google.com/group/nvc-evolves/t/cdea1c3fd93a10ac]] and eZ on [[nvc or cnvc?| http://groups.google.com/group/nvc-evolves/t/5aa6509c956d3b11]]
* [[How to Define Keyboard Shortcuts in Emacs| http://xahlee.org/emacs/keyboard_shortcuts.html]].  Explains how to notate key sequences, with which I sometimes struggle.  I didn't know about the {{{kbd}}} elisp function.
* Reactive paper: ++++
*  Working on outline.  I'm pretty happy with the intellectual content.
*  Wrote abstract
*  Working on introduction
  === 
* Neat blog: [[Computational Arts: Activities, News, and Resources| http://runtime.ci.qut.edu.au/]].  It includes [[a post| http://runtime.ci.qut.edu.au/pivot/entry.php?id=69]] on my google tech talk.
</pre>
</div>
<div title="2008-03-11" modifier="YourName" created="200803271746" tags="2008-03 day" changecount="1">
<pre>* Put up new-reactive darcs repo, and sent note to Ivan.
* Working on Reactive paper.
</pre>
</div>
<div title="2008-03-12" modifier="YourName" created="200803271746" tags="2008-03 day" changecount="1">
<pre>* Reply to Peter V
* Conversations on NVC Evolves
</pre>
</div>
<div title="2008-03-13" modifier="YourName" created="200803271747" tags="2008-03 day" changecount="1">
<pre>* Working on Reactive paper. ++++
*  Here's a clearer way to define the semantics of events.  Define @Event@ via a wrapper  ++++
\begin{code}
type EO = [] :. (,) Time

newtype Event a = Ev { unEv :: EO a }
\end{code}
   === Then define the semantics of operations on @Event@ by time-sorting the result of those some operations on @EO@. ++++
\begin{code}
sortE :: EO a -&gt; Event a
sortE (O ps) = Ev (O (sortBy (comparing fst) ps))

instance Functor Event where
  fmap f (Ev e) = sortE (fmap f e)

instance Applicative Event where
  pure a = sortE (pure a)
  Ev ef &lt;*&gt; Ev ex = sortE (ef &lt;*&gt; ex)

instance Monad Event where
  return a = sortE (return a)
  Ev e &gt;&gt;= f = sortE (e &gt;&gt;= unE . f)
\end{code}
   === 
*  Oh.  Simpler yet: define two semantic functions: ++++
\begin{code}
type E a = [(Time,a)] -- sorted

occs' :: Event a -&gt; EO a

occs :: Event a -&gt; E a
occs (O ps) = sortBy (comparing fst) ps
\end{code}
   === 
*  The trick then is to transform the semantics into a tenable implementation of @occs'@, systematically replacing @occ@.
  === 
</pre>
</div>
<div title="2008-03-14" modifier="YourName" created="200803271747" tags="2008-03 day" changecount="1">
<pre>* Working on Reactive paper. ++++
*  Idea: formulate Reactive via type product: @type Reactive = Id :*: Event@.  What would the standard instances for @(:*:)@ say about @Reactive@?  @Functor@ works out fine, but @Applicative@ doesn't.  First (dropping isomorphism constructors), @pure a == (a, pure a)@, so we have an initial value and and initial change to that value.  Second, @(f,ef) &lt;*&gt; (x,ex) == (f x, ef &lt;*&gt; ex)@, so there are a lot more change events than expected: product instead of sum.  OMG!  A lot of those events happen simultaneously, so maybe it all comes out the same.  If @ef@ has @m@ occurrences and and @ex@ has @n@ occurrences, how many distinct occurrence times can there be for @ef &lt;*&gt; ex@?  At most @m+n@.  Why?  Because the occurrence times are all of the form @tf `max` tx@ for occurrence times @tf@ of @ef@ and @tx@ of @ex@.  Since the maximum of two values is one of those values, there are only @m+n@ possible maxima.
*  Bumping up to monads, I really can get lots more non-simultaneous occurrences.
*  Hm.  Do I really want to keep events and reactive values separate?  Suppose I just use events, which I sometimes interpret as a reactive value.  I'd say that the value is undefined before the first occurrence.  Then I wouldn't have the redundant occurrence for @pure@.  If I want to add an initial value @a@ to an event @e@, use @pure a `mappend` e@.
*  The meaning @(f,ef) &lt;*&gt; (x,ex) == (f x, ef &lt;*&gt; ex)@ is also //missing// some transitions.  Suppose @ex@ occurs before @ef@.  There won't be a transition to @f ex@, because the first occurrence of @ef &lt;*&gt; ex@ coincides with the later of the first occurrences of both @ef@ and @ex@.  If the second occurrence of @ex@ precedes the first occurrence of @ef@, then that transition will be missed also.  There's an easy fix: turn the reactive values into events via the @pure@/@mappend@ trick and combine simply as @ef' &lt;*&gt; ex'@.
*  In a sense, the left bias of event @mappend@ is really a right bias.  The left one occurs first, but the right one, happening second, sticks.
*  Suppose I define reactive values and events by simple mutual recursion (as in the current Reactive release): ++++
\begin{code}
R = Id   :*: E
E = (T,) :.  R
\end{code}
   === What do the instances for type product and composition imply?  @fmap@ works fine.  I think @pure a@ has infinitely many occurrences at -infinity, all with value @a@.  @ef &lt;*&gt; ex@ I think would yield @[(tf1 `max` tx1, f1 x1), (tf2 `max` tx2, f2 x2), ...]@, instead of combining all pairs.  In other words, I'd get the @ZipList@ AF instead of the list/backtracking AF.  I sent a query to Conor &amp; Ross and haskell-cafe asking about a deconstruction of the list AF.
*  How and why might one use the @Event@ AF?
*  Where do I introduce future values?  They simplify the semantics and semantics-based implementation.  And they're motivated by the same.  Try right before the semantics section.
  === 
</pre>
</div>
<div title="2008-03-15" modifier="YourName" created="200803271747" tags="2008-03 day" changecount="1">
<pre>* Chat with Shae E (shapr) and Ed Kemmett (edwardk) about HOAS and Ed's use.  I uploaded a .tar.bz2 of my old Eros that uses hoas.  Ed pointed me to &quot;Boxes goes Bananas&quot; (downloaded).  Sounds like the authors came up with a general way to do in Haskell what we did in Lambda-Prolog, with universal quantification and implication.  If so, I want to understand it.  Saved chats (shapr and scannedinavian).
* Reactive paper: ++++
*  To give my paper more focus, I could remove the @Applicative@ &amp; @Monad@ stuff, possibly adding it back in a later section.  The re-sorting for @Applicative@ is more complicated than for @Monoid@, which just uses @merge@.
*  Define an @Ascending@ list monoid that does the merge.  Define @E a = Ascending (Future a)@ or @E = Ascending :. Future@.
*  Reconsider @E a = Future (Reactive a)@, or @E = Future :. Reactive@.  Define @mappend@ using @mappend@/@min@ for @Future@.
*  Wrote short section on &quot;Deconstructing events&quot;, into future values and sorted lists.  Made a module {{{Data.Sorted}}}, which has the @Monoid@ instance and classes and instances for @Ord@-enriched functors, AFs and monads.  The idea in each case is to do the corresponding method on the lists and sort the result.  For @Monoid@, the sort becomes just a merge.  For the others, optimization would require additional context from use, as in events.
*  On //n//th thought, suppose I remove the sortedness from the semantics of events.  Just say that the semantics is a list of time/value pairs.  For semantics, define @E = [] :. (,) T@ and use the resulting instances.  So what's the meaning of @a `stepper` e@ sampled at @t@?  Sort @e@ (stably), and use the value of the latest last future whose time is earlier than @t@.
*  Rethinking my paper structure //again//.  Since I'm keeping the semantics so very simple, give the semantics //as// I'm introducing FRP.  When to introduce future values, reactive values, and time functions?  How about this: say I'm going to build up from reactive values to reactive behaviors.  Develop reactive values and then in a later section show time functions and the composition of reactive values and time functions to get reactive behaviors.  Even show the composition up front, with definition of @Fun@ to come later.
*  Try this outline: ++++
*   Introduction
*   FRP deconstructed: @E = [] :. (T,)@, @B = (T -&gt;)@
*   Decoupling continuous and discrete change: @B' = E :. (T -&gt;)@.  @Fun@.
*   Reactive values: @R a = (a, E a)@.  Optimize @Applicative@, using @accumE@ and @pairR@.
*   Future values: data type for @(T,)@.  Tricky time bit.
*   Improving values
*   Improving on improving values
*   Related work
*   Limitations and Future work
*   Acknowledgments
   === 
  === 
</pre>
</div>
<div title="2008-03-16" modifier="YourName" created="200803271748" tags="2008-03 day" changecount="1">
<pre>* Learned on #haskell:  ++++&gt;
The [[closed world assumption| http://en.wikipedia.org/wiki/Closed_world_assumption]] is the presumption that what is not currently known to be true is false. The same name also refer to a logical formalization of this assumption by Raymond Reiter. The opposite of the closed world assumption is the open world assumption, stating that lack of knowledge does not imply falsity.
  === Bring out that term next time someone I notice someone on #haskell declaring something to be impossible, just because they can't imagine how it could be done.
* How to specify the semantics of @switcher@ and @stepper@?  I can define @switcher = (fmap.fmap) join stepper@ or @a `stepper` e = pure a `switcher` fmap pure e@.  Let's go with @stepper@.  Add the initial value or behavior as an event occurrence: @e' = pure a `mappend` e@.  Given a sample time @t@, filter the occurrences of @e'@, keeping just the ones properly before @t@ and pick the value in the last such occurrence.  Oh, oops!  That definition don't work.  The last occurrence in the filtered list might be earlier than some previous occurrences.  So first stable-sort the occurrences. ++++
\begin{code}
at (a0 `stepper` e) = \ t -&gt; last [a | (ta,a) &lt;- os, ta &lt; t]
 where
   e' = pure a0 `mappend` e
   os = stableSort (occs' e')
\end{code}
  === For switcher instead of stepper, I could replace @a@ with @b@ and apply the rhs to @t@.  But don't bother, because @join@ does exactly the same thing, semantically.  Now, this semantics is pretty simple.  And it can lead right into a discussion on implementation.  Keep the occurrences sorted.  Sort incrementally.  Sample monotonically.
* Simpler: instead of augmenting @e@ with @pure a@, cons @a@ to the filtered list before extracting the @last@ element.  Also do a bit of refactoring. ++++
\begin{code}
sortOccs' :: Event a -&gt; [(T,a)]
sortOccs' = stableSort . occs'

occsTo :: Event a -&gt; T -&gt; [(T,a)]
occsTo e t = [a | (ta,a) &lt;- sortOccs' e, ta &lt; t]

at (a0 `stepper` e) = \ t -&gt; last (a0 : occsTo e t)
		    = last . (a0 :) . occsTo e
\end{code}
  === 
* Oh: define @stepper@ in terms of @accumR@, which is defined via @accumE@. ++++
\begin{code}
a `stepper` e = a `accumR` fmap const e

a `accumR` e = a `stepper` (a `accumE` e)
\end{code}
  === Oh -- oops.  Circular definitions.  Okay, look at an accumulating combinator like @accumE@.  I think I have to process process the event argument in occurrence order. ++++
\begin{code}
accumE :: a -&gt; Event (a -&gt; a) -&gt; Event a
occs (a `accumE` e) =
  O (pure a `accum` fmap (&lt;*&gt;) (sortOccs' e))
\end{code}
  === 
* Next, what about reactive values, @R a = (a,E a)@?  As explored on [[2008-03-14]], I don't think the @R@ works with my game of deriving semantics right from the model and standard instances.  Oh -- maybe I want reactive normal form.  Could be  ++++
\begin{code}
data RNF a = TFun a `Switcher` Event (TFun a)
-- or 
data HRNF a = TFun a `Switcher` Event (HRNF a)
\end{code}
  === Either one could be the @Behavior@ representation.  If @RNF@, then factor into reactive values and time functions. ++++
\begin{code}
type Behavior = R .: TFun

data Reactive a = a `Stepper` Event a

rat :: Reactive a -&gt; B a
rat (a `Stepper` e) = at (a `stepper` e)
		    = \ t -&gt; last (a0 : occsTo e t)

at :: Behavior a -&gt; B a
at (O rf) = join (apply . rat rf)
\end{code}
  === 
* What does this normalization accomplish?  The goal is to design a data representation that can be stepped through, moving forward in time.  Each piece is non-reactive.  If constant, then do just one output, and otherwise set up a pull loop, which is the best we can hope for.
</pre>
</div>
<div title="2008-03-17" modifier="YourName" created="200803271748" tags="2008-03 day" changecount="1">
<pre>* Since yesterday, we've been unable to access our domains (on Joseph's server), though other people are able to.  I can't get through on FireFox or IE or SecureCRT.  Other domains come through fine.  Happens on our WinXP machines and on my Ubuntu laptop.  Happens with the router as well as wired right to the modem.  I spent an hour or so on the phone with a helpful Starband tech.  He suspected my virus software, but that wouldn't account for the behavior on Ubuntu.  Holly tested at Mom's house.  Same situation.  I called Starband again later.  They know about the problem and are working on it.
* Paper: ++++
*  Where do I go from here? ++++
*   Reactive normal form: leading to a data representation for behaviors ++++
*    The behavior &amp; event combinators are very flexible.  In @b0 `switcher` e@, the phases (@b0@, ...) themselves may be reactive, either as another @switcher@, or a @fmap@ or @(&lt;*&gt;)@ involving reactive behaviors.  Yet, semantically, a behavior built with these combinators must be made of phases of non-reactivity.  (Inductive argument, considering the behavior combinators.)  Suppose we could represent behaviors in a way that reveals this phase structure
*    @data RNF a = TFun a `Switcher` Event (TFun a)@
    === 
*   Decomposing behaviors: Reactive values &amp; time functions
*   Incremental time sorting
*   Optimizing Applicative on behaviors / RNF: reduce m*n to m+n
*   Data-driven: how does it relate to data representations?
   === 
  === 
* I just realized the Reactive join with the list-of-occurrences event representation doesn't work.  For @join ((a `Stepper` e) `Stepper` re)@, I have to stop listening to @e@ once @re@ occurs.  This @join@ is very important, since it implement switcher.  I could fix it with a new event combinator that combines @e@ and @re@ just  so.
* I also realized that my formulation of @Behavior = Reactive :. Fun Time@ might not be a monad after all.  I don't know how to eliminate @Fun Time (Reactive c)@.  I can get as far as using the dorp construction from [[Combining Monads| http://www.cs.nott.ac.uk/~nhn/Publications/icfp2005.pdf]].
</pre>
</div>
<div title="2008-03-18" modifier="YourName" modified="200803271749" created="200803271748" tags="2008-03 day" changecount="2">
<pre>* Released TypeCompose 0.5 and (old) reactive 0.5
* Gwern B sent some patches for reactive.  Hang onto them for when I make another release.  Search my mail for from gwern0 to me.
* Conversation with Gwern (saved) on GUI libraries.  A quote: ++++&gt;
the point was monads seem to've solved IO and  number of other problems, once and for all, so to speak, for haskell
  === I think Gwern was voicing a widely held belief and one that concerns me: that people think monads solved IO rather than hiding it.  Or another take: monads solve the problem of how to do imperative computation (including IO), instead of the more important problem of how //not// to do IO.  Doing IO means intractable semantics and hence great loss of formal reasoning.  Which is the point of Backus's &quot;can programming be liberated&quot; paper.  The disservice of monadic IO is in its superficial convenience via its cosmetic similarlity to functional programming, lulling even FPers into satisfaction.  To me, the Haskell community embracing monadic IO is like the Roman Empire embracing Christianity.  Popularity increased, but I'm not sure there's much of the original enterprise remaining.
* Reactive paper: ++++
*  Trying to capture and express the big picture: ++++
*   Simple compositional semantics, homomorphic over standard type classes.
*   Bridge the gap between this semantics and an efficient implementation. ++++
*    Sorting and searching in events: sort incrementally, sample monotonically.
*    Demand-driven sampling: normalize behaviors to reveal phase structure.  Each phase is non-reactive and often constant, with an event to deliver a new phase.  If constant, no work is done until the event occurs.
    === 
   === 
 === 
* Oh, oog.  My list-based event semantics has a problem.  ++++
*  It appends lists and later sorts.  I've been assuming @sort (os ++ os') == sort os `merge` sort os'@.  However, if @os@ is infinitely long, then @os ++ os' == os@, so the @os'@ occurrences are lost.  Similarly for @Applicative@.  Yeeps.
*  I could go back to my semantics of time-sorted sequences, with its parallel classes for @Functor@, @Applicative@, and @Monad@.  Or drop the factoring and define @Event@ semantics directly.  I couldn't append-then-sort, so I'd have to introduce @merge@ right into the semantics.  And much more complex for @Applicative@ and @Monad@.  Not very appealing.
*  How can a keep the semantics simple?  Better yet, how can I simplify away the problem with my list-based semantics?
*  Idea: the semantics of events is a function from time to lists of occurrences.  Similar to the Yampa formulation of events as @Maybe@-valued signals and signal transformers.  Doesn't have to be list.  Could be any monoid.  Now, how to define the meaning of @switcher@?  What is the latest relevant occurrence?  This question came up for me at the very beginning of my FRP work.  I wanted to consolidate behaviors and events, and I couldn't quite see how to do it.  Funny that it's still here.  Would the class instances work out?  Yes for @Monoid@ and @Functor@, but I think not for @Applicative@ (and hence for @Monad@).  @pure@ makes constant functions, and @Applicative@ combines concurrent values.
*  Oh, of course!  Don't use empty values between occurrences.  Hold the value between.  Then @Applicative@ has exactly the desired meaning.  Of course, I'm talking about //reactive values// here.  The events are at the transitions.  However, I don't know what a transition means within the function model.  What happens when two event occurrences have the same value.  For a @()@-valued event, //all// occurrences have the same value.
*  Idea: augment the time function with a discrete set of times.  For @pure@, use {-infinity}.  For @(&lt;*&gt;)@, use union.  Oh!  If @pure@ uses the empty set instead, I have monoidal combination.  Use a pair of @(set,fun)@, i.e., @(,) (Set Time) :. (-&gt;) Time@.  Use the standard @Functor@ and @Applicative@ instances for type composition.  Perhaps @Monad@ also in this case.  The @Applicative@ instance is a better fit as it doesn't pile up simultaneous occurrences.  Does @pure a = O (empty, const a)@ work out?  I don't know.  Oh, what about the event @Monoid@?  How do I combine functions?  I think I'd have to use the sets, which spoils the orthogonality some.
*  Another idea: use events as list- or maybe-valued behaviors.  Don't have @Applicative@ and @Monad@ instances.  Monoid works great.  It's the list or maybe monoid lifted through the behavior AF.
*  How to define the semantics of @switcher@?
*  Oh, hey.  Here's another idea still.  Return to defining events as future reactive values. ++++
*   De-emphasize semantics (explored elsewhere).  Focus on new stuff: RNF, futures, reactive values, application of improving values, new implementation of improving values.
*   Introduce behaviors and events with informal semantics.  Mention that some of the CFRP functions correspond to instances of standard classes.
*   Decompose reactive behaviors into reactive values and time functions.
*   Future values with semantics.  Take care with @min@/@mappend@.
*   Decompose events as future reactive values, exactly as in my implementation.
   === 
  === 
</pre>
</div>
<div title="2008-03-19" modifier="YourName" created="200803271748" tags="2008-03 day" changecount="1">
<pre>* Reactive paper: ++++
*  Rethinking yet again. ++++
*   I can keep the semantics section but replace the events part with an unfactored version (with the time ordering assumption) and without @Applicative@ and @Monad@.  The @Monoid@ instance merges temporally.  Maybe add @Applicative@ and @Monad@ in a later section.
*   Then &quot;Intermission: from semantics to efficient implementation&quot;.  Describe the obstacles to efficient implementation: impossible time comparison; expensive searching in events (non-incremental sampling); pull-based evaluation (not knowing when value changes).
*   Future values (to begin addressing time comparison).  Will be augmented in &quot;Improving values&quot;.
*   Reactive normal form
*   Decomposing behaviors: reactive values and time functions.
*   Decomposing events: future reactive value.  I'm not sure I want take this approach.  I think so, however, as (a) it's cool, and (b) it simplifies the event @Monoid@ and (for later) the event @Monad@.
*   Improving values
*   Improving on improving values
   === 
  === 
</pre>
</div>
<div title="2008-03-20" modifier="YourName" created="200803271749" tags="2008-03 day" changecount="1">
<pre>* [[Responded to Niklas| http://evolve.awakeningcompassion.com/posts/vague-demands-and-honesty/#comment-191]] on my &quot;NVC Evolves&quot; blog.
* Mostly worked on Reactive paper.  It's coming together.
</pre>
</div>
<div title="2008-03-21" modifier="YourName" created="200803271750" tags="2008-03 day" changecount="1">
<pre>* Convergence day: vernal equinox, full moon, Good Friday, 2 year anniversary of Dad's transition.
* There's quite a lot of live energy in the nvc-evolves and emergence-of-nvc groups.
* (I)An-Ok forwarded part of an Essay by Carl Rogers opposing certification and licensure.  An excerpt: ++++&gt;
As soon as we set up criteria for certification - whether for clinical psychologists, for NTL group trainers, for marriage counselors, for psychiatrists, for psychoanalysts, or, as I heard the other day, for psychic healers - the first and greatest effect is to freeze the profession in a past image. This is an inevitable result. What can you use for examinations? Obviously, the questions and tests that have been used in the past decade or two. Who is wise enough to be an examiner? Obviously, the person who has ten or twenty years of experience and who therefore started his training fifteen to twenty- five years previously. I know how hard such groups try to update their criteria, but they are always several laps behind. So the certification procedure is always rooted in the rather distant past and defines the profession in those terms.
  === 
</pre>
</div>
<div title="2008-03-22" modifier="YourName" created="200803271750" tags="2008-03 day" changecount="1">
<pre>* Reactive paper: ++++
*  Find a clear link between the list-of-occurrences model and the future-reactive-value model of events.  The former matches a simpler intuition, while the latter seems a bit easier to manipulate.  I can translate easily between the two models.  Relate to Fran's original &quot;Event&quot; model, which corresponds to my notion of future value.  Maybe start by considering @switcher@ and simplify to another 
  === 
</pre>
</div>
<div title="2008-03-24" modifier="YourName" created="200803271750" tags="2008-03 day" changecount="1">
<pre>* Reactive paper: ++++
*  How do I use these improving times?
*  Clarify how data-driven. ++++
*   Try this: a function representation suggests pull, i.e., put in a sample time and get out a result.  Make the data structure consist of the distinct values (assuming discretely changing).  The representation must say when the changes take place, so that behaviors can be combined concurrently (via @(&lt;*&gt;)@).  Hence reactive values.  Still, what's data-driven here?  The implementation steps through a reactive value, blocking until events occur.
   === 
*  Idea: use nested @max@ calls for future times.  For each non-occurrence, throw in another @max@.  
*  Idea for interface: schedule an action at a future time.  For reactive values, that action performs one output and schedules another action.
  === 
</pre>
</div>
<div title="2008-03-26" modifier="YourName" created="200803271751" tags="2008-03 day" changecount="1">
<pre>* Reactive paper: ++++
*  I want to drop the terms &quot;pull-based&quot; and &quot;push-based&quot; evaluation, in favor of &quot;demand-driven&quot; and &quot;data-driven&quot;.  Clarify what these latter pair &quot;demand-driven&quot; can mean in the context of functional programming and FRP in particular.  Demand-driven is simple enough: each time sample is a demand.  Set a target sample/frame rate or just sample as frequently as possible.  Lots of functional values get computed, and one output action.  Data-driven is usually associated with imperative frameworks: actions (side-effects) are executed in response to an event (new data).  Lots of update actions, including one output.  What could //functional// data-driven evaluation be?  Instead of a function, use a lazy data structure, and start traversing it.  As usual, accessing a data structure component returns right away if the component has already been accessed.  Otherwise the component gets computed, which delays the access operation.  Typically, the delay is short, and there is a single thread of evaluation.  Now suppose that the value's computation has not just been postponed as an optimization (laziness), but it depends on information about the future.  Then a lazy functional framework can simply wait, as usual, to return a value when it's been computed.  Because this wait can be substantial, and no amount of computing effort will hasten completion, the implementation will likely want to perform other computations while waiting.
  === 
</pre>
</div>
<div title="2008-03-27" modifier="YourName" created="200803310355" tags="2008-03 day" changecount="1">
<pre>* Test out my new improving values implementation.  How to plug it in?  The type: ++++
\begin{code}
data Improving a = Imp { exact :: a, compareI :: a -&gt; Ordering }
\end{code}
  === For each event occurrence, I just have to come up with @exact@ and @compareI@.  For @exact@, use an explicit @MVar@ or maybe a channel with @getChanContents@.  For @iv `compareI` t@, try two tactics in parallel: ++++
*  Use the exact value: @exact iv `compare` t@.
*  Wait until all time @t@ occurrences have been processed, then confirm that @iv@ is still unknown, and say @GT@.  How to wait?  Set up a one-shot event in the same single thread as all related event processing.
  === 
* Related work: ++++
*  &quot;Dynamic optimization for FRP using GADTs&quot;: uses a more complex representation, with several special constructors for pattern matching, which also introduces overhead; uses more complex types (GADTs).
*  &quot;Parallel FRP&quot;: introduces nondeterminism into the semantics (really?); uses Linda for concurrency.
*  &quot;E-FRP&quot;: probably the most closely connected, focused on &quot;event-driven&quot; systems; time is handled discretely; events may not occur simultaneously; resource-bounded (as RT-FRP); generates code.
  === 
</pre>
</div>
<div title="2008-03-28" modifier="YourName" created="200803310355" tags="2008-03 day" changecount="1">
<pre>* Working on the Reactive paper. ++++
*  Related work.
*  Monad semantics and implementation for events.
  === 
</pre>
</div>
<div title="2008-03-29" modifier="YourName" created="200803310355" tags="2008-03 day" changecount="1">
<pre>* [[Twitter from Emacs| http://www.emacswiki.org/cgi-bin/emacs/twit.el]]
* Reactive: ++++
*  Strengthen the tie from semantics to implementation.  Semantics of @stepper@: ++++
\begin{code}
at (a `stepper` e) = \ t -&gt; last (a : occsTo e t)

occsTo :: Event a -&gt; T -&gt; [(T,a)]
occsTo e t = [a | (tah,a) &lt;- occs e, tah &lt; t]
\end{code}
   === Switch to an effective definition of @occsTo@: ++++
\begin{code}
at (a `stepper` e) = \ t -&gt; last (a : before (occs e) t)

occsTo e = before (occs e)

before :: T -&gt; E a -&gt; a -- monotonic
-- specification
before t os = [a | (tah,a) &lt;- os, tah &lt; t]
-- implementation
before t os = map snd (takeWhile ((&lt; t) . fst)) os
\end{code}
   === Unrolling and simplifying the definition of @before@: ++++
\begin{code}
before _ [] = []
before t ((tah,a):os') | tah &lt; t   = a : before t os'
                       | otherwise = []
\end{code}
   === And then adding the context for @before@: ++++
\begin{code}
lastBefore :: a -&gt; T -&gt; E a -&gt; a
lastBefore a0 t os = last (a0 : before os t)

lastBefore a0 t []  = last (a0 : [])
                    = a0

lastBefore a0 t ((tah,a):os') | tah &lt; t   = last (a0 : a : before t os')
                                          = last (a : before t os')
                                          = lastBefore a t os'
                              | otherwise = last (a0 : [])
                                          = a0
\end{code}
   === Now add the definition of @occs@: ++++
\begin{code}
stepperAt :: a -&gt; Event a -&gt; Time -&gt; a
stepperAt a0 e t = (a0 `stepper` e) `at` t
                 = last (a0 : before (occs e) t)
                 = lastBefore a0 (occs e) t
\end{code}
   === Introducing the @Event@ representation: ++++
\begin{code}
stepperAt a0 e t = lastBefore a0 (occs' (-infinity) e) t
                 = stepperAt' (-infinity) a0 e t

stepperAt' :: FTime -&gt; a -&gt; Event a -&gt; Time -&gt; a
-- specification:
stepperAt' t0h a0 e t = lastBefore a0 (occs' t0h e) t

-- implementation:
stepperAt' _ a0 (Event (infinity,_)) t = a0
stepperAt' t0h a0 (Event (tah, a `Stepper` e')) t
  | t1h &lt; t   = a
  | otherwise = stepperAt' t1h a e'
  where
    t1h = t0h `max` tah
\end{code}
   === To simplify, use @rat@ with a reactive value instead of @stepperAt@ with value &amp; event. ++++
\begin{code}
rats :: Event a -&gt; Time -&gt; a
rats (a0 `Stepper` e) ts 
  = (a0 `stepper` e) `ats` ts
  = map (lastBefore a0 (occs e)) ts
  = map (lastBefore a0 (occs' (-infinity) e)) ts

rats' (-infinity) (a0 `Stepper` e) t

\end{code}
   === 
*  Decompose @occs@.  Extract time/value pairs, and then make monotonic. ++++
\begin{code}
occs = monotone . timeVals

timeVals :: Event a -&gt; [(FT,a)]
timeVals (Event (infinity, _)) = []
timeVals (Event (tah, a `Stepper` e')) = (tah,a) : timeVals e'

monotone :: [(FT,a)] -&gt; E a
monotone ps = monotone' (-infinity) ps
  where
    monotone' _ [] = []
    monotone' t0h ((tah,a) : ps') = (t1h,a) : monotone' t1h ps'
     where
       t1h = t0h `max` tah
\end{code}
   === 
  === 
</pre>
</div>
<div title="2008-03-30" modifier="YourName" modified="200804031550" created="200803310356" tags="2008-03 day" changecount="5">
<pre>* Reactive paper: ++++
*  Lots of great comments from Mike Sperber, and a pointer to the relevant part of [[his dissertation| http://w210.ub.uni-tuebingen.de/dbt/volltexte/2001/266/]] (section 12.5).
*  A &quot;monad (homo)morphism&quot; is a natural transformation that preserves the structure of return and join, exactly as in my semantics.  Some references:  ++++
*   [[Monads for functional programming| http://citeseer.ist.psu.edu/wadler95monads.html]]
*   [[Comprehending Monads| http://citeseer.ist.psu.edu/wadler92comprehending.html]] (called just &quot;monad morphism&quot; in section 6).
*   [[The Category of Monads| http://incoherantstudy.blogspot.com/2007/11/category-of-monads.html]]
   === Collectively, I could use the term &quot;(type) class homomorphisms&quot;.  
  === 
* Haskell SDL example (bouncing text screensaver): http://hpaste.org/6743 .
* [[Haskell &amp; category theory| http://en.wikibooks.org/wiki/Haskell/Category_theory]].  Monad laws in terms of @join@: ++++
#  @ join . fmap join = join . join@
#  @ join . fmap return = join . return = id@
#  @ return . f = fmap f . return@
#  @ join . fmap (fmap f) = fmap f . join@
  === 
* Applicative functor laws: ++++
*  //identity//: @pure id &lt;*&gt; v = v@
*  //composition//: @pure (.) &lt;*&gt; u &lt;*&gt; v &lt;*&gt; w = u &lt;*&gt; (v &lt;*&gt; w)@
*  //homomorphism//: @pure f &lt;*&gt; pure x = pure (f x)@
*  //interchange//: @u &lt;*&gt; pure y = pure ($ y) &lt;*&gt; u@
*  The Functor instance should satisfy @fmap f x = pure f &lt;*&gt; x@
*  If @f@ is also a Monad, define @pure = return@ and @(&lt;*&gt;) = ap@@.
  === 
</pre>
</div>
<div title="2008-03-31" modifier="YourName" created="200804031548" tags="2008-03 day" changecount="1">
<pre>* Reactive paper: ++++
*  I put in some &quot;morphism&quot; language.  I'd like to explore this technique more deeply in another paper.
*  I'm not sure the &quot;data-driven&quot; bit is as clear as it might be.  Say that looking at next event occurrence causes the thread to block.  When the event occurs, the thread unblocks.
*  I'm having doubts about the neat trick of representing events as future reactive values.  There's the awkwardness of maintining temporal monotonicity, which is easy to handle in the list-of-occurrences representation, via the @monotone@ pass in @join@.  Moreover, having the representation correspond to the semantics makes the correctness unmistakable.  I liked how the future-reactive representation simplified the definitions of @(&lt;*&gt;)@ and @join@ for @Reactive@ and of @join@ for @Event@.  See if I can translate the simplicity to the list-of-occurrences representation.  Also, the representation of never-occuring event is simpler: an empty list.  Oh!  How could event filtering work?  Suppose the filter eliminates the last occurrence, turning a non-empty list to an empty one.  The emptiness test could block, and hold up the comparison with occurrences that happen before the removed occurrence.  Wow -- that's a darn subtle problem!  Explain it in the paper as a reason not to use the list-of-occurrences representation.
* Show that event filtering is easily defined via @(&gt;&gt;=)@.
  === 
</pre>
</div>
<div title="2008-04-01" modifier="YourName" modified="200804031549" created="200804031548" tags="2008-04 day" changecount="2">
<pre>* Reactive paper: ++++
*  Relate to Lula: ++++
*   Multi-threaded
*   Carefully examines and addresses issues of events and blocking
*   Determination times
*   Eliminates overhead of event non-occurrences
*   Did not guarantee semantic determinism
*   Inspiration for this design
   === 
*  Ripped out &quot;Monotonic sampling&quot; and wrote a new version.  Nice &amp; simple!
*  Axed the first detailed figure on improving values.  Refer to Warren B paper instead.
*  Future work: ++++
*   Extensive testing and measurement, particularly in the new implementation of improving values, using |unamb|.
*   Consider a zipper representation for bidirectional sampling.  Efficient in time but still leaky in space.
   === 
  === 
</pre>
</div>
<div title="2008-04-02" modifier="YourName" created="200804031549" tags="2008-04 day" changecount="2">
<pre>* Submitted my ICFP'08 paper, [[Simply efficient functional reactivity| http://conal.net/papers/simply-reactive]].
</pre>
</div>
<div title="2008-04-03" modifier="Conal Elliott" created="200804122030" tags="2008-04 day" changecount="2">
<pre>* Talked with Eric Shippam at [[Communications/Advantage| http://communicationsadvantage.net]].  They're bringing broadband wireless into local rural areas, including ours.  Sent them our house's GPS coords.
* Poking around at [[jsMath| http://www.math.union.edu/~dpvc/jsmath]].  Get LaTeX-specified math into web pages.  If the user installs TeX fonts, the result zooms with the text and looks great on the screen and paper.
* Relearning to profile ghc packages. Added {{{--enable-library-profiling}}} to my-cabal-make.inc.  Did TypeCompose and simply-reactive.  Next: wxhaskell.  Try out the new cabal version on hackage, when [[hackage| http://hackage.haskell.org/]] is back up.
</pre>
</div>
<div title="2008-04-04" modifier="Conal Elliott" created="200804122031" tags="2008-04 day" changecount="1">
<pre>* Blogging: ++++
*  [[Point to my icfp submission| http://conal.net/papers/simply-reactive/]]
*  Type class morphisms
*  Type composition and class morphisms
*  Latency and frp
*  Unambiguous choice -- a tool for semantically determinate concurrency
  === 
* Upgraded my [[technical blog| http://conal.net/blog]].  Got into terrible trouble with the &quot;maintenance mode&quot; plugin, which locked me out of my blog.  Got through it, though traumatized.
</pre>
</div>
<div title="2008-04-05" modifier="Conal Elliott" created="200804122031" tags="2008-04 day" changecount="1">
<pre>* cnvc-cert conversation about the term &quot;triggered&quot;.
* Writing blog post &quot;Fun with type class morphisms&quot;.
</pre>
</div>
<div title="2008-04-06" modifier="Conal Elliott" created="200804122031" tags="2008-04 day" changecount="1">
<pre>* Processing comments on my paper.
</pre>
</div>
<div title="2008-04-07" modifier="Conal Elliott" created="200804122031" tags="2008-04 day" changecount="1">
<pre>* Thoughts on type class morphisms and type composition: ++++
*  My formulation of @at@ could be a bit simpler. ++++
\begin{code}
at (O rf) == join (fmap apply (rat rf))
          == rat rf &gt;&gt;= apply
\end{code}
   === 
  === 
</pre>
</div>
<div title="2008-04-08" modifier="Conal Elliott" created="200804122031" tags="2008-04 day" changecount="1">
<pre>* Some [[FRP discussion on Lambda-the-Ultimate| href=http://lambda-the-ultimate.org/node/2756]].
* Posted [[Simplifying semantics with type class morphisms| http://conal.net/blog/posts/simplifying-semantics-with-type-class-morphisms/]].
</pre>
</div>
<div title="2008-04-10" modifier="Conal Elliott" created="200804122032" tags="2008-04 day" changecount="2">
<pre>* Chatted with Christophe (vincenz) about [[Simplifying semantics with type class morphisms| http://conal.net/blog/posts/simplifying-semantics-with-type-class-morphisms/]].  Christophe and another reader had missed the distinction between the @Behavior@ type and its semantics.  I added a (hopefully clarifying) comment to the post.
* Spent some time tracking down a problem with my blog.  The block features of markdown don't work for other people leaving comments.
* Started writing blog post &quot;Composition and type class morphisms&quot;.  Maybe I'd better write a post about type composition first and then bring together type composition and type class morphisms.
</pre>
</div>
<div title="2008-04-11" modifier="Conal Elliott" created="200804122032" tags="2008-04 day" changecount="1">
<pre>* Trying out {{{cabal install}}}.  Changing my {{{c:/Documents and Settings/Conal/Application Data/cabal/config}}}: ++++
*  {{{compiler}}}: was &quot;GHC&quot;, now &quot;ghc&quot;
*  {{{cachedir}}}: was &quot;C:\\Documents and Settings\\Conal\\Application Data\\cabal\\packages&quot;, now &quot;c:/Haskell/packages/&quot;
*  Later, change {{{hackage-username}}} and {{{hackage-password}}} (for {{{cabal upload}}}, I guess)
  === 
</pre>
</div>
<div title="2008-04-13" modifier="Conal Elliott" created="200804142137" tags="2008-04 day" changecount="1">
<pre>* Fifteen puzzle: ++++
*  Each tile can see in four directions, distinguishing free vs occupied.
*  How to move pieces?  Some possibilities: ++++
*   Arrow key.  If a tile can move in that direction, it does.  Maybe broadcast the direction to all the tiles, and let each decide whether to more.  Or &quot;tell&quot; a specific tile when it is to move, and never mind about the tile's four-directional vision.  By telling a tile, I mean that the tile's index occurs in an event occurrence.
*   Mouse click.  If the selected tile can move, it does.  Each tile feels the mouse click only when in the tile's region, and can highlight in some way.  Perhaps highlighting differently, depending on whether or not the tile can move.  Use an overlay shows whether the tile can move and, if it can, in which direction.
*   Mouse drag.  If the selected tile can move in the dragged direction, it does.
   === The first two are probably the most convenient.  The third could be cool for a different game, perhaps Sokoban.
*  I'd like to make the tiles look good: use beveled and/or smoothed edges and maybe a neat bump-mapped texture.
*  For environmental information, I'll want some combinators that I couldn't implement at all efficiently in a demand-driven FRP engine.  In particular: ++++
\begin{code}
arrayE :: Ix i =&gt; (i,i) -&gt; Event (i,a) -&gt; Array i (Event a)
\end{code}
   === Similarly for other indexed structures, like maps and various kinds of trees.  Can I implement @arrayE@ efficiently in Reactive?  I want a small amount of work done per occurrence, independent of the size of the array.
*  Track the location of the blank.  Snapshot that location with the @move@ event, which carries a direction.  Then determine which of the 16 locations, if any, is next to the blank in the opposite direction.  Then which tile is currently in that location, yielding an @Event (Loc,Tile)@, which is fit for @arrayE@.
*  Backing up, how can I define which tile is at a given location?  Suppose I have an @Array Loc (Reactive Tile)@.  I want a combinator something like ++++
\begin{code}
(!*) :: Event (i,a) -&gt; Array i (Reactive b) -&gt; Event (a,b)
\end{code}
   === Hm.  I'd worry about time/space leaks with @Array i (Reactive b)@.  Alternatively, I could use @Reactive (Array i b)@, and I wouldn't need @(!*)@.  But how can I maintain that array efficiently?  Ideally, I'd maintain it destructively, which I don't know how to do safely.  (Consider @snapshot@.)
*  Would an @Arrow@ interface help?  It would prevent any code from hanging onto the array of signals.
  === 
* Perhaps the reason that we can move forward in time but not backward is simply that our Reality was easier and/or cheaper to implement that way.  Ditto for remembering the past and not the future.  For instance, a zipper representation for reactive behaviors could easily give access to the past, even efficient access to the //recent// past.  But it would cause a huge space leak.
* On memory (and FRP): We respond not to the past, but to our present (filtered) memory of the past.  Nice trick, allowing the distributed representation and efficient memory management.
* The FRP semantic models are much more expressive than necessary, and more expressive than can be implemented reasonably well.  In classic, pre-arrow FRP, one difficulty is time transformation of behaviors that depend on external input.  In a sense, it's possible to implement, though the memory and latency requirements grow without bound.  In arrow-based FRP, the @Signal a -&gt; Signal b@ model has the same issue.  If time transformation is not implemented, then we're not using the full semantic model, which then fails to be //[[universal| http://www.inf.ed.ac.uk/teaching/courses/fpls/note15.pdf]]//.  In other words, the model contain //junk//, i.e., values that are not the denotation of any expressible behavior.
* So, what are some more restrictive models, particularly ones that align with our (apparent) reality?  The classic Fran/FRP model requires (encourages?) magic/ESP in that behaviors know what other behaviors are up to.  That magic breaks temporal and spatial modularity of interaction.  Transforming an input-dependent behavior in space or time cannot automatically inversely transform the input, while the signal-function model can, which is the main strength I see in the latter model.  Could we replace @Signal a -&gt; Signal b@ simply with @a -&gt; b@?  I don't think that model covers integration or reactivity.  Then there's a differential approach: @a -&gt; b'@ where @b'@ is some sort of derivative type for @b@, but some types don't have derivatives.  Perhaps combine these types of behaviors in a sum, or generalize the notion of derivative to handle both cases and discrete reactivity (say via Dirac impulses).  I'm intrigued with the idea of defining //all// values differentially.  It'd certainly encourage animation.  Discrete types (e.g., @Bool@) would require some special treatment.  (Perhaps replace @if-then-else@ with a slow-in and slow-out interpolation.)  What would be a nice generalization of @integral@ and @switcher@ or @accumR@?  Note that they all take an initial value and a means of changing the value, either discretely or continuously.
</pre>
</div>
<div title="2008-04-14" modifier="Conal Elliott" created="200804160416" tags="2008-04 day" changecount="1">
<pre>* The [[Haskell Symposium| http://haskell.org/haskell-symposium/2008]] submission deadline is June 23.  I wonder what I might write up?  Maybe the representation I was playing with for functions over continuous domains, including images.
* Fifteen puzzle / FRP: ++++
*  Every tile is described by the same bot (signal function), which maps a localized universe (in which the tile is always at the origin) to a location.
*  The location comes from integrating a velocity.  The velocity could be finite (e.g., linear or slow-in/slow-out) or have (infinite &amp; instantaneous) impulses.
*  The location is used, inversely, to transform the puzzle's universe into the tile's perspective.
*  That universe can simply be a function from relative locations to contents.  Each tile sees itself at the center/origin of the universe.
*  Decompose the tile description into an outer perceptual layer and an inner logic.  The perceptual layer filters the tile-localized universe into much less information: the free/occupied status of each of its four neighbors in 2D, and a tapping impulse from above (user click).  That filtered information is fed to the logic layer.
*  I like Henrik's idea of using impulses in place of events, so that a single integral can yield piecewise-continuous results (possibly only discretely changing).  Consider how the notion could be generalized.  For instance, when I type, each character has a differential effect on my buffer.
*  Design the behavior data type so that impulses can occur only discretely.
  === 
</pre>
</div>
<div title="2008-04-15" modifier="Conal Elliott" created="200804160416" tags="2008-04 day" changecount="1">
<pre>* Fifteen puzzle / FRP: ++++
*  Go for continuous tile movement with slow-in/slow-out.  Use a spring model: each tile has a current position (and velocity) and a goal position.  Usually @current == goal@, but sometimes not, when a tile is in motion.  For the 15 puzzle, the goal changes step-wise.
*  Another idea: when the user clicks on a tile, a spring connection is created, which lasts until the tile is released.  The spring force
*  Keep delivering the spring's anchor location relative to the (sometimes moving) tile.  In the ODE then, there's no need to subtract the tile's position from its goal.  (The tile's position is always zero, relative to itself.)  Oh -- maybe a subtraction to account for grabbing it off center.  When neighboring tiles fully or partly block the given tile, an additional force counteracts the spring force.  Alternatively, project the acceleration vector onto the unit vector in the direction of the neighboring blank if any (replacing negative components with zero).
  === 
* The intractable denotational model I think of for @IO a@, namely @U -&gt; (a,U)@ (where @U@ is the physical universe), is not nearly expressive enough to account for concurrency, which brings in the powerset of transition sequences.  How can anyone expect to write correct concurrent imperative programs?
* Another free wifi place in Sonora: HavaJava.
</pre>
</div>
<div title="2008-04-16" modifier="Conal Elliott" modified="200804171833" created="200804170522" tags="2008-04 day" changecount="2">
<pre>* Animated illustration project: ++++
*  Chatted with Andy Gill.  We're starting on a new library for animated illustration (2D &amp; 3D), probably with some interaction as well.  
*  Some sources of examples: ++++
*   [[A PGF and TikZ examples gallery| http://www.fauskes.net/nb/pgftikzexamples/]]
*   [[Graphviz gallery| http://www.graphviz.org/Gallery.php]]
*   [[Project mathematics videos| http://www.projectmathematics.com/]]
   === 
*  To start, we're going to play with some charts made of boxes, arrows, and text.  First [[Simple flow chart| http://www.fauskes.net/pgftikzexamples/simple-flow-chart/]].  I'm thinking we can do the graph layout using masses &amp; springs, with specified rest lengths &amp; angles.  Plop down the components at random (or at the origin) and watch them wiggle around.  Allow the user to move and/or twist.  Even the edges could have interesting physics, e.g., a curvable rod.  Play with interaction ideas.
*  Idea for numeric integration: use a rate-based scheduler.  Larger derivatives get stepped more often.  As a special case, near-zero derivatives wait almost forever to get scheduled.  Meanwhile, a derivative value can get updated thanks to //its own// derivative being stepped or some other specification, which causes its next integration step to get rescheduled.
  === 
</pre>
</div>
<div title="2008-04-17" modifier="Conal Elliott" created="200804251557" tags="2008-04 day" changecount="1">
<pre>* Playing with chart specifications. ++++
*  First cut is modeled after Pgf, wrapping Haskell-style.  The [[simple flow chart| http://www.fauskes.net/pgftikzexamples/simple-flow-chart/]] might become something like the following: +++
\begin{code}
import Pgf

-- block styles
decision = diamond   %+ draw %+ fblue %+ text_width (em 4.5) %+ text_badly_centered
                     %+ d3 %+ inner_sep (pt 0)
block    = rectangle %+ draw %+ fblue %+ text_width (em 5) %+ text_centered
                     %+ rounded_corners %+ minimum_height (em 4)
cloud    = ellipse   %+ draw %+ fred %+ d3 %+ minimum_height (em 2)
line     = draw      %+ no_latex'

-- fills
f20 col = fill (col!20)
fblue = f20 blue
fred  = f20 red

-- Position further for decision node
d3 = node_distance (cm 3)

-- nodes
init     = node block &quot;initialize model&quot;
expert   = node (cloud %+ left_of init) &quot;expert&quot;
system   = node (cloud %+ right_of init) &quot;system&quot;
identify = node (block %+ below init) &quot;identify candidate models&quot;
evaluate = node (block %+ below identify) &quot;evaluate candidate models&quot;
update   = node (block %+ left_of evaluate +% d3) &quot;update model&quot;
decide   = node (decision %+ below evaluate) &quot;is best candidate better?&quot;
stop     = node (block %+ below decide +% d3) &quot;stop&quot;

-- edges
edges = map pathl [
          init --&gt; identify
        , identify --&gt; evaluate
        , evaluate --&gt; decide
        , decide -| node near_start &quot;yes&quot; update  -- what to do here??
        , update |- identify
        , decide --&gt; node mempty &quot;no&quot; stop
        ] ++ map pathl' [
          expert --&gt; init
        , system --&gt; init
        , system |- evaluate
        ]

pathl  = path line
pathl' = path (dashed %+ line)

flowChart =
  chart [init,expert,system,identify,evaluate,update,decide,stop] edges
\end{code}
  === I'm using @(%+)@ as a short-hand synonym for @mappend@ on styles.  I've mimicked the PGF specification as closely as I could.  This operation could simply be reverse function composition.
*  Another idea: move the edges into the source nodes.  (Could as well place in targets.)  A fairly superficial change, I think.
*  Another approach: masses and springs (linear and angular).  Some edges have strong preferences about their lengths, while others don't care.  Every connection point of a node has a force going in and a position coming out.
  === 
* Imported posts from my old Blogger/Blogspot blog and hand-tweaked some strange bits.
* [[Markdownify: The HTML to Markdown converter for PHP| http://milianw.de/projects/markdownify/]].  Oh yeah, [[pandoc| http://johnmacfarlane.net/pandoc/]] can do that too: {{{pandoc --from=html --to=markdown}}}.
</pre>
</div>
<div title="2008-04-18" modifier="Conal Elliott" modified="200804251558" created="200804251557" tags="2008-04 day" changecount="2">
<pre>* Illustration library: ++++
*  I think I know how to handle masses &amp; springs: model each rigid component as a function from force on it to position (say center).  Add more structure by composing with one function that sums forces applied to connection points and another that turns a single position into a position for each connection point.  Later, add torque.
*  Model edge corners as degenerate rigid objects, with zero size and mass.
*  Worked more on a PGF-like specification of graphs.  Going fairly well, though I think I'll prefer the mass &amp; spring model.
  === 
* To me, pure functional programming means that all effects are hidden inside of the implementation of values.  These hidden effects include laziness, in which an evaluated thunk replaces the thunk.  Also pushing data onto call frames, for communication between functions.  Evolving the functional paradigm in the direction of purity requires addressing I/O.  The popular monadic solution, safely separates effects from functional code, but leaves the effects in the user model, where their complex (denotational) semantics (especially with concurrency) thwart simple and powerful reasoning and lead to very weak composability, as discussed by John Backus (&quot;Can programming be liberated ...&quot;).  So monadic IO is not so much functional programming as a way for imperative and functional code to coexist in programs, while preserving simple (denotational) semantics of the functional part.  How else might we &quot;address&quot; I/O?  By seeing it as an implementation of something functional, such as persistence (for file writing/reading) and function-call data marshaling (for human I/O).
* Responded to [[a question on my blog| http://conal.net/blog/posts/simply-efficient-functional-reactivity/#comment-3059]] about how to make externally-sourced future times.
</pre>
</div>
<div title="2008-04-22" modifier="Conal Elliott" created="200804251558" tags="2008-04 day" changecount="1">
<pre>* Great visit in San Francisco with Peter &amp; Rudy from Anygma/Nazooka.  Details pending.
</pre>
</div>
<div title="2008-04-23" modifier="Conal Elliott" created="200804251558" tags="2008-04 day" changecount="1">
<pre>* Chats with Ivan.
* I want to pull together thoughts on issues with arrowish vs classic frp style interface, especially in the context of a non-programming authoring tool.
</pre>
</div>
<div title="2008-04-24" modifier="Conal Elliott" modified="200804251642" created="200804251558" tags="2008-04 day" changecount="9">
<pre>* Masses &amp; springs: ++++
*  I don't know how to give an elegant, non-reduandant specification of an undirected graph of masses and springs.  Here's a formulation that uses keys/labels for the masses, which are then mentioned as spring end-points.  For simplicity, I'll assume standard masses and initial velocities, providing only initial positions. ++++
\begin{code}
graph [('a',a0), ('b',b0), ('c',c0)] [('a','b'),('b','c')]
\end{code}
  === Or replace @a0@ etc with fuller specifications, including mass and appearance.  Btw, where do we get the initial positions?  Perhaps choose arbitrary distinct values, say distributed around a small circle.  More general graph: ++++
\begin{code}
graph :: Ord k =&gt; [(k,v)] -&gt; [(k,k)] -&gt; Graph k v
\end{code}
  === The @Ord@ constraint is simply so that I can use a finite map for efficient lookup.  Otherwise, I'd just assume @Eq@.
*  I'm not sure I really want @k@ in the @Graph@ type.  Maybe hide it.  Depends on what graph accessors are useful.
*  I like this separation between a general graph specification and the physical interpretation.  Also, the graph could be interpreted as directed or undirected.  For this use, undirected, since forces come in opposite pairs.  Here's an idea for yet another intermediate step, generalizing from forces.  Make a graph whose elements are functions from connected values to values. ++++
\begin{code}
tieGraph :: Graph k ([v] -&gt; v) -&gt; [(k,v)]
\end{code}
   === Maybe a specialized/optimized version for symmetric situations like force pairs: ++++
\begin{code}
tieSymG :: Num u =&gt; (v -&gt; v -&gt; u) -&gt; Graph k (u -&gt; v) -&gt; [(k,v)]
\end{code}
   === For instance, @v@ is position, velocity, and mass, and @u@ is force.  We could almost use @Monoid@ instead of @Num@ here, but we need an inverse (@negate@).
*  Oh, oops -- what about spring stiffness?  Could place in the edges, as &quot;labels&quot;.  Each edge label could be the function that maps two vertex values to a force. ++++
\begin{code}
graph :: Ord k =&gt; [(k,v)] -&gt; [(k,k,e)] -&gt; Graph k v e

tieSymG :: (Ord k, Num u) =&gt; Graph k (u -&gt; v) (v -&gt; v -&gt; u) -&gt; [(k,v)]
\end{code}
   === For our use, the edge function would include the spring rule with stiffness and rest length.  I think we'd drop the keys in the result (via @map snd@).  Or maybe drop them in @tieSymG@ and even the @Graph@ type.  I like this separation: having the edges know about springs and the vertices know about masses and forces.
*  Packaging up for convenience, compute motion from initial positions &amp; masses: ++++
\begin{code}
springs :: Map k (V,R) -&gt; [(k,k,R)] -&gt; Map k (B V)
\end{code}
   === Keep the keys for correlating the resulting motions with additional info about the vertices.
*  Small variation: Put edges into the map.  Also, abstract out a graph type. ++++
\begin{code}
type Graph k v e = Map k (v,[(e,k)])

springs :: Graph k (V,R) R -&gt; Map k (B v)
\end{code}
   === 
* Here's an idea for eliminating the labels: ++++
\begin{code}
-- Graph: a--b--c, all with default mass, stiffness, and rest length
abc = (n a0,[]    ) &lt;@&gt; \ a -&gt;
      (n b0,es [a]) &lt;@&gt; \ b -&gt;
      (n c0,es [b]) &lt;@&gt; \ _ -&gt; empty
-- defaults
label = (,)
n   = label 1                         -- mass
e   = label (1,1)                     -- stiffness &amp; rest length
es  = map e
\end{code}
   === This representation is very close to Martin Erwig's [[inductive graph| http://web.engr.oregonstate.edu/~erwig/papers/abstracts.html#JFP01]] formulation with a bit of abbreviation for symmetric graphs and a lambda trick to avoid the labels.  I think it could be mapped onto Martin's graph type by managing a counter for automatic node number generation.
*  More complex example: ++++
\begin{code}
--   a--b--c
--      |  |
--      d--e
abcde = (n a0,[]      ) &lt;@&gt; \ a -&gt; 
        (n b0,es [a]  ) &lt;@&gt; \ b -&gt;
        (n c0,es [b]  ) &lt;@&gt; \ c -&gt;
        (n d0,es [b]  ) &lt;@&gt; \ d -&gt;
        (n e0,es [d,c]) &lt;@&gt; \ _ -&gt; empty
\end{code}
   === 
* Hm.  What about a monadic formulation?  Might look like ++++
\begin{code}
abcde :: G v e ()
abcde = do a &lt;- node' a0 []
           b &lt;- node' b0 [a]
           c &lt;- node' c0 [b]
           d &lt;- node' d0 [b]
           e &lt;- node' e0 [d,c]
           return ()

node' :: v -&gt; [Node] -&gt; G v (R,R) Node
node' v ns = node es v es where es = map e ns

node :: [(e,Node)] -&gt; v -&gt; [(e,Node)] -&gt; G v e Node
\end{code}
   === What might the @G v e@ monad be?  It has a node counter state for generating new @Node@ values and it builds up a FGL graph as it goes. ++++
\begin{code}
newtype G v e a = G (State (Node, Gr v e) a)
  deriving (Functor,Applicative,Monad)

node pre v suc = State (\ (n,g) -&gt;((n+1, (pre,n,v,suc) &amp; g),n))

runG :: G v e a -&gt; (Gr v e, a)
runG (G st) = snd (evalState st 0)
\end{code}
  === BTW, keep the @Node@ type abstract.  Probably just a @newtype@ wrapper around @Int@.
 === 
* &quot;[[VisualComplexity.com| http://VisualComplexity.com]] intends to be a unified resource space for anyone interested in the visualization of complex networks.&quot;
</pre>
</div>
<div title="2008-04-25" modifier="Conal Elliott" modified="200804260603" created="200804260149" tags="2008-04 day" changecount="5">
<pre>* Masses &amp; springs: ++++
*  Idea: use @mdo@ to specify arbitrary directed graphs specifying only successors, rather than some successors and some predecessors. ++++
\begin{code}
--   a--&gt;b--&gt;c
--       ^   |
--       |   V
--       d&lt;--e
abcde = mdo a &lt;- node' a0 []
            b &lt;- node' b0 [c]
            c &lt;- node' c0 [e]
            d &lt;- node' d0 [b]
            e &lt;- node' e0 [d]
            return ()
\end{code}
   === 
*  Then again, I could separate edges from nodes: ++++
\begin{code}
abcde = do a &lt;- node a0
           b &lt;- node b0
           c &lt;- node c0
           d &lt;- node d0
           e &lt;- node e0
           edge a b
           edge b c
           edge c e
           edge e d
           edge d b
           return ()
\end{code}
   === Make this last form primitive, and use it to define the node-with-predecessors-and-successors and node-with-successors forms.  Simple.
*  Could use a prettier operator for edges, e.g., @a --&gt; b@ or @a `to` b@.
*  Or some explicit layout in the edges, e.g., saying which way to go.  For instance, ++++
\begin{code}
abcde = do a &lt;- node a0
           b &lt;- node b0
           c &lt;- node c0
           d &lt;- node d0
           e &lt;- node e0
	   a `toE` b
	   b `toE` c
	   c `toS` e
	   e `toW` d
	   d `toN` b
           return ()
\end{code}
   === It's easy to over-specify layout in this way.  If we use angular springs, inconsistent specifications will tug at each other.
*  For edges that (visually) turn corners, use @toSW@, for instance.  Maybe insert invisible nodes.  For instance, ++++
\begin{code}
a `toSW` b = do c &lt;- invisbleNode
                a `toS` c
                c `toW` b
\end{code}
   === More generally, ++++
\begin{code}
toDirs :: [Dir] -&gt; Node -&gt; Node -&gt; G n () ()

toDir  :: Dir -&gt; Node -&gt; Node -&gt; G n () ()
toDir = toDirs . pure

toW = toDir west
-- etc
\end{code}
   === Generalize @toSW@ with a higher-order formulation: ++++
\begin{code}
type Edger :: Node -&gt; Node -&gt; G n () ()
type Binop a = a -&gt; a -&gt; a

(&amp;) :: Binop Edger
(ab &amp; bc) a c = do b &lt;- invisbleNode
		   a `ab` b
		   b `bc` c

toSW = toS &amp; toW
toWN = toW &amp; toN
toNE = toN &amp; toE
-- etc
\end{code}
   === 
*  Of course, we really want decorated edges (@e /= ()@).
*  What info goes into edges?  Visual style (solid/dashed, arrow shape), rest length &amp; direction, linear and angular stiffness (resistance to deviating from rest).  What goes into nodes?  Visual style (shape, rounded or angular corners, background &amp; foreground colors), text/content, initial position/velocity, mass (resistance to force).
*  What uses can we make of the @G@ monad's return value?  One idea is is one or more nodes that form the interface to a graph fragment.  What else?
* I like the infix style for edges (e.g., @toSW@), but I think it thwarts compositionality.  For instance, how might I specify a //dashed// SW edge?  Well, perhaps I don't really have to.  Suppose some of the rendering were to use information about the node endpoints.  For example, edges emanating from 'source' nodes are dashed.  Suppose also that the edges leaving a decision nodes are somehow ordered and then labeled (yes/no), depending on the order.  Look for some separation of logical structure from style (model vs presentation).  Imagine a renderer taking a graph //and// a specification of style rules.
  === 
*  [[DiffArray| http://haskell.org/ghc/docs/latest/html/libraries/array/Data-Array-Diff.html]] description: ++++&gt;
Diff arrays have an immutable interface, but rely on internal updates in place to provide fast functional update operator @//@.
When the @//@ operator is applied to a diff array, its contents are physically updated in place. The old array silently changes its representation without changing the visible behavior: it stores a link to the new current array along with the difference to be applied to get the old contents.
So if a diff array is used in a single-threaded style, i.e. after @//@ application the old version is no longer used, @a!i@ takes O(1) time and @a // d@ takes O(@length d@). Accessing elements of older versions gradually becomes slower.
Updating an array which is not current makes a physical copy. The resulting array is unlinked from the old family. So you can obtain a version which is guaranteed to be current and thus have fast element access by @a // []@.
   === 
</pre>
</div>
<div title="2008-04-26" modifier="Conal Elliott" created="200805061618" tags="2008-04 day" changecount="1">
<pre>* Yesterday, Holly &amp; I got a second weed-eater.  It's the best one we've had: two-handled, with a powerful engine and heavy line.  With the padded harness/vest, the weight distributes well on my skeleton, so I'm more comfortable than with the lighter weed-eater.  We weed-ate the labyrinth, surrounding area, and the walking path from the road to the labyrinth.  If we work this hard most mornings, I think we'll get a big energy boost.
</pre>
</div>
<div title="2008-04-27" modifier="Conal Elliott" created="200805061618" tags="2008-04 day" changecount="1">
<pre>* Elegant refactoring of STM-based reactivity, in terms of IVals.  Started reworking the Reactive implementation.
</pre>
</div>
<div title="2008-04-28" modifier="Conal Elliott" created="200805061619" tags="2008-04 day" changecount="1">
<pre>* Reactive: ++++
*  Rethinking the @IVal@ interface, given input from Chris Kuklewicz.  Eliminate the style of primitive I've been using for futures and ivals, which yields a sink.  For ivals, replace the old primitive with the function I've using for caching.  Renamed: ++++
\begin{code}
ival :: STM a -&gt; IVal a
\end{code}
   === 
*  Implement futures by composing of @IVal@ and semantic futures: ++++
\begin{code}
type FutureG t = IVal :. S.FutureG t
\end{code}
   === Then @Functor@ and @Applicative@ are free.  But what about @Monad@?
*  Got all of Reactive rebuilt and compiling on top of this new representation of futures.  I want a simple way to test.
*  Oops -- Ryan Ingram pointed out that our STM solutions have a serious flaw: any @retry@ will undo caching.
  === 
</pre>
</div>
<div title="2008-04-29" modifier="Conal Elliott" created="200805061619" tags="2008-04 day" changecount="1">
<pre>* Put together several modules for functional 3D geometry, with OpenGL rendering.
</pre>
</div>
<div title="2008-04-30" modifier="Conal Elliott" created="200805061620" tags="2008-04 day" changecount="1">
<pre>* Brent Yorgey has a [[New Haskell diagrams library| http://byorgey.wordpress.com/2008/04/30/new-haskell-diagrams-library]] built on Cairo.  Nice stuff.  Pretty examples!
* I'm finally installing gtk2hs (and prerequisites), so I can try Brent's library.
</pre>
</div>
<div title="2008-05-01" modifier="Conal Elliott" created="200805061620" tags="2008-05 day" changecount="1">
<pre>* Working on installing and building gtk2hs.  Lots of of difficulties.   The one I'm stuck on now is when {{{make}}} wants to call {{{hsc2hs}}} with with Cygwin-style paths.  Maybe Cygwin is no longer a viable environment for working with GHC.  So I grabbed the [[binary installer| http://haskell.org/~duncan/gtk2hs/gtk2hs-0.9.12.1.exe]], but it wants {{{ghc-6.8.2}}} while I have {{{ghc-6.8.2.20071221}}}.
* Thoughts on safe side-effects: ++++
*  One way to represent a pure value is via a mutable cell for which the only permitted assignments are with semantically equal values.  For example, consider a functional representation of improving values, with a semantic function: ++++
\begin{code}
newtype Improving a = IV [a] -- non-decreasing

meaning :: Improving a -&gt; a
meaning (IV xs) = last xs
\end{code}
  === The next step is to identify one or more transformations on the representation that preserve semantics.  In this case @meaning (IV (a:b:cs)) = meaning (IV (b:cs))@.  The transformation has a cost and benefit: it loses some laziness and speeds up future inquiries.  So, whenever we've paid the cost anyway, we'll want the reap the benefit.  Specifically for @Improving@, when an operation requires looking at the second element of the list representation, discard the first.
*  This technique is at work inside lazy data representations in general.  A pure values is represented as a cell holding a thunk.  When more information is needed, the thunk is evaluated, resulting in a shell data structure (WHNF) around some more thunks, which is then stored in the cell, overwriting the thunk.  I'm suggesting generalizing the mechanism and allowing more instances of the generalization to be implemented on top of Haskell, probably with a proof obligation of semantic equivalence.
*  For future times, where would the successive approximations come from?  I don't want to eagerly inject a stream of non-occurrences.  So I don't really want to use the list-of-approximations representation.
  === 
* Mom showed me an Arthur Young video on the toroidal universe (from [[this collection| http://www.arthuryoung.com/archive/seminarone.html]]).  Since then, I've been imagining flowy 3D animations placed on the surface of a torus and other curvy 3D shapes.
* Thinking about how to specify and render 2D and 3D geometry.  I want the specifications to be the ideal shapes, but rendering will approximate with sets of primitives (triangles and quads). ++++
*  Idea: represent a shape exactly as the union of a sometimes-infinite stream of primitives.
*  When rendering, blast out only as many triangles as we have time for.  Place the bigger primitives first, so that later triangles contribute less and less.  Perhaps track the error, so we can make intelligent decisions.
*  Given a bunch of (ideal) shapes, rendering could go round and round, taking contributions from each.
*  Hm.  The ways I can think of to add detail have exponentially diminishing contributions of exponentially increasing numbers of primitives.  For instance, approximate a half-disk first as a single inscribed right isosceles triangle.  Then as two shallower triangles, one on each leg of the original.  Then four more shallower still, etc.
*  Another approach is to represent a surface as a function from some sort of accuracy specification to a finite set of primitives.  For instance, a number of facets, or ideally some kind of error bound.
*  Whatever the specification is, I want to do something sensible in the presence of spatial transformations.  For instance, specify the error bound in screen coordinates.
*  Oh yeah.  This general idea is called &quot;dynamic tessellation&quot;.  Salim worked on it for trimmed NURBS at Sun, with Leon and Srikanth.
  === 
</pre>
</div>
<div title="2008-05-02" modifier="Conal Elliott" created="200805061620" tags="2008-05 day" changecount="1">
<pre>* Correspondence on the [[NVC Evolves group| http://groups.google.com/group/nvc-evolves]], speculating on needs behind certification.
* More functional 3D stuff.  Wrapping some of OpenGL GLU's handy tessellators.
</pre>
</div>
<div title="2008-05-03" modifier="Conal Elliott" created="200805061620" tags="2008-05 day" changecount="1">
<pre>* Fun progress on functional 3D.  Working on a tablet with rounded corners.  For fun, make the sides fully rounded, and use spheres for the four corners.  For now, I'll full spheres and cylinders on the inside, though I waste 1/2 of the cylinder surface and 3/4 of the sphere surphace.  Maybe find or build a version of cylinder and sphere that take angle ranges.
* For building my own curved surfaces, use automatic differentiation, for tangent vectors, from which I can make normals.
</pre>
</div>
<div title="2008-05-04" modifier="Conal Elliott" created="200805061620" tags="2008-05 day" changecount="1">
<pre>* Finished two versions of Andy's tablet.  Made lots of improvements in the process.
</pre>
</div>
<div title="2008-05-05" modifier="Conal Elliott" created="200805061621" tags="2008-05 day" changecount="2">
<pre>* Playing with derivatives and parametric curves (in 2D and 3D) and surfaces. ++++
*  In Vertigo, I made curves and surfaces and then extracted derivatives.  Since I was generating code, I had access to a symbolic representation of these functions.  Instead, I want to build the derivatives (infinite towers of them) into the range type. ++++
\begin{code}
type a :--&gt; b = ... -- linear maps
newtype a :~&gt; b = DFun (a -&gt; (b, a :--&gt; b))  -- function with derivative.
\end{code}
  === 
*  What's this linear map type?  It doesn't have a purely parametric representation, so I'll use a data type family. ++++
\begin{code}
-- | Provide a representation for linear maps from a to o.
class LinearMap a o where
  -- | Linear map
  data a :--&gt; o :: *
  -- Apply
  lmap :: (a :--&gt; o) -&gt; (a -&gt; o)

-- Standard instances for scalar domains
instance VectorSpace o Float =&gt; LinearMap Float o where
  data Float :--&gt; o = FloatLM o
  lmap (FloatLM o) = (*^ o)

instance VectorSpace o Double =&gt; LinearMap Double o where
  data Double :--&gt; o = DoubleLM o
  lmap (DoubleLM o) = (*^ o)

instance (VectorSpace o s, LinearMap a o, LinearMap b o)
    =&gt; LinearMap (a,b) o where
  data (a,b) :--&gt; o = PairLM (a :--&gt; o) (b :--&gt; o)
  PairLM ao bo `lmap` (a,b) = ao `lmap` a ^+^ bo `lmap` b

instance (VectorSpace o s, LinearMap a o, LinearMap b o, LinearMap c o)
    =&gt; LinearMap (a,b,c) o where
  data (a,b,c) :--&gt; o = TripleLM (a :--&gt; o) (b :--&gt; o) (c :--&gt; o)
  TripleLM ao bo co `lmap` (a,b,c) =
    ao `lmap` a ^+^ bo `lmap` b ^+^ co `lmap` c
\end{code}
  === When type synonym families are working in a released ghc, switch to them.
*  Adding three more methods allows me to define @a :--&gt; o@ as a vector space.
*  Oh -- that function-with-derivative type has only the //first// derivative.  I'd like infinitely many.  Jerzy's formulation of AD (automatic differentiation) identifies @a :--&gt; b@ with @b@, which only works for scalar @a@.  Jeff Siskind and Barak Pearlmutter published some relevant work.  See Barak's comment on [[Lennart Augustsson's blog post| http://augustss.blogspot.com/2007/04/overloading-haskell-numbers-part-2.html]].
*  I want derivatives so as to find normal vectors.  For a surface, one usually takes the cross product of two partial derivatives (and then normalizes).  If I think of the pair of partial derivative vectors (equivalently, the Jacobian matrix) more abstractly as a single linear map, then what notion does the cross product implement?  Got some help on the #math freenode IRC.  I think the key is the notion of [[dual space| http://en.wikipedia.org/wiki/Dual_space]] //V*// of a vector space, which is &quot;consist[s] of all linear functionals on //V//&quot;.  A [[linear functional| http://en.wikipedia.org/wiki/Linear_functional]], where &quot;a [[linear functional| http://en.wikipedia.org/wiki/Linear_functional]] or linear form (also called a one-form or covector) is a linear map from a vector space to its field of scalars.&quot;  Is a normal (co)vector a linear functional then?
  === 
</pre>
</div>
<div title="2008-05-06" modifier="Conal Elliott" created="200805191623" tags="2008-05 day" changecount="1">
<pre>* Derivatives: ++++
*  Here's the structure I'm trying for infinite derivative towers, using linear maps as derivative values.  Here @a :~&gt; b@ contains infinitely differential functions; @a :&gt; b@ contains an infinite chain of derivatives; and @a :--&gt; b@ is a linear map from @a@ to @b@: ++++
\begin{code}
type a :~&gt; b = a -&gt; a:&gt;b

data a :&gt;  b = D b (a :&gt; (a :--&gt; b))
\end{code}
   === 
*  I haven't been able to get my @LinearMap@ module quite as I want.  I got stuck on typing when defining an identity linear map, and covering pair domains.  I think I want an identity to generalize the (scalar) derivative value 1, just as the zero linear map generalizes the value 0.  How did I get stuck?  I'm representing linear maps via a type family indexed on the domain type.  My representation of linear maps from @(a,b)@ is a pair of linear maps, one from @a@ and one from @b@.  For instance, @R2 :--&gt; R3@ is represented by @(R :--&gt;R3, R :--&gt;R3)@.  To apply such a pair map, I apply each map and add the results.
*  How can I handle composition of linear maps?
*  Here's some pretty code.  Start with a single-derivative type.  ++++
\begin{code}
data a :&gt; b = D b (a :--&gt; b)
\end{code}
   === Write down the chain rule: ++++
\begin{code}
infix 0 &lt;=&gt;
(&gt;-&lt;) :: VectorSpace b s =&gt; (b -&gt; b) -&gt; (b -&gt; s)
      -&gt; (a :&gt; b) -&gt; (a :&gt; b)
f &gt;-&lt; d = \ (D u u') -&gt; D (f u) (d u *^ u')
\end{code}
   === Then use function-level overloading of numeric classes to make the derivative functions easy to specify. ++++
\begin{code}
instance (Num b, VectorSpace b b) =&gt; Num (a:&gt;b) where
  fromInteger = dConst . fromInteger
  D u u' + D v v' = D (u + v) (u' ^+^ v')
  D u u' * D v v' = D (u * v) (u' ^* v ^+^ u *^ v')
  negate = negate &gt;-&lt; -1

instance (Fractional b, VectorSpace b b) =&gt; Fractional (a:&gt;b) where
  fromRational = dConst . fromRational
  recip        = recip &gt;-&lt; recip (^2)

instance (Floating b, VectorSpace b b) =&gt; Floating (a:&gt;b) where
  pi    = dConst pi
  exp   = exp   &gt;-&lt; exp
  log   = log   &gt;-&lt; recip
  sqrt  = sqrt  &gt;-&lt; recip (2 * sqrt)
  sin   = sin   &gt;-&lt; cos
  cos   = cos   &gt;-&lt; - sin
  sinh  = sinh  &gt;-&lt; cosh
  cosh  = cosh  &gt;-&lt; sinh
  asin  = asin  &gt;-&lt; recip (sqrt (1-(^2)))
  acos  = acos  &gt;-&lt; recip (- sqrt (1-(^2)))
  atan  = atan  &gt;-&lt; recip (1+(^2))
  asinh = asinh &gt;-&lt; recip (sqrt (1+(^2)))
  acosh = acosh &gt;-&lt; recip (- sqrt ((^2)-1))
  atanh = atanh &gt;-&lt; recip (1-(^2))
\end{code}
   === 
*  What about derivative towers?
  === 
</pre>
</div>
<div title="2008-05-07" modifier="Conal Elliott" created="200805191624" tags="2008-05 day" changecount="1">
<pre>* Derivatives again: ++++
*  Blog post [[Beautiful differentiation| http://conal.net/blog/posts/beautiful-differentiation/]].
*  I know how to do derivative towers for scalars and first derivatives for vector spaces, but not how to do derivative towers for vector spaces.  Since a first derivative is a linear map, a second derivative is a linear map whose range type is linear maps, which is isomorphic to a //bi//-linear map.  If I had maps more generally than linear, then I could represent a linear map to linear maps as a bilinear map, thus reducing the range type.
*  Do I really need a special representation of linear (or multi-linear) maps?  Why not simply represent via a function?  I already have vector space and inner product space instances for functions.  Seems to work out fine, so far.
*  Make an @Arrow@ instance for linear maps.   (@Category@ really, since there's no @arr@.)  Note ++++
\begin{code}
first :: (a :--&gt; b) -&gt; ((a,c) :--&gt; (b,c))
\end{code}
*  The chain rule I'm using, @(&gt;-&lt;)@, now uses scalar multiplication, and so is limited to scalar functions.  To generalize, replace multiplication by //composition// of linear maps.  Currently, I have a funny asymmetry between function and argument.  The arguments are @a:&gt;b@ and the functions are @a:&gt;b -&gt; a:&gt;b@.  Regularize by using a type of infinitely differentiable functions
\begin{code}
newtype a :~&gt; b = DFun (a -&gt; a:&gt;b)
\end{code}
   === Define composition using the chain rule.  See how linear map composition falls out.  Do it first for single derivatives and then for towers.
  === 
</pre>
</div>
<div title="2008-05-08" modifier="Conal Elliott" created="200805191624" tags="2008-05 day" changecount="1">
<pre>* Puzzling over how to combine (a) derivatives as linear maps (thus handling derivatives of non-scalar functions) with (b) infinite derivative towers.  I have each by itself, but not yet the combination. ++++
*  Look at the scalar chain rule: ++++
\begin{code}
(&gt;-&lt;) :: (Num a) =&gt; (a -&gt; a) -&gt; (Dif a -&gt; Dif a) -&gt; (Dif a -&gt; Dif a)
f &gt;-&lt; d = \ p@(D u u') -&gt; D (f u) (d p * u')
\end{code}
   === What makes the tower version work is that multiplication is defined on @Dif@, not just values. 
*  Here's a version for derivatives as linear map, but only a single derivative: ++++
\begin{code}
(&gt;:&lt;) :: (u -&gt; v) -&gt; (u -&gt; u:--&gt;v) -&gt; t:&gt;u -&gt; t:&gt;v
f &gt;:&lt; d = \ (D u u') -&gt; D (f u) (d u &lt;&lt;&lt; u')
\end{code}
   === Here @(&lt;&lt;&lt;)@ here is composition on linear maps, which is *not* defined on @Dif@.  Linear map composition generalizes multiplication if we think of the multiplicands as linear maps that scale.  That is, @scaleLM (u*v) = scaleLM u &lt;&lt;&lt; scaleLM v@.
*  So I guess the missing piece is extending linear map composition to @Dif@ in the same way numeric functions are extended.
*  The derivative rule for multiplication: ++++
\begin{code}
  p@(D x x') * q@(D y y') = D (x * y) (x' * q + p * y')
\end{code}
   === Generalize to composition of linear maps (notes on paper, somewhat handwavy): ++++
\begin{code}
  p@(D u u') &lt;&lt;&lt; q@(D v v') = D (u &lt;&lt;&lt; v) ((u' &lt;&lt;&lt; q) + (p &lt;&lt;&lt; v'))
\end{code}
   === Not quite.  Types don't work out.
  === 
</pre>
</div>
<div title="2008-05-09" modifier="Conal Elliott" created="200805191625" tags="2008-05 day" changecount="1">
<pre>* [[Statically Typed Linear Algebra in Haskell| http://ofb.net/~frederik/stla/]]
* Wrote &amp; turned in ICFP reviews
* Oh!  I just realized that my parametric surfaces already work with derivative towers.  I don't have to adapt them, because I kept the types generic.  For instance, ++++
\begin{code}
torus :: (Floating s, VectorSpace s s) =&gt; (s,s) -&gt; Surf s
\end{code}
  === where @s@ is the coordinate type.
</pre>
</div>
<div title="2008-05-10" modifier="Conal Elliott" created="200805191626" tags="2008-05 day" changecount="2">
<pre>* Cute idiom for pairs of consecutive list elements: @zip &lt;*&gt; tail@.  Picked up from EvilTerran on #haskell.
* [[AlphaGrip Keyboard &amp; Trackball| http://reddit.com/goto?id=6hvoo]].
</pre>
</div>
<div title="2008-05-11" modifier="Conal Elliott" created="200805191626" tags="2008-05 day" changecount="2">
<pre>* [[Comment on a blog post| http://reddit.com/info/6iv5u/comments/]] ++++&gt;
&gt; pure object orientated languages allow you to model the world the way it is.
The world, in our experience, is temporally continuous, while (imperative) OO languages impose temporal discreteness. If you want to eliminate this functional mismatch between programming paradigm and the world, I think you'll be forced toward a math-style paradigm like functional programming (and particularly something like functional reactive programming).

If you want a programming paradigm that reflects a quantum physics reality, then I imagine you'd have to get mathier yet.
  === Also, ++++&gt;
&gt; Ron's summary is that Haskell forces you to think the way it thinks (mathematically) rather than allowing you to express things the way you think.

In addition, Haskell frees you from thinking the way imperative programming languages have already forced programmers to think. Imperative languages were designed to reflect the original computers. The result is that not only do people program machines, but in the process machines (via languages that model them) reprogram people. The most difficult part of declarative programming paradigms may be the required deprogramming.

To be more precise, I don't think it's Haskell we're talking about here, but rather (pure) functional programming. Or the pure subset of Haskell. Haskell also supports imperative programming, via IO, STM, ST, etc.
  === 
* Wow: [[Perceptive Pixels multi-touch screen demo| http://reddit.com/goto?rss=true&amp;id=t3_6iqpf]].
* I want to explain what the differentiation stuff means (see [[Beautiful differentiation| http://conal.net/blog/posts/beautiful-differentiation/]]).  What are these functions, and in what sense are we using the chain rule?  I think the idea is that a value of type @a :&gt; b@ is a structure containing, for some @f :: a -&gt; b@ and @x :: a@, the values @f x@, @f' x@, @f'' x@, ....  The funny thing is that in typical AD, one doesn't explicitly pass around these functions.  Explain why not to compose a @b::&gt;c@ with an @a -&gt; b@, namely that the result is not a derivative tower.
</pre>
</div>
<div title="2008-05-12" modifier="Conal Elliott" created="200805191627" tags="2008-05 day" changecount="1">
<pre>* What about temporal derivatives.  What to do about discrete types (and non-vector-space types)?
* Got parametric surfaces rendering.  Very broken: ++++
*  Slow
*  The sphere is a (bi-)cone
*  Half of the cone is a dull gray
*  On the other half, the curvature seems to be concave where i'd expect convex.
  === 
* I've been tinkering quite a lot with how to formulate parametric surfaces.  I just stumbled on a very simple solution.  Start with surfaces defined as follows: ++++
\begin{code}
type Two   s = (s,s)
type Three s = (s,s,s)

type HeightField s = Two s -&gt; s
type Surf        s = Two s -&gt; Three s

type Curve2 s = s -&gt; Two s
type Curve3 s = s -&gt; Three s

type Warp1 s = s -&gt; s
type Warp2 s = Two   s -&gt; Two   s
type Warp3 s = Three s -&gt; Three s
\end{code}
  === A typical definition might be  ++++
\begin{code}
sphere :: Floating s =&gt; Surf s
sphere (u,v) = (cos theta * sin phi, sin theta * sin phi, cos phi)
  where theta = 2 * pi * u
        phi   = pi * v
\end{code}
  === Though I'd really refactor @sphere@ more elegantly.  For instance, ++++
\begin{code}
-- Profile product
profile :: Num s =&gt; Curve2 s -&gt; Curve2 s -&gt; Surf s
profile curve prof (u,v) = (cx*px, cy*px, py)
 where
   (cx, cy) = curve u
   (px, py) = prof  v
\end{code}
  === Then  ++++
\begin{code}
sphere2 = profile circle semiCircle
sphere3 = profile semiCircle circle
\end{code}
  === Here's the neat thing about all these definitions: they're generic over coordinate type, as long as it's in @Floating@.  In particular, let @s = Two t :&gt; t@. ++++
\begin{code}
type USurf = forall s. Floating s =&gt; Surf s

type VSurf = forall t. (VectorSpace t t, Floating t) =&gt; (Vector2 t ::&gt; Vector3 t)

fToSurf :: USurf -&gt; VSurf
fToSurf f = vec3 . f . split2 . dId
\end{code}
  === where ++++
\begin{code}
type a ::&gt; b = a -&gt; a:&gt;b

dId    :: VectorSpace v s =&gt; v ::&gt; v
vec3   :: (a:&gt;s, a:&gt;s, a:&gt;s) -&gt; a :&gt; Vector3 s
split2 :: a :&gt; Vector2 s -&gt; (a:&gt;s, a:&gt;s)
\end{code}
  === I don't think I even have to define these universals.  Define my surfaces, and if the types are type-flexible enough, they'll work the the types I need.
* This new simple approach works!!  Awfully slow interpreted, but not too shabby when compiled -O2.  And I'm tessellating on the fly.  It'll be //much// faster if I cache tessellations.  Currently I represent shapes as a function from an error bound to a rendering action.  The OpenGL primitives data are in the action.  I'll want to replace that function with a data structure, e.g., an @IntMap@ (Patricia tree.)  I think I'll want to take the log of the bound, scale and round the result, and use the resulting integer as an index.  I can encapsulate this discretizing memoizer in a function ++++
\begin{code}
logMemo :: RealFrac s =&gt; s -&gt; (s-&gt;a) -&gt; (s-&gt;a)
\end{code}
  === 
</pre>
</div>
<div title="2008-05-13" modifier="Conal Elliott" created="200805191627" tags="2008-05 day" changecount="1">
<pre>* FieldTrip: ++++
*  Parameteric surfaces now memoize (multiple) tessellations via @logMemo@.  Works great!
*  What about textures? ++++
*   Do I want one type for conventional 2D geometry and another type for procedural imagery?  The latter is like Pan, using the same math substrate as parametric surfaces and is probably what we want for textures.
*   Solid textures: define as @R3-&gt;Color@ and compose with a surface @R2-&gt;R3@ to get a surface texture.
   === 
* Thoughts on more intelligent adaptive tessellation: ++++
*  I have the derivative machinery.  Throw in interval analysis as well, and combine the two to compute derivative bounds.  If I support second derivatives, then I could tessellate based on the degree of non-linearity, which I think is the measure that matters (since tessellation is a piecewise-linear approximation).
*  I currently tessellate with a regular grid, n-by-m.  Often not a good choice.  Consider a sphere.  Near the poles, I'd like fewer longitude divisions and more latitude divisions.  I think it'd be fairly easy to to create a triangle strip based on differing numbers of points on the two sides, instead of maching numbers as I assume now.
*  Imagine adaptive tessellation/sampling for images as well, based on derivative bounds on images as a function from space to color.  Where color changes slowly, use fewer samples.  Where rapidly, use more.  Take care with discontinuities.  I wonder if there are useful connections with FRP, which also combines discrete and continuous change (though in time instead of space).
   === 
* The repo got into a strange state, in which I couldn't push my changes.  Andy eventually got it sorted out.
* Started a blog post &quot;Beautifully generalized differentiation&quot; about derivatives as linear maps (calculus on manifolds).  (Look for another title.)
* A bunch of tweaks: ++++
*  Moved some files &amp; folders around to make the structure more regular.  Now examples, FieldTrip, and FieldTrip-GLUT are all siblings and all have src folders.
*  I got pretty lost in Glut.hs, and so did some simplifying (I hope!) changes.  I hope you like the result so far.  In the process, I switched from behaviors to reactive values, while I was getting a handle on things.  I can switch back.  For a notion of &quot;time&quot;, I made a stepper in the GlutEvents type (now called GlutEnv, since it's not just events).
*  This new version of Glut.hs is really data-driven, as in section 8 of the Simply paper.  It only triggers a rendering if the scene changes.  For time-dependent scenes, the idle event will trigger an update, as well input events.  For non-time-dependent scenes, there ought to be only negligible cpu use when the user is not interacting.  That's a main goal of this FRP implementation architecture, but we'll have to see if it's really getting there.
*  If changes come in faster than they can be handled, they'll get dropped rather than piled up.
*  Oh -- I just realized that I didn't execute the action immediately but just queue it for the next idle event.  For that reason, there will be more latency than is necessary.  I'll have to think about how to eliminate this latency while keeping (a) thread-safety and (b) the no-pile-up property.
*  Data.Integral in in FieldTrip-GLUT, but not yet tested.  It's pretty simple, though.
*  I requested a new project &quot;VectorSpace&quot; on code/community.haskell.org.  When it's working, I'll make a new repo there and place a dependency on it in simply-reactive in FieldTrip.
   === 
  === 
</pre>
</div>
<div title="2008-05-15" modifier="Conal Elliott" created="200805191627" tags="2008-05 day" changecount="1">
<pre>* Chatting with paolino about making cabal dependency analysis much simpler.  See chat record.  The general problem that interests me is how to describe time-varying *relationships* between time-varying values.  Is FRP already sufficient?  Consider that @Reactive@ is a monad and so has a @join@, which turned reactive reactive values into reactive values.  Besides make/cabal, another example (I think) of the general problem is a game (simulation) in which objects move around and react to what's in their vicinity.  For instance, the fifteen puzzle (see [[2008-04-13]], [[2008-04-14]], and [[2008-04-15]]).
* To think about today: ++++
*  Textures
*  More posts in the &quot;Beautiful differentiation&quot; blog series.
  === 
* //Beautiful differentiation// blog posts ++++
*  I have one post maybe ready to go, called &quot;What is a derivative, really?  Beautiful differentiation, part 2&quot;.  Through examples, the post leads up to the notion that derivative values are linear maps.  Before publishing, I'd like a clearer sense of where I'm going.
*  Then retrace the development of differentiation code, using linear maps.  I get stuck past first derivatives.  Explain the goal and unanswered questions.  Invite help.  My current work-around is to maintain only first derivatives.
  === 
* Oh!  I want to put the linear map module into the VectorSpace package.  (Waiting for my project to appear on code.haskell.org.)
* Textures: ++++
*  An image is defined as a function @(R,R) -&gt; Color@.
*  Appling an image to a parametric surface simply means matching up 3D position and colors, point-wise.  Given @surf :: Surface@ and @im :: Image@, the semantics of texturing (image application) is just @liftA2 (,) surf im@.
*  This simple texturing model isn't nicely composable, because the result of texturing has a different type from its arguments.  Instead, say that all surfaces have colors (and probably other surface properties) at its points.  Texturing then //combines// a given image with whatever is already there.  The most general interface I can think of is to apply a &quot;surface&quot; full of functions to a surface full of arguments.  The semantics of this kind of application is simply @(&lt;*&gt;)@ on functions.  Hm.  Not a &quot;surface&quot;, but an &quot;image&quot; in the sense of Pan, i.e., completely polymorphic in the range type.  Maybe I want enough common structure in the range type so that the result can be manipulated spatially and perhaps chromatically, while still having some type freedom.
*  What about the implementation?  Simplest would be to sample the colors and the points synchronously in parameter space, placing a color with each point.  No texture map.  Great solution for simplicity, but probably not so great for quality &amp; performance.  Typically, I think, textures get sampled more often than vertices.  Moreover, there's pixel hardware that runs (I think) in parallel with the vertex hardware, so we'd want to keep them both going.  However, give the simple thing a try first.
*  Suppose I could tessellate adaptively based on both spatial and chromatic variation, say using derivatives and interval analysis.  Then I could express even a constant color as an image, and rely on the bounds analysis to generate only a single sample.
*  Remember: the hardware does interpolation, so I really want to bound the error of the interpolation.  Requires second derivatives at least (higher for nonlinear interpolation).  I want to figure out how to get higher derivatives with linear maps.
*  Interval bounds also help a lot with view culling.  And normal cone culling.
*  I tried one color per vertex.  Looks pretty bad.
*  Tomorrow, go back to my Piq project and pull out some code for texture-mapping.  We'll have to revisit the problem of prompt finalization to recycle texture chunks.
  === 
</pre>
</div>
<div title="2008-05-16" modifier="Conal Elliott" modified="200805191628" created="200805191627" tags="2008-05 day" changecount="2">
<pre>* Andy asked last night: &quot;What does a surface //mean//?&quot;.  I answered: a function in @R2-&gt;R3@ (restricted to within the unit square domain), but I'm not happy with that answer.  The parametric representation is just that: a //representation//.  For instance, I'd like reparameterization to affect only the representation and not the semantic model.  Also, the implicitness of the unit domain precludes parameter space trimming and genus&gt;0 surfaces.  (Though one could texture with some transparent regions.)  I want the model to express //geometric// rather than //parametric// properties.  For instance, the parametric surface derivatives and their cross-product are purely parametric properties, while the normal (normalized cross product) is also a geometric property.
* FieldTrip texturing: ++++
*  Try a simple approach first.  Make a mipmap for each texture.
*  What max resolution to use?
*  Do we want to anti-alias the highest resolution version?  Perhaps so, using the error bound.
*  Progressive anti-aliasing?
*  There may be some weird and possibly useful feedback between progressive anti-aliasing and frame rate.  Static images can have cached samplings.  At first a sampling takes a while to compute, which may reduce the frame rate.  Then the frame rate could get increased and find that rendering is faster, so the frame rate stabilizes.  We probably want some hysteresis.
  === 
* I'd like to avoid conditionals, for better analysis.  I could use signum, e.g., @(1 + signum x)/2@.  Or a simpler primitive that has known derivatives.  Sticking with numeric operations instead of boolean may keep my image code more polymorphic and hence suitable for derivatives.
* Parametric code and the GPU.  Use the parametricity of my surface code to generate *symbolic* versions, which can then be turned into GPU code.  Deal with CSE as in Pajama or some other method.
* Dirac impulses and interval analysis.  Identify derivative discontinuities to focus sampling there.  If the derivative of signum (for instance) is said to be zero everywhere (e.g., as in my [[recent post| http://conal.net/blog/posts/beautiful-differentiation/]]) then derivative bound analysis will report very few samples are necessary.  Even a crude approximation to impulses would help.  Make the derivatives be extremely large at zero.
* Use an quadtree representation of general images (including surfaces), together with derivative bounds (derivatives plus interval analysis).  Second derivatives are important!!  I have to get higher derivatives in linear-map derivative towers.
* Revisiting derivatives and the product rule.  Start with just first derivatives.  Dropping the distinction between linear maps and functions: ++++
\begin{code}
D s s' * D t t' = D (s*t) (\ d -&gt; s *^ t' d ^+^ s' d *^ t)
		= D (s*t) ((s *) . t' + (* t) . s')
\end{code}
  === Note how the derivative term corresponds to the usual @r*s' + r'*s@, when derivatives are punned with a scale factor.  The derivative part of this definition says that a tiny change @d@ is transformed by @t'@ and then further magnified by @s@ //and// also is transformed by @s'@ and then further magnifies @s@.  For the @VectorSpace@ class, scalar multiplication on derivative towers has a similar definition: ++++
\begin{code}
D s s' *^ D u u' = D (s*^u) ((s *^) . u' ^+^ (*^ u) . s')
\end{code}
  === 
* Restoring the distinction between linear maps and functions: ++++
\begin{code}
D s s' *^ D u u'  = D (s*^u) ((scaleLM s &lt;&lt;&lt; u') ^+^ (scaleLM' u &lt;&lt;&lt; s'))
\end{code}
  === Note that @(scaleLM s &lt;&lt;&lt; u') == s *^ u'@, since linear maps are also vector spaces.  There isn't a similar short-hand for the second summand.
* Now what about higher derivatives?  I think I know how to handle everything except the compositions.
* Chat with Peaker and simony (from #haskell) about their project [[enough| http://code.google.com/p/enough/]].
</pre>
</div>
<div title="2008-05-17" modifier="Conal Elliott" created="200805191628" tags="2008-05 day" changecount="1">
<pre>* I wonder: If I flip my clock over to face the wall, are the hands still turning clockwise?
* I think I now understand what Taylor series have to do with the linear map perspective on derivatives (calculus on manifolds). ++++
*  Take a conventionally written Taylor series ++++
\begin{code}
f (x+d) = f x + d * D f x + 1/2 * d^2 * D (D f) x + ...
\end{code}
   === This form assumes that a derivative value (e.g., @D f x@) is a number and @d@ is a (small) number, so multiplying makes sense and the types all work out.
*  Now change our notion of differentiation: ++++
\begin{code}
D :: (a -&gt; b) -&gt; (a -&gt; (a :-* b))
\end{code}
   === where @a :-* b@ means linear map from @a@ to @b@.   The multiplications in the usual Taylor series form no longer make sense.  However, recall that multiplying by a given value is a linear transformation.  So replace @d * D f x@ with @D f x d@.  What about the second-order term with the @d^2@?  Replace @d^2 * D f x@  @D (D f) x d d@.  Then, ++++
\begin{code}
f (x+d) = f x + D f x d + 1/2! * D (D f) x d d + ...
\end{code}
   === 
*  Now note that there is no assumption that @x@ and @d@ are scalar.  Rewrite again, using @VectorSpace@ operators: ++++
\begin{code}
f (x ^+ ^d) = f x ^+^ D f x d ^+^ 1/2! *^ D (D f) x d d + ...
\end{code}
   === 
*  Is anything more needed for the &quot;multi-variate&quot; (higher-dimensional domain) case?  See the [[multi-variate Taylor series Wikipedia article| http://en.wikipedia.org/wiki/Taylor_series#Taylor_series_in_several_variables]], which looks fairly different.
  === 
* I think I also understand how to take derivatives of lifted linear map compositions. ++++
*  First look at the function setting ++++
\begin{code}
m :: d -&gt; (a :-* b)
n :: d -&gt; (b :-* c)

p :: d -&gt; (a :-* c)
p = liftA2 (.) n m
\end{code}
  === where @(.)@ is composition on linear maps.  (I'm using Arrow notation for convenience, but look for something prettier.)
*  What's the derivative of @p@?  Take the Taylor series forms of @m@ and @n@, form their linear composition.  Use the linearity of @(.)@ on each argument to expand out the composition and isolate the linear part.  The result linear transformation ++++
\begin{code}
D p x = \ d -&gt; D m x d . n x ^+^ m x . D n x d
\end{code}
  === 
*  Write the linear transformation in point-free form: ++++
\begin{code}
D p x = (. n x) . D m x ^+^ (m x .) . D n x
\end{code}
  === Subtle point: I'm using a function-lifted version of (^+^) in the second form.  
*  Hm.  Not a great improvement and certainly more obscure.  However, it does suggest a formulation that's suitable if linear transformations //are not// represented as functions: wrap up pre-composition and post-composition as ways to make linear transformations. ++++
\begin{code}
D p x = (postComp n x &lt;&lt;&lt; D m x) ^+^ (preComp m x &lt;&lt;&lt; D n x)
\end{code}
   === 
*  Now back to AD.  Instead of keeping a function and its derivative function separate, AD combines them into a single function with a structured result.  Then instead of writing function compositions, the AD operations are programmed on this result type, using overloading as much possible, so that AD expressions look just like non-AD ones.  Function arguments like @x@ above disappear.  I think we'd get something like the following: ++++
\begin{code}
D n n' &lt;&lt;&lt; D m m' = D (n &lt;&lt;&lt; m) ((postComp n &lt;&lt;&lt; D m) ^+^ (preComp m &lt;&lt;&lt; D n))
\end{code}
   === I'm using (&lt;&lt;&lt;) at three different types here!
*  If linear transformations are represented as functions, then ++++
\begin{code}
D n n' &lt;&lt;&lt; D m m' = D (n . m) ((n &lt;&lt;&lt; D m) ^+^ (m &lt;&lt;&lt; D n))
\end{code}
   === 
*  Note the similarity to the old product rule (with derivative values being represented as regular values): ++++
\begin{code}
D u u' * D v v' = D (u * v) (v *^ u' ^+^ u *^ v')
\end{code}
   === 
  === 
* Chatted on #haskell ++++
*  The @Expr@ type.  I had the idea of adding CSE.
*  chessguy's [[ChessLibrary project| http://code.haskell.org/ChessLibrary/README.txt]].  I shared a lot of how my creative process works.  I liked geezusfreeek's contributions.
*  web-iswim
*  More chat with Peaker, though I'm tiring of it.  I don't think I've inspired him with the goal that motivates me to want a non-syntactic solution to revising denotations.
  === 
* Chatted with paolino again (see transcript) and then with Saizan on #haskell, about frp solutions to compilation management (make/cabal).  My conclusion: they have very short-term goals, and I want to start from scratch, building a new semantic foundation.  Working together wouldn't help either effort.
</pre>
</div>
<div title="2008-05-18" modifier="Conal Elliott" created="200805191628" tags="2008-05 day" changecount="1">
<pre>* Realization: it's not possible to say what one means, because meanings and words are different kinds of things.
* Worked more with chessguy in #haskell (chat saved), on his algebraic type for tree zippers.  It [[got quite lovely| http://hpaste.org/7731]] in the end.  Something came up that I want to ponder on more.  chessguy wanted an @Arbitrary@ instance, and his semantic model (zipper endomorphisms) already has an Arbitrary instance, so could he use it?  No.  Because it contains semantic //junk//, not corresponding to the meaning of any traversal.  In other words, the model is not [[universal| http://www.inf.ed.ac.uk/teaching/courses/fpls/note15.pdf]].  My question: is there a simple universal model?  If so, could it have an @Arbitrary@ instance?
* Some repo shuffling: ++++
*  New repo [[vector-space| http://darcs.haskell.org/vector-space]], with vector &amp; affine spaces and generalized derivative towers.
*  Released it [[on hackage| http://hackage.haskell.org/cgi-bin/hackage-scripts/package/vector-space]].
*  Make simply-reactive depend on vector-space and move Integral there from FieldTrip-GLUT.
*  Push all three repos: vector-space (0.0), simply-reactive (0.6), f3d
  === 
* Duncan C set up the {{{vector-space}}} directory for me on http://code.haskell.org.  So I moved my repository there.
* Posted [[What is a derivative, really? Beautiful differentiation, part 2| http://conal.net/blog/posts/what-is-a-derivative-really/]] and started a [[reddit| http://reddit.com/info/6jw8w/comments/]].  Started part 3, which is about derivatives in my new library.  Part 4 will show how to use these derivatives for generating normals of parametric surfaces.
* Set up a [[ClustrMaps| http://clustrmaps.com]] account for my blog.  Pasted the code into my theme.  It updates my stats daily and shows a world map with my readers' locations.
</pre>
</div>
<div title="2008-05-19" modifier="Conal Elliott" modified="200805231412" created="200805231411" tags="2008-05 day" changecount="2">
<pre>* FieldTrip: ++++
*  I came up with a coding trick, and I'm torn about using it.  @HOpenGL@ has a @Vertex@ class.  I added instances for normals and colors, and for pairs.  Then surfaces over any nested pairing of such things can be rendered.  Moreover, one can do interpolation and differentiation generically, if the components support those operations.  However, it's not really safe, given the order-senstivity of processing of these components, and specifically that the real vertex must come last.  Perhaps provide a type of vertex-with-adornment, and give it a @VectorSpace@ instance.  I could play the tuple game on the adornments.  Even represent the vertex-with-adornment as a newtype around a pair, deriving the @VectorSpace@ instance.
  === 
* Derivatives: ++++
*  Oops!  I goofed in putting my derivative implementation back together.  I wondered why I didn't end up needing to differentiate *composition* of linear maps, explored on [[2008-05-17]].  The reason is that I fooled myself with the type of my chain rule, which used only the first derivative, which I then composed with all higher derivatives.  Luckily I caught my mistake when I tried to write down the chain rule directly.
*  For higher derivatives, I'm using curried linear functions, which correspond to multilinear uncurried functions.  What about more direct use of multilinear functions?  Hm!  Represent a derivative tower as a list of multilinear functions.  Even the constant term (//0^^th^^// derivative) is a &quot;nullinear&quot; (constant) function.  In general, the //n^^th^^// element in the tower is a multilinear map of degree //n//.  The question of composition may now become simpler.
*  There must be a close relationship between infinite AD and Taylor series manipulation.  What exactly is that relationship?  Maybe they differ only in whether the reciprocal factorial constant factors are present or implicit.  If left implicit, as in AD, how do they get manipulated correctly in operations other than sum?
*  Wow.  I think Jerzy's implementation of multiplication is exponentially inefficient as the derivative degree grows.  Note sum and product:  ++++
\begin{code}
D x0 x'     + D y0 y'     = D (x0 + y0) (x' + y')
x@(D x0 x') * y@(D y0 y') = D (x0 * y0) (x' * y + x * y')
\end{code}
   === So ++++
\begin{code}
x * y == x0*y0 `D` (x'*y + x*y')
      == xy0 `D` (x1*y0 + x0*y1) `D` (x''*y + x'*y' + x'*y' + x*y'')
      == xy0 `D` xy1 `D` (x2*y0 + x1*y1 + x1*y1 + x0*y2) `D` ...
      == ...
\end{code}
   === Already we start to see repetition: the @x'*y'@ term appears twice, leading to computing @x1*y1@ twice and doubled work in the unrolling the two @x'*y'@.  The //n^^th^^// derivative value will have //2^^n^^// product terms, though only //n+1// distinct.
*  Since multiplication is at the heart of the chain rule, //everything// inherits this efficiency problem.
*  One solution may be switching to Taylor series.  Probably augmented with a means of speeding up the required factorial tweaks for extracting derivatives.
* Here's a note on the Haskell list, which I used in my google tech talk on tangible functional programming: +++&gt;
[Haskell] Power series in a nutshell
Doug McIlroy
Thu, 12 Jul 2007 09:50:01 -0700

For lovers of things small and beautiful, http://www.cs.dartmouth.edu/~doug/powser.html boils down basic operations on power series with numeric coefficients to the bare minimum--each is a one-liner. Included are overloaded arithmetic operators, integration, differentiation, functional composition, functional inverse and coercion from scalars. --A telling demonstration of the power of lazy evaluation and of Haskell's attunement to math.

Doug McIlroy
   === 
*  Another solution may involve optimizing this one multiplication step.
*  Watch out for the chain rule, which also uses both a whole and a part
*  Consider the generalized chain rule, yet again: ++++
\begin{code}
D (f . g) x = D f (g x) . D g x
\end{code}
   === where the @(.)@ on the right composes //linear// functions.  I know how to deal with bilinear functions like @(*)@, @(*^)@, and @(&lt;.&gt;)@, so can I reduce the chain rule's RHS to a bilinear composition?  I want to see it as a @liftA2@ of a bilinear (really curried linear) function. ++++
\begin{code}
D (f . g) = liftA2 (.) (D f . g) (D g)
\end{code}
   === Recall that linear map composition is bilinear.  If I can handle the @(D f . g)@, then I'm done.  Hm.  In a sense, @(D f . g)@ is exactly what we do have, sampled at @x@.  However, the higher derivatives are all wrong, since they're all derivatives of @f@ at @g x@, not of @D f . g@ at @x@.  These derivatives map changes in @g x@, not in @x@.  On the other hand, the chain rule tells us how these two derivatives relate, given @D g x@, which we also know.
*  I got stuck with this representation: ++++
\begin{code}
data a :&gt; b = D b (a :&gt; (a :-* b))
\end{code}
   === and tried the following instead, which I'd accidentally written once before: ++++
\begin{code}
data a :&gt; b = D b (a :-* (a :&gt; b))
\end{code}
   === This data type is not nested.  Note the similarity with the type of infinitely differentiable functions: ++++
\begin{code}
type a :~&gt; b = a -&gt; (a:&gt;b)
\end{code}
   === With the restriction that the derivative is a linear map, we could say ++++
\begin{code}
data a :&gt; b = D b (a :~&gt; b)
\end{code}
   === 
  === 
* What static typing matters: a correct type includes all correct implementations and excludes some incorrect implementation.  In some cases, very few incorrect implementations have the required type.  Types therefore serve a machine-checkable partial specification, i.e., necessary condition for correctness.  //Statically// checkable types therefore go part of the way toward machine-checked correctness.  The essential point here isn't types at all, it's automated partial specification checking.
</pre>
</div>
<div title="2008-05-20" modifier="Conal Elliott" created="200805231413" tags="2008-05 day" changecount="2">
<pre>* [[Practical web programming in Haskell| http://www.haskell.org/haskellwiki/Practical_web_programming_in_Haskell]]
* Came up with a {{{cabal-make}}} work-around for the problem of cabal making documentation directories that I'm not allowed to write.  See the {{{install}}} target in {{{cabal-make.inc}}}.
* Added {{{cabal-make}}} target {{{release}}}, which bundles up the steps in the [[project release check-list]].  Easy!! ++++
\begin{code}
release: clean doc install release-record tag push test-get-build web-doc-see darcs-dist upload wiki
\end{code}
  === 
* Published my third differentiation blog post: [[Higher-dimensional, higher-order derivatives, functionally| http://conal.net/blog/posts/higher-dimensional-higher-order-derivatives-functionally/]]
</pre>
</div>
<div title="2008-05-21" modifier="Conal Elliott" created="200805231414" tags="2008-05 day" changecount="1">
<pre>* What to do next?  Possibilities: ++++
*  Shift thinking to back to authoring tools
*  Read and noodle over chessguy's Chessboard module
*  Make the derivative stuff more visible.  Hook up to an expression type.
*  Write post about surface modeling
*  FieldTrip: ++++
*   More surface tools, including @displace@, from Vertigo
*   Can we have a simple way to render an image, independent of FRP and GLUT?
*   Design texture mapping.
*   Quad-tree representation of surfaces and images to complement the parametric representation.
*   Solid textures
*   Tubes, say via frenet frames.  Try first without arc-length re-parameterization.
*   Explore uses of higher derivatives.
   === 
*  Lennart A pointed me to his [[&quot;numbers&quot; package| http://hackage.haskell.org/cgi-bin/hackage-scripts/package/numbers]], which includes symbolic expressions, derivative towers (scalar domains), a bit of interval arithmetic, constructive (exact) reals, and a few others types.  I want to use the expressions to examine my derivative stuff.  Gave it a try and ran into a problem immediately.  His representation assumes all arguments have the same type, which doesn't work for, say, scalar multiplication.
*  Started on a more flexible type of typed expressions.
  === 
* Got my reviews for &quot;Simply efficient functional reactivity&quot;.  Mixed.
</pre>
</div>
<div title="2008-05-22" modifier="Conal Elliott" modified="200805231415" created="200805231414" tags="2008-05 day" changecount="2">
<pre>* Chatting with Andy, I got an idea: hook up my simple graph specification idea ([[2008-04-25]]) to generate {{{dot}}} format.
* Got some interest on #haskell for &quot;Functional Cabal&quot; a functional successor/replacement to the current (very imperative) Cabal.  I mentioned I'm looking for research collaborators on the idea.  Got positives from thetallguy, geezusfreeek, dcoutts, edwardk.
* How does my &quot;simply&quot; paper relate to [[adaptive functional programming| http://www.cs.cmu.edu/~guyb/pubs.html]] (self-adjusting computation)? ++++
*  Simple denotational model.
*  Interface and implementation are purely functional (given the functional unamb operator).
*  Hindley-Milner typing suffices vs no modal typing.
*  More precise/efficient updating because of Applicative rather than continuation/monad implementation.  (See &quot;[[Monads for Incremental Computing| http://citeseer.ist.psu.edu/carlsson02monads.html]]&quot;.)
*  Simple static safety vs &quot;correct usage&quot; requirement.
  === 
* The AFP papers use the example of &quot;adaptive Quicksort&quot;, which updates a sorted list in log time, in response to an added element.  Try the same example in my implementation.  Experimenting in {{{~/Haskell/Quicksort.hs}}} ++++
*  For insertion, they define a list type with static heads but dynamic tails.  In a FRP formulation, I'd have a reactive cons whose head is constant and whose tail is initially empty and later a new such reactive cons.  Use a reactive if-then-else.
*  The standard non-adaptive algorithm: ++++
\begin{code}
qsort1 :: Ord a =&gt; [a] -&gt; [a]
qsort1 []     = []
qsort1 (p:xs) = qsort1 (filter (&lt; p) xs) ++ [p] ++ qsort1 (filter (&gt;= p) xs)
\end{code}
   === The AFP papers use an accumulating parameter to eliminate the appends.  In Haskell, ++++
\begin{code}
qsort2 :: Ord a =&gt; [a] -&gt; [a]
qsort2 l = q l []
 where
   q []     = id
   q (p:xs) = q (filter (&lt; p) xs) . (p :) . q (filter (&gt;= p) xs)
\end{code}
   === We'll also want a @filter@ for making adaptive: ++++
\begin{code}
filt :: (a -&gt; Bool) -&gt; [a] -&gt; [a]
filt _ []                 = []
filt f (x:xs) | f x       = x : filt f xs'
              | otherwise = filt f xs'
\end{code}
   === I could factor out the recursive call, but the AFP papers didn't, and I won't bother.  (See sample code, though.)
*  Next a non-incremental FRP version.  First, for fun, turn an element-generating event into a sorter: ++++
\begin{code}
gather1 :: Event a -&gt; Event [a]
gather1 e = [] `accumE` (fmap (:) e)
\end{code}
   === Then sort incoming elements: ++++
\begin{code}
qr1 :: Ord a =&gt; Event a -&gt; Event [a]
qr1 = fmap qsort2 . gather1
\end{code}
   === Or via reactive values: ++++
\begin{code}
gather2 :: Event a -&gt; Reactive [a]
gather2 e = [] `accumR` (fmap (:) e)

qr2 :: Ord a =&gt; Event a -&gt; Reactive [a]
qr2 = fmap qsort2 . gather2
\end{code}
   === 
*  Of course, for incrementality (adaptivity), we won't want to use @fmap@.  Instead, we'd rewrite @qsort2@ on reactive lists.  For instance, ++++
\begin{code}
ifA :: Applicative h =&gt; h Bool -&gt; h a -&gt; h a -&gt; h a
ifA = liftA3 (\ c t e -&gt; if c then t else e)

filt4 :: Applicative h =&gt; (a -&gt; Bool) -&gt; h [a] -&gt; h [a]
filt4 f l =
  ifA (null &lt;$&gt; l) (pure []) $
      let (x,xs) = unCons l in
        ifA (f &lt;$&gt; x)
            (liftA2 (:) x (filt4 f xs))
            (filt4 f xs)
\end{code}
   === Factoring out the recursive call, ++++
\begin{code}
filt4 f l =
  ifA (null &lt;$&gt; l) (pure []) $
      let (x,xs) = unCons l in
        (ifA (f &lt;$&gt; x) ((:) &lt;$&gt; x) (pure id)) &lt;*&gt; filt4 f xs
\end{code}
   === 
*  It might be important to handle propagation specially for @ifA@.
*  Now try a special representation that allows only changeable tails, as in the AFP papers. ++++
\begin{code}
data ListF' f a = Nil | Cons a (ListF f a)
type ListF  f a = f (ListF' f a)
\end{code}
   === 
*  Here's a monadic formulation: ++++
\begin{code}
filt5 :: Monad f =&gt; (a -&gt; Bool) -&gt; ListF f a -&gt; ListF f a
filt5 f lf =
  do l &lt;- lf
     case l of
       Nil       -&gt; return Nil
       Cons x xs -&gt;
         let xs' = filt5 f xs in
           if f x then return (Cons x xs') else xs'
\end{code}
   === I don't know how to do without @Monad@.  Odd, considering that the more flexibly changeable version (@filt4@) needed only @Applicative@.
*  This version is similar to, but simpler than, the AFP version: ++++
{{{
fun filter' f l =
let
  fun filt(l,d) = read(l, fn l' =&gt;
    case l' of
      NIL =&gt; write(d, NIL)
    | CONS(h,r) =&gt;
   	if f(h) then write(d,
          CONS(h, modl(function d =&gt; filt(r,d))))
	else
	  filt(r,d))
in
  modl(function d =&gt; filt(l, d))
end
}}}
   === 
*  Compare also with Magnus Carlsson's version from &quot;[[Monads for Incremental Computing| http://citeseer.ist.psu.edu/carlsson02monads.html]]&quot;: ++++
\begin{code}
filter' :: (Eq a, NewMod m) =&gt;
           (a -&gt; Bool) -&gt; Mod (List' a) -&gt; m (Mod (List' a))
filter' f l = newMod (filt l)
  where
    filt l = do
      l' &lt;- readMod l
      case l' of
        NIL -&gt; return NIL
        CONS h r -&gt;
          if f h then
            CONS h `liftM` newMod (filt r)
          else filt r
\end{code}
   === 
  === 
* Note to Krasimir Angelov's request for feedback on the his tree zipper interface. +++&gt;
I had a long exchange with chessguy about this interface, suggesting a significant change in style, simplifying the type.  (Incidentally, the change removed the State and hence mtl dependence.)

The conversation is on http://tunes.org/~nef/logs/haskell/08.05.17, starting with &quot;12:08:11 &lt;chessguy&gt; w00t!&quot; and really picking up with &quot;&lt;conal&gt; chessguy: something smells funny ...&quot;.

Here's a summary of the conversation, though I encourage you to read the whole thing:

* Every definition of type @State (TreeLoc a) a@, does a @getLabel@ at the end (except @getLabel@ itself).
* Often users of those movement functions discard the result.
* Simpler and more orthogonal would be remove the @getLabel@ and return @State (TreeLoc a) ()@ instead.
* Now remove that return value altogether, simplifying the type of zipper movements to just @TreeLoc a -&gt; TreeLoc a@.  Then they compose nicely with @(.)@, having @id@ as identity.
* Simplify the type of @getLabel@ to just @TreeLoc a -&gt; a@.  Now no more @State@.
  === 
* Responded to reviewer comments on my ICFP @08 submission.
* Found blog post //[[Bicycling for Collatz| http://swik.net/Haskell/Data.Syntaxfree/Bicycling+for+Collatz/bmt0z]]//, giving a very simple way to generate {{{.dot}}} format from Haskell values.  Nice application to graphing functions on a finite domain.  Copied code into {{{~/Haskell/Bike.hs}}} to play with.  Installed [[graphviz| http://www.graphviz.org/]] and tried out the code.  Fun &amp; simple.  
* There's also [[a module in the inductive graph library| http://www.haskell.org/ghc/docs/latest/html/libraries/fgl/Data-Graph-Inductive-Graphviz.html]] that converts a graph to graphviz format.
</pre>
</div>
<div title="2008-05-23" modifier="Conal Elliott" created="200805301421" tags="2008-05 day" changecount="1">
<pre>* Adding displacement mapping to FieldTrip. ++++
*  I want a single definition to apply to both curves and surfaces.
*  The code: ++++
\begin{code}
displaceV :: (InnerSpace v s, Floating s, HasNormal v) =&gt;
             v -&gt; s -&gt; v
displaceV v s = v ^+^ s *^ normal v

displace :: (InnerSpace v s, Floating s, HasNormal v, Applicative f) =&gt;
            f v -&gt; f s -&gt; f v
displace = liftA2 displaceV
\end{code}
   === The first version almost sufficed for functions (surfaces &amp; curves), but scalar multiplication on functions is lifted only in the second argument.  I'd had the other definition (@(*^) = liftA2 (*^)@), with functions as scalars, but it wasn't compatible with the meaning on linear maps.  (I also lost dot products in the process.)
*  I moved cross products into the {{{vector-space}}} package, using a @HasNormal@ class: ++++
\begin{code}
-- | Thing with a normal vector (not necessarily normalized).
class HasNormal v where normalVec :: v -&gt; v

-- | Normalized normal vector.  See also 'cross.
normal :: (HasNormal v, InnerSpace v s, Floating s) =&gt; v -&gt; v
normal = normalized . normalVec
\end{code}
   === Two instances:  ++++
\begin{code}
instance (Num s, VectorSpace s s) =&gt; HasNormal (s :&gt; Vector2 s) where
  normalVec v = cross2 (deriv v 1)

instance (Num s, VectorSpace s s) =&gt; HasNormal (Vector2 s :&gt; Vector3 s) where
  normalVec v = v' xVector2 `cross3` v' yVector2
   where
     v' = dDeriv v
\end{code}
   === I made similar instances for pairs and triples.  Also, variants for types like @Three (Vector2 s :&gt; s)@.
*  I'm having doubts about using the OpenGL types for vectors, instead of tuples.  I use tuples in @ParamSurf@, but tuples in @Geometry3@, and I have to convert between them.  Instead, we could just use tuples in FieldTrip, and convert to OpenGL types when rendering.  For static shapes, the conversion would happen only once, while building the rendering actions.  For dynamic shapes (more fun), perhaps ghc could remove at least some of the intermediate representations.  One advantage of the OpenGL is that they're strict.  I don't know if that strictness is helping us, compared with ghc's strictness analysis.
*  Somewhere I broke things and am getting an undefined @(==)@ test on @(a:&gt;b)@.  I don't know how to track down the source code that's calling @(==)@, because it's in a separate library (@vector-space@).  Idea: tweak my {{{.ghci}}} file to add the other source directories to the source path.  To debug, to &quot;{{{:trace main}}}&quot; in ghci.
  === 
</pre>
</div>
<div title="2008-05-25" modifier="Conal Elliott" created="200805301421" tags="2008-05 day" changecount="1">
<pre>* FieldTrip performance: ++++
*  Andy had an idea about performance of surface sampling, which is a problem now.  Consider the torus.  It's a single curve (circle) swept around an axis.  Because we're sampling on a regular grid, that circle gets sampled over &amp; over at the same sequence of inputs.  One simple solution would be to represent surfaces in //curried// form.  Then there'd be the possibility of doing some work based on the first parameter to be reused as the second parameter varies.  Perhaps the general problem is that a surface (function) contains work that depends on one parameter and some work that depends on the other, and some that depends on both.
*  Still, we're getting a huge amount of computation in the 
*  Tips on profiling, from Andy: ++++
*   In the .cabal file, add {{{ghc-prof-options: -prof -auto-all}}}
*   Then use {{{runhaskell Setup.lhs configure --enable-library-profiling}}}
   === The library gets built with and without profiling.
*   
  === 
</pre>
</div>
<div title="2008-05-26" modifier="Conal Elliott" created="200805301421" tags="2008-05 day" changecount="1">
<pre>* Formulation of distance formula: @(fmap.fmap) sqrt ((+) `on` (^2))@.  Or use @join (*)@ in place of @(^2)@.
* Noodling over why displacement is so very slow. ++++
*  Could it have to do with the representation of derivatives as (linear) functions?  See saved conversation with Andy.  He's getting 73 cross-product computations per sample point.  One would be for the normal used in shading.  what would the other be for?
*  Andy's example involves this function: ++++
\begin{code}
fun :: Surf (Vector2 R :&gt; R)
fun v = 0 ^/ magnitude r1
  where
	r1 = unvector3F (normalV (vector3F (tt v)))
\end{code}
   === 
*  When I drop @unvector3F@, my per-vertex count (of cross products) minus one drops from 72 to 24, i.e., one third. ++++
\begin{code}
unvector3F :: (Functor f) =&gt; f (Vector3 s) -&gt; Three (f s)
unvector3F d = (vector3x &lt;$&gt; d, vector3y &lt;$&gt; d, vector3z &lt;$&gt; d)
\end{code}
   === Here, @f a = Vector2 R :&gt; a@.


*  I suspect @distribD@ is a big part of the problem.  It generalizes the product rule that Jerzy used: ++++
\begin{code}
x@(D x0 x') * y@(D y0 y') = D (x0 * y0) (x' * y + x * y')
\end{code}
   === As on [[2008-05-19]], this formulation computes redundant products after the first derivative.  In //[[The Music of Streams| http://citeseer.ist.psu.edu/mcilroy00music.html]]// (section 4.1 called &quot;Complexity&quot;), Doug McIlroy says ++++&gt;
The product operators for Maclaurin and Horner forms respectively take //O(2^^n^^)// and //O(n^^2^^)// coefficient-domain operations to compute //n// terms.  Evidently it would be advantageous to compute the product of Maclaurin-form series by bypassing (Melzak 1983) to Hormer form and back.
   === The work done for the //n^^th^^// derivative of a product in the Horner form seems to be linear, in contrast to the exponential work for the Maclaurin form.
*  Instead of converting back &amp; forth with Maclaurin form,  maybe a simpler solution is to work in the Horner form throughout, i.e., a straight power series.  I'm trying that alternative now.  It only changes a few things, but it does require distinguishing differentiation from accessing part of the representation, and integration from constructing the representation.
*  Now there are two power series modules: @Maclaurin@ (was @Derivative@) and @Horner@.  Now @Derivative@ is an indirection to one or the other, for testing.  See Doug McIlroy's paper &quot;The Music of Streams&quot;.  However, I don't notice a speedup in the displacement examples.  Maybe it does have to do with my function representations and related loss of sharing.  
*  Perhaps I could give a data representation of linear maps if I tracked bases of vector spaces.  Every linear map is fully determined by its action on a basis.  The basis doesn't have to be orthogonal or normal.  Just linearly independent.  I'd also have to be able to decompose arbitrary vectors in terms of the basis.
  === 
</pre>
</div>
<div title="2008-05-27" modifier="Conal Elliott" created="200805301422" tags="2008-05 day" changecount="1">
<pre>* Andy fixed our terrible performance problem by memoizing derivatives.  The current definition: ++++
\begin{code}
data a :&gt; b = H b (a :-* (a :&gt; b))
\end{code}
  === Since linear maps are represented as //functions//, this representation is begging for trouble.  Andy's fix: ++++
\begin{code}
data a :&gt; b = D b (Memo a (a :&gt; b))
\end{code}
  === where @Memo u v@ memoizes @u -&gt; v@ in a finite map, where @a@ must be in @Ord@.  With surfaces, @a = R2@ and @b = R3@.  Andy also noticed that these memoized functions get two distinct arguments each, namely @(0,1)@ and @(1,0)@, i.e., the usual basis.  I use these vectors to extract the usual &quot;partial derivatives&quot;, though I could use //any// two linearly independent vectors.  So, the question arises: could I represent these linear maps as a pair instead of a (linear) function?  Of course, this pair representation would have to fall out as a special case of a general scheme.
* Consider representing a power series as a sequence of //multilinear// maps (see [[2008-05-19]]).  The //n^^th^^// map is //n//-linear, if @f (c *^ v) == c^n * f v@.  Lemma: The product of an //m//-linear function with an //n//-linear function is //(m+n)//-linear.  This lemma leads to the usual product rule for power series.
* Another idea: Eliminate all but functions of a scalar value, by using currying.  Then use the simpler derivative towers, as in Jerzy's paper.  (Though still fix products to have linear instead of exponential complexity in the derivative degree.)  Then a surface would have type @s -&gt; s -&gt; (s,s,s)@ instead of @(s,s) -&gt; (s,s,s)@.  This representation has the further benefit that it allows partial computation based on the first parameter.  This partial application would, I think, be especially useful for surfaces of revolution and other profile products.  I can think of the curried type as saying that a surface is an infinite family of curves.
</pre>
</div>
<div title="2008-05-28" modifier="Conal Elliott" created="200805301422" tags="2008-05 day" changecount="1">
<pre>* Correspondence on emergence-of-nvc about bottom-up certification.
* Thinking about non-function representations of linear maps.  I wonder why my earlier approach didn't work, in which I represented @(a,b) :-* c@ as @(a :-* c, b :-* c)@.  Try again.
* Cross product has two arguments in 3D but only one argument in 2D.  Think of it instead as an operation on @R2 :-* R3@ or @R :-* R2@, and then note that these two linear transformations can be represent as @(R3,R3)@ and @R2@, respectively.
* Here's a variation on Andy's use of @memo@: represent a linear map as a specially memoized function.  Because linear maps are so constrained, the map can be prepopulated to hold just values corresponding to a basis of the vector space.  To compose maps, just memoize the composition of functions.  The memoizer would rely on being given //linear// functions.
</pre>
</div>
<div title="2008-05-29" modifier="Conal Elliott" created="200805301422" tags="2008-05 day" changecount="1">
<pre>* Linear maps and derivatives: ++++
*  Yesterday I came up with a simple idea to represent linear maps efficiently, using a type family. ++++
\begin{code}
-- | Domain of a linear map.
class VectorSpace a s =&gt; LMapDom a s where
  -- | Linear map type
  data (:-*) a :: * -&gt; *
  -- | Linear map as function
  ($*) :: VectorSpace b s =&gt; (a :-* b) -&gt; (a -&gt; b)
  -- | Function (assumed linear) as linear map.
  linear :: (a -&gt; b) -&gt; (a :-* b)
\end{code}
   === I tried something similar before, but I hadn't thought of @linear@, which essentially memoizes over a basis of the domain vector space.
*  Here are some instances: ++++
\begin{code}
instance LMapDom Float Float where
  data Float :-* v  = FloatL v
  ($*) (FloatL v)   = (*^ v)
  linear f          = FloatL (f 1)

-- | Convenience function for 'linear' definitions.  Both functions are
-- assumed linear.
linearK :: (LMapDom a s) =&gt; (a -&gt; b) -&gt; (b -&gt; c) -&gt; a :-* c
linearK k f = linear (f . k)

instance (LMapDom a s, LMapDom b s) =&gt; LMapDom (a,b) s where
  data (a,b) :-* o = PairL (a :-* o) (b :-* o)
  PairL ao bo $* (a,b) = ao $* a ^+^ bo $* b
  linear = liftA2 PairL
             (linearK (\ a -&gt; (a,zeroV)))
             (linearK (\ b -&gt; (zeroV,b)))
\end{code}
   === 
*  Lots of changes needed for derivative towers.  Works out pretty well.
*  //But// there's a catch.  What @VectorSpace@ instance do I use for derivative towers?  It seems to be that I need one instance for compatibility with linear maps, and a different instance for use in parametric surfaces.  I've been fiddling with several variations, and I'm stuck so far.
*  I tried re-wrapping @(a:&gt;b)@ in another @newtype@ to allow the second @VectorSpace@ instance.  Mostly worked, but I don't seem to be able to apply my derivatives to basis vectors.  Try again tomorrow.  If this one application is the only problem, I can probably make something special that gets to the @VectorSpace@ instance of the underlying representation.
  === 
</pre>
</div>
<div title="2008-05-30" modifier="Conal Elliott" created="200807300702" tags="2008-05 day" changecount="1">
<pre>* Linear maps &amp; derivatives: ++++
*  Simple idea: represent linear maps as functions but use a smart @(:&gt;)@ constructor that wraps a special basis-memoizer.  Hm.  I'd still require the @LMapDom@ constraint.
*  I'm making great progress with the new derivative stuff.  I really struggled over that instance conflict, even after re-wrapping @(:&gt;)@ in a newtype.  Now I think it's in good shape, but I ran into another problem, which appears to be a type-family implementation bug in ghc-6.8.2, preventing me from adding a @LMapDom@ instance for @Vector2@ and @Vector3@.  Some options: ++++
*   Upgrade to ghc-6.9, and cross my fingers (since I'm on Windows).  However, I'd rather our library didn't depend on ghc-6.9.
*   Stop using the OpenGL types in our interface, as we discussed, and use tuples instead.  A down side is that I have to rip up even more of the system before getting to another stable point.
*   Temporarily add @LMapDom@ instances for the OpenGL types to the vector-space package.  Remove later.
   === Taking the third option.
*  I got everything working again.  Phew!  Trying the tests, I see a dramatic slow-down, in contrast to my intended speed-up.  Hm!  Ask Andy's help with profiling and examining the results.
  === 
</pre>
</div>
<div title="2008-06-01" modifier="Conal Elliott" created="200807300702" tags="2008-06 day" changecount="1">
<pre>* Andy found a dramatic speed-up for my linear map code, which was simply avoiding the @(&lt;*&gt;)@-like operation.  He believes we're getting a huge amount of repeated computation due to use of functions, which don't cache.  And particulary due to use of @(&lt;*&gt;)@ on functions.  And that the non-sharing is hidden by implicit dictionary passing.  I don't understand it yet.  Now the examples that were fast are fast again, but displacement examples are still considerably slower.
* I found that my @linear.lapply@ rule is not firing.  I don't know why yet.
</pre>
</div>
<div title="AudioPlayerPlugin" modifier="Conal Elliott" modified="200701010203" created="200611152225" tags="systemConfig 2006-11-15">
<pre>/***
| Name:|AudioPlayerPlugin|
| Author:|[[Conal Elliott|http://conal.net]]|
| Version:|1.0.0, 2006-11-15|
!Examples
&lt;&lt;audioPlayer http://www.cnvc.org/downlds/20020510.mp3&gt;&gt;
&lt;&lt;marshallism 20020329&gt;&gt;
{{{
&lt;&lt;audioPlayer http://www.cnvc.org/downlds/20020510.mp3&gt;&gt;
&lt;&lt;marshallism 20020329&gt;&gt;
}}}
!History
* 1.0.0 (2006-11-15): first release
!Code
***/
//{{{
version.extensions.AudioPlayerMacro = {
	major: 1,
	minor: 0,
	revision: 0,
	date: new Date(2006,11,15),
	source: &quot;...&quot;
};

config.macros.audioPlayer = {
  player: function(url) {
    return &quot;&lt;html&gt;&lt;iframe src=\&quot;http://mail.google.com/mail/html/audio.swf?audioUrl=&quot;+url+&quot;\&quot; style=\&quot;width: 250px; height: 25px; border: 1px solid #aaa;\&quot; id=musicPlayer&gt;&lt;/iframe&gt;&lt;/html&gt;&quot;;
  },
  play: function (url,place) {
    wikify(config.macros.audioPlayer.player(url),place);
  },
  handler: function (place,macroName,params,wikifier,paramString,tiddler) {
    config.macros.audioPlayer.play(params[0],place);
  }
}
config.macros.marshallism = {
  handler: function (place,macroName,params,wikifier,paramString,tiddler) {
    config.macros.audioPlayer.play(&quot;http://www.cnvc.org/downlds/&quot;+params[0]+&quot;.mp3&quot;,place);
  }
}

// Use with a slider.  Doesn't work :(.  The player doesn't materialize.
config.macros.playerSlider = {
  play: function(label,url,place) {
    wikify(&quot;+++[&quot;+label+&quot;]&quot;+config.macros.audioPlayer.player(url)+&quot;=== &quot;,place);
  },
  handler: function (place,macroName,params,wikifier,paramString,tiddler) {
    config.macros.playerSlider.play(params[0],params[0],place);
  }
}
config.macros.mbr= {
  handler: function (place,macroName,params,wikifier,paramString,tiddler) {
    config.macros.playerSlider.play(params[0],&quot;http://www.cnvc.org/downlds/&quot;+params[1]+&quot;.mp3&quot;,place);
  }
}

//}}}
</pre>
</div>
<div title="AutoTaggerPlugin" modifier="Conal Elliott" modified="200701220616" created="200610281854" tags="systemConfig editing 2006-10-28">
<pre>/***
|''Name:''|AutoTaggerPlugin|
|''Source:''|http://www.TiddlyTools.com/#AutoTaggerPlugin|
|''Author:''|Eric Shulman - ELS Design Studios|
|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|''~CoreVersion:''|2.0.10|

Automatically tag tiddlers with their original creation date and author and optionally scan the tiddler content for any tags that are embedded as text.  Makes cross-referencing your tiddlers a snap!

!!!!!Usage
&lt;&lt;&lt;
When ~AutoTagger is present, it automatically ''generates 'creation date' and 'creator' tag values'' for all newly created tiddlers, so that this information is retained even after a tiddler has been updated many times.  In addition, if you enter ''//auto//'' as a tiddler tag value, ~AutoTagger ''scans the tiddler content'' (including title) for all existing tags, and ''automatically adds any embedded tags that it finds''.

You can also specify a default tag (e.g. &quot;untagged&quot;) that will be added to the tiddler if no other tags have been specified.  This ensures that all tiddlers will have at least one tag associated with them.

After the new tags have been added to the tiddler, they are treated just as if you had entered them by hand and can be edited to make any changes you want.  Of course, as long as the &quot;auto&quot; tag is still present on a tiddler, ~AutoTagger will re-scan that tiddler's content each time it is edited.  If you DO edit the generated tags, you can remove the &quot;auto&quot; tag from the tiddler to prevent it from being re-scanned when you press 'done' to finish editing.

//Note: the special-purpose ''&quot;systemConfig&quot; tag is not added automatically, even if matched in the tiddler content'', since this tag should be added manually to ensure it is always used appropriately.//

//Note: if you have set the &quot;auto&quot; tag on a tiddler, and then add several tags to your document, those tags will ''not'' be automatically added to the tiddler until you actually edit that tiddler and press 'done' to trigger an AutoTagger scan.//
&lt;&lt;&lt;
!!!!!Configuration
&lt;&lt;&lt;
The ~AutoTagger plugin comes with a ''self-contained control panel''.  Use these controls to enable or disable automatic 'creation date' or 'creator' tagging, modify the default date formatting, or redefine the special 'scan trigger' tag value (so you can use &quot;auto&quot; as a normal tag value in your document).

&lt;&lt;option chkAutoTagAuthor&gt;&gt; add 'created by' tag //(when a tiddler is first created)//
&lt;&lt;option chkAutoTagDate&gt;&gt; add 'creation date' tag, using date format: &lt;&lt;option txtAutoTagFormat&gt;&gt;
&lt;&lt;option chkAutoTagEditor&gt;&gt; add 'edited by' tag //(when a tiddler is updated)//
&lt;&lt;option chkAutoTagTrigger&gt;&gt; scan tiddler content for matching tags when tagged with: &lt;&lt;option txtAutoTagTrigger&gt;&gt;
&lt;&lt;option chkAutoTagDefault&gt;&gt; add default tag(s) to tiddlers that are not otherwise tagged: &lt;&lt;option txtAutoTagDefault&gt;&gt;
----
//date formatting syntax://
^^//''DDD'' - day of week in full (eg, &quot;Monday&quot;), ''DD'' - day of month, ''0DD'' - adds leading zero//^^
^^//''MMM'' - month in full (eg, &quot;July&quot;), ''MM'' - month number, ''0MM'' - adds leading zero//^^
^^//''YYYY'' - full year, ''YY'' - two digit year//^^
&lt;&lt;&lt;
!!!!!Installation
&lt;&lt;&lt;
import (or copy/paste) the following tiddlers into your document:
''AutoTaggerPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)
&lt;&lt;&lt;
!!!!!Revision History
&lt;&lt;&lt;
''2007.01.20 [1.4.1]'' don't add create date tag to dated journal tiddlers (based on request from ConalElliott)
''2006.12.10 [1.4.0]'' added option to use default tag value when no tags are specified
''2006.08.29 [1.3.3]'' use newTags.contains() instead of newTags.find() to check for 'auto' tag
''2006.06.15 [1.3.2]'' hijack TiddlyWiki.prototype.saveTiddler instead of store.saveTiddler.  Permits other plugins to also hijack the function (thanks to Simon Baird for finding this!)
''2006.05.31 [1.3.1]'' Re-assemble tags into a space-separated string (use encodeTiddlyLink to add {{{[[...]]}}} as needed) before passing it on to core (or other hijacked function)
''2005.10.09 [1.3.0]'' Added 'edited by' tagging. Combined documentation and code into a single tiddler
''2005.08.16 [1.2.0]'' Added optional scanning for tags in tiddler content (based on suggestion from Jacques Turbé)
''2005.08.15 [1.1.0]'' Added 'created by' tag generation (based on suggestion from Elise Springer). Renamed from DateTag to AutoTagger
''2005.08.15 [1.0.0]'' Initial Release
&lt;&lt;&lt;
!!!!!Credits
&lt;&lt;&lt;
This feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]].
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.autoTagger = {major: 1, minor: 4, revision: 1, date: new Date(2007,1,20)};

if (config.options.chkAutoTagDate==undefined)
	config.options.chkAutoTagDate=false;
if (config.options.chkAutoTagEditor==undefined)
	config.options.chkAutoTagEditor=false;
if (config.options.chkAutoTagAuthor==undefined)
	config.options.chkAutoTagAuthor=false;
if (config.options.chkAutoTagTrigger==undefined)
	config.options.chkAutoTagTrigger=false;
if (config.options.txtAutoTagTrigger==undefined)
	config.options.txtAutoTagTrigger=&quot;auto&quot;;
if (config.options.chkAutoTagDefault==undefined)
	config.options.chkAutoTagDefault=false;
if (config.options.txtAutoTagDefault==undefined)
	config.options.txtAutoTagDefault=&quot;untagged&quot;;
if (config.options.txtAutoTagFormat==undefined)
	config.options.txtAutoTagFormat=&quot;YYYY.0MM.0DD&quot;;

// hijack saveTiddler()
TiddlyWiki.prototype.coreSaveTiddler=TiddlyWiki.prototype.saveTiddler;
TiddlyWiki.prototype.saveTiddler=function(title,newTitle,newBody,modifier,modified,tags)
{
	// get the tags as passed from the tiddler editor
	var newTags = [];
	if (tags) newTags = (typeof tags == &quot;string&quot;) ? tags.readBracketedList() : tags;

	// if saving a new tiddler, add 'creation date' tag
	var now=new Date().formatString(config.options.txtAutoTagFormat);
	if (config.options.chkAutoTagDate &amp;&amp; (store.getTiddler(title)==undefined))
		if (newTitle!=now) newTags.pushUnique(now); // don't add create date tag to dated journal tiddlers
	// if saving a new tiddler, add 'created by' tag
	if (config.options.chkAutoTagAuthor &amp;&amp; (store.getTiddler(title)==undefined))
		newTags.pushUnique(config.options.txtUserName);
	// if saving an existing tiddler, add 'edited by' tag
	if (config.options.chkAutoTagEditor &amp;&amp; (store.getTiddler(title)))
		newTags.pushUnique(config.options.txtUserName);

	// if tagged for scanning, find tags embedded in text of tiddler title/body
	var allTags = store.getTags();
	if (config.options.chkAutoTagTrigger
		&amp;&amp; config.options.txtAutoTagTrigger.length
		&amp;&amp; newTags.contains(config.options.txtAutoTagTrigger))
		for (var t=0; t&lt;allTags.length; t++)
			{
			// note: don't automatically tag a tiddler with 'systemConfig'
			if (allTags[t][0]=='systemConfig')
				continue;
			if ((newBody.indexOf(allTags[t][0])!=-1) || (newTitle.indexOf(allTags[t][0])!=-1))
				newTags.pushUnique(allTags[t][0]);
			}

	// encode tags with [[...]] (as needed)
	for (var t=0; t&lt;newTags.length; t++) newTags[t]=String.encodeTiddlyLink(newTags[t]);

	// if there are no tags on this tiddler (either user-entered or auto-tagged)
	// and AutoTagDefault is enabled then use default tag (if any)
	if (!newTags.length &amp;&amp; config.options.chkAutoTagDefault &amp;&amp; config.options.txtAutoTagDefault.length)
		newTags.push(config.options.txtAutoTagDefault);

	//  reassemble tags into a string (for other plugins that require a string) and pass it all on
	return this.coreSaveTiddler(title,newTitle,newBody,modifier,modified,newTags.join(&quot; &quot;));
}
//}}}</pre>
</div>
<div title="CalendarPlugin" modifier="Conal Elliott" modified="200610241625" created="200610230304" tags="systemConfig plugin">
<pre>/***
|''Name:''|CalendarPlugin|
|''Source:''|http://www.TiddlyTools.com/#CalendarPlugin|
|''Author:''|SteveRumsby|
|''License:''|unknown|
|''~CoreVersion:''|2.0.10|

// // updated by Jeremy Sheeley to add cacheing for reminders
// // see http://www.geocities.com/allredfaq/reminderMacros.html
// // ''Changes by ELS 2006.08.23:''
// // added handling for weeknumbers (code supplied by Martin Budden.  see &quot;wn**&quot; comment marks)
// // ''Changes by ELS 2005.10.30:''
// // config.macros.calendar.handler()
// // ^^use &quot;tbody&quot; element for IE compatibility^^
// // ^^IE returns 2005 for current year, FF returns 105... fix year adjustment accordingly^^
// // createCalendarDays()
// // ^^use showDate() function (if defined) to render autostyled date with linked popup^^
// // calendar stylesheet definition
// // ^^use .calendar class-specific selectors, add text centering and margin settings^^


!!!!!Configuration:
&lt;&lt;option chkDisplayWeekNumbers&gt;&gt; Display week numbers //(note: Monday will be used as the start of the week)//
|''First day of week:''|&lt;&lt;option txtCalFirstDay&gt;&gt;|(Monday = 0, Sunday = 6)|
|''First day of weekend:''|&lt;&lt;option txtCalStartOfWeekend&gt;&gt;|(Monday = 0, Sunday = 6)|

!!!!!Syntax:
|{{{&lt;&lt;calendar&gt;&gt;}}}|Produce a full-year calendar for the current year|
|{{{&lt;&lt;calendar year&gt;&gt;}}}|Produce a full-year calendar for the given year|
|{{{&lt;&lt;calendar year month&gt;&gt;}}}|Produce a one-month calendar for the given month and year|
|{{{&lt;&lt;calendar thismonth&gt;&gt;}}}|Produce a one-month calendar for the current month|
|{{{&lt;&lt;calendar lastmonth&gt;&gt;}}}|Produce a one-month calendar for last month|
|{{{&lt;&lt;calendar nextmonth&gt;&gt;}}}|Produce a one-month calendar for next month|

***/
// //Modify this section to change the text displayed for the month and day names, to a different language for example. You can also change the format of the tiddler names linked to from each date, and the colours used.

//{{{
config.macros.calendar = {};

config.macros.calendar.monthnames = [&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;];
config.macros.calendar.daynames = [&quot;M&quot;, &quot;T&quot;, &quot;W&quot;, &quot;T&quot;, &quot;F&quot;, &quot;S&quot;, &quot;S&quot;];

config.macros.calendar.weekendbg = &quot;#c0c0c0&quot;;
config.macros.calendar.monthbg = &quot;#e0e0e0&quot;;
config.macros.calendar.holidaybg = &quot;#ffc0c0&quot;;

//}}}
// //''Code section:''
// (you should not need to alter anything below here)//
//{{{
if(config.options.txtCalFirstDay == undefined)
  config.options.txtCalFirstDay = 0;
if(config.options.txtCalStartOfWeekend == undefined)
  config.options.txtCalStartOfWeekend = 5;
if(config.options.chkDisplayWeekNumbers == undefined)//wn**
  config.options.chkDisplayWeekNumbers = false;
if(config.options.chkDisplayWeekNumbers)
  config.options.txtCalFirstDay = 0;

config.macros.calendar.tiddlerformat = &quot;YYYY-MM-DD&quot;;  // This used to be changeable - for now, it isn't// &lt;&lt;smiley :-(&gt;&gt; 

version.extensions.calendar = { major: 0, minor: 6, revision: 0, date: new Date(2006, 1, 22)};
config.macros.calendar.monthdays = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

config.macros.calendar.holidays = [ ]; // Not sure this is required anymore - use reminders instead
//}}}

// //Is the given date a holiday?
//{{{
function calendarIsHoliday(date)
{
 var longHoliday = date.formatString(&quot;YYYY-MM-DD&quot;);
 var shortHoliday = date.formatString(&quot;YYYY-MM-DD&quot;);

 for(var i = 0; i &lt; config.macros.calendar.holidays.length; i++) {
   if(config.macros.calendar.holidays[i] == longHoliday || config.macros.calendar.holidays[i] == shortHoliday) {
     return true;
   }
 }
 return false;
}
//}}}

// //The main entry point - the macro handler.
// //Decide what sort of calendar we are creating (month or year, and which month or year)
// // Create the main calendar container and pass that to sub-ordinate functions to create the structure.
// ELS 2005.10.30: added creation and use of &quot;tbody&quot; for IE compatibility and fixup for year &gt;1900//
// ELS 2005.10.30: fix year calculation for IE's getYear() function (which returns '2005' instead of '105')//
// ELS 2006.05.29: add journalDateFmt handling//
//{{{
config.macros.calendar.handler = function(place,macroName,params)
{
   var calendar = createTiddlyElement(place, &quot;table&quot;, null, &quot;calendar&quot;, null);
   var tbody = createTiddlyElement(calendar, &quot;tbody&quot;, null, null, null);
   var today = new Date();
   var year = today.getYear();
   if (year&lt;1900) year+=1900;
 
   // get format for journal link by reading from SideBarOptions (ELS 5/29/06 - based on suggestion by Martin Budden)
   var text = store.getTiddlerText(&quot;SideBarOptions&quot;);
   this.journalDateFmt = &quot;YYYY-MM-DD&quot;;
   var re = new RegExp(&quot;&lt;&lt;(?:newJournal)([^&gt;]*)&gt;&gt;&quot;,&quot;mg&quot;); var fm = re.exec(text);
   if (fm &amp;&amp; fm[1]!=null) { var pa=fm[1].readMacroParams(); if (pa[0]) this.journalDateFmt = pa[0]; }

   if (params[0] == &quot;thismonth&quot;)
  {
      cacheReminders(new Date(year, today.getMonth(), 1, 0, 0), 31);
      createCalendarOneMonth(tbody, year, today.getMonth());
  } 
  else if (params[0] == &quot;lastmonth&quot;) {
      var month = today.getMonth()-1; if (month==-1) { month=11; year--; }
      cacheReminders(new Date(year, month, 1, 0, 0), 31);
      createCalendarOneMonth(tbody, year, month);
   }
   else if (params[0] == &quot;nextmonth&quot;) {
      var month = today.getMonth()+1; if (month&gt;11) { month=0; year++; }
      cacheReminders(new Date(year, month, 1, 0, 0), 31);
      createCalendarOneMonth(tbody, year, month);
   }
   else {
      if (params[0]) year = params[0];
      if(params[1])
      {
         cacheReminders(new Date(year, params[1]-1, 1, 0, 0), 31);
         createCalendarOneMonth(tbody, year, params[1]-1);
      }
      else
      {
         cacheReminders(new Date(year, 0, 1, 0, 0), 366);
         createCalendarYear(tbody, year);
      }
   }
  window.reminderCacheForCalendar = null;
}
//}}}
//{{{
//This global variable is used to store reminders that have been cached
//while the calendar is being rendered.  It will be renulled after the calendar is fully rendered.
window.reminderCacheForCalendar = null;
//}}}
//{{{
function cacheReminders(date, leadtime)
{
  if (window.findTiddlersWithReminders == null)
    return;
  window.reminderCacheForCalendar = {};
  var leadtimeHash = [];
  leadtimeHash [0] = 0;
  leadtimeHash [1] = leadtime;
  var t = findTiddlersWithReminders(date, leadtimeHash, null, 1);
  for(var i = 0; i &lt; t.length; i++) {
    //just tag it in the cache, so that when we're drawing days, we can bold this one.
     window.reminderCacheForCalendar[t[i][&quot;matchedDate&quot;]] = &quot;reminder:&quot; + t[i][&quot;params&quot;][&quot;title&quot;]; 
  }
}
//}}}
//{{{
function createCalendarOneMonth(calendar, year, mon)
{
  var row = createTiddlyElement(calendar, &quot;tr&quot;, null, null, null);
  createCalendarMonthHeader(calendar, row, config.macros.calendar.monthnames[mon] + &quot; &quot; + year, true, year, mon);
  row = createTiddlyElement(calendar, &quot;tr&quot;, null, null, null);
  createCalendarDayHeader(row, 1);
  createCalendarDayRowsSingle(calendar, year, mon);
}
//}}}

//{{{
function createCalendarMonth(calendar, year, mon)
{
  var row = createTiddlyElement(calendar, &quot;tr&quot;, null, null, null);
  createCalendarMonthHeader(calendar, row, config.macros.calendar.monthnames[mon] + &quot; &quot; + year, false, year, mon);
  row = createTiddlyElement(calendar, &quot;tr&quot;, null, null, null);
  createCalendarDayHeader(row, 1);
  createCalendarDayRowsSingle(calendar, year, mon);
}
//}}}

//{{{
function createCalendarYear(calendar, year)
{
  var row;
  row = createTiddlyElement(calendar, &quot;tr&quot;, null, null, null);
  var back = createTiddlyElement(row, &quot;td&quot;, null, null, null);
  var backHandler = function() {
      removeChildren(calendar);
      createCalendarYear(calendar, year-1);
    };
  createTiddlyButton(back, &quot;&lt;&quot;, &quot;Previous year&quot;, backHandler);
  back.align = &quot;center&quot;;

  var yearHeader = createTiddlyElement(row, &quot;td&quot;, null, &quot;calendarYear&quot;, year);
  yearHeader.align = &quot;center&quot;;
  //yearHeader.setAttribute(&quot;colSpan&quot;, 19);
  yearHeader.setAttribute(&quot;colSpan&quot;,config.options.chkDisplayWeekNumbers?22:19);//wn**

  var fwd = createTiddlyElement(row, &quot;td&quot;, null, null, null);
  var fwdHandler = function() {
    removeChildren(calendar);
    createCalendarYear(calendar, year+1);
  };
  createTiddlyButton(fwd, &quot;&gt;&quot;, &quot;Next year&quot;, fwdHandler);
  fwd.align = &quot;center&quot;;

  createCalendarMonthRow(calendar, year, 0);
  createCalendarMonthRow(calendar, year, 3);
  createCalendarMonthRow(calendar, year, 6);
  createCalendarMonthRow(calendar, year, 9);
}
//}}}

//{{{
function createCalendarMonthRow(cal, year, mon)
{
  var row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);
  createCalendarMonthHeader(cal, row, config.macros.calendar.monthnames[mon], false, year, mon);
  createCalendarMonthHeader(cal, row, config.macros.calendar.monthnames[mon+1], false, year, mon);
  createCalendarMonthHeader(cal, row, config.macros.calendar.monthnames[mon+2], false, year, mon);
  row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);
  createCalendarDayHeader(row, 3);
  createCalendarDayRows(cal, year, mon);
}
//}}}

//{{{
function createCalendarMonthHeader(cal, row, name, nav, year, mon)
{
  var month;
  if(nav) {
    var back = createTiddlyElement(row, &quot;td&quot;, null, null, null);
    back.align = &quot;center&quot;;
    back.style.background = config.macros.calendar.monthbg;

/*
    back.setAttribute(&quot;colSpan&quot;, 2);

    var backYearHandler = function() {
      var newyear = year-1;
      removeChildren(cal);
      cacheReminders(new Date(newyear, mon , 1, 0, 0), 31);
      createCalendarOneMonth(cal, newyear, mon);
    };
    createTiddlyButton(back, &quot;&lt;&lt;&quot;, &quot;Previous year&quot;, backYearHandler);
*/
    var backMonHandler = function() {
      var newyear = year;
      var newmon = mon-1;
      if(newmon == -1) { newmon = 11; newyear = newyear-1;}
      removeChildren(cal);
      cacheReminders(new Date(newyear, newmon , 1, 0, 0), 31);
      createCalendarOneMonth(cal, newyear, newmon);
    };
    createTiddlyButton(back, &quot;&lt;&quot;, &quot;Previous month&quot;, backMonHandler);


    month = createTiddlyElement(row, &quot;td&quot;, null, &quot;calendarMonthname&quot;, name)
//    month.setAttribute(&quot;colSpan&quot;, 3);
//    month.setAttribute(&quot;colSpan&quot;, 5);
    month.setAttribute(&quot;colSpan&quot;, config.options.chkDisplayWeekNumbers?6:5);//wn**

    var fwd = createTiddlyElement(row, &quot;td&quot;, null, null, null);
    fwd.align = &quot;center&quot;;
    fwd.style.background = config.macros.calendar.monthbg; 

//    fwd.setAttribute(&quot;colSpan&quot;, 2);
    var fwdMonHandler = function() {
      var newyear = year;
      var newmon = mon+1;
      if(newmon == 12) { newmon = 0; newyear = newyear+1;}
      removeChildren(cal);
      cacheReminders(new Date(newyear, newmon , 1, 0, 0), 31);
      createCalendarOneMonth(cal, newyear, newmon);
    };
    createTiddlyButton(fwd, &quot;&gt;&quot;, &quot;Next month&quot;, fwdMonHandler);
/*
    var fwdYear = createTiddlyElement(row, &quot;td&quot;, null, null, null);
    var fwdYearHandler = function() {
      var newyear = year+1;
      removeChildren(cal);
      cacheReminders(new Date(newyear, mon , 1, 0, 0), 31);
      createCalendarOneMonth(cal, newyear, mon);
    };
    createTiddlyButton(fwd, &quot;&gt;&gt;&quot;, &quot;Next year&quot;, fwdYearHandler);
*/
  } else {
    month = createTiddlyElement(row, &quot;td&quot;, null, &quot;calendarMonthname&quot;, name)
    //month.setAttribute(&quot;colSpan&quot;, 7);
    month.setAttribute(&quot;colSpan&quot;,config.options.chkDisplayWeekNumbers?8:7);//wn**
  }
  month.align = &quot;center&quot;;
  month.style.background = config.macros.calendar.monthbg;
}
//}}}

//{{{
function createCalendarDayHeader(row, num)
{
  var cell;
  for(var i = 0; i &lt; num; i++) {
    if (config.options.chkDisplayWeekNumbers) createTiddlyElement(row, &quot;td&quot;);//wn**
    for(var j = 0; j &lt; 7; j++) {
      var d = j + (config.options.txtCalFirstDay - 0);
      if(d &gt; 6) d = d - 7;
      cell = createTiddlyElement(row, &quot;td&quot;, null, null, config.macros.calendar.daynames[d]);
      if(d == (config.options.txtCalStartOfWeekend-0) || d == (config.options.txtCalStartOfWeekend-0+1))
        cell.style.background = config.macros.calendar.weekendbg;
    }
  }
}
//}}}

//{{{
function createCalendarDays(row, col, first, max, year, mon)
{
  var i;
  if (config.options.chkDisplayWeekNumbers){
    if (first&lt;=max) {
      var ww = new Date(year,mon,first);
      createTiddlyElement(row, &quot;td&quot;, null, null, &quot;w&quot;+ww.getWeek());//wn**
    }
    else createTiddlyElement(row, &quot;td&quot;, null, null, null);//wn**
  }
  for(i = 0; i &lt; col; i++) {
    createTiddlyElement(row, &quot;td&quot;, null, null, null);
  }
  var day = first;
  for(i = col; i &lt; 7; i++) {
    var d = i + (config.options.txtCalFirstDay - 0);
    if(d &gt; 6) d = d - 7;
    var daycell = createTiddlyElement(row, &quot;td&quot;, null, null, null);
    var isaWeekend = ((d == (config.options.txtCalStartOfWeekend-0) || d == (config.options.txtCalStartOfWeekend-0+1))? true:false);

    if(day &gt; 0 &amp;&amp; day &lt;= max) {
      var celldate = new Date(year, mon, day);
      // ELS 2005.10.30: use &lt;&lt;date&gt;&gt; macro's showDate() function to create popup
      if (window.showDate) {
        showDate(daycell,celldate,&quot;popup&quot;,&quot;DD&quot;,config.macros.calendar.journalDateFmt,true, isaWeekend); // ELS 5/29/06 - use journalDateFmt 
      } else {
        if(isaWeekend) daycell.style.background = config.macros.calendar.weekendbg;
        var title = celldate.formatString(config.macros.calendar.tiddlerformat);
        if(calendarIsHoliday(celldate)) {
          daycell.style.background = config.macros.calendar.holidaybg;
        }
        if(window.findTiddlersWithReminders == null) {
          var link = createTiddlyLink(daycell, title, false);
          link.appendChild(document.createTextNode(day));
        } else {
          var button = createTiddlyButton(daycell, day, title, onClickCalendarDate);
        }
      }
    }
    day++;
  }
}
//}}}

// //We've clicked on a day in a calendar - create a suitable pop-up of options.
// //The pop-up should contain:
// // * a link to create a new entry for that date
// // * a link to create a new reminder for that date
// // * an &lt;hr&gt;
// // * the list of reminders for that date
//{{{
function onClickCalendarDate(e)
{
  var button = this;
  var date = button.getAttribute(&quot;title&quot;);
  var dat = new Date(date.substr(6,4), date.substr(3,2)-1, date.substr(0, 2));

  date = dat.formatString(config.macros.calendar.tiddlerformat);
  var popup = createTiddlerPopup(this);
  popup.appendChild(document.createTextNode(date));
  var newReminder = function() {
    var t = store.getTiddlers(date);
    displayTiddler(null, date, 2, null, null, false, false);
    if(t) {
      document.getElementById(&quot;editorBody&quot; + date).value += &quot;\n&lt;&lt;reminder day:&quot; + dat.getDate() +
                                                                                         &quot; month:&quot; + (dat.getMonth()+1) +
                                                                                         &quot; year:&quot; + (dat.getYear()+1900) + &quot; title: &gt;&gt;&quot;;
    } else {
      document.getElementById(&quot;editorBody&quot; + date).value = &quot;&lt;&lt;reminder day:&quot; + dat.getDate() +
                                                                                       &quot; month:&quot; + (dat.getMonth()+1) +
                                                                                       &quot; year:&quot; + (dat.getYear()+1900) + &quot; title: &gt;&gt;&quot;;
    }
  };
  var link = createTiddlyButton(popup, &quot;New reminder&quot;, null, newReminder); 
  popup.appendChild(document.createElement(&quot;hr&quot;));

  var t = findTiddlersWithReminders(dat, [0,14], null, 1);
  for(var i = 0; i &lt; t.length; i++) {
    link = createTiddlyLink(popup, t[i].tiddler, false);
    link.appendChild(document.createTextNode(t[i].tiddler));
  }
}
//}}}

//{{{
function calendarMaxDays(year, mon)
{
 var max = config.macros.calendar.monthdays[mon];
 if(mon == 1 &amp;&amp; (year % 4) == 0 &amp;&amp; ((year % 100) != 0 || (year % 400) == 0)) {
 max++;
 }
 return max;
}
//}}}

//{{{
function createCalendarDayRows(cal, year, mon)
{
 var row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);

 var first1 = (new Date(year, mon, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
 if(first1 &lt; 0) first1 = first1 + 7;
 var day1 = -first1 + 1;
 var first2 = (new Date(year, mon+1, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
 if(first2 &lt; 0) first2 = first2 + 7;
 var day2 = -first2 + 1;
 var first3 = (new Date(year, mon+2, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
 if(first3 &lt; 0) first3 = first3 + 7;
 var day3 = -first3 + 1;

 var max1 = calendarMaxDays(year, mon);
 var max2 = calendarMaxDays(year, mon+1);
 var max3 = calendarMaxDays(year, mon+2);

 while(day1 &lt;= max1 || day2 &lt;= max2 || day3 &lt;= max3) {
 row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);
 createCalendarDays(row, 0, day1, max1, year, mon); day1 += 7;
 createCalendarDays(row, 0, day2, max2, year, mon+1); day2 += 7;
 createCalendarDays(row, 0, day3, max3, year, mon+2); day3 += 7;
 }
}
//}}}

//{{{
function createCalendarDayRowsSingle(cal, year, mon)
{
 var row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);

 var first1 = (new Date(year, mon, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
 if(first1 &lt; 0) first1 = first1+ 7;
 var day1 = -first1 + 1;
 var max1 = calendarMaxDays(year, mon);

 while(day1 &lt;= max1) {
 row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);
 createCalendarDays(row, 0, day1, max1, year, mon); day1 += 7;
 }
}
//}}}

// //ELS 2005.10.30: added styles
//{{{
setStylesheet(&quot;.calendar, .calendar table, .calendar th, .calendar tr, .calendar td { text-align:center; } .calendar, .calendar a { margin:0px !important; padding:0px !important; }&quot;, &quot;calendarStyles&quot;);
//}}}
</pre>
</div>
<div title="CollapseTiddlersPlusPlugin" modifier="Conal Elliott" created="200610282132" tags="systemConfig 2006-10-28">
<pre>/***
|''Name:''|Based on CollapseTiddlersPlugin|
|''Source:''|http://gensoft.revhost.net/Collapse.html|
|''Author:''|Bradley Meck|
|''License:''|unknown|
|''~CoreVersion:''|2.0.10|

|JOS 9/14/2006: changed text for 'collapse all' and 'expand all' to lower-case (consistency's sake); cleanned-up syntax (readability's sake) |
|JOS 9/14/2006: removed &quot;WebCollapsedTemplate&quot; altogether; added compat code for topOfPageMode; added tool tips for collapseAll and expandAll |
|ELS 2/24/2006: added fallback to &quot;CollapsedTemplate if &quot;WebCollapsedTemplate&quot; is not found |
|ELS 2/6/2006: added check for 'readOnly' flag to use alternative &quot;WebCollapsedTemplate&quot; |
***/
//{{{
config.commands.collapseTiddler = {
  text: &quot;fold&quot;,
  tooltip: &quot;Collapse this tiddler&quot;,
  handler: function(event,src,title){
    var e = story.findContainingTiddler(src);
    var t = &quot;CollapsedTemplate&quot;;
    if (!store.tiddlerExists(t)) { alert(&quot;Can't find 'CollapsedTemplate'&quot;); return; }
    if (config.options.chkTopOfPageMode!=undefined) {
      var pm=config.options.chkTopOfPageMode;
      config.options.chkTopOfPageMode=false;
    }
    if(e.getAttribute(&quot;template&quot;) != config.tiddlerTemplates[DEFAULT_EDIT_TEMPLATE]){
      if(e.getAttribute(&quot;template&quot;) != t ){
        e.setAttribute(&quot;oldTemplate&quot;,e.getAttribute(&quot;template&quot;));
        story.displayTiddler(null,title,t);
      }
    }
    if (config.options.chkTopOfPageMode!=undefined) config.options.chkTopOfPageMode=pm;
  }
}

config.commands.expandTiddler = {
  text: &quot;unfold&quot;,
  tooltip: &quot;Expand this tiddler&quot;,
  handler: function(event,src,title){
    if (config.options.chkTopOfPageMode!=undefined) {
      var pm=config.options.chkTopOfPageMode;
      config.options.chkTopOfPageMode=false;
    }
    var e = story.findContainingTiddler(src);
    story.displayTiddler(null,title,e.getAttribute(&quot;oldTemplate&quot;));
    if (config.options.chkTopOfPageMode!=undefined) config.options.chkTopOfPageMode=pm;
  }
}

config.macros.collapseAll = {
  handler: function(place,macroName,params,wikifier,paramString,tiddler){
    createTiddlyButton(place,&quot;collapse all&quot;,&quot;Collapse all tiddlers&quot;,function(){
                         var t = &quot;CollapsedTemplate&quot;;
                         if (!store.tiddlerExists(t)) { alert(&quot;Can't find 'CollapsedTemplate'&quot;); return; }
                         if (config.options.chkTopOfPageMode!=undefined) {
                           var pm=config.options.chkTopOfPageMode;
                           config.options.chkTopOfPageMode=false;
                         }
                         story.forEachTiddler(function(title,tiddler){
                                                if(tiddler.getAttribute(&quot;template&quot;) != config.tiddlerTemplates[DEFAULT_EDIT_TEMPLATE])
                                                  story.displayTiddler(null,title,t);
                                              })
                           if (config.options.chkTopOfPageMode!=undefined) config.options.chkTopOfPageMode=pm;
                       })
  }
}

config.macros.expandAll = {
  handler: function(place,macroName,params,wikifier,paramString,tiddler){
    createTiddlyButton(place,&quot;expand all&quot;,&quot;&quot;,function(){
                         var t = &quot;CollapsedTemplate&quot;;
                         if (!store.tiddlerExists(t)) { alert(&quot;Can't find 'CollapsedTemplate'&quot;); return; }
                         if (config.options.chkTopOfPageMode!=undefined) {
                           var pm=config.options.chkTopOfPageMode;
                           config.options.chkTopOfPageMode=false;
                         }
                         story.forEachTiddler(function(title,tiddler){
                                                if(tiddler.getAttribute(&quot;template&quot;) == t) story.displayTiddler(null,title,tiddler.getAttribute(&quot;oldTemplate&quot;));
                                              })
                           if (config.options.chkTopOfPageMode!=undefined) config.options.chkTopOfPageMode=pm;
                       })
  }
}

config.commands.collapseOthers = {
  text: &quot;focus&quot;,
  tooltip: &quot;Expand this tiddler and collapse all others&quot;,
  handler: function(event,src,title){
    var e = story.findContainingTiddler(src);
    var t = &quot;CollapsedTemplate&quot;;
    if (!store.tiddlerExists(t)) { alert(&quot;Can't find 'CollapsedTemplate'&quot;); return; }
    if (config.options.chkTopOfPageMode!=undefined) {
      var pm=config.options.chkTopOfPageMode;
      config.options.chkTopOfPageMode=false;
    }
    story.forEachTiddler(function(title,tiddler){
                           if(tiddler.getAttribute(&quot;template&quot;) != config.tiddlerTemplates[DEFAULT_EDIT_TEMPLATE]){
                             if (tiddler!=e) story.displayTiddler(null,title,t);
                           }
                         })
    if (config.options.chkTopOfPageMode!=undefined) config.options.chkTopOfPageMode=pm;
  }
}
//}}}
</pre>
</div>
<div title="CollapsedTemplate" modifier="Conal Elliott" modified="200610282149" created="200610282140" tags="systemShadow">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar closeTiddler closeOthers +expandTiddler collapseOthers editTiddler permalink'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="CommentPlugin" modifier="Conal Elliott" modified="200610302209" created="200610272115" tags="systemConfig 2006-10-27">
<pre>/***
|''Source:''|http://ziddlywiki.com/forum#CommentPlugin|
|''Credit:''|Tim Morgan|

''Adds &quot;comments&quot; to any TiddlyWiki or adaptation.'' To use, copy this tiddler's contents to a new tiddler on your site and tag it {{{systemConfig}}}.  Used in conjunction with the RecentPlugin, one can have a decent forum environment.
***/
//{{{
config.CommentPlugin = {
  only_on_tags: [],
  not_on_tags: ['about'],
  // &quot;true&quot; or &quot;false&quot;...
  fold_comments: true,
  default_fold: false
};

function in_array(item, arr){for(var i=0;i&lt;arr.length;i++)if(item==arr[i])return true};
function one_in_array(items, arr){for(var i=0;i&lt;items.length;i++)if(in_array(items[i], arr))return true;return false};
function get_parent(tiddler){while(in_array('comments', tiddler.tags)) tiddler=store.fetchTiddler(tiddler.tags[0]);return tiddler};
function count_comments(tiddler){var tagged=store.getTaggedTiddlers(tiddler.title);var count=0;for(var i=0;i&lt;tagged.length;i++)if(in_array('comments', tagged[i].tags)){count++;count+=count_comments(tagged[i])}return count};
config.shadowTiddlers.ViewTemplate += &quot;\n&lt;div class='comments' macro='comments'&gt;&lt;/div&gt;&quot;;
config.shadowTiddlers.StyleSheetLayout += '\n.commentTags ul{list-style:none; padding-left:0px;margin: 0 0 3px 0;} .commentTags li{display:inline;color:#999;} .commentTags li a.button{color:#999;} .comment{border-left:1px solid #ccc; margin-top:10px; margin-left:10px; padding:5px;} .newCommentLink{padding-top:10px} .tagging, .selected .tagging, .tiddler .tagging{display:none;} .comment a.button{padding:0px; font-size:smaller;}';
config.macros.newCommentLink = {
  label: 'New Comment Here...',
  prompt: 'Create a new comment tiddler associated with this tiddler',
  handler: function(place,macroName,params,wikifier,paramString,tiddler) {
    if(tiddler &amp;&amp; store.tiddlerExists(tiddler.title) &amp;&amp; !readOnly &amp;&amp; (!window.zw || zw.loggedIn || zw.anonEdit)) {
      if(config.CommentPlugin.only_on_tags.length&gt;0 &amp;&amp; !one_in_array(tiddler.tags, config.CommentPlugin.only_on_tags)) return;
      if(config.CommentPlugin.not_on_tags.length&gt;0 &amp;&amp; one_in_array(tiddler.tags, config.CommentPlugin.not_on_tags)) return;
      var onclick = function(e) {
        if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
        if(tiddler.title.indexOf(' Comment ')&gt;-1) var title = tiddler.title.split(' Comment ')[0];
        else var title = tiddler.title;
        var title = title + ' Comment ' + (new Date()).formatString('YYYY-0MM-0DD 0hh:0mm:0ss');
        var comment = store.createTiddler(title);
        comment.text = '';
        comment.tags = [tiddler.title, 'comments', 'excludeLists'];
        story.displayTiddler(theTarget, title, DEFAULT_EDIT_TEMPLATE);
        story.focusTiddler(title,&quot;text&quot;);
        return false;
      }
      createTiddlyButton(place, this.label, this.prompt, onclick);
    }
  }
};
config.macros.comments = {
  dateFormat: 'DD MMM YYYY hh:0mm',
  handler: function(place,macroName,params,wikifier,paramString,tiddler) {
    if(tiddler.title=='comments') return;
    var comments = store.getTaggedTiddlers(tiddler.title, 'created');
    if(comments.length&gt;0 &amp;&amp; !in_array('comments', tiddler.tags) &amp;&amp; config.CommentPlugin.fold_comments) {
      var show = createTiddlyElement(place, 'p');
      show.innerHTML = '&lt;a href=&quot;#&quot; onclick=&quot;var e=document.getElementById(\'comments'+tiddler.title+'\');e.style.display=e.style.display==\'block\'?\'none\':\'block\';return false;&quot;&gt;Comments ('+count_comments(tiddler)+') &amp;raquo;&lt;/a&gt;';
    }
    var place = createTiddlyElement(place, 'div', 'comments'+tiddler.title, 'comments');
    if(comments.length&gt;0 &amp;&amp; !in_array('comments', tiddler.tags) &amp;&amp; config.CommentPlugin.fold_comments &amp;&amp; config.CommentPlugin.default_fold)
      place.style.display = 'none';
    else
      place.style.display = 'block';
    for(var i=0; i&lt;comments.length; i++) {
      if(!in_array('comments', comments[i].tags))continue;
      var container = createTiddlyElement(place, 'div', null, 'comment');
      var title = createTiddlyElement(container, 'strong');
      var link = createTiddlyLink(title, comments[i].modifier, true);
      createTiddlyElement(title, 'span', null, null, ', '+comments[i].created.formatString(this.dateFormat));
      if(comments[i].modifier == config.options.txtUserName) {
        createTiddlyElement(title, 'span', null, null, ' (');
        var edit = createTiddlyLink(title, comments[i].title);
        edit.innerHTML = 'edit';
        createTiddlyElement(title, 'span', null, null, ')');
      }
      createTiddlyElement(container, 'br');
      config.macros.tiddler.handler(container, null, [comments[i].title]);
      createTiddlyElement(container, 'br');
      config.macros.comments.handler(container,null,null,null,null,comments[i]);
    }
    config.macros.newCommentLink.handler(place,null,null,null,null,tiddler);
  }
};
var CPCloseTiddlers = [];
TiddlyWiki.prototype.CommentPlugin_saveTiddler = TiddlyWiki.prototype.saveTiddler;
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags) {
  var t = this.CommentPlugin_saveTiddler(title,newTitle,newBody,modifier,modified,tags);
  var tags = tags.split(/\s+/g);
  if(in_array('comments', tags)) {
    var original = config.CommentPlugin.default_fold;
    config.CommentPlugin.default_fold = false;
    story.refreshTiddler(get_parent(t).title, DEFAULT_VIEW_TEMPLATE, true);
    config.CommentPlugin.default_fold = original;
    CPCloseTiddlers.push(newTitle);
    setTimeout(&quot;story.closeTiddler(CPCloseTiddlers.pop(), true)&quot;, 1000);
  }
  return t;
};
//}}}</pre>
</div>
<div title="DeepArrow" modifier="Conal Elliott" modified="200701160804" created="200701132332" tags="2007-01-13 project">
<pre>* ''Next action'': Announce DeepArrow 0.0
* To do ++++
*  Announce DeepArrow 0.0
  === 
* Done +++
*  Heard back from Ross. +++&gt;
There's no remove facility at present, though the plan was to prevent repeat uploads even if the original was removed.  That way a version would denote a unique instance.
But because we're all feeling our way at present, I've turned off the repeated upload check for now.
   ===  I re-uploaded 0.0.
*  If Ross P removes 0.0 from Hackage, re-upload it.  Otherwise, bump version in .cabal, follow [[project release check-list]], and delete the 0.0 dist on darcs.haskell.org (which will differ from Hackage's).
*  Asked Ross to remove my 0.0 package from Hackage.
*  [[project release check-list]]
*  Examples on the wiki page.  Took from the Eros paper.
*  Better: Haddock'd examples in {{{src/Examples}}}.
*  Learned about hit counting on the Haskell wiki.  No need for a statcounter.  Mediawiki does hit counting per page.  The Quiet skin had hidden the counts, but the other skins show it.  I asked Ashley Y to add the counter back to Quiet, and meanwhile I've switched.
*  Substitute mtl for monadLib for DeepArrow, Phooey, and TV.  It comes along with Hugs and GHC and so simplifies installation.
*  Documentation.  For starters, I might point to the Eros paper.
*  Wiki page
*  Link docs to [[TV]] project (wiki) page.
*  Rename {{{ArrowX}}} to {{{DeepArrow}}} in the Eros paper and put new version on the web.
*  Sync with monadLib-3.1.0
*  External library links
*  Docs with source &amp; comment pointers
*  Use [[cabal-make]]
*  Use in TV
*  Make a Cabalized library
  === 
</pre>
</div>
<div title="DefaultTiddlers" modifier="Conal Elliott" modified="200611021740" created="200610241619" tags="protected">
<pre></pre>
</div>
<div title="DisableWikiLinksList" modifier="Conal Elliott" created="200701020111" tags="DisableWikiLinksPlugin">
<pre>TiddlyWiki</pre>
</div>
<div title="DisableWikiLinksPlugin" modifier="Conal Elliott" modified="200701281552" created="200701010632" tags="systemConfig">
<pre>/***
|''Name:''|DisableWikiLinksPlugin|
|''Source:''|http://www.TiddlyTools.com/#DisableWikiLinksPlugin|
|''Author:''|Eric Shulman - ELS Design Studios|
|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|''~CoreVersion:''|2.0.10|

This plugin allows you to disable TiddlyWiki's automatic WikiWord linking behavior, so that WikiWords embedded in tiddler content will be rendered as regular text, instead of being automatically converted to tiddler links.  To create a tiddler link when automatic linking is disabled, you must enclose the link text within {{{[[...]]}}}.

You can also block automatic WikiWord linking behavior only for non-existing tiddler titles, while still automatically linking WikiWords that correspond to existing tiddlers titles or shadow tiddler titles.

You can also block specific selected WikiWords from being automatically linked by listing them in [[DisableWikiLinksList]], separated by whitespace.  This tiddler is optional and, when present, causes the listed words to always be excluded, even if automatic linking of other WikiWords is being permitted.  

Note: WikiWords contained in default ''shadow'' tiddlers will be automatically linked unless you select an additional checkbox option lets you disable these automatic links as well, though this is not recommended, since it can make it more difficult to access some TiddlyWiki standard default content (such as AdvancedOptions or SideBarTabs)

!!!!!Configuration
&lt;&lt;&lt;
Self-contained control panel:
&lt;&lt;option chkDisableNonExistingWikiLinks&gt;&gt; Disable automatic WikiWord links for non-existing tiddlers
&lt;&lt;option chkDisableWikiLinks&gt;&gt; Disable ALL automatic WikiWord tiddler links
&lt;&lt;option chkAllowLinksFromShadowTiddlers&gt;&gt; ... except for WikiWords contained in shadow tiddlers
&lt;&lt;&lt;
!!!!!Installation
&lt;&lt;&lt;
import (or copy/paste) the following tiddlers into your document:
''DisableWikiLinksPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)
&lt;&lt;&lt;
!!!!!Revision History
&lt;&lt;&lt;
''2006.12.31 [1.4.0]'' in formatter, test for chkDisableNonExistingWikiLinks
''2006.12.09 [1.3.0]'' in formatter, test for excluded wiki words specified in DisableWikiLinksList
''2006.12.09 [1.2.2]'' fix logic in autoLinkWikiWords() (was allowing links TO shadow tiddlers, even when chkDisableWikiLinks is TRUE).  
''2006.12.09 [1.2.1]'' revised logic for handling links in shadow content
''2006.12.08 [1.2.0]'' added hijack of Tiddler.prototype.autoLinkWikiWords so regular (non-bracketed) WikiWords won't be added to the missing list
''2006.05.24 [1.1.0]'' added option to NOT bypass automatic wikiword links when displaying default shadow content (default is to auto-link shadow content)
''2006.02.05 [1.0.1]'' wrapped wikifier hijack in init function to eliminate globals and avoid FireFox 1.5.0.1 crash bug when referencing globals
''2005.12.09 [1.0.0]'' initial release
&lt;&lt;&lt;
!!!!!Credits
&lt;&lt;&lt;
This feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]]
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.disableWikiLinks= {major: 1, minor: 4, revision: 0, date: new Date(2006,12,31)};

if (config.options.chkDisableNonExistingWikiLinks==undefined) config.options.chkDisableNonExistingWikiLinks= true;
if (config.options.chkDisableWikiLinks==undefined) config.options.chkDisableWikiLinks= false;
if (config.options.chkAllowLinksFromShadowTiddlers==undefined) config.options.chkAllowLinksFromShadowTiddlers=true;

// find the formatter for wikiLink and replace handler with 'pass-thru' rendering
initDisableWikiLinksFormatter();
function initDisableWikiLinksFormatter() {
	for (var i=0; i&lt;config.formatters.length &amp;&amp; config.formatters[i].name!=&quot;wikiLink&quot;; i++);
	config.formatters[i].coreHandler=config.formatters[i].handler;
	config.formatters[i].handler=function(w) {
		// supress any leading &quot;~&quot; (if present)
		var skip=(w.matchText.substr(0,1)==config.textPrimitives.unWikiLink)?1:0;
		var title=w.matchText.substr(skip);
		var exists=store.tiddlerExists(title);
		var inShadow=w.tiddler &amp;&amp; store.isShadowTiddler(w.tiddler.title);

		// check for specific excluded wiki words
		var t=store.getTiddlerText(&quot;DisableWikiLinksList&quot;)
		if (t &amp;&amp; t.length &amp;&amp; t.indexOf(w.matchText)!=-1)
			{ w.outputText(w.output,w.matchStart+skip,w.nextMatch); return; }

		// if not disabling links from shadows (default setting)
		if (config.options.chkAllowLinksFromShadowTiddlers &amp;&amp; inShadow)
			return this.coreHandler(w);

		// check for non-existing non-shadow tiddler
		if (config.options.chkDisableNonExistingWikiLinks &amp;&amp; !exists)
			{ w.outputText(w.output,w.matchStart+skip,w.nextMatch); return; }

		// if not enabled, just do standard WikiWord link formatting
		if (!config.options.chkDisableWikiLinks)
			return this.coreHandler(w);

		// just return text without linking
		w.outputText(w.output,w.matchStart+skip,w.nextMatch)
	}
}

Tiddler.prototype.coreAutoLinkWikiWords = Tiddler.prototype.autoLinkWikiWords;
Tiddler.prototype.autoLinkWikiWords = function()
{
	// DEBUG alert(&quot;processing: &quot;+this.title);
	// if all automatic links are not disabled, just return results from core function
	if (!config.options.chkDisableWikiLinks)
		return this.coreAutoLinkWikiWords.apply(this,arguments);
	return false;
}
//}}}
</pre>
</div>
<div title="EditTemplate" modifier="Conal Elliott" modified="200610290603" created="200610282052" tags="2006-10-28">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar +saveTiddler -cancelTiddler copyTiddler deleteTiddler autosizeEditor increaseEditor decreaseEditor resizeEditor'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;
&lt;div class='editorFooter'&gt;
&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;
&lt;span macro='tagChooser'&gt;&lt;/span&gt;
&lt;!-- &lt;div macro='resize'&gt;&lt;/div&gt; --&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="Emacs hacking" modifier="Conal Elliott" created="200611232059">
<pre>* For twee.el, keybound functions:
** Start a new line with the same *'s or #'s as the current logical line.  I don't know how to get to the start of the current logical line in a longlines mode.
** Add or remove a bullet or numbering nesting level for a region.
</pre>
</div>
<div title="Eros" modifier="Conal Elliott" modified="200611182238" created="200611182034" tags="2006-11-18 project">
<pre>Where to go with Eros:
* Get darcs-server working.  //Status//: Waiting to hear from Daan ([[2006-11-16]]).
* Learn about cabal, and use it.
* Rework implementation in terms of values, with no syntactic representation and no code generation.  Structure with enough flexibility so that I can slip in alternative representations, to support persistence and optimization.  See if composition speeds up significantly.
* Improve highlighting.  Doesn't always work with sliders.  Never with image output.
* How to retain input state?
* Try out some simple 3D, via ~OpenGL.  Might work fine without compilation.

More at {{{c:/conal/Eros/Haskell/todo.txt}}}
</pre>
</div>
<div title="Eros paper comments from Kragen" modifier="Conal Elliott" modified="200704012121" created="200703171732" tags="note review Eros 2007-03-17">
<pre>|from|&quot;Paul R. Potts&quot; &lt;paul@thepottshouse.org&gt;|
|to|conal@conal.net|
|date|Mar 31, 2007 3:54 PM|
|subject|comments on &quot;Tangible Functional Programming&quot;|

Hi Conal,

I'm sorry these comments are so late. I hope they are still useful to you.

General comments first:

* The presentation of the GUI and the way it operates I find fairly confusing and unclear. In particular, the dynamic behavior of the GUI is very hard to convey here. I think the problem is really that you know too much about how it works to be writing this section -- it is too easy for you to review what you've written along with the screen shots, fill in the blanks, and believe that it really makes sense. It might produce better results to sit down with someone unfamiliar with the program and allow them to discover the operation, asking you questions, and then start with notes generated from that session.
* I think the presentation on input extractors should logically come before function extractors, as it is easier to understand.

Specifics in order of appearance:

Abstract: &quot;artistic/visual creative style.&quot; Maybe change to &quot;visual learners&quot;; there is at least some research on the way people learn. More generally, I'm a little bit baffled by your references to this as a creative tool rather than a learning tool. What is the &quot;created&quot; result -- an interactive program? A drawing? In general I think this tool and approach has a lot of pedagogical value but not necessarily much value as a tool for creation. Although it does remind me in some ways of the defunct mTropolis tool, a sort of Macromedia Director with a much more rational authoring paradigm.

In para. 2 of the abstract, you mention &quot;tuples, functions, etc.&quot; Wording &quot;lists, tuples, or other functions&quot; seems preferable to me.

Introduction: para. 3: in several places you mention &quot;value inspectors&quot; without indicating that you can use them to modify the values. They seem more like property editors than inspectors, where inspector has a read-only connotation.

Sec. 2.1: para. 3: &quot;allows the user to view slices of the function dynamically.&quot; I'm not sure what you mean by &quot;slices.&quot; Some relation to &quot;sections?&quot; Para. 4: you introduce magSq before explaining what it does.  You should introduce the implementation of magSq the first time you use it. I found myself staring at 3, 4, and 25.0 with only the type signature wondering how you got 25.

The whole section 2.2 became every confusing for me. From the GUI screen shots, I still can't make any sense out of why the empty sace between the inputs containing 3 and 4 is an input -- I guess that represents the pair -- why the space between 6 and the pair is the output apparently of the whole combination, and why the space below the pair seems to be the partial/curried (Double, Double) -&gt; Bool. I'm sure using the GUI tool for just a few seconds would clear this up, but I think this representation is just not clear in general. And you never show what is in your application's menus, although you mention it in the text. A real step-by-step would probably clarify this part enormously. Intermixing the GUI and the program representation at this stage probably hampers understanding. There are too many overlapping concepts here: the dynamic behavior of the GUI, the program representations of the GUI objects, and the (actually very simple) program behavior that the representation is expressing. Consider coming at this in three completely separate consecutive passes, the GUI step by step, the program step by step, and then the &quot;wrapped&quot; code including the GUI objects as code.

Sec. 2.2 4th para, code following: I don't know what the asterisks are for here. This may be some Haskell I'm not familiar with yet.

5th para., : &quot;the visualization of in&quot; should read &quot;the visualization in&quot;

6th para., makes much more sense here.

Sec. 2.3 para 3: &quot;The Haskell expressions appearing at the top of TVs rely that alternative.&quot; Do you mean &quot;...appearing at the tops of the TVs _reify_ that alternative&quot;? or &quot;rely on&quot; ? Unclear.

Sec. 3: Again, consider rearranging this presentation to show progression of visual examples step by step. It would help a great deal to make sure that figures 12 and 13 appear on the same page; the page break here is particularly bad. Also, it isn't possible from the figures to understand the &quot;vanishing&quot; inputs and outputs unless you show before/after, step by step. I think this is really not very good GUI design; &quot;wires&quot; to indicate connection would be better, and a clear method is needed to undo the connection.

Figure 14: I'm not sure why your conjunction operator has two outs; one of them a section (&amp;&amp; y)? It seems like the placement and meaning of the input/output bars is generally confusing.

Last para. sec. 4: are tweaked links represented visually in some way? How do you select something to tweak/untweak, and how do you know you've tweaked it?

Sec. 4 para. 3: the use of &quot;upper&quot; and &quot;lower&quot; referring to figure 11 -- which is not on this page, a layout problem -- is very confusing. You use &quot;TV&quot; to refer to a whole window in the GUI, but here you are referring to a part of a window's contents. There are 3 windows; what are you talking about when you refer to &quot;lower left&quot; and &quot;lower right?&quot; I have no clue.  Also, how do you hold &quot;xPos&quot; (I think you mean you select the box). This needs some consistent language here.

Sec. 4.1 footnote 5: I'm not really clear on what you mean here. Are you talking about operations on an AST (what would be s-expressions in a Lispy language) v. compiled code, because an expression like 3+4 would be collapsed to a single value? Can you even do that in Haskell? If you can't, you seem to be undermining your own project in favor of a language with macro transformers as opposed to graph-rewriting? What is the advantage? Strong typing? That's why I'm not clear what you mean!

In general I should say that the &quot;mathematical&quot; part (sec. 4) is clearer, although due to my general knowledge of Haskell and FP I can't follow your argument very well much beyond sec. 4.4. A few misc. comments:

Why at the top of p. 7 are you suddenly using named parameters (&quot;h&quot;) as opposed to point-free style?

Last code section in 4.3, why test2 instead of just test?

By 5.1 I'm pretty well lost, but that's not your fault.

In footnote 7 I think you might want to refer to &quot;legal Haskell 98 [reference] syntax,&quot; instead of &quot;standard Haskell.&quot;

The layout of the text across pages in sec. 5.3 is unfortunate and hard to follow, particularly where you pick up on p. 9. I'm confused by the elipses (...). Maybe the text could continue after figure 18? Confusing that some of your code is inline, and some in &quot;figures.&quot;

Sec. 6 para. 4, text &quot;With every input node, associate a function extractor...&quot; change these usages to make them parallel, like &quot;there is an associated function extractor&quot; or &quot;we associate&quot;

p. 11 bottom left, another use of asterisks; maybe some Haskell syntax I'm unfamiliar with...

p. 11 to right, intentional to show incomplete code here with ellipses?

Sec. 8 para. 1: &quot;Our use of a term reresentation&quot; -- change to &quot;Our display of&quot;

para. 2: &quot;the size and complexity of a TV is dependent only it type,&quot; change to &quot;only on its type&quot; (I think that's what you mean, at least).  Later para. 2: &quot;value and an accompanying visualization&quot; should read either &quot;a value and an accompanying representation&quot; or just &quot;value and accompanying rep...&quot; (make the usage parallel, either both use a/an or both don't).

I think your point about the composition step producing a more complex representation is interesting here, having used a lot of Visual programming environments like HyperCard, Visual BASIC, the origina Cocoa, Macromedia Director, Toolbook, etc.

The last para. in section 8, about referring to function distinct from value, has gotten lost a bit and is unclear in your visual examples. It doesn't help the way you refer to &quot;value-based&quot; and &quot;semantic&quot; as your approach, as distinct from &quot;syntactic.&quot;

Sec. 8.2, para. 2, &quot;Eros remedy&quot; should read &quot;Eros remedies&quot; and &quot;definability&quot; should probably read &quot;definition.&quot; In the text that follows when you are talking about systems as presented in books or papers, your tense is inconsistent; I'd make everything present tense (&quot;relaxes&quot;, &quot;explores&quot;). End of para 3, &quot;shows&quot; instead of &quot;does show,&quot; you need a comma after &quot;intermediate values,&quot; and the last sentence here says &quot;uses a lacks&quot; which I think should just read &quot;lacks.&quot;

Last sentence before references section ends with two periods.

That's all... hope this is helpful!

Paul

--
Paul R. Potts - paul@thepottshouse.org - http://thepottshouse.org
</pre>
</div>
<div title="Eros paper comments from Paul Potts" modifier="Conal Elliott" created="200704012121" tags="note review Eros 2007-04-01">
<pre>|from|&quot;Paul R. Potts&quot; &lt;paul@thepottshouse.org&gt;|
|to|conal@conal.net|
|date|Mar 31, 2007 3:54 PM|
|subject|comments on &quot;Tangible Functional Programming&quot;|

Hi Conal,

I'm sorry these comments are so late. I hope they are still useful to you.

General comments first:

- The presentation of the GUI and the way it operates I find fairly confusing and unclear. In particular, the dynamic behavior of the GUI is very hard to convey here. I think the problem is really that you know too much about how it works to be writing this section -- it is too easy for you to review what you've written along with the screen shots, fill in the blanks, and believe that it really makes sense. It might produce better results to sit down with someone unfamiliar with the program and allow them to discover the operation, asking you questions, and then start with notes generated from that session.

- I think the presentation on input extractors should logically come before function extractors, as it is easier to understand.

Specifics in order of appearance:

Abstract: &quot;artistic/visual creative style.&quot; Maybe change to &quot;visual learners&quot;; there is at least some research on the way people learn. More generally, I'm a little bit baffled by your references to this as a creative tool rather than a learning tool. What is the &quot;created&quot; result -- an interactive program? A drawing? In general I think this tool and approach has a lot of pedagogical value but not necessarily much value as a tool for creation. Although it does remind me in some ways of the defunct mTropolis tool, a sort of Macromedia Director with a much more rational authoring paradigm.

In para. 2 of the abstract, you mention &quot;tuples, functions, etc.&quot; Wording &quot;lists, tuples, or other functions&quot; seems preferable to me.

Introduction: para. 3: in several places you mention &quot;value inspectors&quot; without indicating that you can use them to modify the values. They seem more like property editors than inspectors, where inspector has a read-only connotation.

Sec. 2.1: para. 3: &quot;allows the user to view slices of the function dynamically.&quot; I'm not sure what you mean by &quot;slices.&quot; Some relation to &quot;sections?&quot; Para. 4: you introduce magSq before explaining what it does.  You should introduce the implementation of magSq the first time you use it. I found myself staring at 3, 4, and 25.0 with only the type signature wondering how you got 25.

The whole section 2.2 became every confusing for me. From the GUI screen shots, I still can't make any sense out of why the empty sace between the inputs containing 3 and 4 is an input -- I guess that represents the pair -- why the space between 6 and the pair is the output apparently of the whole combination, and why the space below the pair seems to be the partial/curried (Double, Double) -&gt; Bool. I'm sure using the GUI tool for just a few seconds would clear this up, but I think this representation is just not clear in general. And you never show what is in your application's menus, although you mention it in the text. A real step-by-step would probably clarify this part enormously. Intermixing the GUI and the program representation at this stage probably hampers understanding. There are too many overlapping concepts here: the dynamic behavior of the GUI, the program representations of the GUI objects, and the (actually very simple) program behavior that the representation is expressing. Consider coming at this in three completely separate consecutive passes, the GUI step by step, the program step by step, and then the &quot;wrapped&quot; code including the GUI objects as code.

Sec. 2.2 4th para, code following: I don't know what the asterisks are for here. This may be some Haskell I'm not familiar with yet.

5th para., : &quot;the visualization of in&quot; should read &quot;the visualization in&quot;

6th para., makes much more sense here.

Sec. 2.3 para 3: &quot;The Haskell expressions appearing at the top of TVs rely that alternative.&quot; Do you mean &quot;...appearing at the tops of the TVs _reify_ that alternative&quot;? or &quot;rely on&quot; ? Unclear.

Sec. 3: Again, consider rearranging this presentation to show progression of visual examples step by step. It would help a great deal to make sure that figures 12 and 13 appear on the same page; the page break here is particularly bad. Also, it isn't possible from the figures to understand the &quot;vanishing&quot; inputs and outputs unless you show before/after, step by step. I think this is really not very good GUI design; &quot;wires&quot; to indicate connection would be better, and a clear method is needed to undo the connection.

Figure 14: I'm not sure why your conjunction operator has two outs; one of them a section (&amp;&amp; y)? It seems like the placement and meaning of the input/output bars is generally confusing.

Last para. sec. 4: are tweaked links represented visually in some way? How do you select something to tweak/untweak, and how do you know you've tweaked it?

Sec. 4 para. 3: the use of &quot;upper&quot; and &quot;lower&quot; referring to figure 11 -- which is not on this page, a layout problem -- is very confusing. You use &quot;TV&quot; to refer to a whole window in the GUI, but here you are referring to a part of a window's contents. There are 3 windows; what are you talking about when you refer to &quot;lower left&quot; and &quot;lower right?&quot; I have no clue.  Also, how do you hold &quot;xPos&quot; (I think you mean you select the box). This needs some consistent language here.

Sec. 4.1 footnote 5: I'm not really clear on what you mean here. Are you talking about operations on an AST (what would be s-expressions in a Lispy language) v. compiled code, because an expression like 3+4 would be collapsed to a single value? Can you even do that in Haskell? If you can't, you seem to be undermining your own project in favor of a language with macro transformers as opposed to graph-rewriting? What is the advantage? Strong typing? That's why I'm not clear what you mean!

In general I should say that the &quot;mathematical&quot; part (sec. 4) is clearer, although due to my general knowledge of Haskell and FP I can't follow your argument very well much beyond sec. 4.4. A few misc. comments:

Why at the top of p. 7 are you suddenly using named parameters (&quot;h&quot;) as opposed to point-free style?

Last code section in 4.3, why test2 instead of just test?

By 5.1 I'm pretty well lost, but that's not your fault.

In footnote 7 I think you might want to refer to &quot;legal Haskell 98 [reference] syntax,&quot; instead of &quot;standard Haskell.&quot;

The layout of the text across pages in sec. 5.3 is unfortunate and hard to follow, particularly where you pick up on p. 9. I'm confused by the elipses (...). Maybe the text could continue after figure 18? Confusing that some of your code is inline, and some in &quot;figures.&quot;

Sec. 6 para. 4, text &quot;With every input node, associate a function extractor...&quot; change these usages to make them parallel, like &quot;there is an associated function extractor&quot; or &quot;we associate&quot;

p. 11 bottom left, another use of asterisks; maybe some Haskell syntax I'm unfamiliar with...

p. 11 to right, intentional to show incomplete code here with ellipses?

Sec. 8 para. 1: &quot;Our use of a term reresentation&quot; -- change to &quot;Our display of&quot;

para. 2: &quot;the size and complexity of a TV is dependent only it type,&quot; change to &quot;only on its type&quot; (I think that's what you mean, at least).  Later para. 2: &quot;value and an accompanying visualization&quot; should read either &quot;a value and an accompanying representation&quot; or just &quot;value and accompanying rep...&quot; (make the usage parallel, either both use a/an or both don't).

I think your point about the composition step producing a more complex representation is interesting here, having used a lot of Visual programming environments like HyperCard, Visual BASIC, the origina Cocoa, Macromedia Director, Toolbook, etc.

The last para. in section 8, about referring to function distinct from value, has gotten lost a bit and is unclear in your visual examples. It doesn't help the way you refer to &quot;value-based&quot; and &quot;semantic&quot; as your approach, as distinct from &quot;syntactic.&quot;

Sec. 8.2, para. 2, &quot;Eros remedy&quot; should read &quot;Eros remedies&quot; and &quot;definability&quot; should probably read &quot;definition.&quot; In the text that follows when you are talking about systems as presented in books or papers, your tense is inconsistent; I'd make everything present tense (&quot;relaxes&quot;, &quot;explores&quot;). End of para 3, &quot;shows&quot; instead of &quot;does show,&quot; you need a comma after &quot;intermediate values,&quot; and the last sentence here says &quot;uses a lacks&quot; which I think should just read &quot;lacks.&quot;

Last sentence before references section ends with two periods.

That's all... hope this is helpful!

Paul

--
Paul R. Potts - paul@thepottshouse.org - http://thepottshouse.org
</pre>
</div>
<div title="ExpandSlidersScript" modifier="Conal Elliott" created="200702100323" tags="script 2007-02-09">
<pre>/%
|Name|ExpandSlidersScript|
|Source|http://www.TiddlyTools.com/#ExpandSlidersScript|
|Version|0.0.0|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;&lt;br&gt;&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|script|
|Requires||
|Overrides||
|Description||
%//% usage:
	&lt;&lt;tiddler ExpandSlidersScript with: elementID expandlabel collapselabel&gt;&gt;

%/&lt;script label=&quot;expand&quot;&gt;
	// if 'in a tiddler', expand all sliders... otherwise, expand based on passed in element ID
	var here=story.findContainingTiddler(place);
	if (!here) {
		if (&quot;$1&quot;==&quot;$&quot;+&quot;1&quot;) { alert(&quot;ExpandSlidersScript: not in a tiddler, please use 'with: elementID' syntax&quot;); return; }
		var here=document.getElementById(&quot;$1&quot;);
		if (!here) { alert(&quot;ExpandSlidersScript: unknown elementID: '$1'&quot;); return; }
	}
	var expandlabel=&quot;expand&quot;; if (&quot;$2&quot;!=&quot;$&quot;+&quot;2&quot;) var expandlabel=&quot;$2&quot;;
	var collapselabel=&quot;collapse&quot;; if (&quot;$3&quot;!=&quot;$&quot;+&quot;3&quot;) var collapselabel=&quot;$3&quot;;
	var elems=here.getElementsByTagName(&quot;*&quot;);
	var state=(place.innerHTML.toLowerCase().indexOf(&quot;expand&quot;)!=-1)?&quot;none&quot;:&quot;block&quot;;
	for (var e=0; e&lt;elems.length; e++) {
		var p=elems[e].sliderPanel;
		if (p &amp;&amp; p.className==&quot;sliderPanel&quot;) {
			if (p.style.display==state) window.onClickNestedSlider({target:elems[e]});
		}
	}
	place.innerHTML=state==&quot;none&quot;?collapselabel:expandlabel;
	return false;
&lt;/script&gt;&lt;script&gt;
	place.lastChild.className=&quot;button&quot;;
	var expandlabel=&quot;expand&quot;; if (&quot;$2&quot;!=&quot;$&quot;+&quot;2&quot;) var expandlabel=&quot;$2&quot;;
	var collapselabel=&quot;collapse&quot;; if (&quot;$3&quot;!=&quot;$&quot;+&quot;3&quot;) var collapselabel=&quot;$3&quot;;
	if (place.lastChild.innerHTML.toLowerCase().indexOf(&quot;expand&quot;)==-1)
		place.lastChild.innerHTML=collapselabel;
	else
		place.lastChild.innerHTML=expandlabel;
&lt;/script&gt;</pre>
</div>
<div title="FileDropPlugin" modifier="Conal Elliott" modified="200611192319" created="200611192219" tags="2006-11-19 systemConfig_not">
<pre>/***
|FileDropPlugin|h
|author : ~BradleyMeck|
|source : http://bradleymeck.tiddlyspot.com/#FileDropPlugin |
|version : 0.1.1|
|date : Nov 13 2006|
|usage : drag a file onto the TW to have it be made into a tiddler|
|browser(s) supported : Mozilla|

!Trouble Shooting
*If the plugin does not seem to work, open up the page &quot;about:config&quot; (just type it in the address bar) and make sure @@color(blue):signed.applets.codebase_principal_support@@ is set to @@color(blue):true@@
*Also, the plugin apparently depends on TW 2.1.

!Revisions
*Multiple File Dropping API updated, to end all capturing events after yours return a value that makes if(myFunctionsReturnValue) evaluate to true
*Added support for multiple file drop handlers
**Use the config.macros.fileDrop.addEventListener(@@color(green):String Flavor@@, @@color(green):Function handler(nsiFile){}@@, @@color(green):Boolean addToFront@@) function
***Standard Flavor is &quot;application/x-moz-file&quot;
***addToFront gives your handler priority over all others at time of add
*Old plugin would disallow drops of text vetween applications because it didn't check if the transfer was a file.

!Example Handler
*Adds simple file import control, add this to a tiddler tagged {{{systemConfig}}} to make file dropping work
{{{
config.macros.fileDrop.addEventListener(&quot;application/x-moz-file&quot;,function(nsiFile)
{
 if(
    confirm(&quot;You have dropped the file \&quot;&quot;+nsiFile.path+&quot;\&quot; onto the page, it will be imported as a tiddler. Is that ok?&quot;)
    )
 {
 var newDate = new Date();
 var title = prompt(&quot;what would you like to name the tiddler?&quot;);
 store.saveTiddler(title,title,loadFile(nsiFile.path),config.options.txtUserName,newDate,[]);
 }
 return true;
})
}}}

!Example Handler without popups and opening the tiddler on load
*Adds simple file import control, add this to a tiddler tagged {{{systemConfig}}} to make file dropping work
{{{
config.macros.fileDrop.addEventListener(&quot;application/x-moz-file&quot;,function(nsiFile)
{
 var newDate = new Date();
 store.saveTiddler(nsiFile.path,nsiFile.path,loadFile(nsiFile.path),config.options.txtUserName,newDate,[]);
 story.displayTiddler(null,nsiFile.path)
 return true;
})
}}}

***/

//{{{
config.macros.fileDrop = {varsion : {major : 0, minor : 0, revision: 1}};
config.macros.fileDrop.customDropHandlers = [];

config.macros.fileDrop.dragDropHandler = function(evt) {

 netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
 // Load in the native DragService manager from the browser.
 var dragService = Components.classes[&quot;@mozilla.org/widget/dragservice;1&quot;].getService(Components.interfaces.nsIDragService);

 // Load in the currently-executing Drag/drop session.
 var dragSession = dragService.getCurrentSession();

 // Create an instance of an nsITransferable object using reflection.
 var transferObject = Components.classes[&quot;@mozilla.org/widget/transferable;1&quot;].createInstance();

 // Bind the object explicitly to the nsITransferable interface. We need to do this to ensure that
 // methods and properties are present and work as expected later on.
 transferObject = transferObject.QueryInterface(Components.interfaces.nsITransferable);

 // I've chosen to add only the x-moz-file MIME type. Any type can be added, and the data for that format
 // will be retrieved from the Drag/drop service.
 transferObject.addDataFlavor(&quot;application/x-moz-file&quot;);

 // Get the number of items currently being dropped in this drag/drop operation.
 var numItems = dragSession.numDropItems;
 for (var i = 0; i &lt; numItems; i++)
 {
 // Get the data for the given drag item from the drag session into our prepared
 // Transfer object.
 dragSession.getData(transferObject, i);

 // We need to pass in Javascript 'Object's to any XPConnect method which
 // requires OUT parameters. The out value will then be saved as a new
 // property called Object.value.
 var dataObj = {};
 var dropSizeObj = {};

for(var ind = 0; ind &lt; config.macros.fileDrop.customDropHandlers.length; ind++)
{
  var item = config.macros.fileDrop.customDropHandlers[ind];
  if(dragSession.isDataFlavorSupported(item.flavor))
  {
    transferObject.getTransferData(item.flavor, dataObj, dropSizeObj);
    var droppedFile = dataObj.value.QueryInterface(Components.interfaces.nsIFile);
    // Display all of the returned parameters with an Alert dialog.
    var result = item.handler.call(item,droppedFile);
 // Since the event is handled, prevent it from going to a higher-level event handler.
	 evt.stopPropagation();
	 evt.preventDefault();
    if(result){break;}
  }
}
 }
}

if(!window.event)
{
 // Register the event handler, and set the 'capture' flag to true so we get this event
 // before it bubbles up through the browser.
 window.addEventListener(&quot;dragdrop&quot;, config.macros.fileDrop.dragDropHandler , true);
}

config.macros.fileDrop.addEventListener = function(paramflavor,func,inFront)
{
var obj = {};
obj.flavor = paramflavor;
obj.handler = func;
if(!inFront)
{config.macros.fileDrop.customDropHandlers.push(obj);}
else{config.macros.fileDrop.customDropHandlers.shift(obj);}
}
//}}}</pre>
</div>
<div title="FileDropPlugin Config" modifier="Conal Elliott" modified="200611192319" created="200611192222" tags="2006-11-19 systemConfig_not">
<pre>//{{{
config.macros.fileDrop.addEventListener(&quot;application/x-moz-file&quot;,function(nsiFile)
{
 var newDate = new Date();
 store.saveTiddler(null,nsiFile.path,loadFile(nsiFile.path),config.options.txtUserName,newDate,[]);
 story.displayTiddler(null,nsiFile.path)
})
//}}}</pre>
</div>
<div title="From StyleSheetShortcuts" modifier="Conal Elliott" modified="200709042011" created="200709042008" changecount="4">
<pre></pre>
</div>
<div title="Gamble everything for love, ..." modifier="Conal Elliott" created="200701130532" tags="Rumi love [[quotation TiddlyWiki]]">
<pre>Gamble everything for love,
if you're a true human being.
If not, leave this gathering.
   - Rumi
</pre>
</div>
<div title="Guest Book" modifier="Conal Elliott" modified="200610262114" created="200610262112">
<pre>&lt;html&gt;&lt;iframe src=&quot;http://www.haloscan.com/comments/conal/Try1/&quot; width=100% height=360&gt;&lt;/iframe&gt;&lt;/html&gt;</pre>
</div>
<div title="HaloscanMacro" modifier="Conal Elliott" modified="200610310514" created="200610240550" tags="systemConfig 2006-10-30">
<pre>/***
|Name|HaloscanMacro|
|Created by|JimSpeth|
|Location|http://end.com/~speth/HaloscanMacro.html|
|Version|1.1.0|
|Requires|~TW2.x|

!Description
Comment and trackback support for TiddlyWiki (via Haloscan).

!History
* 16-Feb-06, version 1.1.0, drastic changes, now uses settings from haloscan account config
* 31-Jan-06, version 1.0.1, fixed display of counts for default tiddlers
* 30-Jan-06, version 1.0, initial release

!Examples
|!Source|!Output|h
|{{{&lt;&lt;haloscan comments&gt;&gt;}}}|&lt;&lt;haloscan comments&gt;&gt;|
|{{{&lt;&lt;haloscan trackbacks&gt;&gt;}}}|&lt;&lt;haloscan trackbacks&gt;&gt;|

!Installation
Register for a [[Haloscan|http://www.haloscan.com]] account.  It's free and painless.
Install the HaloscanMacro in a new tiddler with a tag of systemConfig (save and reload to activate).
In the macro configuration code (below), change //YourName// to your Haloscan account name.
Use the macro somewhere in a tiddler (see ViewTemplate for an example).

!Settings
You can adjust various options for your account in the member configuration area of Haloscan's web site.  The macro will use these settings when formatting the links.

!Code
***/
//{{{

/* Set account to your Haloscan account name and idPrefix to a prefix unique to TiddlyWiki for this account. */
config.macros.haloscan = {account: &quot;conal&quot;, idPrefix: &quot;Conal's Journal&quot;, baseURL: &quot;http://www.haloscan.com/load/&quot;};

var haloscanLoaded = 0;
config.macros.haloscan.load = function ()
{
    if (haloscanLoaded == 1)
        return;
    
    account = config.macros.haloscan.account;
    if (!account || (account == &quot;YourName&quot;))
        account = store.getTiddlerText(&quot;SiteTitle&quot;);
    
    var el = document.createElement('script');
    el.language = 'JavaScript'; 
    el.type = 'text/javascript'; 
    el.src = config.macros.haloscan.baseURL + account;
    document.documentElement.childNodes[0].appendChild(el);
    
    haloscanLoaded = 1;
}
config.macros.haloscan.load();

/* this totally clobbers document.write, i hope that's ok */
var safeWrite = function(s)
{
    document.written = s;
    return s;
};
document.write = safeWrite;

config.macros.haloscan.refreshDefaultTiddlers = function ()
{
    var start = store.getTiddlerText(&quot;DefaultTiddlers&quot;);
    if (start)
    {
        var titles = start.readBracketedList();
        for (var t=titles.length-1; t&gt;=0; t--)
            story.refreshTiddler(titles[t], DEFAULT_VIEW_TEMPLATE, 1);
    }
}

var haloscanRefreshed = 0;
config.macros.haloscan.handler = function (place, macroName, params, wikifier, paramString, tiddler)
{
    if (typeof HaloScan == 'undefined')
    {
        if (haloscanRefreshed == 0)
        {
            setTimeout(&quot;config.macros.haloscan.refreshDefaultTiddlers()&quot;, 1);
            haloscanRefreshed = 1;
        }
        return;
    }
    
    var id = story.findContainingTiddler(place).id.substr(7);
    // conal: commenting out the next two lines makes comment-finding work when the tiddler title contains hyphens.  The 
    // Haloscan and HaloscanTB functions already do this replacement.  I don't know why removing the redundant replace helps.
    // var hs_search = new RegExp('\\W','gi');
    // id = id.replace(hs_search,&quot;_&quot;);
    // conal: Prepend idPrefix to make sure different TWs get different comment ids.
    id = config.macros.haloscan.idPrefix + ' tiddler ' + id
    
    account = config.macros.haloscan.account;
    if (!account || (account == &quot;YourName&quot;))
        account = store.getTiddlerText(&quot;SiteTitle&quot;);
    
    var haloscanError = function (msg)
    {
        createTiddlyError(place, config.messages.macroError.format([&quot;HaloscanMacro&quot;]), config.messages.macroErrorDetails.format([&quot;HaloscanMacro&quot;, msg]));
    }
    
    if (params.length == 1)
    {
        if (params[0] == &quot;comments&quot;)
        {
            postCount(id);
            commentsLabel = document.written;
            commentsPrompt = &quot;Comments on this tiddler&quot;;
            var commentsHandler = function(e) { HaloScan(id); return false; };
            var commentsButton = createTiddlyButton(place, commentsLabel, commentsPrompt, commentsHandler);
        }
        else if (params[0] == &quot;trackbacks&quot;)
        {
            postCountTB(id);
            trackbacksLabel = document.written;
            trackbacksPrompt = &quot;Trackbacks for this tiddler&quot;;
            var trackbacksHandler = function(e) { HaloScanTB(id); return false; };
            var trackbackButton = createTiddlyButton(place, trackbacksLabel, trackbacksPrompt, trackbacksHandler);
        }
        else
            haloscanError(&quot;unknown parameter: &quot; + params[0]);
    }
    else if (params.length == 0)
        haloscanError(&quot;missing parameter&quot;);
    else
        haloscanError(&quot;bad parameter count&quot;);
}

//}}}
</pre>
</div>
<div title="Haskell-based web server log analyzer" modifier="Conal Elliott" modified="200612251512" created="200612210247" tags="project 2006-12-20">
<pre>Features:
* Easy to use &amp; customize
* Elegant code / easy to extend
* Time- and space-efficient (important for high-traffic sites)
* Highly detailed -- no information loss
Competitors:
* [[AWStats|http://awstats.sourceforge.net]] (Perl)
* [[Analog|http://www.analog.cx]] (C)
</pre>
</div>
<div title="HorizontalMainMenuStyles" modifier="Conal Elliott" modified="200709050414" created="200610261804" changecount="7">
<pre>/***
To use, add {{{[[HorizontalMainMenuStyles]]}}} to your StyleSheet tiddler. Then use {{{topMenu}}} instead of {{{mainMenu}}} as an id in PageTemplate.
***/
/*{{{*/

#topMenu br {display:none; }
#topMenu { background: #39a; }
#topMenu { padding:2px; }
#topMenu .button,  #topMenu .tiddlyLink { padding-left:1em; padding-right:1em; color:white; font-size:115%;}

#displayArea { margin: 1em 15.5em 0em 1em; } /* use the full horizontal width */

/* just in case want some QuickOpenTags in your topMenu */
#topMenu .quickopentag { padding:0px; margin:0px; border:0px; }
#topMenu .quickopentag .tiddlyLink { padding-right:1px; }
#topMenu .quickopentag .button { padding-left:1px; border:0px; }


/*}}}*/</pre>
</div>
<div title="InlineJavascriptPlugin" modifier="Conal Elliott" created="200610300310" tags="systemConfig 2006-10-29">
<pre>/***
|''Name:''|InlineJavascriptPlugin|
|''Source:''|http://www.TiddlyTools.com/#InlineJavascriptPlugin|
|''Author:''|Eric Shulman - ELS Design Studios|
|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|''~CoreVersion:''|2.0.10|

Insert Javascript executable code directly into your tiddler content.  Lets you ''call directly into TW core utility routines, define new functions, calculate values, add dynamically-generated TiddlyWiki-formatted output'' into tiddler content, or perform any other programmatic actions each time the tiddler is rendered.
!!!!!Usage
&lt;&lt;&lt;
When installed, this plugin adds new wiki syntax for surrounding tiddler content with {{{&lt;script&gt;}}} and {{{&lt;/script&gt;}}} markers, so that it can be treated as embedded javascript and executed each time the tiddler is rendered.

''Deferred execution from an 'onClick' link''
By including a label=&quot;...&quot; parameter in the initial {{{&lt;script&gt;}}} marker, the plugin will create a link to an 'onclick' script that will only be executed when that specific link is clicked, rather than running the script each time the tiddler is rendered.

''External script source files:''
You can also load javascript from an external source URL, by including a src=&quot;...&quot; parameter in the initial {{{&lt;script&gt;}}} marker (e.g., {{{&lt;script src=&quot;demo.js&quot;&gt;&lt;/script&gt;}}}).  This is particularly useful when incorporating third-party javascript libraries for use in custom extensions and plugins.  The 'foreign' javascript code remains isolated in a separate file that can be easily replaced whenever an updated library file becomes available.

''Display script source in tiddler output''
By including the keyword parameter &quot;show&quot;, in the initial {{{&lt;script&gt;}}} marker, the plugin will include the script source code in the output that it displays in the tiddler.

''Defining javascript functions and libraries:''
Although the external javascript file is loaded while the tiddler content is being rendered, any functions it defines will not be available for use until //after// the rendering has been completed.  Thus, you cannot load a library and //immediately// use it's functions within the same tiddler.  However, once that tiddler has been loaded, the library functions can be freely used in any tiddler (even the one in which it was initially loaded).

To ensure that your javascript functions are always available when needed, you should load the libraries from a tiddler that will be rendered as soon as your TiddlyWiki document is opened.  For example, you could put your {{{&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;}}} syntax into a tiddler called LoadScripts, and then add {{{&lt;&lt;tiddler LoadScripts&gt;&gt;}}} in your MainMenu tiddler.

Since the MainMenu is always rendered immediately upon opening your document, the library will always be loaded before any other tiddlers that rely upon the functions it defines.  Loading an external javascript library does not produce any direct output in the tiddler, so these definitions should have no impact on the appearance of your MainMenu.

''Creating dynamic tiddler content''
An important difference between this implementation of embedded scripting and conventional embedded javascript techniques for web pages is the method used to produce output that is dynamically inserted into the document:
* In a typical web document, you use the document.write() function to output text sequences (often containing HTML tags) that are then rendered when the entire document is first loaded into the browser window.
* However, in a ~TiddlyWiki document, tiddlers (and other DOM elements) are created, deleted, and rendered &quot;on-the-fly&quot;, so writing directly to the global 'document' object does not produce the results you want (i.e., replacing the embedded script within the tiddler content), and completely replaces the entire ~TiddlyWiki document in your browser window.
* To allow these scripts to work unmodified, the plugin automatically converts all occurences of document.write() so that the output is inserted into the tiddler content instead of replacing the entire ~TiddlyWiki document.

If your script does not use document.write() to create dynamically embedded content within a tiddler, your javascript can, as an alternative, explicitly return a text value that the plugin can then pass through the wikify() rendering engine to insert into the tiddler display.  For example, using {{{return &quot;thistext&quot;}}} will produce the same output as {{{document.write(&quot;thistext&quot;)}}}.

//Note: your script code is automatically 'wrapped' inside a function, {{{_out()}}}, so that any return value you provide can be correctly handled by the plugin and inserted into the tiddler.  To avoid unpredictable results (and possibly fatal execution errors), this function should never be redefined or called from ''within'' your script code.//

''Accessing the ~TiddlyWiki DOM''
The plugin provides one pre-defined variable, 'place', that is passed in to your javascript code so that it can have direct access to the containing DOM element into which the tiddler output is currently being rendered.

Access to this DOM element allows you to create scripts that can:
* vary their actions based upon the specific location in which they are embedded
* access 'tiddler-relative' information (use findContainingTiddler(place))
* perform direct DOM manipulations (when returning wikified text is not enough)
&lt;&lt;&lt;
!!!!!Examples
&lt;&lt;&lt;
an &quot;alert&quot; message box:
&gt;&lt;script show&gt;
	alert('InlineJavascriptPlugin: this is a demonstration message');
&lt;/script&gt;
dynamic output:
&gt;&lt;script show&gt;
	return (new Date()).toString();
&lt;/script&gt;
wikified dynamic output:
&gt;&lt;script show&gt;
	return &quot;link to current user: [[&quot;+config.options.txtUserName+&quot;]]&quot;;
&lt;/script&gt;
dynamic output using 'place' to get size information for current tiddler:
&gt;&lt;script show&gt;
   if (!window.story) window.story=window;
   var title=story.findContainingTiddler(place).id.substr(7);
   return title+&quot; is using &quot;+store.getTiddlerText(title).length+&quot; bytes&quot;;
&lt;/script&gt;
creating an 'onclick' button/link that runs a script:
&gt;&lt;script label=&quot;click here&quot; show&gt;
   if (!window.story) window.story=window;
   alert(&quot;Hello World!\nlinktext='&quot;+place.firstChild.data+&quot;'\ntiddler='&quot;+story.findContainingTiddler(place).id.substr(7)+&quot;'&quot;);
&lt;/script&gt;
loading a script from a source url:
&gt;http://www.TiddlyTools.com/demo.js contains:
&gt;&gt;{{{function demo() { alert('this output is from demo(), defined in demo.js') } }}}
&gt;&gt;{{{alert('InlineJavascriptPlugin: demo.js has been loaded'); }}}
&gt;&lt;script src=&quot;demo.js&quot; show&gt;
	return &quot;loading demo.js...&quot;
&lt;/script&gt;
&gt;&lt;script label=&quot;click to execute demo() function&quot; show&gt;
	demo()
&lt;/script&gt;
&lt;&lt;&lt;
!!!!!Installation
&lt;&lt;&lt;
import (or copy/paste) the following tiddlers into your document:
''InlineJavascriptPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)
&lt;&lt;&lt;
!!!!!Revision History
&lt;&lt;&lt;
''2006.10.16 [1.5.2]'' add newline before closing '}' in 'function out_' wrapper.  Fixes error caused when last line of script is a comment.
''2006.06.01 [1.5.1]'' when calling wikify() on script return value, pass hightlightRegExp and tiddler params so macros that rely on these values can render properly
''2006.04.19 [1.5.0]'' added 'show' parameter to force display of javascript source code in tiddler output
''2006.01.05 [1.4.0]'' added support 'onclick' scripts.  When label=&quot;...&quot; param is present, a button/link is created using the indicated label text, and the script is only executed when the button/link is clicked.  'place' value is set to match the clicked button/link element.
''2005.12.13 [1.3.1]'' when catching eval error in IE, e.description contains the error text, instead of e.toString().  Fixed error reporting so IE shows the correct response text.  Based on a suggestion by UdoBorkowski
''2005.11.09 [1.3.0]'' for 'inline' scripts (i.e., not scripts loaded with src=&quot;...&quot;), automatically replace calls to 'document.write()' with 'place.innerHTML+=' so script output is directed into tiddler content.  Based on a suggestion by BradleyMeck
''2005.11.08 [1.2.0]'' handle loading of javascript from an external URL via src=&quot;...&quot; syntax
''2005.11.08 [1.1.0]'' pass 'place' param into scripts to provide direct DOM access 
''2005.11.08 [1.0.0]'' initial release
&lt;&lt;&lt;
!!!!!Credits
&lt;&lt;&lt;
This feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]]
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.inlineJavascript= {major: 1, minor: 5, revision: 2, date: new Date(2006,10,16)};

config.formatters.push( {
	name: &quot;inlineJavascript&quot;,
	match: &quot;\\&lt;script&quot;,
	lookahead: &quot;\\&lt;script(?: src=\\\&quot;((?:.|\\n)*?)\\\&quot;)?(?: label=\\\&quot;((?:.|\\n)*?)\\\&quot;)?( show)?\\&gt;((?:.|\\n)*?)\\&lt;/script\\&gt;&quot;,

	handler: function(w) {
		var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source)
		if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {
			if (lookaheadMatch[1]) { // load a script library
				// make script tag, set src, add to body to execute, then remove for cleanup
				var script = document.createElement(&quot;script&quot;); script.src = lookaheadMatch[1];
				document.body.appendChild(script); document.body.removeChild(script);
			}
			if (lookaheadMatch[4]) { // there is script code
				if (lookaheadMatch[3]) // show inline script code in tiddler output
					wikify(&quot;{{{\n&quot;+lookaheadMatch[0]+&quot;\n}}}\n&quot;,w.output);
				if (lookaheadMatch[2]) { // create a link to an 'onclick' script
					// add a link, define click handler, save code in link (pass 'place'), set link attributes
					var link=createTiddlyElement(w.output,&quot;a&quot;,null,&quot;tiddlyLinkExisting&quot;,lookaheadMatch[2]);
					link.onclick=function(){try{return(eval(this.code))}catch(e){alert(e.description?e.description:e.toString())}}
					link.code=&quot;function _out(place){&quot;+lookaheadMatch[4]+&quot;\n};_out(this);&quot;
					link.setAttribute(&quot;href&quot;,&quot;javascript:;&quot;); link.setAttribute(&quot;title&quot;,&quot;&quot;); link.style.cursor=&quot;pointer&quot;;
				}
				else { // run inline script code
					var code=&quot;function _out(place){&quot;+lookaheadMatch[4]+&quot;\n};_out(w.output);&quot;
					code=code.replace(/document.write\(/gi,'place.innerHTML+=(');
					try { var out = eval(code); } catch(e) { out = e.description?e.description:e.toString(); }
					if (out &amp;&amp; out.length) wikify(out,w.output,w.highlightRegExp,w.tiddler);
				}
			}
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	}
} )
//}}}
</pre>
</div>
<div title="Inspiring Demos" modifier="Conal Elliott" modified="200703071845" created="200703071824" tags="project 2007-03-07">
<pre>* [[Reactable demos| http://www.youtube.com/profile_videos?user=marcosalonso]]
* [[Multi-Touch Interaction Research, Jeff Han| http://cs.nyu.edu/~jhan/ftirtouch/index.html]]</pre>
</div>
<div title="LoadDependencies" modifier="Conal Elliott" modified="200701300049" created="200612311627" tags="2006-12-31 TiddlyWiki definition">
<pre>Some [[plugin]]s cannot load until other plugins have loaded.  There's no TiddlyWiki mechanism to record such dependencies.   Tiddlers are loaded in lexical order of their names, so the thing to do is make sure that I use a name that comes //after// the names of any load-time dependencies.

There is a [[discussion thread| http://groups-beta.google.com/group/TiddlyWiki/browse_frm/thread/9f5996eefa082d29]] on the TiddlyWiki group of  mechanisms for expressing and managing dependencies.

LoadDependencies are usually also UseDependencies, so for brevity I don't repeat LoadDependencies in a UseDependencies list.

Examples: [[SyntaxifyPlugin: Haskell]], [[RewritePlugin: Haskell]].
</pre>
</div>
<div title="MainMenu" modifier="Conal Elliott" modified="200711261534" created="200610230314" tags="protected" changecount="9">
<pre>[[site map]]
&lt;&lt;tag project&gt;&gt;
&lt;&lt;tag idea&gt;&gt;
&lt;&lt;tag article&gt;&gt;
&lt;&lt;tag &quot;how to&quot;&gt;&gt;
&lt;&lt;tag {{new Date().formatString(&quot;YYYY-0MM&quot;)}}&gt;&gt;
[[sand box]]
&lt;&lt;newTiddler&gt;&gt;
&lt;&lt;newJournal 'YYYY-0MM-0DD' {{new Date().formatString(&quot;YYYY-0MM&quot;)}} 'day'&gt;&gt;
&lt;&lt;tiddler ToggleRightSidebar&gt;&gt;</pre>
</div>
<div title="MarkupPreHead" modifier="Conal Elliott" modified="200702102347" created="200702102340">
<pre>&lt;!--{{{--&gt;
&lt;style type=&quot;text/css&quot;&gt;
#contentWrapper {display:none;}
body { background:#003; }
&lt;/style&gt;
&lt;div id=&quot;SplashScreen&quot; style=&quot;border: 1px solid #ccc; -moz-border-radius:1em; display:block; text-align:center; width:400px; margin:100px auto; padding:.5em; color:#fff; font-size:24pt; font-family:verdana,arial,helvetica,sans; background-color:#006;&quot;&gt;Conal's Journal is loading&lt;div style=&quot;font-size: 18px; color:#fff;&quot;&gt;please wait...&lt;/div&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="Marshallisms" modifier="Conal Elliott" modified="200611232104" created="200610252150" tags="2006-11-15 AudioPlayerPlugin demo">
<pre>This section contains a ''large'' test of the [[AudioPlayerPlugin]] macros.  It loads a lot of mp3 files at once and swamps the browser.  See comment at [[2006-11-15]].

The audio clips come from the [[cnvc sound bytes page|http://www.cnvc.org/sbytes.htm]].

| searching for everyone's need |&lt;&lt;marshallism 200311&gt;&gt;|
| jackal postal delivery |&lt;&lt;marshallism 200310&gt;&gt;|
| how we experience needs |&lt;&lt;marshallism 200309&gt;&gt;|
| how the past affects |&lt;&lt;marshallism 200308&gt;&gt;|
| how Marshall sees our needs |&lt;&lt;marshallism 200307&gt;&gt;|
| bullshit in giraffe |&lt;&lt;marshallism 200306&gt;&gt;|
| beauty behind the judgment |&lt;&lt;marshallism 200305&gt;&gt;|
| act self-fully |&lt;&lt;marshallism 200304&gt;&gt;|
| needs as a gift example |&lt;&lt;marshallism 200303&gt;&gt;|
| when your needs are heard |&lt;&lt;marshallism 200302&gt;&gt;|
| what is a need? |&lt;&lt;marshallism 200301&gt;&gt;|
| the more ugly sounding ... |&lt;&lt;marshallism 200212&gt;&gt;|
| self full motivation |&lt;&lt;marshallism 200211&gt;&gt;|
| how the past effects |&lt;&lt;marshallism 200210&gt;&gt;|
| a need to Marshall |&lt;&lt;marshallism 20021004&gt;&gt;|
| when you hear a demand |&lt;&lt;marshallism 20020927&gt;&gt;|
| see your gift in their eyes |&lt;&lt;marshallism 20020920&gt;&gt;|
| no but your needs matter |&lt;&lt;marshallism 20020913&gt;&gt;|
| greatest menace on earth |&lt;&lt;marshallism 20020906&gt;&gt;|
| bullshit in giraffe |&lt;&lt;marshallism 20020830&gt;&gt;|
| beauty behind the judgment |&lt;&lt;marshallism 20020823&gt;&gt;|
| act self-fully |&lt;&lt;marshallism 20020816&gt;&gt;|
| what a request contains |&lt;&lt;marshallism 20020809&gt;&gt;|
| do as I've requested only |&lt;&lt;marshallism 20020802&gt;&gt;|
| to think you know what's right |&lt;&lt;marshallism 20020728&gt;&gt;|
| the cause of male-itis |&lt;&lt;marshallism 20020721&gt;&gt;|
| never let someone say what you are |&lt;&lt;marshallism 20020714&gt;&gt;|
| never hear a jackal's thoughts |&lt;&lt;marshallism 20020707&gt;&gt;|
| if you hear any rejection . . . |&lt;&lt;marshallism 20020626&gt;&gt;|
| gratitude tells us . . . |&lt;&lt;marshallism 20020619&gt;&gt;|
| a &quot;no&quot; is a need and request |&lt;&lt;marshallism 20020612&gt;&gt;|
| a &quot;no&quot; is a gift |&lt;&lt;marshallism 20020605&gt;&gt;|
| role play request example |&lt;&lt;marshallism 20020531&gt;&gt;|
| &quot;yes that isn't so&quot; detector |&lt;&lt;marshallism 20020524&gt;&gt;|
| we have a choice |&lt;&lt;marshallism 20020517&gt;&gt;|
| to think in enemy images |&lt;&lt;marshallism 20020510&gt;&gt;|
| love as a need |&lt;&lt;marshallism 20020503&gt;&gt;|
| need focus |&lt;&lt;marshallism 20020426&gt;&gt;|
| the need behind the &quot;no&quot; |&lt;&lt;marshallism 20020419&gt;&gt;|
| focus on needs |&lt;&lt;marshallism 20020412&gt;&gt;|
| every diagnosis of others |&lt;&lt;marshallism 20020405&gt;&gt;|
| different needs, is never |&lt;&lt;marshallism 20020329&gt;&gt;|
| what a request contains |&lt;&lt;marshallism 20020322&gt;&gt;|
| the cost of hearing rejection |&lt;&lt;marshallism 20020315&gt;&gt;|
| connected at heart level |&lt;&lt;marshallism 20020308&gt;&gt;|
| thoughts that imply wrong |&lt;&lt;marshallism 20020301&gt;&gt;|
| strategies differ, not needs |&lt;&lt;marshallism 20020222&gt;&gt;|
| the cost of hearing rejection |&lt;&lt;marshallism 20020215&gt;&gt;|
| a need contains no reference to a specific person |&lt;&lt;marshallism 20020104&gt;&gt;|
| all humans have same needs |&lt;&lt;marshallism 20011228&gt;&gt;|
| a hug is a mug when . . . |&lt;&lt;marshallism 20011221&gt;&gt;|
| needs can be met many ways |&lt;&lt;marshallism 20011214&gt;&gt;|
| we have choice and power |&lt;&lt;marshallism 20011207&gt;&gt;|
| what you say is NOT empathy! |&lt;&lt;marshallism 20011130&gt;&gt;|
| false needs/pseudo needs vs. the real stuff |&lt;&lt;marshallism 20011123&gt;&gt;|
| the difference between mourning &amp;amp; apology |&lt;&lt;marshallism 20011116&gt;&gt;|
| mixing up needs and preferences |&lt;&lt;marshallism 20011109&gt;&gt;|
| we never do anything wrong |&lt;&lt;marshallism 20011102&gt;&gt;|
| when no request is made |&lt;&lt;marshallism 20011026&gt;&gt;|
| we never know what we want |&lt;&lt;marshallism 20011019&gt;&gt;|
| most important need |&lt;&lt;marshallism 20011012&gt;&gt;|</pre>
</div>
<div title="MoveablePanelPlugin" modifier="Conal Elliott" created="200702100042" tags="systemConfig 2007-02-09">
<pre>/***
|Name|MoveablePanelPlugin|
|Source|http://www.TiddlyTools.com/#MoveablePanelPlugin|
|Version|1.3.4|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;&lt;br&gt;&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|plugin|
|Requires|NestedSlidersPlugin|
|Overrides||
|Description||

Add move, size, max/restore mouse event handling and fold/unfold, hover/scroll, and close/dock toolbar command items to any floating panel or tiddler. (see NestedSlidersPlugin for floating panel syntax/usage).

!!!!!Usage
&lt;&lt;&lt;
syntax: {{{&lt;&lt;moveablePanel&gt;&gt;}}}

example: //using NestedSlidersPlugin 'floating panel' syntax//
//{{{
+++^30em^[panel]&lt;&lt;moveablePanel&gt;&gt;this is a headline for the panel
----
	this is a moveable floating panel
	with a few lines of text
	as an example for you to try...
	//note: this line is really long so you can see what happens to word wrapping when you re-size this panel//
===
//}}}
Try it: +++^30em^[panel]&lt;&lt;moveablePanel&gt;&gt;this is a headline for the panel
----
	this is a moveable floating panel
	with a few lines of text
	as an example for you to try...
	//note: this line is really long so you can see what happens to word wrapping when you re-size this panel//
===


When the mouse is just inside the edges of the tiddler/panel, the cursor will change to a &quot;crossed-arrows&quot; symbol, indicating that the panel is &quot;moveable&quot;.  Grab (click-hold) the panel anywhere in the edge area and then drag the mouse to reposition the panel.

To resize the panel, hold the ''shift'' key and then grab the panel: the cursor will change to a &quot;double-arrow&quot; symbol.  Drag a side edge of the panel to stretch horizontally or vertically, or drag a corner of the panel to stretch in both dimensions at once.

Double-clicking anywhere in the edge area of a panel will 'maximize' it to fit the current browser window.

When the mouse is anywhere over a panel (not just near the edge), a 'toolbar menu' appears in the ''upper right corner'', with the following command items:
*fold/unfold: ''fold'' temporarily reduces the panel height to show just one line of text.  ''unfold'' restores the panel height.
*hover/scroll: when you scroll the browser window, the moveable panels scroll with it.  ''hover'' lets you keep a panel in view, while the rest of the page content moves in the window.  ''scroll'' restores the default scrolling behavior for the panel.  //Note: Due to browser limitations, this feature is not currently available when using Internet Explorer (v6 or lower)... sorry.//
*close: ''close'' hides a panel from the page display.  If you have moved/resized a panel, closing it restores its default position and size.
*dock: unlike a floating panel, a moveable //tiddler// does not &quot;float&quot; on the page until it has actually been moved from its default position.  When moving a tiddler, the ''close'' command is replaced with ''dock'', which restores the tiddler to its default //non-floating// location on the page.
&lt;&lt;&lt;
!!!!!Installation
&lt;&lt;&lt;
import (or copy/paste) the following tiddlers into your document:
''MoveablePanelPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)
Note: for compatibility, please also install the current version of ''NestedSlidersPlugin''.
&lt;&lt;&lt;
!!!!!Revision History
&lt;&lt;&lt;
''2006.10.17 [1.3.4]'' when moving panel, adjust position for relative containing DIV
''2006.05.25 [1.3.3]'' in closePanel(), use p.button.onclick() so that normal processing (updating slider button tooltip, access key, etc.) is performed
''2006.05.11 [1.3.2]'' doc update
''2006.05.11 [1.3.1]'' re-define all functions within moveablePanel object (eliminate global window.* function definitions (and some &quot;leaky closures&quot; in IE)
''2006.05.11 [1.3.0]'' converted from inline javascript to true plugin
''2006.05.09 [1.2.3]'' in closePanel(), set focus to sliderpanel button (if any)
''2006.05.02 [1.2.2]'' in MoveOrSizePanel(), calculate adjustments for top and left when inside nested floating panels
''2006.04.06 [1.2.1]'' in getPanel(), allow redefinition or bypass of &quot;moveable&quot; tag (changed from hard-coded &quot;tearoff&quot;)
''2006.03.29 [1.2.0]'' in getPanel(), require &quot;tearoff&quot; tag to enable floating tiddlers
''2006.03.13 [1.1.0]'' added handling for floating tiddlers and conditional menu display
''2006.03.06 [1.0.2]'' set move or resize cursor during mousetracking
''2006.03.05 [1.0.1]'' use &quot;window&quot; vs &quot;document.body&quot; so mousetracking in FF doesn't drop the panel when moving too quickly
''2006.03.04 [1.0.0]'' Initial public release
&lt;&lt;&lt;
!!!!!Credits
&lt;&lt;&lt;
This feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]]
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.moveablePanel= {major: 1, minor: 3, revision: 4, date: new Date(2006,10,17)};
//}}}
//{{{
config.macros.moveablePanel= { 
	handler:
	function(place,macroName,params) {
		var p=this.getPanel(place); if (!p) return;

		// remember original panel event handlers, size, location, border
		if (!p.saved) p.saved= {
			mouseover: p.onmouseover,
			mouseout: p.onmouseout,
			dblclick: p.ondblclick,
			top: p.style.top,
			left: p.style.left,
			width: p.style.width,
			height: p.style.height,
			position: p.style.position,
			border: p.style.border
		};

		// create control menu items
		var menupos=p.className==&quot;floatingPanel&quot;?&quot;float:right;&quot;:&quot;position:absolute;right:2em;top:3em;&quot;;
		var menustyle=p.className!=&quot;floatingPanel&quot;?'style=&quot;border:1px solid #666;background:#ccc;color:#000;padding:0px .5em;&quot;':&quot;&quot;;
		var html='&lt;div style=&quot;font-size:7pt;display:none;'+menupos+'&quot;&gt;&amp;nbsp;';
		if (p.className==&quot;floatingPanel&quot;)
			html+='&lt;a href=&quot;javascript:;&quot; title=&quot;reduce panel size&quot; '+menustyle
				+' onclick=&quot;return config.macros.moveablePanel.foldPanel(this,event)&quot;&gt;fold&lt;/a&gt;&amp;nbsp; ';
		if (!config.browser.isIE)
			html+='&lt;a href=&quot;javascript:;&quot; title=&quot;keep panel in view when scrolling&quot;'+menustyle
				+' onclick=&quot;return config.macros.moveablePanel.hoverPanel(this,event)&quot;&gt;hover&lt;/a&gt;&amp;nbsp; ';
		if (p.className==&quot;floatingPanel&quot;)
			html+='&lt;a href=&quot;javascript:;&quot; title=&quot;close panel and reset to default size and position&quot;'+menustyle
				+' onclick=&quot;return config.macros.moveablePanel.closePanel(this,event)&quot;&gt;close&lt;/a&gt;';
		else
			html+='&lt;a href=&quot;javascript:;&quot; title=&quot;reset panel to default size and position&quot;'+menustyle
				+' onclick=&quot;return config.macros.moveablePanel.closePanel(this,event)&quot;&gt;dock&lt;/a&gt;';
		html+='&lt;/div&gt;';
		p.menudiv=createTiddlyElement(place,&quot;span&quot;);
		p.menudiv.innerHTML=html;

		// init mouse handling and tooltip
		p.title=&quot;drag edge to move, shift key=stretch, double-click=max/restore&quot;;
		p.onmouseover=function(event) {
			if (this.className==&quot;floatingPanel&quot;||this.style.position==&quot;absolute&quot;||this.style.position==&quot;fixed&quot;) {
				if (this.className!=&quot;floatingPanel&quot;) this.style.border=&quot;1px dotted #999&quot;; // border around tiddler
				this.menudiv.firstChild.style.display=&quot;inline&quot;;
			}
			if (this.saved.mouseover) return this.saved.mouseover(event);
		};
		p.onmouseout=function(event) {
			this.menudiv.firstChild.style.display=&quot;none&quot;;
			if (this.className!=&quot;floatingPanel&quot;) this.style.border=this.saved.border;
			if (this.saved.mouseout) return this.saved.mouseout(event);
		};
		p.ondblclick=function(event) {
			if (!config.macros.moveablePanel.maximizePanel(this,event)) return false; // processed
			return this.saved.dblclick?this.saved.dblclick(event):true;
		};
		p.onmousemove=function(event) { return config.macros.moveablePanel.setCursorPanel(this,event); };
		p.onmousedown=function(event) { return config.macros.moveablePanel.moveOrSizePanel(this,event); };
	},

	getPanel:
	function(place) {
		var p=place; while (p &amp;&amp; p.className!='floatingPanel') p=p.parentNode; if (p) return p; // floatingPanel
		p=story.findContainingTiddler(place); if (!p || !store.getTiddler(p.getAttribute(&quot;tiddler&quot;))) return null; // not in a tiddler

		// moveable **tiddlers** in IE have LOTS of problems... DISABLED FOR NOW... but floating panels still work in IE
		if (config.browser.isIE) return null;

		// tiddlers tagged (e.g. with &quot;moveable&quot;) to allow movement?  use null or &quot;&quot; to bypass tag check
		var tag=&quot;moveable&quot;; if (!tag || !tag.trim().length) return p;
		return (store.getTiddler(p.getAttribute(&quot;tiddler&quot;)).tags.find(tag)!=null)?p:null; // tiddler is tagged for moving
	},

	processed:
	function(event) {
		event.cancelBubble=true; if (event.stopPropagation) event.stopPropagation(); return false;
	},

	getClientWidth:
	function() {
		if(document.width!=undefined) return document.width;
		if(document.documentElement &amp;&amp; document.documentElement.clientWidth) return document.documentElement.clientWidth;
		if(document.body &amp;&amp; document.body.clientWidth) return document.body.clientWidth;
		if(window.innerWidth!=undefined) return window.innerWidth;
		return 100; // should never get here
	},

	closePanel:
	function(place,event) {
		if (!event) var event=window.event;
		var p=this.getPanel(place); if (!p) return true;
		if (p.hover) this.hoverPanel(p.hoverButton,event); 
		if (p.folded) this.foldPanel(p.foldButton,event); 
		p.maxed=false; 
		p.style.top=p.saved.top;
		p.style.left=p.saved.left;
		p.style.width=p.saved.width;
		p.style.height=p.saved.height;
		p.style.position=p.saved.position;
		if (p.button) { p.button.focus(); onClickNestedSlider({target:p.button}); } // click on slider &quot;button&quot; (if any) to close the panel
		return this.processed(event);
	},

	foldPanel:
	function(place,event) {
		if (!event) var event=window.event;
		var p=this.getPanel(place); if (!p) return true;
		if (!p.foldButton) p.foldButton=place;
		if (p.folded) {
			p.style.height=p.folded_savedheight;
			p.style.overflow=p.folded_savedoverflow;
		} else {
			p.folded_savedheight=p.style.height; p.style.height=&quot;1em&quot;; 
			p.folded_savedoverflow=p.style.overflow; p.style.overflow=&quot;hidden&quot;;
		}
		p.folded=!p.folded;
		place.innerHTML=p.folded?&quot;unfold&quot;:&quot;fold&quot;;
		place.title=p.folded?&quot;restore panel size&quot;:&quot;reduce panel size&quot;;
		return this.processed(event);
	},

	hoverPanel:
	function(place,event) {
		if (config.browser.isIE) { return this.processed(event); } // 'fixed' position is not handled properly by IE :-(
		if (!event) var event=window.event;
		var p=this.getPanel(place); if (!p) return true;
		if (!p.hoverButton) p.hoverButton=place;
		if (p.hover)
			p.style.position=p.hover_savedposition;
		else
			{ p.hover_savedposition=p.style.position; p.style.position=&quot;fixed&quot;; }
		p.hover=!p.hover;
		place.innerHTML=p.hover?&quot;scroll&quot;:&quot;hover&quot;;
		place.title=p.hover?&quot;make panel move with page when scrolling&quot;:&quot;keep panel in view when scrolling page&quot;;
		return this.processed(event);
	},

	maximizePanel:
	function(place,event) {
		if (!event) var event=window.event;
		var p=this.getPanel(place); if (!p) return true;
		var left=findPosX(p); var top=findPosY(p);
		var width=p.offsetWidth; var height=p.offsetHeight;
		var x=!config.browser.isIE?event.pageX:event.clientX;
		var y=!config.browser.isIE?event.pageY:event.clientY;
		if (x&lt;left||x&gt;=left+width||y&lt;top||y&gt;=top+height) return true; // not inside panel, let mousedown bubble through
		var edgeWidth=10; var edgeHeight=10;
		var isTop=(y-top&lt;edgeHeight);
		var isLeft=(x-left&lt;edgeWidth);
		var isBottom=(top+height-y&lt;edgeHeight);
		var isRight=(left+width-x&lt;edgeWidth);
		if (!(isTop||isLeft||isBottom||isRight))
			return true; // not near an edge... let double click bubble through
		if (p.folded) this.foldPanel(p.foldButton,event); // unfold panel first (if needed)
		if (p.maxed) {
			p.style.top=p.max_savedtop;
			p.style.left=p.max_savedleft;
			p.style.width=p.max_savedwidth;
			p.style.height=p.max_savedheight;
			p.style.position=p.max_savedposition;
		} else {
			p.max_savedwidth=p.style.width;
			p.max_savedheight=p.style.height;
			p.max_savedtop=p.style.top;
			p.max_savedleft=p.style.left;
			p.max_savedposition=p.style.position;
			// IE gets the percentage stretch wrong if floating panel is inside a table
			p.style.width=config.browser.isIE?(getClientWidth()*0.95+&quot;px&quot;):&quot;95%&quot;;
			p.style.height=&quot;95%&quot;;
			p.style.top=p.style.left='1em';
			p.style.position=&quot;absolute&quot;;
		}
		p.maxed=!p.maxed;
		return this.processed(event);
	},

	setCursorPanel:
	function(place,event) {
		if (!event) var event=window.event;
		var p=this.getPanel(place); if (!p) return true;
		var left=findPosX(p); var top=findPosY(p);
		var width=p.offsetWidth; var height=p.offsetHeight;
		var x=!config.browser.isIE?event.pageX:event.clientX;
		var y=!config.browser.isIE?event.pageY:event.clientY;
		if (x&lt;left||x&gt;=left+width||y&lt;top||y&gt;=top+height) return true; // not inside panel, let mousedown bubble through
		var edgeWidth=10; var edgeHeight=10;
		var isTop=(y-top&lt;edgeHeight);
		var isLeft=(x-left&lt;edgeWidth);
		var isBottom=(top+height-y&lt;edgeHeight);
		var isRight=(left+width-x&lt;edgeWidth);
		if (!(isTop||isLeft||isBottom||isRight))
			{ p.style.cursor=&quot;auto&quot;; if (!p.savedtitle) p.savedtitle=p.title; p.title=&quot;&quot;; }
		else {
			p.style.cursor=!event.shiftKey?&quot;move&quot;:((isTop?'n':(isBottom?'s':''))+(isLeft?'w':(isRight?'e':''))+'-resize');
			if (p.savedtitle) p.title=p.savedtitle;
		}
		return true; // let mouseover event bubble through
	},

	moveOrSizePanel:
	function(place,event) {
		if (!event) var event=window.event;
		var p=this.getPanel(place); if (!p) return true;
		var left=findPosX(p); var top=findPosY(p);
		var width=p.offsetWidth; var height=p.offsetHeight;
		var x=!config.browser.isIE?event.pageX:event.clientX;
		var y=!config.browser.isIE?event.pageY:event.clientY;
		if (x&lt;left||x&gt;=left+width||y&lt;top||y&gt;=top+height) return true; // not inside panel, let mousedown bubble through
		var edgeWidth=10; var edgeHeight=10;
		var isTop=(y-top&lt;edgeHeight);
		var isLeft=(x-left&lt;edgeWidth);
		var isBottom=(top+height-y&lt;edgeHeight);
		var isRight=(left+width-x&lt;edgeWidth);
		if (!(isTop||isLeft||isBottom||isRight)) return true; // not near an edge... let mousedown bubble through
	
		// when resizing, change cursor to show directional (NSEW) &quot;drag arrows&quot;
		var sizing=event.shiftKey; // remember this for use during mousemove tracking
		if (sizing) p.style.cursor=((isTop?'n':(isBottom?'s':''))+(isLeft?'w':(isRight?'e':''))+'-resize');
	
		var adjustLeft=0; var adjustTop=0;
		var pp=p.parentNode; while (pp &amp;&amp; pp.style.position!='relative') pp=parent.parentNode;
		if (pp) { adjustLeft+=findPosX(pp); adjustTop+=findPosY(pp); }
		var pp=p.parentNode; while (pp &amp;&amp; pp.className!=&quot;floatingPanel&quot;) pp=pp.parentNode;
		if (pp) { adjustLeft+=findPosX(pp); adjustTop+=findPosY(pp); }
	
		// start tracking mousemove events
		config.macros.moveablePanel.activepanel=p;
		var target=p; // if 'capture' handling not supported, track within panel only
		if (document.body.setCapture) { document.body.setCapture(); var target=document.body; } // IE
		if (window.captureEvents) { window.captureEvents(Event.MouseMove|Event.MouseUp,true); var target=window; } // moz
		if (target.onmousemove!=undefined) target.saved_mousemove=target.onmousemove;
		target.onmousemove=function(e){
			if (!e) var e=window.event;
			var p=config.macros.moveablePanel.activepanel;
			if (!p) { this.onmousemove=this.saved_mousemove?this.saved_mousemove:null; return; }
	
			// PROBLEM: p.offsetWidth and p.offsetHeight do not seem to account for padding or borders
			// WORKAROUND: subtract padding and border (in px) when calculating new panel width and height
			// TBD: get these values from p.style... convert to px as needed.
			var paddingWidth=10.6667; var paddingHeight=10.6667;
			var borderWidth=1; var borderHeight=1;
			var adjustWidth=-(paddingWidth*2+borderWidth*2);
			var adjustHeight=-(paddingHeight*2+borderHeight*2);
	
			if (p.style.position!=&quot;absolute&quot;) { // convert relative DIV to movable absolute DIV
				p.style.position=&quot;absolute&quot;;
				p.style.left=left+&quot;px&quot;; p.style.top=top+&quot;px&quot;;
				p.style.width=(width+adjustWidth)+&quot;px&quot;; p.style.top=(height+adjustHeight)+&quot;px&quot;;
			}
			var newX=!config.browser.isIE?e.pageX:e.clientX;
			var newY=!config.browser.isIE?e.pageY:e.clientY;
			if (sizing) { // resize panel
				// don't let panel get smaller than edge &quot;grab&quot; zones
				var minWidth=edgeWidth*2-adjustWidth;
				var minHeight=edgeHeight*2-adjustHeight;
				p.maxed=false; // make sure panel is not maximized
				if (p.folded) this.foldPanel(p.foldButton,e); // make sure panel is unfolded
				if (isBottom) var newHeight=height+newY-y+1;
				if (isTop) var newHeight=height-newY+y+1;
				if (isLeft) var newWidth=width-newX+x+1;
				if (isRight) var newWidth=width+newX-x+1;
				if (isLeft||isRight) p.style.width=(newWidth&gt;minWidth?newWidth:minWidth)+adjustWidth+&quot;px&quot;;
				if (isLeft) p.style.left=left-adjustLeft+newX-x+1+&quot;px&quot;;
				if (isTop||isBottom) p.style.height=(newHeight&gt;minHeight?newHeight:minHeight)+adjustHeight+&quot;px&quot;;
				if (isTop) p.style.top=top-adjustTop+newY-y+1+&quot;px&quot;;
			} else { // move panel
				p.style.top=top-adjustTop+newY-y+1+&quot;px&quot;;
				p.style.left=left-adjustLeft+newX-x+1+&quot;px&quot;;
			}
			var status=sizing?(&quot;size: &quot;+p.style.width+&quot;,&quot;+p.style.height):(&quot;pos: &quot;+p.style.left+&quot;,&quot;+p.style.top);
			window.status=status.replace(/(\.[0-9]+)|px/g,&quot;&quot;); // remove decimals and &quot;px&quot;
			return config.macros.moveablePanel.processed(e);
		};
	
		// stop tracking mousemove events
		if (target.onmouseup!=undefined) target.saved_mouseup=target.onmouseup;
		target.onmouseup=function(e){
			if (!e) var e=window.event;
			if (this.releaseCapture) this.releaseCapture(); // IE
			if (this.releaseEvents) this.releaseEvents(Event.MouseMove|Event.MouseUp); // moz
			this.onmousemove=this.saved_mousemove?this.saved_mousemove:null;
			this.onmouseup=this.saved_mouseup?this.saved_mouseup:null;
			config.macros.moveablePanel.activepanel=null;
			window.status=&quot;&quot;;
			return config.macros.moveablePanel.processed(e);
		};
		return this.processed(event); // mousedown handled
	}
};
//}}}</pre>
</div>
<div title="NVC certification and violence" modifier="Conal Elliott" modified="200611190336" created="200611141152" tags="2006-11-14 essay">
<pre>I remember Marshall saying that one can tell from a language's culture whether that culture is violent, and specifically whether the language talks about //what people are//, not just what they //do//, //feel//, or //need//.

Marshall also said:
&gt; Never let somebody in authority tell you what you are.  &lt;&lt;marshallism 20020714&gt;&gt;

I've been very uncomfortable with the culture of PSNCC, and lately I've been painfully sensitive to use of the word //trainer// to label what some people are or are not.  Sorting out my reactions, I find the following:  //(rest is notes)//
* imprecision
* implicitness of external validation/approval/evaluation
* loss of convenient term for teaching NVC
* labeling -- i want community support in walking our talk

//Convenience//: what does it reveal that this culture wants validation/approval/evaluation to be more convenient thing to discuss than teaching NVC?
</pre>
</div>
<div title="NestedFormatterMacro" modifier="Conal Elliott" modified="200701010143" created="200612310224" tags="systemConfig 2006-12-30">
<pre>/***
|au(#t(#h(#o(#r#)#)#)#):|Bradley Meck|
|date:|12/03/2006|
|use:|config.macros.nestedFormatter.getFormatter|
|params:|String name, String openingMatch, String closingMatch, function Handler|

!About
This plugin's purpose is to produce a formatter that will allow for it to have nested structures. Included in this macro is an example at the bottom using parenthesis to give a font size increasing effect.

!Example text source
{{{
(#t(#e(#s#)t (#t(#hi#)s#)#)!#)
}}}
!Example result
(#t(#e(#s#)t (#t(#hi#)s#)#)!#)

See example code below.

See also [[literate Haskell plugin]] for an example of a simplified formatter.

The main difference in how the handler for such a handler function works for a nested formatter is that it has a second arguement {{{strArr}}}. {{{strArr}}} has 3 parts, the original tag {{{opening signifier strArr[0]}}} and the middle test {{{what is between the signifiers strArr[1]}}} and the ending tag {{{ending signifier strArr[2]}}}. w.matchText will return the entire string match from the first openning signifier to the last closing signifier {{{inclusive}}}.

!Todo
*restructure the code so that wikify is not called because it is such a heavy function call.
*handle improper formatting nicely.
*allow for capturing/bubbling style handler calls.

!Changes
|2006-12-30|[[Conal Elliott|http://conal.net]]|added {{{substAndWikify}}} and activated example.|
!Code
***/
//{{{
config.macros.nestedFormatter = {};
config.macros.nestedFormatter.getFormatter =
  function(fname, openTag, closeTag, formattingHandler) {
    var formatterResult = {};
    formatterResult.name = fname;
    formatterResult.match = openTag;
    formatterResult.openRegex = new RegExp(openTag,&quot;m&quot;);
    formatterResult.closeRegex = new RegExp(closeTag,&quot;m&quot;);
    formatterResult.handler = function(w) {
       var testString = w.source.substring(w.matchStart+w.matchLength);
       var strArr = [w.source.substring(w.matchStart,w.matchStart+w.matchLength)];
       var depth = 1;
       var off = w.matchLength;
       var index = true;var endex = true;
       while (depth &gt; 0 &amp;&amp; (index || endex) &amp;&amp; testString.length &gt; 0){
           index = this.openRegex.exec(testString);
           endex = this.closeRegex.exec(testString);
           //Found New Opening
           if (index &amp;&amp; endex &amp;&amp; index.index &lt; endex.index)
           {
               depth++;
               off+=index.index+index[0].length;
               testString = testString.substring(index[0].length+index.index);
           }
           else if (!index || endex.index &lt; index.index)
           {
               depth--;
               off+=endex.index+endex[0].length;
               testString = testString.substring(endex[0].length+endex.index);
           }
       }
       if (depth != 0) {
           createTiddlyText(w.output,w.matchText);
       }
       else {
           w.matchText = w.source.substring(w.matchStart,w.matchStart+off);
           strArr.push(w.matchText.substring(strArr[0].length,w.matchText.length-endex[0].length));
           strArr.push(endex[0]);
           w.matchLength = w.matchText.length;
           w.nextMatch = w.matchStart + w.matchLength;
           formattingHandler(w,strArr);
       }
    };
    return formatterResult;
}

// Here's a simplified variation that takes a string substitution function.
config.macros.nestedFormatter.substAndWikify = 
  function(fname, openTag, closeTag, stringFun) {
   return (
    config.macros.nestedFormatter.getFormatter(
      fname,openTag,closeTag,
      function (w,s) {
	wikify(stringFun(s[1]),w.output,null,w.tiddler);
      }));
  };
 
// Example:
config.formatters.push(
 config.macros.nestedFormatter.getFormatter(&quot;paren&quot;,&quot;\\(#&quot;,&quot;#\\)&quot;,function(w,s){
 var elem = createTiddlyElement(w.output,&quot;span&quot;)
 wikify(s[1],elem,null,w.tiddler);
 elem.style.fontSize = &quot;120%&quot;;
}));

//}}}</pre>
</div>
<div title="NestedSlidersPlugin" modifier="Conal Elliott" created="200610240616" tags="systemConfig">
<pre>/***
|''Name:''|NestedSlidersPlugin|
|''Source:''|http://www.TiddlyTools.com/#NestedSlidersPlugin|
|''Author:''|Eric Shulman - ELS Design Studios|
|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|''~CoreVersion:''|2.0.10|

Quickly make any tiddler content into an expandable 'slider' panel, without needing to create a separate tiddler to contain the slider content.  Optional syntax allows ''default to open'', ''custom button label/tooltip'' and ''automatic blockquote formatting.''

You can also 'nest' these sliders as deep as you like (see complex nesting example below), so that expandable 'tree-like' hierarchical displays can be created.  This is most useful when converting existing in-line text content to create in-line annotations, footnotes, context-sensitive help, or other subordinate information displays.

For more details, please click on a section headline below:
++++!!!!![Configuration]&gt;
Debugging messages for 'lazy sliders' deferred rendering:
&lt;&lt;option chkDebugLazySliderDefer&gt;&gt; show debugging alert when deferring slider rendering
&lt;&lt;option chkDebugLazySliderRender&gt;&gt; show debugging alert when deferred slider is actually rendered
===
++++!!!!![Usage]&gt;
When installed, this plugin adds new wiki syntax for embedding 'slider' panels directly into tiddler content.  Use {{{+++}}} and {{{===}}} to delimit the slider content.  Additional optional syntax elements let you specify
*default to open
*cookiename
*heading level
*floater (with optional CSS width value)
*mouse auto rollover
*custom class/label/tooltip/accesskey
*automatic blockquote
*deferred rendering
The complete syntax, using all options, is:
//{{{
++++(cookiename)!!!!!^width^*{{class{[label=key|tooltip]}}}&gt;...
content goes here
===
//}}}
where:
* {{{+++}}} (or {{{++++}}}) and {{{===}}}^^
marks the start and end of the slider definition, respectively.  When the extra {{{+}}} is used, the slider will be open when initially displayed.^^
* {{{(cookiename)}}}^^
saves the slider opened/closed state, and restores this state whenever the slider is re-rendered.^^
* {{{!}}} through {{{!!!!!}}}^^
displays the slider label using a formatted headline (Hn) style instead of a button/link style^^
* {{{^width^}}} (or just {{{^}}})^^
makes the slider 'float' on top of other content rather than shifting that content downward.  'width' must be a valid CSS value (e.g., &quot;30em&quot;, &quot;180px&quot;, &quot;50%&quot;, etc.).  If omitted, the default width is &quot;auto&quot; (i.e., fit to content)^^
* {{{*}}}^^
automatically opens/closes slider on &quot;rollover&quot; as well as when clicked^^
* {{{{{class{[label=key|tooltip]}}}}}}^^
uses custom label/tooltip/accesskey.  {{{{{class{...}}}}}}, {{{=key}}} and {{{|tooltip}}} are optional.  'class' is any valid CSS class name, used to style the slider label text.  'key' must be a ''single letter only''.  Default labels/tootips are: &quot;&gt;&quot; (more) and &quot;&lt;&quot; (less), with no default access key assignment.^^
* {{{&quot;&gt;&quot;}}} //(without the quotes)//^^
automatically adds blockquote formatting to slider content^^
* {{{&quot;...&quot;}}} //(without the quotes)//^^
defers rendering of closed sliders until the first time they are opened.  //Note: deferred rendering may produce unexpected results in some cases.  Use with care.//^^

//Note: to make slider definitions easier to read and recognize when editing a tiddler, newlines immediately following the {{{+++}}} 'start slider' or preceding the {{{===}}} 'end slider' sequence are automatically supressed so that excess whitespace is eliminated from the output.//
===
++++!!!!![Examples]&gt;
simple in-line slider: 
{{{
+++
   content
===
}}}
+++
   content
===
----
use a custom label and tooltip: 
{{{
+++[label|tooltip]
   content
===
}}}
+++[label|tooltip]
   content
===
----
content automatically blockquoted: 
{{{
+++&gt;
   content
===
}}}
+++&gt;
   content
===
----
all options combined //(default open, cookie, heading, sized floater, rollover, class, label/tooltip/key, blockquoted, deferred)//
{{{
++++(testcookie)!!!^30em^*{{big{[label=Z|click or press Alt-Z to open]}}}&gt;...
   content
===
}}}
++++(testcookie)!!!^30em^*{{big{[label=Z|click or press Alt-Z to open]}}}&gt;...
   content
===
----
complex nesting example:
{{{
+++^[get info...=I|click for information or press Alt-I]
   put some general information here, plus a floating slider with more specific info:
   +++^10em^[view details...|click for details]
      put some detail here, which could include a rollover with a +++^25em^*[glossary definition]explaining technical terms===
   ===
===
}}}
+++^[get info...=I|click for information or press Alt-I]
   put some general information here, plus a floating slider with more specific info:
   +++^10em^[view details...|click for details]
      put some detail here, which could include a rollover with a +++^25em^*[glossary definition]explaining technical terms===
   ===
===
===
!!!!!Installation
&lt;&lt;&lt;
import (or copy/paste) the following tiddlers into your document:
''NestedSlidersPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)
&lt;&lt;&lt;
!!!!!Revision History
&lt;&lt;&lt;
''2006.07.28 - 2.0.0'' added custom class syntax around label/tip/key syntax: {{{{{classname{[label=key|tip]}}}}}}
''2006.07.25 - 1.9.3'' when parsing slider, save default open/closed state in button element, then in onClickNestedSlider(), if slider state matches saved default, instead of saving cookie, delete it.  Significantly reduces the 'cookie overhead' when default slider states are used.
''2006.06.29 - 1.9.2'' in onClickNestedSlider(), when setting focus to first control, skip over type=&quot;hidden&quot;
''2006.06.22 - 1.9.1'' added panel.defaultPanelWidth to save requested panel width, even after resizing has changed the style value
''2006.05.11 - 1.9.0'' added optional '^width^' syntax for floating sliders and '=key' syntax for setting an access key on a slider label
''2006.05.09 - 1.8.0'' in onClickNestedSlider(), when showing panel, set focus to first child input/textarea/select element
''2006.04.24 - 1.7.8'' in adjustSliderPos(), if floating panel is contained inside another floating panel, subtract offset of containing panel to find correct position
''2006.02.16 - 1.7.7'' corrected deferred rendering to account for use-case where show/hide state is tracked in a cookie
''2006.02.15 - 1.7.6'' in adjustSliderPos(), ensure that floating panel is positioned completely within the browser window (i.e., does not go beyond the right edge of the browser window)
''2006.02.04 - 1.7.5'' add 'var' to unintended global variable declarations to avoid FireFox 1.5.0.1 crash bug when assigning to globals
''2006.01.18 - 1.7.4'' only define adjustSliderPos() function if it has not already been provided by another plugin.  This lets other plugins 'hijack' the function even when they are loaded first.
''2006.01.16 - 1.7.3'' added adjustSliderPos(place,btn,panel,panelClass) function to permit specialized logic for placement of floating panels.  While it provides improved placement for many uses of floating panels, it exhibits a relative offset positioning error when used within *nested* floating panels.  Short-term workaround is to only adjust the position for 'top-level' floaters.
''2006.01.16 - 1.7.2'' added button property to slider panel elements so that slider panel can tell which button it belongs to.  Also, re-activated and corrected animation handling so that nested sliders aren't clipped by hijacking Slider.prototype.stop so that &quot;overflow:hidden&quot; can be reset to &quot;overflow:visible&quot; after animation ends
''2006.01.14 - 1.7.1'' added optional &quot;^&quot; syntax for floating panels.  Defines new CSS class, &quot;.floatingPanel&quot;, as an alternative for standard in-line &quot;.sliderPanel&quot; styles.
''2006.01.14 - 1.7.0'' added optional &quot;*&quot; syntax for rollover handling to show/hide slider without requiring a click (Based on a suggestion by tw4efl)
''2006.01.03 - 1.6.2'' When using optional &quot;!&quot; heading style, instead of creating a clickable &quot;Hn&quot; element, create an &quot;A&quot; element inside the &quot;Hn&quot; element.  (allows click-through in SlideShowPlugin, which captures nearly all click events, except for hyperlinks)
''2005.12.15 - 1.6.1'' added optional &quot;...&quot; syntax to invoke deferred ('lazy') rendering for initially hidden sliders
removed checkbox option for 'global' application of lazy sliders
''2005.11.25 - 1.6.0'' added optional handling for 'lazy sliders' (deferred rendering for initially hidden sliders)
''2005.11.21 - 1.5.1'' revised regular expressions: if present, a single newline //preceding// and/or //following// a slider definition will be suppressed so start/end syntax can be place on separate lines in the tiddler 'source' for improved readability.  Similarly, any whitespace (newlines, tabs, spaces, etc.) trailing the 'start slider' syntax or preceding the 'end slider' syntax is also suppressed.
''2005.11.20 - 1.5.0'' added (cookiename) syntax for optional tracking and restoring of slider open/close state
''2005.11.11 - 1.4.0'' added !!!!! syntax to render slider label as a header (Hn) style instead of a button/link style
''2005.11.07 - 1.3.0'' removed alternative syntax {{{(((}}} and {{{)))}}} (so they can be used by other
formatting extensions) and simplified/improved regular expressions to trim multiple excess newlines
''2005.11.05 - 1.2.1'' changed name to NestedSlidersPlugin
more documentation
''2005.11.04 - 1.2.0'' added alternative character-mode syntax {{{(((}}} and {{{)))}}}
tweaked &quot;eat newlines&quot; logic for line-mode {{{+++}}} and {{{===}}} syntax
''2005.11.03 - 1.1.1'' fixed toggling of default tooltips (&quot;more...&quot; and &quot;less...&quot;) when a non-default button label is used
code cleanup, added documentation
''2005.11.03 - 1.1.0'' changed delimiter syntax from {{{(((}}} and {{{)))}}} to {{{+++}}} and {{{===}}}
changed name to EasySlidersPlugin
''2005.11.03 - 1.0.0'' initial public release
&lt;&lt;&lt;
!!!!!Credits
&lt;&lt;&lt;
This feature was implemented by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]] with initial research and suggestions from RodneyGomes, GeoffSlocock, and PaulPetterson.
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.nestedSliders = {major: 2, minor: 0, revision: 0, date: new Date(2006,7,28)};
//}}}

//{{{
// options for deferred rendering of sliders that are not initially displayed
if (config.options.chkDebugLazySliderDefer==undefined) config.options.chkDebugLazySliderDefer=false;
if (config.options.chkDebugLazySliderRender==undefined) config.options.chkDebugLazySliderRender=false;

// default styles for 'floating' class
setStylesheet(&quot;.floatingPanel { position:absolute; z-index:10; padding:0.5em; margin:0em; \
	background-color:#eee; color:#000; border:1px solid #000; text-align:left; }&quot;,&quot;floatingPanelStylesheet&quot;);
//}}}

//{{{
config.formatters.push( {
	name: &quot;nestedSliders&quot;,
	match: &quot;\\n?\\+{3}&quot;,
	terminator: &quot;\\s*\\={3}\\n?&quot;,
	lookahead: &quot;\\n?\\+{3}(\\+)?(\\([^\\)]*\\))?(\\!*)?(\\^(?:[^\\^\\*\\[\\&gt;]*\\^)?)?(\\*)?(?:\\{\\{([\\w]+[\\s\\w]*)\\{)?(\\[[^\\]]*\\])?(?:\\}{3})?(\\&gt;)?(\\.\\.\\.)?\\s*&quot;,
	handler: function(w)
		{
			// defopen=lookaheadMatch[1]
			// cookiename=lookaheadMatch[2]
			// header=lookaheadMatch[3]
			// panelwidth=lookaheadMatch[4]
			// rollover=lookaheadMatch[5]
			// class=lookaheadMatch[6]
			// label=lookaheadMatch[7]
			// blockquote=lookaheadMatch[8]
			// deferred=lookaheadMatch[9]

			 lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source)
			if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart)
			{
				// location for rendering button and panel
				var place=w.output;

				// default to closed, no cookie, no accesskey
				var show=&quot;none&quot;; var title=&quot;&gt;&quot;; var tooltip=&quot;show&quot;; var cookie=&quot;&quot;; var key=&quot;&quot;;

				// extra &quot;+&quot;, default to open
				if (lookaheadMatch[1])
					{ show=&quot;block&quot;; title=&quot;&lt;&quot;; tooltip=&quot;hide&quot;; }

				// cookie, use saved open/closed state
				if (lookaheadMatch[2]) {
					cookie=lookaheadMatch[2].trim().slice(1,-1);
					cookie=&quot;chkSlider&quot;+cookie;
					if (config.options[cookie]==undefined)
						{ config.options[cookie] = (show==&quot;block&quot;) }
					if (config.options[cookie])
						{ show=&quot;block&quot;; title=&quot;&lt;&quot;; tooltip=&quot;hide&quot;; }
					else
						{ show=&quot;none&quot;; title=&quot;&gt;&quot;; tooltip=&quot;show&quot;; }
				}

				// parse custom label/tooltip/accesskey: [label=X|tooltip]
				if (lookaheadMatch[7]) {
					title = lookaheadMatch[7].trim().slice(1,-1);
					var pos=title.indexOf(&quot;|&quot;);
					if (pos!=-1) { tooltip = title.substr(pos+1,title.length); title=title.substr(0,pos); }
					if (title.substr(title.length-2,1)==&quot;=&quot;) { key=title.substr(title.length-1,1); title=title.slice(0,-2); }
					if (pos==-1) tooltip += &quot; &quot;+title; // default tooltip: &quot;show/hide &lt;title&gt;&quot;
				}

				// create the button
				if (lookaheadMatch[3]) { // use &quot;Hn&quot; header format instead of button/link
					var lvl=(lookaheadMatch[3].length&gt;6)?6:lookaheadMatch[3].length;
					var btn = createTiddlyElement(createTiddlyElement(place,&quot;h&quot;+lvl,null,null,null),&quot;a&quot;,null,lookaheadMatch[6],title);
					btn.onclick=onClickNestedSlider;
					btn.setAttribute(&quot;href&quot;,&quot;javascript:;&quot;);
					btn.setAttribute(&quot;title&quot;,tooltip);
				}
				else
					var btn = createTiddlyButton(place,title,tooltip,onClickNestedSlider,lookaheadMatch[6]);

				// set extra button attributes
				btn.sliderCookie = cookie; // save the cookiename (if any) in the button object
				btn.defOpen=lookaheadMatch[1]!=null; // save default open/closed state (boolean)
				btn.keyparam=key; // save the access key letter (&quot;&quot; if none)
				if (key.length) {
					btn.setAttribute(&quot;accessKey&quot;,key); // init access key
					btn.onfocus=function(){this.setAttribute(&quot;accessKey&quot;,this.keyparam);}; // **reclaim** access key on focus
				}

				// &quot;non-click&quot; MouseOver open/close slider
				if (lookaheadMatch[5]) btn.onmouseover=onClickNestedSlider;

				// create slider panel
				var panelClass=lookaheadMatch[4]?&quot;floatingPanel&quot;:&quot;sliderPanel&quot;;
				var panel=createTiddlyElement(place,&quot;div&quot;,null,panelClass,null);
				panel.button = btn; // so the slider panel know which button it belongs to
				panel.defaultPanelWidth=(lookaheadMatch[4] &amp;&amp; lookaheadMatch[4].length&gt;2)?lookaheadMatch[4].slice(1,-1):&quot;&quot;; // save requested panel size
				btn.sliderPanel=panel;
				panel.style.display = show;
				panel.style.width=panel.defaultPanelWidth;

				// render slider (or defer until shown) 
				w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
				if ((show==&quot;block&quot;)||!lookaheadMatch[9]) {
					// render now if panel is supposed to be shown or NOT deferred rendering
					w.subWikify(lookaheadMatch[8]?createTiddlyElement(panel,&quot;blockquote&quot;):panel,this.terminator);
					// align slider/floater position with button
					adjustSliderPos(place,btn,panel,panelClass);
				}
				else {
					var src = w.source.substr(w.nextMatch);
					var endpos=findMatchingDelimiter(src,&quot;+++&quot;,&quot;===&quot;);
					panel.setAttribute(&quot;raw&quot;,src.substr(0,endpos));
					panel.setAttribute(&quot;blockquote&quot;,lookaheadMatch[8]?&quot;true&quot;:&quot;false&quot;);
					panel.setAttribute(&quot;rendered&quot;,&quot;false&quot;);
					w.nextMatch += endpos+3;
					if (w.source.substr(w.nextMatch,1)==&quot;\n&quot;) w.nextMatch++;
					if (config.options.chkDebugLazySliderDefer) alert(&quot;deferred '&quot;+title+&quot;':\n\n&quot;+panel.getAttribute(&quot;raw&quot;));
				}
			}
		}
	}
)

// TBD: ignore 'quoted' delimiters (e.g., &quot;{{{+++foo===}}}&quot; isn't really a slider)
function findMatchingDelimiter(src,starttext,endtext) {
	var startpos = 0;
	var endpos = src.indexOf(endtext);
	// check for nested delimiters
	while (src.substring(startpos,endpos-1).indexOf(starttext)!=-1) {
		// count number of nested 'starts'
		var startcount=0;
		var temp = src.substring(startpos,endpos-1);
		var pos=temp.indexOf(starttext);
		while (pos!=-1)  { startcount++; pos=temp.indexOf(starttext,pos+starttext.length); }
		// set up to check for additional 'starts' after adjusting endpos
		startpos=endpos+endtext.length;
		// find endpos for corresponding number of matching 'ends'
		while (startcount &amp;&amp; endpos!=-1) {
			endpos = src.indexOf(endtext,endpos+endtext.length);
			startcount--;
		}
	}
	return (endpos==-1)?src.length:endpos;
}
//}}}

//{{{
window.onClickNestedSlider=function(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var theLabel = theTarget.firstChild.data;
	var theSlider = theTarget.sliderPanel
	var isOpen = theSlider.style.display!=&quot;none&quot;;
	// if using default button labels, toggle labels
	if (theLabel==&quot;&gt;&quot;) theTarget.firstChild.data = &quot;&lt;&quot;;
	else if (theLabel==&quot;&lt;&quot;) theTarget.firstChild.data = &quot;&gt;&quot;;
	// if using default tooltips, toggle tooltips
	if (theTarget.getAttribute(&quot;title&quot;)==&quot;show&quot;)
		theTarget.setAttribute(&quot;title&quot;,&quot;hide&quot;);
	else if (theTarget.getAttribute(&quot;title&quot;)==&quot;hide&quot;)
		theTarget.setAttribute(&quot;title&quot;,&quot;show&quot;);
	if (theTarget.getAttribute(&quot;title&quot;)==&quot;show &quot;+theLabel)
		theTarget.setAttribute(&quot;title&quot;,&quot;hide &quot;+theLabel);
	else if (theTarget.getAttribute(&quot;title&quot;)==&quot;hide &quot;+theLabel)
		theTarget.setAttribute(&quot;title&quot;,&quot;show &quot;+theLabel);
	// deferred rendering (if needed)
	if (theSlider.getAttribute(&quot;rendered&quot;)==&quot;false&quot;) {
		if (config.options.chkDebugLazySliderRender)
			alert(&quot;rendering '&quot;+theLabel+&quot;':\n\n&quot;+theSlider.getAttribute(&quot;raw&quot;));
		var place=theSlider;
		if (theSlider.getAttribute(&quot;blockquote&quot;)==&quot;true&quot;)
			place=createTiddlyElement(place,&quot;blockquote&quot;);
		wikify(theSlider.getAttribute(&quot;raw&quot;),place);
		theSlider.setAttribute(&quot;rendered&quot;,&quot;true&quot;);
	}
	// show/hide the slider
	if(config.options.chkAnimate)
		anim.startAnimating(new Slider(theSlider,!isOpen,e.shiftKey || e.altKey,&quot;none&quot;));
	else
		theSlider.style.display = isOpen ? &quot;none&quot; : &quot;block&quot;;
	// reset to default width (might have been changed via plugin code)
	theSlider.style.width=theSlider.defaultPanelWidth;
	// align slider/floater position with target button
	if (!isOpen) adjustSliderPos(theSlider.parentNode,theTarget,theSlider,theSlider.className);
	// if showing panel, set focus to first 'focus-able' element in panel
	if (theSlider.style.display!=&quot;none&quot;) {
		var ctrls=theSlider.getElementsByTagName(&quot;*&quot;);
		for (var c=0; c&lt;ctrls.length; c++) {
			var t=ctrls[c].tagName.toLowerCase();
			if ((t==&quot;input&quot; &amp;&amp; ctrls[c].type!=&quot;hidden&quot;) || t==&quot;textarea&quot; || t==&quot;select&quot;)
				{ ctrls[c].focus(); break; }
		}
	}
	if (this.sliderCookie &amp;&amp; this.sliderCookie.length) {
		config.options[this.sliderCookie]=!isOpen;
		if (config.options[this.sliderCookie]!=this.defOpen)
			saveOptionCookie(this.sliderCookie);
		else { // remove cookie if slider is in default display state
			var ex=new Date(); ex.setTime(ex.getTime()-1000);
			document.cookie = this.sliderCookie+&quot;=novalue; path=/; expires=&quot;+ex.toGMTString();
		}
	}
	return false;
}

// hijack animation handler 'stop' handler so overflow is visible after animation has completed
Slider.prototype.coreStop = Slider.prototype.stop;
Slider.prototype.stop = function() { this.coreStop(); this.element.style.overflow = &quot;visible&quot;; }

// adjust panel position based on button position
if (window.adjustSliderPos==undefined) window.adjustSliderPos=function(place,btn,panel,panelClass) {
	if (panelClass==&quot;floatingPanel&quot;) {
		var left=0;
		var top=btn.offsetHeight; 
		if (place.style.position!=&quot;relative&quot;) {
			var left=findPosX(btn);
			var top=findPosY(btn)+btn.offsetHeight;
			var p=place; while (p &amp;&amp; p.className!='floatingPanel') p=p.parentNode;
			if (p) { left-=findPosX(p); top-=findPosY(p); }
		}
		if (left+panel.offsetWidth &gt; getWindowWidth()) left=getWindowWidth()-panel.offsetWidth-10;
		panel.style.left=left+&quot;px&quot;; panel.style.top=top+&quot;px&quot;;
	}
}

function getWindowWidth() {
	if(document.width!=undefined)
		return document.width; // moz (FF)
	if(document.documentElement &amp;&amp; ( document.documentElement.clientWidth || document.documentElement.clientHeight ) )
		return document.documentElement.clientWidth; // IE6
	if(document.body &amp;&amp; ( document.body.clientWidth || document.body.clientHeight ) )
		return document.body.clientWidth; // IE4
	if(window.innerWidth!=undefined)
		return window.innerWidth; // IE - general
	return 0; // unknown
}
//}}}</pre>
</div>
<div title="PageTemplate" modifier="Conal Elliott" modified="200709050343" created="200709050342" changecount="2">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
	&lt;div class='headerShadow'&gt;
		&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
		&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
	&lt;/div&gt;
	&lt;div class='headerForeground'&gt;
		&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
		&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
	&lt;/div&gt;
&lt;/div&gt;
&lt;!-- horizontal MainMenu --&gt;
&lt;div id='topMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
	&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
	&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
	&lt;div id='messageArea'&gt;&lt;/div&gt;
	&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="Pajama" modifier="Conal Elliott" modified="200612210246" created="200612210243" tags="project 2006-12-20">
<pre>Here are some thoughts on releasing [[Pajama|http://conal.net/Pajama]] as an open source software project.

When released, there may be bits of code that I did for Pan while at Microsoft.  I think the MS license required that people give the modifications back to MS.  Releasing Pajama in source satisfies that agreement.  And MS is unlikely to care.

The main unwritten part is the representation of expressions and simplification.  When ~GADTs are improved, I think I'll be able to rewrite the expression implementation more nicely, with just one layer rather than three, and with static typing throughout.

Factor the implementation into some reusable libraries.  Document these pieces with Haddock and written papers (tech reports, at least).  Encourage people to use them for things other than Pajama, and invite collaboration for improving them.  Libraries:
* The supporting Java library (maybe split into generic and Image-oriented)
* Expressions with simplification and CSE
* Java code generation tools
* Compiling Pajama expressions into Java code
* Images and related types
Target [[GIMP|gimp.org]] plugins.  Maybe use an ahead-of-time Java compiler (e.g., [[gcj|http://gcc.gnu.org/java]]) and some way to speed up array accesses and trig, assuming the Tiger language features are supported.  Switching back to C++ would probably be pretty painful at this point, given my reliance on garbage collection and anonymous inner classes.
</pre>
</div>
<div title="Phooey" modifier="Conal Elliott" modified="200701250349" created="200611182235" tags="2006-11-18 project">
<pre>*''Next action'':
* To do ++++
*  Consider moving examples from the Haddock docs to the wiki.
*  Follow the [[project release check-list]].
*  Revisit the paper draft.  Improve. +++
*   De-emphasize the recursive examples.  Move them to a later section.
*   Perhaps start with the arrow-functional rather than imperative form.
*   Clearly state the Phooey's strengths ++++
*    Purely functional interface/semantics
*    Naturalness: implementation dependencies mirror logical dependencies
*    Efficiency (not there yet)
*    Layout flexibility 
*    Systematic transformation of imperative into declarative (strength of  paper, rather than system)
    === 
*   Paper outline +++
*    Intro with Phooey example and imperative counterpart
*    Examples, types
*    A functional //monadic// variation.  Explain why the monadic version  introduces value //sources//, while the arrow version doesn't.
*    From monad to arrow
*    Deconstructing the UI monad: skip some details.  Postpone layout.
*    Conclusion
    === 
   === 
  === 
* Done +++
*  Fix the layout bug in ui3.  Push changes to server.
*  Release Phooey-0.1.
*  Move example images to the haskell wiki.
*  Add to wiki page: motivation and tie to TV.
*  Re-read comments I got after my first Phooey release.  Improve explanation.
*  Change location of library docs on server.
*  Redo my web page as a Wiki and set up a redirect.
*  Web pointers for doc refs.
*  Docs with source &amp; comment pointers
*  Explore applying some of [[haddock for library illustration]]
*  Learn about cabal, and use it.
*  Make a source release and announce
  === 
</pre>
</div>
<div title="RSSReaderPlugin" modifier="Conal Elliott" created="200610260007" tags="systemConfig plugin RSSExtensions">
<pre>/***
|''Name:''|RSSReaderPlugin|
|''Description:''|This plugin provides a RSSReader for TiddlyWiki|
|''Version:''|0.3.0|
|''Date:''|Aug 24, 2006|
|''Source:''|http://tiddlywiki.bidix.info/#RSSReaderPlugin|
|''Documentation:''|http://tiddlywiki.bidix.info/#RSSReaderPluginDoc|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''Credit:''|BramChen for RssNewsMacro|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.0.0|
|''Browser:''|Firefox 1.5; InternetExplorer 6.0; Safari|
|''Include:''|none|
|''Require:''|none|
***/
//{{{
version.extensions.RSSReaderPlugin = {
	major: 0, minor: 3, revision: 0,
	date: new Date(&quot;Aug 24, 2006&quot;),
	author: &quot;BidiX&quot;,
	credit: &quot;BramChen for RssNewsMacro&quot;,
	source: &quot;http://TiddlyWiki.bidix.info/#RSSReaderPlugin&quot;,
	documentation : &quot;http://TiddlyWiki.bidix.info/#RSSReaderPluginDoc&quot;,
	author: 'BidiX (BidiX (at) bidix (dot) info',
	license: '[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D]]',
	coreVersion: '2.0.0',
	browser: 'Firefox 1.5; InternetExplorer 6.0; Safari'	
};

config.macros.rssReader = {
	dateFormat: &quot;DDD, DD MMM YYYY&quot;,
	itemStyle: &quot;display: block;border: 1px solid black;padding: 5px;margin: 5px;&quot;, //useed  '@@'+itemStyle+itemText+'@@'
	msg:{
		permissionDenied: &quot;Permission to read preferences was denied.&quot;,
		noRSSFeed: &quot;No RSS Feed at this address %0&quot;,
		urlNotAccessible: &quot; Access to %0 is not allowed&quot;
	},
	cache: [], 	// url =&gt; request
	desc: &quot;noDesc&quot;,
	// feedURL: &quot;&quot;,
	place:&quot;&quot;,
	handler: function(place,macroName,params,wikifier,paramString,tiddler){
		var desc = params[0];
		var feedURL = params[1];
		// var toFilter = (params[2] ? params[2] : false);
		var toFilter = false;
		var filterString;
		if (params[2] != undefined) {
			toFilter = true;
			if (params[2].match(/\w+/))
				filterString = params[2];
			else
				filterString = tiddler.title;
		}
		var place = createTiddlyElement(place, &quot;div&quot;, &quot;RSSReader&quot;);
		wikify(&quot;^^&lt;&lt;rssFeedUpdate &quot;+feedURL+&quot; [[&quot; + tiddler.title + &quot;]]&gt;&gt;^^\n&quot;,place);
		if (this.cache[feedURL]) {
			this.processResponse(this.cache[feedURL], feedURL, place, desc, toFilter, filterString);
		}
		else {
			this.asyncGet(feedURL, place, desc, toFilter, filterString);
		}
	},

	asyncGet: function (feedURL, place, desc, toFilter, filterString){
		var xmlhttp;
		try {xmlhttp=new XMLHttpRequest();}
		catch (e) {
			try {xmlhttp = new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;);}
			catch (e) {
				try {xmlhttp = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);}
				catch (e) { displayMessage(e.description?e.description:e.toString());}
			}
		}
		if (!xmlhttp){
			return;
		}
		if (window.netscape){
			try {
				if (document.location.protocol.indexOf(&quot;http&quot;) == -1) {
 					netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalBrowserRead&quot;);
				}
			}
			catch (e) { displayMessage(e.description?e.description:e.toString()); }
		}
		xmlhttp.onreadystatechange=function (){
			if (xmlhttp.readyState==4) {
				if (xmlhttp.status==200 || xmlhttp.status===0) {
					config.macros.rssReader.processResponse(xmlhttp, feedURL, place, desc, toFilter, filterString);
				}
				else {
					displayMessage(&quot;Problem retrieving XML data:&quot; + xmlhttp.statusText);
				}
			}
		};
		try {
			xmlhttp.open(&quot;GET&quot;,feedURL,true);
			if (config.browser.isIE) {
				xmlhttp.send();
			}
			else {
				xmlhttp.send(null);
			}
		}
		catch (e) {
			wikify(e.toString()+this.urlNotAccessible.format([feedURL]), place);
		}
	},
	processResponse: function(xmlhttp, feedURL, place, desc, toFilter, filterString){	
		if (window.netscape){
			try {
				if (document.location.protocol.indexOf(&quot;http&quot;) == -1) {
					netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalBrowserRead&quot;);
				}
			}
			catch (e) { displayMessage(e.description?e.description:e.toString()); }
		}
		if (xmlhttp.responseXML){
			this.cache[feedURL] = xmlhttp;
			this.genRssNews(xmlhttp.responseXML, place, feedURL, desc, toFilter, filterString);
		}
		else {
			var dom = (new DOMParser()).parseFromString(xmlhttp.responseText, &quot;text/xml&quot;); 
			if (dom) {
				this.cache[feedURL] = xmlhttp;
				this.genRssNews(dom, place, feedURL, desc, toFilter, filterString);
			}
			else {
				wikify(&quot;&lt;html&gt;&quot;+xmlhttp.responseText+&quot;&lt;/html&gt;&quot;, place);
				displayMessage(this.msg.noRSSFeed.format([feedURL]));
			}
		}
	},
	genRssNews: function(xml, place, feedURL, desc, toFilter, filterString){
		// Channel
		var chanelNode = xml.getElementsByTagName('channel').item(0);
		var chanelTitleElement = (chanelNode ? chanelNode.getElementsByTagName('title').item(0) : null);
		var chanelTitle = &quot;&quot;;
		if ((chanelTitleElement) &amp;&amp; (chanelTitleElement.firstChild)) chanelTitle = chanelTitleElement.firstChild.nodeValue;
		var chanelLinkElement = (chanelNode ? chanelNode.getElementsByTagName('link').item(0) : null);
		var chanelLink = &quot;&quot;;
		if (chanelLinkElement) chanelLink = chanelLinkElement.firstChild.nodeValue;
		var titleTxt = &quot;!![[&quot;+chanelTitle+&quot;|&quot;+chanelLink+&quot;]]\n&quot;;
		var title = createTiddlyElement(place,&quot;div&quot;,null,&quot;ChanelTitle&quot;,null);
		wikify(titleTxt,title);
		// ItemList
		var itemList = xml.getElementsByTagName('item');
		var article = createTiddlyElement(place,&quot;ul&quot;,null,null,null);
		var lastDate;
		var re;
		if (toFilter) 
			re = new RegExp(filterString.escapeRegExp());
		for (var i=0; i&lt;itemList.length; i++){
			var titleElm = itemList[i].getElementsByTagName('title').item(0);
			var titleText = (titleElm ? titleElm.firstChild.nodeValue : '');
			if (toFilter &amp;&amp; ! titleText.match(re)) {
				continue;
			}
			var descText = '';
			var isWikitext = false;
			var descElem = itemList[i].getElementsByTagName('wikitext').item(0);
			if (descElem){
				try{
					isWikitext = true;
					descText = &quot;\n&quot;+descElem.firstChild.nodeValue;}
					catch(e){}
			}
			else {
				descElem = itemList[i].getElementsByTagName('encoded').item(0);
				if (descElem){
					try{descText = descElem.firstChild.nodeValue;}
						catch(e){}
					descText = &quot;&lt;html&gt;&quot;+descText+&quot;&lt;/html&gt;&quot;;
				}
				else {
					descElem = itemList[i].getElementsByTagName('description').item(0);
					if (descElem){
						try{descText = descElem.firstChild.nodeValue;}
						catch(e){}
						descText = descText.replace(/&lt;br \/&gt;/g,'\n');
						if (desc == &quot;asHtml&quot;)
							descText = &quot;&lt;html&gt;&quot;+descText+&quot;&lt;/html&gt;&quot;;
					}
				}
			}
			var linkElm = itemList[i].getElementsByTagName(&quot;link&quot;).item(0);
			var linkURL = linkElm.firstChild.nodeValue;
			var pubElm = itemList[i].getElementsByTagName('pubDate').item(0);
			var pubDate;
			if (!pubElm) {
				pubElm = itemList[i].getElementsByTagName('date').item(0); // for del.icio.us
				if (pubElm) {
					pubDate = pubElm.firstChild.nodeValue;
					pubDate = this.formatDateString(this.dateFormat, pubDate);
					}
					else {
						pubDate = '0';
					}
				}
			else {
				pubDate = (pubElm ? pubElm.firstChild.nodeValue : 0);
				pubDate = this.formatString(this.dateFormat, pubDate);
			}
			titleText = titleText.replace(/\[|\]/g,'');
			var rssText = '** '+'[[' + titleText + '|' + linkURL + ']]' + '\n' ;
			if ((desc != &quot;noDesc&quot;) &amp;&amp; descText){
				if (version.extensions.nestedSliders){
					rssText = rssText.replace(/\n/g,' ');
					descText = '+++[...]\n'
						+(isWikitext ? '\n&lt;&lt;rssFeedImportTiddler '+ feedURL + ' [['+titleText+']]&gt;&gt;':'')
						+'@@'+this.itemStyle+descText+'\n@@\n'
						+'===';
					}
				rssText = rssText + descText + '\n\n';
			}
			var story;
			if ((lastDate != pubDate) &amp;&amp; ( pubDate != '0')) {
				story = createTiddlyElement(article,&quot;li&quot;,null,&quot;RSSItem&quot;,pubDate);
				lastDate = pubDate;
			}
			else {
				lastDate = pubDate;
			}
			story = createTiddlyElement(article,&quot;div&quot;,null,&quot;RSSItem&quot;,null);
			wikify(rssText,story);
		}
	},
	formatString: function(template, theDate){
		var dateString = new Date(theDate);
		template = template.replace(/hh|mm|ss/g,'');
		return dateString.formatString(template);
	},
	formatDateString: function(template, theDate){
		var dateString = new Date(theDate.substr(0,4), theDate.substr(5,2) - 1, theDate.substr(8,2)
			/*,  theDate.substr(11,2), theDate.substr(14,2), theDate.substr(17,2)*/
			);
		return dateString.formatString(template);
	}
	
};
//}}}

//{{{
config.macros.rssFeedUpdate = {
	label: &quot;Update&quot;,
	prompt: &quot;Clear the cache and redisplay this RssFeed&quot;,
	handler: function(place,macroName,params) {
		var feedURL = params[0];
		var tiddlerTitle = params[1];
		createTiddlyButton(place, this.label, this.prompt, 
			function () {
				if (config.macros.rssReader.cache[feedURL]) {
					config.macros.rssReader.cache[feedURL] = null; 
					//story.refreshTiddler(tiddlerTitle,null, true);
			}
			story.refreshTiddler(tiddlerTitle,null, true);
		return false;});
	}
};
//}}}

//{{{
config.macros.rssFeedImportTiddler = {
	label: &quot;Import&quot;,
	prompt: &quot;Import this tiddler in this TiddlyWiki&quot;,
	askReplaceMsg: &quot;Tiddler already exists, replace it ?&quot;,
	handler: function(place,macroName,params) {
		var  feedUrl = params[0];
		var tiddlerTitle = params[1];
		createTiddlyButton(place, this.label, this.prompt, 
			function () {
				if (feedUrl &amp;&amp; config.macros.rssReader.cache[feedUrl]) {
					var tiddler = config.macros.rssFeedImportTiddler.parseRssNews(config.macros.rssReader.cache[feedUrl].responseXML, tiddlerTitle);
					if (tiddler &amp;&amp; (! store.getTiddler(tiddlerTitle) || confirm(config.macros.rssFeedImportTiddler.askReplaceMsg))) {
						store.addTiddler(tiddler);
						store.notify(tiddler.title, true);
						store.setDirty(true);
					}
				}
			return false;});
	},
	
	// parse a RssFeed for retrieving a Tiddler with title
	parseRssNews: function(xml, title) {
		// ItemList
		if (document.location.protocol.indexOf(&quot;http&quot;) == -1) {
			netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalBrowserRead&quot;);
		}

		var itemList = xml.getElementsByTagName('item');
		for (var i=0; i&lt;itemList.length; i++){

			var titleElm = itemList[i].getElementsByTagName('title').item(0);
			var titleText = titleElm.firstChild.nodeValue;
			if (titleText == title) {
				//	&lt;tiddlywiki:title&gt;
				//	titleText
				titleText = titleText.htmlDecode();
				//	&lt;tiddlywiki:wikitext&gt;
				var elem = itemList[i].getElementsByTagName('wikitext').item(0);
				var text = elem ? elem.firstChild.nodeValue.htmlDecode() : &quot;&quot;;
				//	&lt;tiddlywiki:modifier&gt;
				elem = itemList[i].getElementsByTagName('modifier').item(0);
				var modifier = elem ? elem.firstChild.nodeValue : &quot;&quot;;
				//	&lt;tiddlywiki:modified&gt;
				elem = itemList[i].getElementsByTagName('modified').item(0);
				var modified = elem ? Date.convertFromYYYYMMDDHHMM(elem.firstChild.nodeValue) : &quot;&quot;;
				//	&lt;tiddlywiki:created&gt;
				elem = itemList[i].getElementsByTagName('created').item(0);
				var created = elem ? Date.convertFromYYYYMMDDHHMM(elem.firstChild.nodeValue) : &quot;&quot;;
				//	&lt;tiddlywiki:links&gt;
				//	Links ?
				//	&lt;tiddlywiki:tags&gt;
				elem = itemList[i].getElementsByTagName('tags').item(0);
				var tags = elem ? elem.firstChild.nodeValue.htmlDecode() : &quot;&quot;;
				var tiddler = new Tiddler();
				tiddler.assign(titleText,text,modifier,modified,tags,created);
				return tiddler;
			}
		}
		// not found 
		alert(&quot;Tiddler \[[&quot; + title +&quot;]] notFound.&quot;);
		return null;
	}

};

//}}}
</pre>
</div>
<div title="RearrangeTiddlersPlugin" modifier="Conal Elliott" created="200610282126" tags="systemConfig 2006-10-28">
<pre>/***
|''Name:''|RearrangeTiddlersPlugin|
|''Source:''|http://www.TiddlyTools.com/#AttachFilePlugin|
|''Author:''|Joe Raii|
|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|''~CoreVersion:''|2.0.10|

adapted from: http://www.cs.utexas.edu/~joeraii/dragn/#Draggable
changes by ELS:
* hijack refreshTiddler() instead of overridding createTiddler()
* find title element by className instead of elementID
* set cursor style via code instead of stylesheet
* set tooltip help text
* set tiddler &quot;position:relative&quot; when starting drag event, restore saved value when drag ends
* update 2006.08.07: use getElementsByTagName(&quot;*&quot;) to find title element, even when it is 'buried' deep in tiddler DOM elements (due to custom template usage)

***/
//{{{

Story.prototype.rearrangeTiddlersHijack_refreshTiddler = Story.prototype.refreshTiddler;
Story.prototype.refreshTiddler = function(title,template,unused1,unused2,unused3,unused4,unused5)
{
	this.rearrangeTiddlersHijack_refreshTiddler(title,template,unused1,unused2,unused3,unused4,unused5);
	var theTiddler = document.getElementById(this.idPrefix + title); if (!theTiddler) return;
	var theHandle;
	var children=theTiddler.getElementsByTagName(&quot;*&quot;);
	for (var i=0; i&lt;children.length; i++) if (hasClass(children[i],&quot;title&quot;)) { theHandle=children[i]; break; }
	if (!theHandle) return theTiddler;

	Drag.init(theHandle, theTiddler, 0, 0, null, null);
	theHandle.style.cursor=&quot;move&quot;;
	theHandle.title=&quot;drag title to re-arrange tiddlers&quot;
	theTiddler.onDrag = function(x,y,myElem) {
		if (this.style.position!=&quot;relative&quot;)
			{ this.savedstyle=this.style.position; this.style.position=&quot;relative&quot;; }
		y = myElem.offsetTop;
		var next = myElem.nextSibling;
		var prev = myElem.previousSibling;
		if (next &amp;&amp; y + myElem.offsetHeight &gt; next.offsetTop + next.offsetHeight/2) { 
			myElem.parentNode.removeChild(myElem);
			next.parentNode.insertBefore(myElem, next.nextSibling);//elems[pos+1]);
			myElem.style[&quot;top&quot;] = -next.offsetHeight/2+&quot;px&quot;;
		}
		if (prev &amp;&amp; y &lt; prev.offsetTop + prev.offsetHeight/2) { 
			myElem.parentNode.removeChild(myElem);
			prev.parentNode.insertBefore(myElem, prev);
			myElem.style[&quot;top&quot;] = prev.offsetHeight/2+&quot;px&quot;;
		}
	};
	theTiddler.onDragEnd = function(x,y,myElem) {
		myElem.style[&quot;top&quot;] = &quot;0px&quot;;
		if (this.savedstyle!=undefined)
			this.style.position=this.savedstyle;
	}
	return theTiddler;
}

/**************************************************
 * dom-drag.js
 * 09.25.2001
 * www.youngpup.net
 **************************************************
 * 10.28.2001 - fixed minor bug where events
 * sometimes fired off the handle, not the root.
 **************************************************/

var Drag = {
	obj:null,

	init:
	function(o, oRoot, minX, maxX, minY, maxY) {
		o.onmousedown = Drag.start;
		o.root = oRoot &amp;&amp; oRoot != null ? oRoot : o ;
		if (isNaN(parseInt(o.root.style.left))) o.root.style.left=&quot;0px&quot;;
		if (isNaN(parseInt(o.root.style.top))) o.root.style.top=&quot;0px&quot;;
		o.minX = typeof minX != 'undefined' ? minX : null;
		o.minY = typeof minY != 'undefined' ? minY : null;
		o.maxX = typeof maxX != 'undefined' ? maxX : null;
		o.maxY = typeof maxY != 'undefined' ? maxY : null;
		o.root.onDragStart = new Function();
		o.root.onDragEnd = new Function();
		o.root.onDrag = new Function();
	},

	start:
	function(e) {
		var o = Drag.obj = this;
		e = Drag.fixE(e);
		var y = parseInt(o.root.style.top);
		var x = parseInt(o.root.style.left);
		o.root.onDragStart(x, y, Drag.obj.root);
		o.lastMouseX = e.clientX;
		o.lastMouseY = e.clientY;
		if (o.minX != null) o.minMouseX = e.clientX - x + o.minX;
		if (o.maxX != null) o.maxMouseX = o.minMouseX + o.maxX - o.minX;
		if (o.minY != null) o.minMouseY = e.clientY - y + o.minY;
		if (o.maxY != null) o.maxMouseY = o.minMouseY + o.maxY - o.minY;
		document.onmousemove = Drag.drag;
		document.onmouseup = Drag.end;
		Drag.obj.root.style[&quot;z-index&quot;] = &quot;10&quot;;
		return false;
	},

	drag:
	function(e) {
		e = Drag.fixE(e);
		var o = Drag.obj;
		var ey = e.clientY;
		var ex = e.clientX;
		var y = parseInt(o.root.style.top);
		var x = parseInt(o.root.style.left);
		var nx, ny;
		if (o.minX != null) ex = Math.max(ex, o.minMouseX);
		if (o.maxX != null) ex = Math.min(ex, o.maxMouseX);
		if (o.minY != null) ey = Math.max(ey, o.minMouseY);
		if (o.maxY != null) ey = Math.min(ey, o.maxMouseY);
		nx = x + (ex - o.lastMouseX);
		ny = y + (ey - o.lastMouseY);
		Drag.obj.root.style[&quot;left&quot;] = nx + &quot;px&quot;;
		Drag.obj.root.style[&quot;top&quot;] = ny + &quot;px&quot;;
		Drag.obj.lastMouseX = ex;
		Drag.obj.lastMouseY = ey;
		Drag.obj.root.onDrag(nx, ny, Drag.obj.root);
		return false;
	},

	end:
	function() {
		document.onmousemove = null;
		document.onmouseup = null;
		Drag.obj.root.style[&quot;z-index&quot;] = &quot;0&quot;;
		Drag.obj.root.onDragEnd(parseInt(Drag.obj.root.style[&quot;left&quot;]), parseInt(Drag.obj.root.style[&quot;top&quot;]), Drag.obj.root);
		Drag.obj = null;
	},

	fixE:
	function(e) {
		if (typeof e == 'undefined') e = window.event;
		if (typeof e.layerX == 'undefined') e.layerX = e.offsetX;
		if (typeof e.layerY == 'undefined') e.layerY = e.offsetY;
		return e;
	}
};
//}}}
</pre>
</div>
<div title="ResizeEditTextPlugin" modifier="Conal Elliott" created="200610282054" tags="systemConfig 2006-10-28">
<pre>/***
|''Name:''|ResizeEditTextPlugin|
|''Author:''|Jon Scully|
|''~CoreVersion:''|2.1.2|
!!!!!Purpose
Adds a handle below the textarea of a tiddler, in edit mode, that the user can drag with the mouse to resize the textarea.
!!!!!Configuration
Add the following div to the end of the [[EditTemplate]] tiddler:
{{{&lt;div macro='resize'&gt;&lt;/div&gt;}}}
!!!!!Code
***/
/*{{{*/
config.macros.resize = {
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		if (story.getTiddlerField(tiddler.title,&quot;text&quot;))
			new TextAreaResizer(story.getTiddlerField(tiddler.title,&quot;text&quot;));
	}
}
/*}}}*/
/***
!!!!!TextAreaResizer
TextAreaResizer script by Jason Johnston (jj@lojjic.net)
Created August 2003.  Use freely, but give me credit.

This script adds a handle below textareas that the user can drag with the mouse to resize the textarea.
***/
/*{{{*/
function TextAreaResizer(elt) {
	this.element = elt;
	this.create();
}
TextAreaResizer.prototype = {
	create : function() {
		var elt = this.element;
		var thisRef = this;

		var h = this.handle = document.createElement(&quot;div&quot;);
		//h.className = &quot;textarea-resizer&quot;; // optional: replace the next 3 lines
		h.style.height = &quot;4px&quot;;
		h.style.background = &quot;#ddd&quot;;
		h.style.cursor = &quot;s-resize&quot;;
		h.title = &quot;Drag to resize text box&quot;;
		h.addEventListener(&quot;mousedown&quot;, function(evt){thisRef.dragStart(evt);}, false);
		elt.parentNode.insertBefore(h, elt.nextSibling);
	},
	
	dragStart : function(evt) {
		var thisRef = this;
		this.dragStartY = evt.clientY;
		this.dragStartH = parseFloat(document.defaultView.getComputedStyle(this.element, null).getPropertyValue(&quot;height&quot;));
		document.addEventListener(&quot;mousemove&quot;, this.dragMoveHdlr=function(evt){thisRef.dragMove(evt);}, false);
		document.addEventListener(&quot;mouseup&quot;, this.dragStopHdlr=function(evt){thisRef.dragStop(evt);}, false);
	},
	
	dragMove : function(evt) {
		this.element.style.height = this.dragStartH + evt.clientY - this.dragStartY + &quot;px&quot;;
	},
	
	dragStop : function(evt) {
		document.removeEventListener(&quot;mousemove&quot;, this.dragMoveHdlr, false);
		document.removeEventListener(&quot;mouseup&quot;, this.dragStopHdlr, false);
	},
	
	destroy : function() {
		var elt = this.element;
		elt.parentNode.removeChild(this.handle);
		elt.style.height = &quot;&quot;;
	}
};
//TextAreaResizer.scriptSheetSelector = &quot;textarea&quot;;
/*}}}*/
</pre>
</div>
<div title="ResizeEditorPlugin" modifier="Conal Elliott" modified="200610310103" created="200610281846" tags="systemConfig editing">
<pre>/***
|''Name:''|ResizeEditorPlugin|
|''Source:''|http://www.TiddlyTools.com/#ResizeEditorPlugin|
|''Author:''|Eric Shulman - ELS Design Studios|
|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|''~CoreVersion:''|2.0.10|

Adds toolbar commands for use in EditTemplate to permit on-the-fly adjustment of the tiddler editor text area height:
* ''autosizeTiddler'' - toggles the tiddler editor textarea height between standard height and &quot;automatically fit the contents&quot;.
* ''resizeTiddler'' - prompts for number of lines of text to display
* ''decreaseTiddler'' - reduce text area height by 5 lines
* ''increaseTiddler'' - increase text area height by 5 lines

!!!!!Installation
&lt;&lt;&lt;
import (or copy/paste) the following tiddlers into your document:
''ResizeEditorPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)

If you are using the default (shadow) EditTemplate, the plugin automatically updates the template to include all four commands in the editor toolbar.  If you have created a custom EditTemplate tiddler, you will need to manually add the desired toolbar commands (listed above) to your existing template definition.
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
''2006.10.18 [1.2.3]'' added decreaseEditor and increaseEditor commands
''2006.10.18 [1.2.2]'' onkeypress handling to redirect PGUP/PGDN to window.scrollByPages() (works in FF, but not yet in IE)
''2006.10.18 [1.2.1]'' fixed references to default string constants (oops!)
''2006.10.18 [1.2.0]'' renamed 'resizeEditor' to 'autosizeEditor' and added new 'resizeEditor' toolbar command to prompt for # of rows to display
''2006.10.02 [1.1.1]'' show checkbox in button label (when automatic resizing is enabled)
''2006.10.01 [1.1.0]'' added 'onkeyup' automatic fit-to-contents handling
''2006.09.30 [1.0.0]'' initial release
&lt;&lt;&lt;
!!!!!Credits
&gt;This feature was developed by EricShulman from [[ELS Design Studios|http://www.elsdesign.com]]
!!!!!Code
***/
//{{{
version.extensions.resizeEditor = {major: 1, minor: 2, revision: 3, date: new Date(2006,10,18)};

config.commands.autosizeEditor = {
	text: 'autosize',
	tooltip: 'adjust the editor height to fit the contents',
	text_alt: '&lt;input type=&quot;checkbox&quot; style=&quot;padding:0;margin:0;border:0;background:transparent;&quot; checked&gt;autosize',
	tooltip_alt: 'uncheck to reset the editor to the standard height',
	hideReadOnly: false,
	handler: function(event,src,title) {
		var here=story.findContainingTiddler(src); if (!here) return;
		var ta=here.getElementsByTagName('textarea'); if (!ta) return;
		for (i=0;i&lt;ta.length;i++) {
			if (ta[i].maxed) {
				ta[i].style.height=ta[i].savedheight;
				ta[i].onkeyup=ta[i].savedkeyup;
				ta[i].onkeypress=ta[i].savedkeypress;
				src.innerHTML=config.commands.autosizeEditor.text;
				src.title=config.commands.autosizeEditor.tooltip;
			}
			else {
				if (!ta[i].savedheight) ta[i].savedheight=ta[i].style.height;
				if (!ta[i].savedkeyup) ta[i].savedkeyup=ta[i].onkeyup;
				if (!ta[i].savedkeypress) ta[i].savedkeyup=ta[i].onkeypress;
				// NOTE &quot;-2&quot; adjustment...  for top+bottom border width???
				ta[i].style.height=ta[i].scrollHeight-2+'px';
				ta[i].onkeypress=function(ev) {
					if (!ev) var ev=window.event; var e=resolveTarget(ev);
					if (ev.keyCode==33) { // PGUP
						if (window.scrollByPages) window.scrollByPages(-1);
						return false;
					}
					if (ev.keyCode==34) { // PGDN
						if (window.scrollByPages) window.scrollByPages(1);
						return false;
					}
					if (e.savedkeypress) e.savedkeypress();
				}
				ta[i].onkeyup=function(ev) {
					if (!ev) var ev=window.event; var e=resolveTarget(ev);
					e.style.height=e.scrollHeight-2+'px';
					if (e.savedkeyup) e.savedkeyup();
				}
				src.innerHTML=config.commands.autosizeEditor.text_alt;
				src.title=config.commands.autosizeEditor.tooltip_alt;
			}
			ta[i].maxed=!ta[i].maxed;
		}
		return false;
	}
};

config.commands.resizeEditor = {
	text: '=',
	tooltip: 'set the number of lines displayed in the editor',
	askmsg: 'Enter the number of lines of text to display',
	hideReadOnly: false,
	handler: function(event,src,title) {
		var here=story.findContainingTiddler(src); if (!here) return;
		var ta=here.getElementsByTagName('textarea'); if (!ta) return;
		// ask for new size, default to height of first text area in editor (usually only one text area)
		var newsize=prompt(config.commands.resizeEditor.askmsg,ta[0].rows);
		if (!newsize || newsize===0) return false; // cancelled by user
		for (i=0;i&lt;ta.length;i++) ta[i].rows=newsize;
		return false;
	}
};

config.commands.increaseEditor = {
	text: '+',
	tooltip: 'increase the size of the editor',
	step: 5,
	hideReadOnly: false,
	handler: function(event,src,title) {
		var here=story.findContainingTiddler(src); if (!here) return;
		var ta=here.getElementsByTagName('textarea'); if (!ta) return;
		var step=config.commands.increaseEditor.step;
		for (i=0;i&lt;ta.length;i++) ta[i].rows+=step;
		return false;
	}
};

config.commands.decreaseEditor = {
	text: '\u2013', // &amp;endash;
	tooltip: 'decrease the size of the editor',
	step: 5,
	hideReadOnly: false,
	handler: function(event,src,title) {
		var here=story.findContainingTiddler(src); if (!here) return;
		var ta=here.getElementsByTagName('textarea'); if (!ta) return;
		var step=config.commands.increaseEditor.step;
		for (i=0;i&lt;ta.length;i++) ta[i].rows=ta[i].rows&gt;step?ta[i].rows-step:step;
		return false;
	}
};

// automatically tweak shadow EditTemplate to add &quot;resizeEditor and autosizeEditor&quot; (and &quot;copyTiddler&quot;) to toolbar
config.shadowTiddlers.EditTemplate = &quot;&lt;div class='toolbar' macro='toolbar +saveTiddler -cancelTiddler copyTiddler deleteTiddler autosizeEditor increaseEditor decreaseEditor resizeEditor'&gt;&lt;/div&gt;\n&lt;div class='title' macro='view title'&gt;&lt;/div&gt;\n&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;\n&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;\n&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;\n&lt;div class='editorFooter'&gt;\n&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;\n&lt;span macro='tagChooser'&gt;&lt;/span&gt;\n&lt;/div&gt;&quot;;

//}}}</pre>
</div>
<div title="RewritePlugin" modifier="Conal Elliott" modified="200701280047" created="200701012029" tags="systemConfig editing 2007-01-01">
<pre>/***
|Synopsis|Replace strings with others|
|Author|[[Conal Elliott|http://conal.net]]|
|Version|1.0.2|
|Creation date|2007-01-27|
!Description
Automatically replace strings with others.  The replacement string gets wikified as well, allowing for cascading rewrites.  (No check for cycles, so watch out.)  If you want to use a string that has a replacement rule, prefix it with a backslash.
 
Some possible uses:
* Abbreviations 
* Fill in math symbols, e.g., //a -&gt; b//, //g . f//, and //\ x -&gt; x+x//.
* You tell me.
!Example
//{{{
config.macros.rewrite.declare(
  [ [&quot;-&gt;&quot;, &quot;&amp;rarr;&quot;]
  , [&quot;csid&quot;, &quot;chronosynclasticinfidibulum&quot;]
  , [&quot;@(.*?)@&quot;, &quot;{{haskell{$1}}}&quot;]
  ]
);
//}}}
Then the string &quot;csid&quot; would get rewritten but &quot;\csid&quot; would not.

Note in the last rule that right-hand-sides may substitute captured text.
!To do
* Use these rewrites in displaying [[Haskell code|literate Haskell plugin]].  How?  Idea: make a second formatters list, filtering for the ones that contain a special field.  Temporarily replace the main formatters before calling subWikify, and then restore.
* Get the rewrite rules from a table in a tiddler, maybe from a table.  Allow updating the list without having to reload the TW, and still keep it efficient.  How to get the rules to look good when rendered? 
* Regular expression replacement.
!History
* Version 1.0.2
** Left-hand-sides can capture text to be substituted on right-hand-sides.  Much more powerful than before.
!Code
***/
//{{{
version.extensions.rewrite = {major: 1, minor: 0, revision: 2, date: new Date(2007,1,27)};

config.macros.rewrite = {};

config.macros.rewrite.declare = function (rewrites) {
    var rewrite = function (from,to) {
 	var fromReg = new RegExp(from,&quot;gm&quot;);
	// Make sure &quot;from&quot; pattern doesn't remember matches, or we'll
        // mess up the handling of formatters.  Turn &quot;(&quot; into &quot;(?:&quot;.  What
        // about escaped open paren?  Rewrite them away first and then
        // back last.
	var fromNoGrab =
	  from.replace(/\\\(/g,&quot;Q####Q&quot;)
	      .replace(/\((?!\?\:)/g,&quot;(?:&quot;)
              .replace(/Q####Q/g,&quot;\\(&quot;);
	//alert(&quot;from == &quot;+from+&quot;, fromNoGrab == &quot;+fromNoGrab);
	config.formatters.push(
	{
	    name: &quot;noRewrite&quot;+fromNoGrab,
	    match: &quot;\\\\&quot;+fromNoGrab,
	    handler: function (w) {
	        w.outputText(w.output,w.matchStart+1,w.nextMatch);
	    }
	});
	config.formatters.push(
	{
	    name: &quot;rewrite&quot;+fromNoGrab,
	    match: fromNoGrab,
	    handler: function (w) {
	      var newStr = w.matchText.replace(fromReg,to);
	      //alert(&quot;Matched &quot;+w.matchText+
	      //      &quot;. Substituting &quot;+to+&quot; for &quot;+from+&quot; gives &quot;+newStr);
	      if (newStr == w.matchText)
	        alert(&quot;Breaking rewrite cycle&quot;);
              else
 		wikify(newStr,w.output,null,w.tiddler);
	    }
	});
    }
    for (var i=0; i&lt;rewrites.length; i++)
        rewrite(rewrites[i][0],rewrites[i][1]);
}
//}}}
</pre>
</div>
<div title="RewritePlugin: Haskell" modifier="Conal Elliott" modified="200710102038" created="200701020034" tags="systemConfig 2007-01-01 RewritePlugin" changecount="9">
<pre>/***
|Synopsis|Haskell rewrites|
|Author|[[Conal Elliott|http://conal.net]]|
|Creation date|2007-01-01|
|LoadDependencies|RewritePlugin|
|UseDependencies|[[SyntaxifyPlugin: Haskell]]|
!Description
Some rewrites to make math/Haskell notation look prettier and easier to write
!Examples
* //forall alpha. alpha -&gt; beta//, //g . f//, and //\ x -&gt; x+x//.  Or avoid the rewrite: //\forall \alpha. \alpha \-&gt; \beta//, //g\ . f//, and //\\ x \-&gt; x+x//.
{{{
//forall alpha. alpha -&gt; beta//, //g . f//, and //\ x -&gt; x+x//.  Or avoid the rewrite: //\forall \alpha. \alpha \-&gt; \beta//, //g\ . f//, and //\\ x \-&gt; x+x//.
}}}
* Literate-style out-of-line code:
\begin{code}
type Task = (String,Double) -- name and task score
 
parseTasks :: String -&gt; [Task]
parseTasks src = map (split.words) (lines src)
 where
   split [name,mark] = (name, read mark)
\end{code}
{{{
\begin{code}
type Task = (String,Double) -- name and task score
 
parseTasks :: String -&gt; [Task]
parseTasks src = map (split.words) (lines src)
 where
   split [name,mark] = (name, read mark)
\end{code}
}}}
* Literate-style in-line code: @if foo then &quot;bar&quot; else &quot;baz&quot;@
{{{
@if foo then &quot;bar&quot; else &quot;baz&quot;@
}}}
!Code
***/
//{{{
version.extensions.rewriteHaskell = {major: 1, minor: 0, revision: 1, date: new Date(2007,1,28)};
config.macros.rewrite.declare(
  [ [&quot;--&quot;, &quot;&amp;mdash;&quot;]  // not really Haskell-related
  , [&quot;-&gt;&quot;, &quot;&amp;rarr;&quot;]
  , [&quot; \\. &quot;, &quot; &amp;bull; &quot;]
  , [&quot;\\\\ &quot;, &quot;&amp;lambda;&quot;]
  , [&quot;forall&quot;, &quot;&amp;forall;&quot;]
  , [&quot;alpha&quot;, &quot;&amp;alpha;&quot;]
  , [&quot;beta&quot;, &quot;&amp;beta;&quot;]
  , [&quot;gamma&quot;, &quot;&amp;gamma;&quot;]
  , [&quot;@(.*?)@&quot;, &quot;{{haskell{$1}}}&quot;]
  , [&quot;^\\\\begin\\{code\\}((?:.|\n)*?)\\\\end\\{code\\}$&quot;, &quot;{{haskell{$1}}}&quot;]
  , [&quot;^\\\\begin\\{spec\\}((?:.|\n)*?)\\\\end\\{spec\\}$&quot;, &quot;{{haskell{$1}}}&quot;]
  , [&quot;([a-zA-Z0-9']+)_(\\d+)&quot;,&quot;$1~~$2~~&quot;]
  ]
);
//}}}
</pre>
</div>
<div title="ShowUnsavedChanges" modifier="Conal Elliott" created="200702100104" tags="script 2007-02-09">
<pre>/%
|Name|ShowUnsavedChanges|
|Source|http://www.TiddlyTools.com/#ShowUnsavedChanges|
|Version|0.0.0|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;&lt;br&gt;&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|script|
|Requires|NestedSlidersPlugin|
|Overrides|TiddlyWiki.prototype.setDirty|
|Description|droplist of tiddlers that have changed since the last time the document was saved with GOTO and REVERT buttons|
%/{{smallform{&lt;script&gt;

	// hijack store.setDirty() function (force display update after saving the file)
	if (TiddlyWiki.prototype.showUnsavedHijack_setDirty==undefined) {
		TiddlyWiki.prototype.showUnsavedHijack_setDirty=TiddlyWiki.prototype.setDirty;
		TiddlyWiki.prototype.setDirty = function(flag) {
			var refresh=this.isDirty() &amp;&amp; !flag; // 'dirty' to 'clean', force a refresh...
			this.showUnsavedHijack_setDirty(flag); // but change the flag first.
			if (refresh) {
				config.options.lastSaved=new Date(); // remember save time
				refreshDisplay(); // finally, update the display
			}
		}
	}

	// get the tiddlers sorted by date - INCLUDE ALL TIDDLERS (even hidden ones!!)
	var tiddlers=store.getTiddlers(&quot;modified&quot;);

	// track date/time of last file save (initialize to last tiddler change)
	if (config.options.lastSaved==undefined)
		config.options.lastSaved=tiddlers[tiddlers.length-1].modified;

	// If no tiddlers have changed, DO NOTHING.
	if (tiddlers[tiddlers.length-1].modified&lt;=config.options.lastSaved) return;

	// find the unsaved tiddlers
	var count=0; var list=&quot;&quot;;
	var item='&lt;option value=&quot;%0&quot;&gt;%1 - %0&lt;/option&gt;';
	for (var i=tiddlers.length-1; i&gt;=0; i--) {
		if (tiddlers[i].modified&lt;=config.options.lastSaved) break;
		list+=item.format([tiddlers[i].title,
			tiddlers[i].modified.formatString('YYYY.0MM.0DD 0hh:0mm:0ss')]);
		count++;
	}
	// display the dropdown list wrapped in a slider
	var out='';
	var label='There %0 %1 unsaved tiddler%2...'.format([count==1?'is':'are',count,count==1?'':'s'])
	out+='+++(unsaved)['+label+'|show/hide a list of changed tiddlers]...';
	out+='&lt;html&gt;&lt;form style=&quot;display:inline&quot;&gt;';
	out+='&lt;select size=&quot;1&quot; name=&quot;list&quot; title=&quot;select a tiddler to view&quot; ';
	out+='	onchange=&quot;var v=this.value; if (!v.length) return;';
	out+='		story.displayTiddler(null,v);';
	out+='		window.scrollTo(0,ensureVisible(document.getElementById(story.idPrefix+v)));&quot;&gt;';
	out+=list;
	out+='&lt;/select&gt;';
	out+='&lt;input type=&quot;button&quot; value=&quot;goto&quot;';
	out+='	onclick=&quot;var v=this.form.list.value; if (!v.length) return; story.displayTiddler(null,v);';
	out+='	var t=document.getElementById(story.idPrefix+v); if (t) window.scrollTo(0,ensureVisible(t));&quot;&gt;';
	out+='&lt;input type=&quot;button&quot; value=&quot;revert&quot; title=&quot;import the last saved version of this tiddler&quot;';
	out+='	onclick=&quot;var v=this.form.list.value; if (!v.length) return;';
	out+='	var t=\'&lt;\'+\'&lt;loadTiddlers [[tiddler:\'+v+\']] \'+document.location.href+\' confirm force&gt;\'+\'&gt;\';';
	out+='	var e=document.getElementById(\'executeRevert\'); if (e) e.parentNode.removeChild(e);';
	out+='	e=document.createElement(\'span\'); e.id=\'executeRevert\'; wikify(t,e);&quot;&gt;';
	out+='&lt;/form&gt;&lt;/html&gt;';
	if (!readOnly)
	out+='\n{{small{';
	out+='&lt;&lt;saveChanges&gt;&gt;';
	if (config.macros.newDocument) out+=' | &lt;&lt;newDocument ask all&gt;&gt;';
	if (config.macros.upload) out+=' | &lt;&lt;upload&gt;&gt;';
	if (config.macros.emptyTrash &amp;&amp; store.getTaggedTiddlers(&quot;Trash&quot;).length) out+=' | &lt;&lt;emptyTrash&gt;&gt;';
	out+='}}}';
	out+='===';
	return out;
&lt;/script&gt;}}}</pre>
</div>
<div title="SideBarOptions" modifier="Conal Elliott" created="200709041916" changecount="1">
<pre>&lt;&lt;search&gt;&gt;&lt;&lt;closeAll&gt;&gt;&lt;&lt;permaview&gt;&gt;&lt;&lt;newTiddler&gt;&gt;&lt;&lt;newJournal 'YYYY-0MM-0DD' {{new Date().formatString(&quot;YYYY-0MM&quot;)}} 'day'&gt;&gt;&lt;&lt;saveChanges&gt;&gt;&lt;&lt;slider chkSliderOptionsPanel OptionsPanel &quot;options »&quot; &quot;Change TiddlyWiki advanced options&quot;&gt;&gt;</pre>
</div>
<div title="SiteLogo" modifier="Conal Elliott" modified="200701020755" created="200610260203">
<pre>[img[http://conal.net/Pan/Gallery/transparent/cornucopia/small/05-glow.png]]</pre>
</div>
<div title="SiteMapMacroPlugin" modifier="Conal Elliott" modified="200610281857" created="200610260346" tags="systemConfig">
<pre>/***
| Name:|SiteMapMacro|
| Author:|Simon Baird|
| Location:|http://simonbaird.com/mptw/#SiteMapMacro|
| Version:|1.0.3, 15-Mar-06|

!!Examples
See SiteMap and SliderSiteMap for example usage.

!!Parameters
* Name of tiddler to start at
* Max depth (a number) 
* Format (eg, nested, see formats below)
* Don't show root flag (anything other than null turns it on)
* Tags - a string containing a bracketed list of tags that we are interested in

!!History
* 1.0.3 (15-Mar-06)
** added tag filtering
* 1.0.2 (15-Mar-06)
** Added json format and dontshowroot option
* 1.0.1 (9-Mar-06)
** Added selectable formats and fixed nested slider format
* 1.0.0 (8-Mar-06)
** first release

***/
//{{{

version.extensions.SiteMapMacro = {
	major: 1,
	minor: 0,
	revision: 3,
	date: new Date(2006,3,15),
	source: &quot;http://simonbaird.com/mptw/#SiteMapMacro&quot;
};

config.macros.siteMap = {

	formats: {
		bullets: {
			formatString: &quot;%0[[%1]]\n%2&quot;,
			indentString: &quot;*&quot;
		},

		// put this in your StyleSheet to make it look good.
		// .sliderPanel { margin-left: 2em; }

		sliders: {
			formatString: &quot;[[%1]]+++\n%2===\n\n&quot;,
			formatStringLeaf: &quot;[[%1]]\n&quot;
		},

		openSliders: {
			formatString: &quot;[[%1]]++++\n%2===\n\n&quot;,
			formatStringLeaf: &quot;[[%1]]\n&quot;
		},

		popups: {
			formatString: &quot;[[%1]]+++^\n%2===\n\n&quot;,
			formatStringLeaf: &quot;[[%1]]\n&quot;
		},

		// these don't work too well
		openPopups: {
			formatString: &quot;[[%1]]++++^\n%2===\n\n&quot;,
			formatStringLeaf: &quot;[[%1]]\n&quot;
		},
		
		// this is a little nuts but it works
		json: {
			formatString: '\n%0{&quot;%1&quot;:[%2\n%0]}',
			formatStringLeaf: '\n%0&quot;%1&quot;',
			indentString: &quot;  &quot;,
			separatorString: &quot;,&quot;
		}


	},

	defaultFormat: &quot;bullets&quot;,

	treeTraverse: function(title,depth,maxdepth,format,dontshowroot,tags,excludetags) {

		var tiddler = store.getTiddler(title);
		var tagging = store.getTaggedTiddlers(title);

		if (dontshowroot)
			depth = 0;

		var indent = &quot;&quot;;
		if (this.formats[format].indentString)
			for (var j=0;j&lt;depth;j++)
				indent += this.formats[format].indentString;

		var childOutput = &quot;&quot;;
		if (!maxdepth || depth &lt; parseInt(maxdepth)) 
			for (var i=0;i&lt;tagging.length;i++)
				if (tagging[i].title != title) {
					if (this.formats[format].separatorString &amp;&amp; i != 0)
						childOutput += this.formats[format].separatorString;
					childOutput += this.treeTraverse(tagging[i].title,depth+1,maxdepth,format,null,tags,excludetags);
				}

		if (childOutput == &quot;&quot; &amp;&amp; (
				(tags &amp;&amp; tags != &quot;&quot; &amp;&amp; !tiddler.tags.containsAll(tags.readBracketedList())) ||
				(excludetags &amp;&amp; excludetags != &quot;&quot; &amp;&amp; tiddler.tags.containsAny(excludetags.readBracketedList()))
				)
			) {
			// so prune it cos it doesn't have the right tags and neither do any of it's children
			return &quot;&quot;;
		}

		if (dontshowroot)
			return childOutput;

		if (this.formats[format].formatStringLeaf &amp;&amp; childOutput == &quot;&quot;) {
			// required for nestedSliders
			return this.formats[format].formatStringLeaf.format([indent,title,childOutput]);
		}

		return this.formats[format].formatString.format([indent,title,childOutput]);
	},

	handler: function (place,macroName,params,wikifier,paramString,tiddler) {
		wikify(this.treeTraverse(
			params[0] &amp;&amp; params[0] != '.' ? params[0] : tiddler.title, 1, 
			params[1] &amp;&amp; params[1] != '.' ? params[1] : null, // maxdepth
			params[2] &amp;&amp; params[2] != '.' ? params[2] : this.defaultFormat, // format
			params[3] &amp;&amp; params[3] != '.' ? params[3] : null, // dontshowroot
			params[4] &amp;&amp; params[4] != '.' ? params[4] : null, // tags
			params[5] &amp;&amp; params[5] != '.' ? params[5] : null // excludetags
			),place);
	}

}

//}}}
</pre>
</div>
<div title="SiteStartup" modifier="Conal Elliott" created="200702100053" tags="settings 2007-02-09">
<pre>This tiddler is included in the PageTemplate as a ''hidden SPAN''.  You can use it include macros or inline scripts that are automatically invoked whenever the document is loaded.

!!!!!initialize left/right sidebar displays
&lt;&lt;&lt;
The ToggleLeftSidebar and ToggleRightSidebar inline scripts set the visibility (//display:none// or //display:block//) of the MainMenu ('left sidebar', DOM ID=//mainMenu//) and SideBarOptions ('right sidebar', DOM ID=//sidebar//) displays.  They also adjust the margins of the center column ('story', DOM ID=//displayArea//) accordingly, so that it uses the available space without overlapping the sidebars.  The ToggleScrollingSidebars inline script sets 'position:fixed' for the sidebars, so that they remain fixed in place (aka, &quot;hover&quot;) when the rest of the page content is scrolled.

displayArea margins:
&lt;script&gt;
	if (config.options.txtDisplayAreaRightMargin==undefined)
		config.options.txtDisplayAreaRightMargin=&quot;18em&quot;;
	if (config.options.txtDisplayAreaLeftMargin==undefined)
		config.options.txtDisplayAreaLeftMargin=&quot;13em&quot;;
	if (config.options.chkShowLeftSidebar==undefined)
		config.options.chkShowLeftSidebar=false;
	if (config.options.chkShowRightSidebar==undefined)
		config.options.chkShowRightSidebar=false;
&lt;/script&gt;
left: &lt;&lt;option txtDisplayAreaLeftMargin&gt;&gt; right: &lt;&lt;option txtDisplayAreaRightMargin&gt;&gt;
|{{{&lt;&lt;tiddler ToggleLeftSidebar&gt;&gt;}}} |&lt;&lt;tiddler ToggleLeftSidebar&gt;&gt; |
|{{{&lt;&lt;tiddler ToggleRightSidebar&gt;&gt;}}} |&lt;&lt;tiddler ToggleRightSidebar&gt;&gt; |
|{{{&lt;&lt;tiddler ToggleScrollingSidebars&gt;&gt;}}} |&lt;&lt;tiddler ToggleScrollingSidebars&gt;&gt; |
&lt;&lt;&lt;
!!!!!initialize header display
&lt;&lt;&lt;
The ToggleSiteTitles inline script sets the visibility (//display:none// or //display:block//) of the SiteTitle/SiteSubtitle display area ('page titles', DOM ID=//header//)
|{{{&lt;&lt;tiddler ToggleSiteTitles&gt;&gt;}}} |&lt;&lt;tiddler ToggleSiteTitles&gt;&gt; |
&lt;&lt;&lt;
!!!!!&quot;scroll to top&quot; button
&lt;&lt;&lt;
The ToggleTopButton script creates a link that 'hovers' in the lower right corner of your browser window and, when clicked, causes the page to return to the top (assuming it has been scrolled down...).  The script also provides an interface so you can enable/disable this feature:
|{{{&lt;&lt;tiddler ToggleTopButton&gt;&gt;}}} |&lt;&lt;tiddler ToggleTopButton&gt;&gt; |
&lt;&lt;&lt;
!!!!!toggle low-profile SiteMenu
&lt;&lt;&lt;
The ToggleSiteMenu inline script sets the visibility (//display:none// or //display:block//) of the SiteMenu display area ('menubar', DOM ID=//siteMenu//).
|{{{&lt;&lt;tiddler ToggleSiteMenu&gt;&gt;}}} |&lt;&lt;tiddler ToggleSiteMenu&gt;&gt; |
&lt;&lt;&lt;
</pre>
</div>
<div title="SiteSubtitle" modifier="Conal Elliott" modified="200612090150" created="200610230145" tags="protected">
<pre>a non-linear personal web notebook</pre>
</div>
<div title="SiteTitle" modifier="Conal Elliott" modified="200612090147" created="200610230145" tags="protected">
<pre>Conal's Journal</pre>
</div>
<div title="SmileyPlugin" modifier="Conal Elliott" created="200610300451" tags="systemConfig 2006-10-29">
<pre>/***
|''Name:''|SmileyPlugin|
|''Source:''|http://www.blogjones.com/TiddlyWikiTutorial.html#smiley|
|''Author:''|Alan Hecht|
***/
//{{{
version.extensions.smileyMacro = {major: 0, minor: 1, revision: 0, date: new Date(2005,7,20)};

config.macros.smiley = {}
config.macros.smiley.handler = function(place,macroName,params)
{
	var palette = [&quot;transparent&quot;,&quot;#000000&quot;,&quot;#1a1507&quot;,&quot;#352e18&quot;,&quot;#464646&quot;,&quot;#666666&quot;,&quot;#a3141e&quot;,&quot;#b06b63&quot;,&quot;#cc9900&quot;,&quot;#dd9030&quot;,&quot;#dddddd&quot;,&quot;#e89d00&quot;,&quot;#edc32a&quot;,&quot;#f3cb3c&quot;,&quot;#fdf201&quot;,&quot;#fdf526&quot;,&quot;#ff3149&quot;,&quot;#ffac00&quot;,&quot;#ffbf06&quot;,&quot;#ffc846&quot;,&quot;#ffcc66&quot;,&quot;#ffd758&quot;,&quot;#ffdd01&quot;,&quot;#ffea7b&quot;,&quot;#ffed55&quot;,&quot;#ffffff&quot;];
	var data = params;
	var imageMap = null;
	if(data[0] == &quot;:-)&quot; || data[0] == &quot;:)&quot;)

		imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyffyffuujbaadyyyeeyeetttdabppppddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwboooowwwbllbbwwwboooowbrllbacwwwbbbbbrllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
	else if(data[0] == &quot;:-(&quot; || data[0] == &quot;:(&quot;)
		imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyyyyyyuujbaadyyyeeyeetttdabppppddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwoooooowwrllbbwwwwbbbbbsrllbacwwbwwwwsbllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
	else if(data[0] == &quot;;-)&quot; || data[0] == &quot;;)&quot;)
		imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyxxxxxuujbaadyyyxxxeetttdabppphddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwboooowwwbllbbwwwboooowbrllbacwwwbbbbbrllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
	else if(data[0] == &quot;:-|&quot; || data[0] == &quot;:|&quot;)
		imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyffyffuujbaadyyyeeyeetttdabppppddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwoooooowwrllbbwwwwbbbbbsrllbacwwwwwwwsrllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
	else if(data[0] == &quot;:-D&quot; || data[0] == &quot;:D&quot;)
		imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyeeyeeuujbaadyyyeeyeetttdabppppyyyyypmmlbbwbbbbbbbbbbblbbwbkzzzzzzzkbwbbwbfzzzzzzzfbwbbwbkzzzzzzzkbwbacwbkzzzzzkblcaablsbkzzzkblibaaablsbbbbblibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
	else
		createTiddlyElement(place,&quot;span&quot;,null,&quot;errorNoSuchMacro&quot;,&quot;unknown smiley&quot;);
	if(imageMap)
		{
		var box = createTiddlyElement(place,&quot;span&quot;,null,&quot;smiley&quot;,String.fromCharCode(160));
		box.style.position = &quot;relative&quot;;
		box.style.width = &quot;15px&quot;;
		box.style.height = &quot;15px&quot;;
		box.style.marginLeft = &quot;1px&quot;;
		box.style.marginRight = &quot;1px&quot;;
		box.style.paddingRight = &quot;12px&quot;;
		box.style.verticalAlign = &quot;top&quot;;

		//now divide into 15x15 grid and create each pixel
		// rows
		for(r=0; r&lt;15; r++)
			{
			// columns
			for(c=0; c&lt;15; c++)
				{
				//create each pixel with the correct background
				var pix = document.createElement(&quot;img&quot;);
				pix.className = &quot;smileyPixel&quot;;
				pix.style.position = &quot;absolute&quot;;
				pix.border = 0;
				pix.style.top = r + &quot;px&quot;;
				pix.style.left = c + &quot;px&quot;;
				pix.style.width = &quot;1px&quot;;
				pix.style.height = &quot;1px&quot;;
				pix.style.backgroundColor = palette[imageMap.charCodeAt((r*15)+c)-97];
				pix.src = &quot;data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B&quot;;
				box.appendChild(pix);
				}
			}
		}
}
//}}}</pre>
</div>
<div title="SplashScreenPlugin" modifier="Conal Elliott" created="200702102340" tags="systemConfig 2007-02-10">
<pre>/***

''Inspired by [[TiddlyPom|http://www.warwick.ac.uk/~tuspam/tiddlypom.html]]''

|Name|SplashScreenPlugin|
|Created by|SaqImtiaz|
|Location|http://tw.lewcid.org/#SplashScreenPlugin|
|Version|0.21 |
|Requires|~TW2.08+|
!Description:
Provides a simple splash screen that is visible while the TW is loading.

!Installation
Copy the source text of this tiddler to your TW in a new tiddler, tag it with systemConfig and save and reload. The SplashScreen will now be installed and will be visible the next time you reload your TW.

!Customizing
Once the SplashScreen has been installed and you have reloaded your TW, the splash screen html will be present in the MarkupPreHead tiddler. You can edit it and customize to your needs.

!History
* 20-07-06 : version 0.21, modified to hide contentWrapper while SplashScreen is displayed.
* 26-06-06 : version 0.2, first release

!Code
***/
//{{{
var old_lewcid_splash_restart=restart;

restart = function()
{   if (document.getElementById(&quot;SplashScreen&quot;))
        document.getElementById(&quot;SplashScreen&quot;).style.display = &quot;none&quot;;
      if (document.getElementById(&quot;contentWrapper&quot;))
        document.getElementById(&quot;contentWrapper&quot;).style.display = &quot;block&quot;;
    
    old_lewcid_splash_restart();
   
    if (splashScreenInstall)
       {if(config.options.chkAutoSave)
			{saveChanges();}
        displayMessage(&quot;TW SplashScreen has been installed, please save and refresh your TW.&quot;);
        }
}


var oldText = store.getTiddlerText(&quot;MarkupPreHead&quot;);
if (oldText.indexOf(&quot;SplashScreen&quot;)==-1)
   {var siteTitle = store.getTiddlerText(&quot;SiteTitle&quot;);
   var splasher='\n\n&lt;style type=&quot;text/css&quot;&gt;#contentWrapper {display:none;}&lt;/style&gt;&lt;div id=&quot;SplashScreen&quot; style=&quot;border: 3px solid #ccc; display: block; text-align: center; width: 320px; margin: 100px auto; padding: 50px; color:#000; font-size: 28px; font-family:Tahoma; background-color:#eee;&quot;&gt;&lt;b&gt;'+siteTitle +'&lt;/b&gt; is loading&lt;blink&gt; ...&lt;/blink&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;font-size: 14px; color:red;&quot;&gt;Requires Javascript.&lt;/span&gt;&lt;/div&gt;';
   if (! store.tiddlerExists(&quot;MarkupPreHead&quot;))
       {var myTiddler = store.createTiddler(&quot;MarkupPreHead&quot;);}
   else
      {var myTiddler = store.getTiddler(&quot;MarkupPreHead&quot;);}
      myTiddler.set(myTiddler.title,oldText+splasher,config.options.txtUserName,null,null);
      store.setDirty(true);
      var splashScreenInstall = true;
}
//}}}</pre>
</div>
<div title="StyleSheet" modifier="Conal Elliott" modified="200709050413" created="200709041953" changecount="15">
<pre>/***
Custom CSS goes here.
***/

/*{{{*/
[[HorizontalMainMenuStyles]]
[[StyleSheetPlugins]] /* include adjustments to plugin-supplied definitions */
[[StyleSheetShortcuts]] /* include formatting &quot;shortcut&quot; definitions */

body { font-family: Verdana,Arial,Helvetica; position:static; }

h1 { text-indent: 0em;}
h2 { text-indent: 1em;}
h3 { text-indent: 2em;}
h4 { text-indent: 3em;}
h5 { text-indent: 4em;}

.viewer code { color: #000; }

/* .viewer { font-family: times, arial; } */

.syntaxify ol li.alt { background-color: #ffc; !important; }

.viewer pre {
        padding: 0.5em;
        margin-left: 1.5em;
        margin-right: 1.5em;
/*
        font-size: 1.2em;
        line-height: 1.4em;
*/
        font-size: 1em;
        line-height: 1.4em;
        /* -moz-border-radius: 0.75em;  */
        overflow: auto;
	font-family: &quot;Lucida Console&quot;, Courier, &quot;Courier New&quot;, monospace;
}
 
.viewer code {
/*
        font-size: 1.2em;
        line-height: 1.4em;
        font-size: 1.1em;
*/
	font-family: &quot;Lucida Console&quot;, Courier, &quot;Courier New&quot;, monospace;
}


/* .viewer { background-color: #eee; } */

.selected .tagging, .selected .tagged,
.tagging, .tagged {
	/* border: 0px none white; */
	border: none;
	background-color: transparent;
}

/*
.tagging {float:right }
.tagged, .tagging { -moz-border-radius: 1em; }
*/

.tagged ul, .tagged li, .tagging ul, .tagging li,
            .tagged .listTitle, .tagging .listTitle { 
   display: inline; 
}

.tagged li, .tagging li {
  margin: 2px;
  padding: 1px 1px 2px 1px;
  border: 1px solid #000;
}

.tagging .listTitle, .tagged .listTitle {
  color: DarkGreen;  /* was #014 */
  font-weight: bold;
  border: none;
}

/*
li.listTitle, ul.listTitle {
  font-weight: bold;
  border: none;
}
*/

.tagged, .tagging { float: none; }

.isTag .tagging { display: inline; }


.siteLogo {
        position: absolute;
        padding: 0em 0em 1em 0em;
        top:   15px;  /* I'd rather center vertically in the space, but how? */
        right: 15px;
}

.demoImg img {
    display: block;
    margin-left: auto;
    margin-right: auto;
    background-color: rgb(200,200,200);
}

.subtitle {font-size: 85%}
.editor textarea { font-family: monospace; }

/* .viewer { text-align: justify; } */
/* .viewer { font-family: times; } */

/* Was 0.2em 0.4em. */
.tiddler .button { padding: 0.1em 0.2em; }

/* Was margin: 0em 0.25em; padding: 0em 0.25em; */
.viewer .button {
        margin: 0em 0em;
        padding: 0em 0.15em 0.1em 0.15em;
}

/* .viewer pre { margin-left: 1.5em; margin-right: 2em; } */

/* inline code is shorter than other text, but upping the font size makes
   it wider than I like.  Hmm. */
/* .viewer code { font-size: 10pt; } */

@media print {
 /* Suppress, in addition to those in StyleSheetPrint
 .toolbar, .tagged, .tagging, .header, .headerForeground, #topMenu {display: none ! important;}
 .subtitle {font-size: 70%}
}
/*}}}*/
</pre>
</div>
<div title="StyleSheet Giffmex" modifier="Conal Elliott" modified="200709050410" created="200709050354" changecount="6">
<pre>/*{{{*/
/* horizontal main menu */

#displayArea { margin: 1em 15.5em 0em 1em; } /* use the full horizontal width */

#topMenu { background: [[ColorPalette::PrimaryMid]]; color: [[ColorPalette::PrimaryPale]]; padding: 0.2em 0.2em 0.2em 0.5em; border-bottom: 2px solid #000000; }

#topMenu br { display: none; }

#topMenu .button, #topMenu .tiddlyLink, #topMenu a { margin-left: 0.25em; margin-right: 0.25em; padding-left: 0.5em; padding-right: 0.5em; color: [[ColorPalette::PrimaryPale]]; font-size: 1.15em; }

#topMenu .button:hover, #topMenu .tiddlyLink:hover { background: [[ColorPalette::PrimaryDark]]; }

 .firstletter{ float:left; width:0.75em; font-size:400%; font-family:times,arial; line-height:60%; }

.viewer .FOO table tr.oddRow { background-color: #bbbbbb; }
.viewer .FOO table tr.evenRow { background-color: #fff; } 


/*Invisible table*/

.viewer .invisibletable table { 
border-color: white;
 }

.viewer .invisibletable table td { 
font-size: 1em;
font-family: Verdana;
border-color: white;
padding: 10px 20px 10px 0px;
text-align: left;
vertical-align: top;
} 

.viewer .invisibletable table th { 
color: #005566;
background-color: white;
border-color: white;
font-family: Verdana;
font-size: 1.2em;
font-weight: bold;
padding: 10px 20px 10px 0px;
text-align: left;
vertical-align: top;
} 

/* GIFFMEX TWEAKS TO STYLESHEETPRINT (so that nothing but tiddler title and text are printed) */


@media print {#mainMenu {display: none ! important;}}
@media print {#topMenu {display: none ! important;}}
@media print {#sidebar {display: none ! important;}}
@media print {#messageArea {display: none ! important;}} 
@media print {#toolbar {display: none ! important;}}
@media print {.header {display: none ! important;}}
@media print {.tiddler .subtitle {display: none ! important;}}
@media print {.tiddler .toolbar {display; none ! important; }}
@media print {.tiddler .tagging {display; none ! important; }}
@media print {.tiddler .tagged {display; none ! important; }}
@media print {#displayArea {margin: 1em 1em 0em 1em;}}
@media print {.pageBreak {page-break-before: always;}}

a.button{
 border: 0;

} 

/*Color changes*/


#sidebarOptions input {
	border: 1px solid [[ColorPalette::TertiaryPale]];
}

#sidebarOptions .sliderPanel {
	background: [[ColorPalette::TertiaryPale]];
}

#sidebarOptions .sliderPanel a {
	border: none;
	color: [[ColorPalette::PrimaryMid]];
}

#sidebarOptions .sliderPanel a:hover {
	color: [[ColorPalette::Background]];
	background: [[ColorPalette::TertiaryPale]];
}

#sidebarOptions .sliderPanel a:active {
	color: [[ColorPalette::PrimaryMid]];
	background: [[ColorPalette::TertiaryPale]];
}

/*Makes sliders bold*/

.tuduSlider .button{font-weight: bold;
}

/* (2) Adjusts the color for all headlines so they are both readable and match my color schemes. */

h1,h2,h3,h4,h5 {
 color: #000;
 background: [[ColorPalette::TertiaryPale]];
}

.title {
color: [[ColorPalette::PrimaryMid]];
}

/* (2) Makes text verdana. */

body {
 font-family: verdana;
font-size: 9pt;
}

/* (4) Allows for Greek - one way */

   .greek {
      font-family: Palatino Linotype;
      font-style: normal;
      font-size: 150%;
   }

/* (5) Shortens the height of the Header */

.headerShadow {
 padding: 1.5em 0em 1em 1em;
}

.headerForeground {
 padding: 2em 0em 1em 1em;
}

/* (8) Makes ordered and unordered lists double-spaced between items but single-spaced within items. */

.viewer li {
   padding-top: 0.5em;
   padding-bottom: 0.5em;

} 

/*Makes block quotes line-less*/

.viewer blockquote {
border-left: 0px;
margin-top:0em;
margin-bottom:0em; 
}

/* Cosmetic fixes that probably should be included in a future TW... */

.viewer .listTitle { list-style-type:none; margin-left:-2em; }
.editorFooter .button { padding-top: 0px; padding-bottom:0px; }

Important stuff. See TagglyTaggingStyles and HorizontalMainMenuStyles

[[Styles TagglyTagging]]
[[Styles HorizontalMainMenu]]

Just colours, fonts, tweaks etc. See MessageTopRight and SideBarWhiteAndGrey

body { 
  background: #eee; }
.headerForeground a { 
  color: #6fc;}
.headerShadow { 
  left: 2px; 
  top: 2px; }
.siteSubtitle { 
  padding-left: 1.5em; }

.shadow .title {
  color: #999; }

.viewer pre { 
  background-color: #f8f8ff; 
  border-color: #ddf }

.tiddler {
  border-top:    1px solid #ccc; 
  border-left:   1px solid #ccc; 
  border-bottom: 3px solid #ccc; 
  border-right:  3px solid #ccc; 
  margin: 0.5em; 
  background:#fff; 
  padding: 0.5em; 
  -moz-border-radius: 1em; }

#messageArea { 
  background-color: #eee; 
  border-color: #8ab; 
  border-width: 4px; 
  border-style: dotted; 
  font-size: 90%; 
  padding: 0.5em; 
  -moz-border-radius: 1em; }

#messageArea .button { text-decoration:none; font-weight:bold; background:transparent; border:0px; }

#messageArea .button:hover {background: #acd; }

.editorFooter .button { 
  padding-top: 0px; 
  padding-bottom:0px; 
  background: #fff;
  color: #000; 
  border-top:    1px solid #ccc; 
  border-left:   1px solid #ccc; 
  border-bottom: 2px solid #ccc; 
  border-right:  2px solid #ccc; 
  margin-left: 3px;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px; }
  
.editorFooter .button:hover { 
  border-top:    2px solid #ccc; 
  border-left:   2px solid #ccc; 
  border-bottom: 1px solid #ccc; 
  border-right:  1px solid #ccc; 
  margin-left: 3px;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px; }

.tagged {
  padding: 0.5em;
  background-color: #eee;
  border-top:    1px solid #ccc; 
  border-left:   1px solid #ccc; 
  border-bottom: 3px solid #ccc; 
  border-right:  3px solid #ccc; 
  -moz-border-radius: 1em; }

.selected .tagged {
  padding: 0.5em;
  background-color: #eee;
  border-top:    1px solid #ccc; 
  border-left:   1px solid #ccc; 
  border-bottom: 3px solid #ccc; 
  border-right:  3px solid #ccc; 
  -moz-border-radius: 1em; }

Clint's fix for weird IE behaviour
body {position:static;}
.tagClear{margin-top:1em;clear:both;}


/*}}}*/

/*{{{*/

/* text alignments */
.left
	{ display:block;text-align:left; }
.center
	{ display:block;text-align:center; }
.right	
	{ display:block;text-align:right; }
.justify
	{ display:block;text-align:justify; }
.indent
	{ margin:0;padding:0;border:0;margin-left:2em; }
.floatleft
	{ float:left; }
.floatright
	{ float:right; }
.clear
	{ clear:both; }
.wrap
	{ white-space:normal; }
.nowrap
	{ white-space:nowrap; }
.hidden
	{ display:none; }
.span
	{ display:span; }
.block
	{ display:blockquote; }

/* font sizes */
.big
	{ font-size:14pt;line-height:120% }
.medium
	{ font-size:12pt;line-height:120% }
.normal
	{ font-size:9pt;line-height:120% }
.small
	{ font-size:8pt;line-height:120% }
.fine
	{ font-size:7pt;line-height:120% }
.tiny
	{ font-size:6pt;line-height:120% }
.larger
	{ font-size:120%; }
.smaller
	{ font-size:80%; }

/* font styles */
.bold
	{ font-weight:bold; }
.italics
	{ font-style:italics; }
.underline
	{ text-decoration:underline; }

/* multi-column tiddler content (not supported in Internet Explorer) */
.twocolumns
	{ display:block; -moz-column-count:2; -moz-column-gap:1em; -moz-column-width:50%;}
.threecolumns
	{ display:block; -moz-column-count:3; -moz-column-gap:1em; -moz-column-width:33%}
.fourcolumns
	{ display:block; -moz-column-count:4; -moz-column-gap:1em; -moz-column-width:25%}

/* borderless tables */
.borderless, .borderless table, .borderless td, .borderless tr, .borderless th, .borderless tbody
	{ border:0 !important; margin:0 !important; padding:0 !important; }

/* thumbnail images (fixed-sized scaled images) */
.thumbnail img { height:5em !important; }

/* grouped content */
.outline
	{ display:block; padding:1em; -moz-border-radius:1em; border:1px solid; }
.menubox
	{ display:block; padding:1em; -moz-border-radius:1em; border:1px solid; background:#ccccff; color:#000; }
.menubox .button, .menubox .tiddlyLinkExisting, .menubox .tiddlyLinkNonExisting
	{ color:#009 !important; }
.groupbox
	{ display:block; padding:1em; -moz-border-radius:1em; border:1px solid; background:#ffe; color:#000; }
.groupbox a, .groupbox .button, .groupbox .tiddlyLinkExisting, .groupbox .tiddlyLinkNonExisting
	{ color:#009 !important; }
.groupbox code
	{ color:#333 !important; }
.borderleft
	{ margin:0;padding:0;border:0;margin-left:1em; border-left:1px dotted; padding-left:.5em; }
.borderright
	{ margin:0;padding:0;border:0;margin-right:1em; border-right:1px dotted; padding-right:.5em; }
.borderbottom
	{ margin:0;padding:1px 0;border:0;border-bottom:1px dotted; margin-bottom:1px; padding-bottom:1px; }
.bordertop
	{ margin:0;padding:0;border:0;border-top:1px dotted; margin-top:1px; padding-top:1px; }

/* compact form */
.smallform
	{ white-space:nowrap; }
.smallform input, .smallform textarea, .smallform button, .smallform checkbox, .smallform radio, .smallform select
	{ font-size:8pt; }

/* colors */
.green { color:#6f6 !important }
.red { color:#f66 !important }
.blue { color:#99f !important }

/*}}}*/</pre>
</div>
<div title="StyleSheetPlugins" modifier="Conal Elliott" created="200702100108" tags="settings CSS 2007-02-09">
<pre>/***
The following CSS declarations modify default style classes defined by various plugins and scripts, and/or used in customized Page/View/Edit templates

These 'style tweaks' can be easily included in other stylesheet tiddler so they can share a baseline look-and-feel that can then be customized to create a wide variety of 'flavors'.

/***
!PageTemplate - siteMenu 
***/
/*{{{*/
.siteMenu
	{ background:transparent; padding:.5em; }
.siteMenu a, .siteMenu .button, .siteMenu .tiddlyLinkExisting, .siteMenu .tiddlyLinkNonExisting
	{ font-weight: normal; font-style: normal; }
/*** LEAVE THESE OUT FOR NOW
.siteMenu .button, .siteMenu a
	{ border:1px solid transparent; background:transparent; margin:0px; padding:0px 1px; -moz-border-radius:.5em; }
.siteMenu .button:hover, .siteMenu a:hover
	{ border:1px solid #69c; background:#006; color:#fff; }
***/
/*}}}*/

/***
!PageTemplate - storyMenu 
***/
/*{{{*/
.storyMenu
	{ display:block; margin:0em 1em 0em 1em; }
.storyMenu a, .storyMenu .button, .storyMenu .tiddlyLinkExisting, .storyMenu .tiddlyLinkNonExisting
	{ font-weight: normal; font-style: normal; text-decoration:none; }
/*}}}*/

/***
!NestedSlidersPlugin 
***/
/*{{{*/
.floatingPanel
	{ padding:1em; margin:0em; border:1px solid; -moz-border-radius:1em; font-size:8pt; text-align:left; }
.floatingPanel hr
	{ margin:2px 0 1px 0; padding:0; }
#sidebarOptions .sliderPanel
	{ margin:0; padding:0; font-size:1em; background:transparent; }
#sidebarOptions .sliderPanel a
	{ font-weight:normal; }
#sidebarOptions .sliderPanel blockquote
	{ margin:0;padding:0;margin-left:1em; border-left:1px dotted; padding-left:1em }
/*}}}*/

/***
!CheckboxPlugin 
***/
/*{{{*/
input[type=&quot;Checkbox&quot;]
	{ margin-top:2px;margin-bottom:2px; }
/*}}}*/

/***
!BreadcrumbsPlugin 
***/
/*{{{*/
/* smaller size for bread crumbs (see BreadcrumbsPlugin) */
#breadCrumbs
	{ display:none; margin:0 1em; font-size:7pt; } /* display:block is set by plugin when crumbs are in use */
/*}}}*/

/***
!TableOfContentsPlugin 
***/
/*{{{*/
#sidebarTabs .tabContents *[class=&quot;TOCList&quot;] /* MOZ ONLY */
	{ background-color: transparent; border-color:transparent !important; }
/*}}}*/

/***
!AttachFilePlugin 
***/
/*{{{*/
#sidebar .attachPanel
	{ right:115%; top:3em; text-align:left; }
/*}}}*/

/***
!ImportTiddlersPlugin 
***/
/*{{{*/
#sidebar #importPanel
	{ right:115%; top:6em; text-align:left; }
/*}}}*/

/***
!ExportTiddlersPlugin 
***/
/*{{{*/
#sidebar #exportPanel
	{ right:115%; top:9em; text-align:left; }
/*}}}*/
</pre>
</div>
<div title="StyleSheetShortcuts" modifier="Conal Elliott" modified="200709042015" created="200702100111" tags="settings CSS 2007-02-09" changecount="28">
<pre>/***
The following CSS declarations provide quick shortcuts for common formatting styles

These 'style tweaks' can be easily included in other stylesheet tiddler so they can share a baseline look-and-feel that can then be customized to create a wide variety of 'flavors'.

***/
/*{{{*/

/* text alignments */
.left
	{ display:block;text-align:left; }
.floatleft
	{ float:left; }
.right	
	{ display:block;text-align:right; }
.floatright
	{ float:right; }
.clear
	{ clear:both; }
.center
	{ display:block;text-align:center; }
.wrap
	{ white-space:normal }
.nowrap
	{ white-space:nowrap }

/* font sizes */
.big
	{ font-size:14pt;line-height:120% }
.medium
	{ font-size:12pt;line-height:120% }
.normal
	{ font-size:9pt;line-height:120% }
.small
	{ font-size:8pt;line-height:120% }
.fine
	{ font-size:7pt;line-height:120% }
.tiny
	{ font-size:6pt;line-height:120% }
.larger
	{ font-size:120%; }
.smaller
	{ font-size:80%; }

/* borderless tables */
.borderless, .borderless table, .borderless td, .borderless tr, .borderless th, .borderless tbody
	{ border:0 !important; margin:0 !important; padding:0 !important; }

/* thumbnail images (fixed-sized scaled images) */
.thumbnail img { height:5em !important; }

/* grouped content */
.outline
	{ display:block; padding:1em; -moz-border-radius:1em; border:1px solid; }
.menubox
	{ display:block; padding:1em; -moz-border-radius:1em; border:1px solid; background:#fff; color:#000; }
.menubox a, .menubox .button, .menubox .tiddlyLinkExisting, .menubox .tiddlyLinkNonExisting
	{ color:#009 !important; }
.groupbox
	{ display:block; padding:1em; -moz-border-radius:1em; border:1px solid; background:#ffe; color:#000; }
.groupbox a, .groupbox .button, .groupbox .tiddlyLinkExisting, .groupbox .tiddlyLinkNonExisting
	{ color:#009 !important; }
.indent
	{ margin:0;padding:0;border:0;margin-left:.5em; }
.borderleft
	{ margin:0;padding:0;border:0;margin-left:1em; border-left:1px dotted; padding-left:.5em; }
.borderright
	{ margin:0;padding:0;border:0;margin-right:1em; border-right:1px dotted; padding-right:.5em; }
.borderbottom
	{ margin:0;padding:1px 0;border:0;border-bottom:1px dotted; margin-bottom:1px; padding-bottom:1px; }
.bordertop
	{ margin:0;padding:0;border:0;border-top:1px dotted; margin-top:1px; padding-top:1px; }

/* compact form */
.smallform
	{ white-space:nowrap; }
.smallform input, .smallform textarea, .smallform button, .smallform checkbox, .smallform radio, .smallform select
	{ font-size:8pt; }

/* colors */
.green { color:#6f6 !important }
.red { color:#f66 !important }
.blue { color:#99f !important }



/*}}}*/</pre>
</div>
<div title="StyleSheetSyntaxify" modifier="Conal Elliott" modified="200703052004" created="200701281833" tags="2007-01-28">
<pre>/*{{{*/
.viewer .syntaxify {
         font-family: &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;
         /* font-size: 1.1em; */
}
.viewer div.syntaxify {
         background-color: #ffc;
         border: 1px solid #fe8;
/*
         margin: 0 0 1em 0.5em;
         font-size: 1.2em;
*/
         padding: 0.2em 0.5em 0.2em 0.5em;
         margin: 0.5em 1.5em 0.5em 1.5em;
         line-height: 1.4em;
         -moz-border-radius: 0.75em; 
         overflow: auto;
}

.syntaxify ol {
        margin: 0;
        padding: 1px;
        color: #2B91AF;
}

.syntaxify ol li {
       background-color: #ffc;
       color: black;
       list-style-type: none;
/* An alternate style to enable line numbering -- remove the line above and uncomment below if desired */
/*
       list-style-type: 1;
       border-left: 3px solid #fe8;
       margin-left: 3.5em;
*/
}

/* To disable alternating lines having a different colors, comment out the following line. */
/* .syntaxify ol li.alt { background-color: #ffe; } */

.syntaxify ol li span { color: black; }
.syntaxify .singleLineComments { color: green; }
.syntaxify .multiLineComments { color: green; }
.syntaxify .multiLineComments1 { color: red; }
.syntaxify .tag { font-weight: bold; color: blue; }
.syntaxify .tagname { font-weight: bold; color: black; }
.syntaxify .attribute { color: rgb(127,0,85); }
.syntaxify .value { color: rgb(42,0,255); }
.syntaxify .keywords { color: #006699; }
.syntaxify .keywords1 { color: red; }
.syntaxify .delimiters { color: maroon; }
.syntaxify .delimiters1 { color: olive; }
.syntaxify .literals { color: maroon; }
.syntaxify .literals1 { color: blue; }
.syntaxify .literals2 { color: blue; }
.syntaxify .literals3 { color: #129; }
.syntaxify .identifiers { /* font-weight: bold; */ color: blue; }
.syntaxify .identifiers1 { font-weight: bold; color: black; }
/*}}}*/</pre>
</div>
<div title="SyntaxifyPlugin" modifier="Conal Elliott" modified="200702100248" created="200610262124" tags="systemConfig">
<pre>/***
|''Name:''|Plugin: Syntaxify|
|''Description:''|Performs syntax highlighting on CSS, JavaScript, and HTML/XML|
|''Version:''|1.2|
|''Date:''|January 29, 2007|
|''Source:''|http://bob.mcelrath.org/syntaxify.html|
|''Author:''|BobMcElrath|
|''Email:''|my first name at my last name dot org|
|''License:''|[[GPL open source license|http://www.gnu.org/licenses/gpl.html]]|
|''~CoreVersion:''|2.0.0|
!Description
This plugin will syntax highlight (&quot;pretty-print&quot;) source code used by TiddlyWiki.  To activate CSS markup, enclose the code in the CSS code in the delimiters 
&lt;html&gt;&lt;code&gt;
/&amp;#42;{{{&amp;#42;/&lt;br/&gt;
/&amp;#42; CSS code here &amp;#42/&lt;br/&gt;
/&amp;#42;}}}&amp;#42;/&lt;br/&gt;
&lt;/code&gt;&lt;/html&gt;
To activate XML markup, enclose your HTML/XML in the delimiters
&lt;html&gt;&lt;code&gt;
&amp;lt;!--{{{--&amp;gt;&lt;br/&gt;
&amp;lt;!-- XML/HTML code here --&amp;gt;&lt;br/&gt;
&amp;lt;!--}}}--&amp;gt;&lt;br/&gt;
&lt;/code&gt;&lt;/html&gt;
And to activate JavaScript markup, enclose your code in the delimiters
&lt;html&gt;&lt;code&gt;
//{{{&lt;br/&gt;
// JavaScript code here.&lt;br/&gt;
//}}}&lt;br/&gt;
&lt;/code&gt;&lt;/html&gt;

In addition, all of the above languages can be syntaxified by using the custom class formatter
&lt;html&gt;&lt;code&gt;
{{foo{&lt;br/&gt;
    code for language &quot;foo&quot; here&lt;br/&gt;
}}}&lt;br/&gt;
&lt;/code&gt;&lt;/html&gt;
where {{{foo}}} is the name of the language: {{{css}}}, {{{javascript}}}, or {{{xml}}}.  This plugin can be extended with new languages by creating a data structure like those below (in {{{syntaxify.languages}}} and then calling {{{syntaxify.addLanguages}}}.
!History
* 1.2 Release
** Now syntaxifies in-line style code (thanks [[Conal Elliott|http://conal.net]]).
** Fix multi-line comments in CSS.
** Consolidate customClassesHelper and monospacedByLineHelper which had lots of duplicated code.
** Fix autoLinkWikiWords bug when using custom classes and the tag formatter.
** Fix compatability problems between 2.1 and 2.0 (termRegExp vs. terminator)
* 1.1 Release
** Rewrite things to make it easier to add new languages.
** Override customClasses to syntaxify when the class corresponds to a known language.
** TiddlyWiki 2.1 beta compatibility
* 1.0.2 Release
** Don't use {{{class}}} as a variable name, dummy.
* 1.0.1 Release
** Simplified stylesheet and removed line numbering.
** Fixed highlighting when &lt;html&gt;&lt;code&gt;&amp;#42;/&lt;/code&gt;&lt;/html&gt; appeared at the beginning of a line.
** Fixed blank lines not being shown if {{{list-style-type: none}}} was turned on.
** Small speedups
* 1.0.0 Initial Release
!Code
***/
//{{{
version.extensions.Syntaxify = { major: 1, minor: 2, revision: 0, date: new Date(&quot;2007&quot;,&quot;01&quot;,&quot;29&quot;),
	source: &quot;http://bob.mcelrath.org/syntaxify.html&quot;
};

var syntaxify = {};

syntaxify.regexpSpace = new RegExp(&quot; &quot;, &quot;mg&quot;);
syntaxify.regexpTab = new RegExp(&quot;\t&quot;, &quot;mg&quot;);
syntaxify.regexpAmp = new RegExp(&quot;&amp;&quot;,&quot;mg&quot;);
syntaxify.regexpLessThan = new RegExp(&quot;&lt;&quot;,&quot;mg&quot;);
syntaxify.regexpGreaterThan = new RegExp(&quot;&gt;&quot;,&quot;mg&quot;);
syntaxify.regexpQuote = new RegExp(&quot;\&quot;&quot;,&quot;mg&quot;);
syntaxify.regexpDoubleQuotedString = new RegExp(&quot;\&quot;(?:\\\\.|[^\\\\\&quot;])*?\&quot;&quot;, &quot;mg&quot;);
syntaxify.regexpSingleQuotedString = new RegExp(&quot;'(?:\\\\.|[^\\\\'])*?'&quot;, &quot;mg&quot;);
syntaxify.regexpCSingleLineComment = new RegExp('//.*$', &quot;g&quot;);
syntaxify.regexpCMultiLineComment 
    = new RegExp('/\\*(?:(?:.|(?:\\r)?\\n)(?!\\*/))*(?:.|(?:\\r)?\\n)?\\*/',&quot;mg&quot;);
String.prototype.htmlListMono = function() {
    return(this.replace(syntaxify.regexpAmp,&quot;&amp;amp;&quot;)
               .replace(syntaxify.regexpLessThan,&quot;&amp;lt;&quot;)
               .replace(syntaxify.regexpGreaterThan,&quot;&amp;gt;&quot;)
               .replace(syntaxify.regexpQuote,&quot;&amp;quot;&quot;)
               .replace(syntaxify.regexpSpace,&quot;&amp;nbsp;&quot;)
               .replace(syntaxify.regexpTab,&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;));
}

syntaxify.handleSpanClass = function(w) {
    var match, lastPos=0;
    if(this.lookahead) {
        var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);  
        lookaheadRegExp.lastIndex = w.matchStart;  
        var lookaheadMatch = lookaheadRegExp.exec(w.source);  
        if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {  
            createTiddlyText(w.output, lookaheadMatch[1]);
            var e = createTiddlyElement(w.output, &quot;span&quot;, null, this.name);
            e.innerHTML = this.hasSpaces?lookaheadMatch[2].htmlListMono():lookaheadMatch[2];
        }
    } else {
        while((match = regexpNewLine.exec(w.matchText)) != null) {  // multi-line
            var alt = &quot;&quot;;
            var e = createTiddlyElement(w.output, &quot;span&quot;, null, this.name);
            e.innerHTML = this.hasSpaces?w.matchText.substr(lastPos,match.index-lastPos).htmlListMono()
                            :w.matchText.substr(lastPos,match.index-lastPos);
            if(w.output.className != &quot;alt&quot;) alt = &quot;alt&quot;;
            w.output = createTiddlyElement(w.output.parentNode, &quot;li&quot;, null, alt);
            lastPos = match.index;
        } 
        var e = createTiddlyElement(w.output, &quot;span&quot;, null, this.name);
        e.innerHTML = this.hasSpaces?w.matchText.substr(lastPos, w.matchText.length-lastPos).htmlListMono()
                        :w.matchText.substr(lastPos, w.matchText.length-lastPos)
    }
}

/* This is a shadow tiddler.  Do not edit it here.  Instead, open the tiddler StyleSheetSyntaxify 
 * and edit it instead.  (go to the toolbar on the right and select &quot;More&quot;-&gt;&quot;Shadowed&quot;) */
config.shadowTiddlers.StyleSheetSyntaxify = &quot;/*{{{*/\n&quot;
+&quot;.viewer .syntaxify {\n&quot;
+&quot;         font-family: monospace;\n&quot;
+&quot;}\n&quot;
+&quot;.viewer div.syntaxify {\n&quot;
+&quot;         background-color: #ffc;\n&quot;
+&quot;         border: 1px solid #fe8;\n&quot;
+&quot;         padding: 0.5em;\n&quot;
+&quot;         margin: 0 0 1em 0.5em;\n&quot;
+&quot;         font-size: 1.2em;\n&quot;
+&quot;         overflow: auto;\n&quot;
+&quot;}\n\n&quot;
+&quot;.syntaxify ol {\n&quot;
+&quot;        margin: 0;\n&quot;
+&quot;        padding: 1px;\n&quot;
+&quot;        color: #2B91AF;\n&quot;
+&quot;}\n\n&quot;
+&quot;.syntaxify ol li {\n&quot;
+&quot;       background-color: #ffc;\n&quot;
+&quot;       color: black;\n&quot;
+&quot;       list-style-type: none;\n&quot;
+&quot;/* An alternate style to enable line numbering -- remove the line above and uncomment below if desired */\n&quot;
+&quot;/*\n&quot;
+&quot;       list-style-type: 1;\n&quot;
+&quot;       border-left: 3px solid #fe8;\n&quot;
+&quot;       margin-left: 3.5em;\n&quot;
+&quot;*/\n&quot;
+&quot;}\n\n&quot;
+&quot;/* To disable alternating lines having a different colors, comment out the following line. */\n&quot;
+&quot;.syntaxify ol li.alt { background-color: #ffe; }\n\n&quot;
+&quot;.syntaxify ol li span { color: black; }\n&quot;
+&quot;.syntaxify .singleLineComments { color: green; }\n&quot;
+&quot;.syntaxify .multiLineComments { color: green; }\n&quot;
+&quot;.syntaxify .multiLineComments1 { color: red; }\n&quot;
+&quot;.syntaxify .tag { font-weight: bold; color: blue; }\n&quot;
+&quot;.syntaxify .tagname { font-weight: bold; color: black; }\n&quot;
+&quot;.syntaxify .attribute { color: rgb(127,0,85); }\n&quot;
+&quot;.syntaxify .value { color: rgb(42,0,255); }\n&quot;
+&quot;.syntaxify .keywords { color: #006699; }\n&quot;
+&quot;.syntaxify .keywords1 { color: red; }\n&quot;
+&quot;.syntaxify .delimiters { color: maroon; }\n&quot;
+&quot;.syntaxify .delimiters1 { color: olive; }\n&quot;
+&quot;.syntaxify .literals { color: maroon; }\n&quot;
+&quot;.syntaxify .literals1 { color: blue; }\n&quot;
+&quot;.syntaxify .literals2 { color: blue; }\n&quot;
+&quot;.syntaxify .literals3 { color: #129; }\n&quot;
+&quot;.syntaxify .identifiers { font-weight: bold; color: blue; }\n&quot;
+&quot;.syntaxify .identifiers1 { font-weight: bold; color: black; }\n&quot;
+&quot;/*}}}*/&quot;;

store.addNotification(&quot;StyleSheetSyntaxify&quot;,refreshStyles);
config.shadowTiddlers.ViewTemplate = &quot;&lt;!--{{{--&gt;\n&quot;+config.shadowTiddlers.ViewTemplate+&quot;\n&lt;!--}}}--&gt;&quot;;
config.shadowTiddlers.EditTemplate = &quot;&lt;!--{{{--&gt;\n&quot;+config.shadowTiddlers.EditTemplate+&quot;\n&lt;!--}}}--&gt;&quot;;
config.shadowTiddlers.PageTemplate = &quot;&lt;!--{{{--&gt;\n&quot;+config.shadowTiddlers.PageTemplate+&quot;\n&lt;!--}}}--&gt;&quot;;
config.shadowTiddlers.StyleSheetPrint = &quot;/*{{{*/\n&quot;+config.shadowTiddlers.StyleSheetPrint+&quot;\n/*}}}*/&quot;;

syntaxify.commonFormatters = [
{   name: &quot;spaces&quot;,
    match: &quot;[ \\t]+&quot;,
    handler: function(w) {
        w.output.innerHTML += w.matchText.htmlListMono();
    }
},{ name: &quot;newline&quot;,
    match: &quot;\\n&quot;,
    handler: function(w) {
        var alt = &quot;&quot;
        if(w.output.className != &quot;alt&quot;) alt = &quot;alt&quot;;
        if(!w.output.hasChildNodes()) w.output.innerHTML = &quot;&amp;nbsp;&quot;;
        w.output = createTiddlyElement(w.output.parentNode, &quot;li&quot;, null, alt);
    }
}];

syntaxify.xmlTagFormatters = syntaxify.commonFormatters;
syntaxify.xmlTagFormatters = syntaxify.xmlTagFormatters.concat([
{   name: &quot;tagname&quot;,
    match: '&lt;[/\\?]?\\s*(?:[\\w-\\.]+)',
    lookahead: '(&lt;[/\\?]?\\s*)([\\w-\\.]+)',
    handler: syntaxify.handleSpanClass
},{
    name: &quot;attribute-value&quot;,
    match: '[\\w-\.]+(?:\\s*=\\s*&quot;[^&quot;]*?&quot;|\'[^\']*?\'|\\w+)?',
    lookahead: '([\\w-\.]+)(?:(\\s*=\\s*)(&quot;[^&quot;]*?&quot;|\'[^\']*?\'|\\w+))?',
    handler: function(w) {
        var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);  
        lookaheadRegExp.lastIndex = w.matchStart;  
        var lookaheadMatch = lookaheadRegExp.exec(w.source);  
        if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {  
            var e = createTiddlyElement(w.output, &quot;span&quot;, null, &quot;attribute&quot;);
            e.innerHTML = lookaheadMatch[1];
            if(lookaheadMatch[2]) {
                var e = createTiddlyElement(w.output, &quot;span&quot;);
                e.innerHTML = lookaheadMatch[2].htmlListMono();
                e = createTiddlyElement(w.output, &quot;span&quot;, null, &quot;value&quot;);
                e.innerHTML = lookaheadMatch[3].htmlListMono();
            }
        }
        w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;  
    }
}]);


// A rather huge data structure to store languages.  Add to it!
syntaxify.languages = {
javascript: {
    singleLineComments: [[syntaxify.regexpCSingleLineComment.source]],
    multiLineComments: [[syntaxify.regexpCMultiLineComment.source]],
    keywords: [['abstract', 'boolean', 'break', 'byte', 'case', 'catch', 'char',
        'class', 'const', 'continue', 'debugger', 'default', 'delete', 'do',
        'double', 'else', 'enum', 'export', 'extends', 'false', 'final',
        'finally', 'float', 'for', 'function', 'goto', 'if', 'implements',
        'import', 'in', 'instanceof', 'int', 'interface', 'long', 'native',
        'new', 'null', 'package', 'private', 'protected', 'public', 'return',
        'short', 'static', 'super', 'switch', 'synchronized', 'this', 'throw',
        'throws', 'transient', 'true', 'try', 'typeof', 'var', 'void',
        'volatile', 'while', 'with']
    ],
    literals: [
        [syntaxify.regexpSingleQuotedString.source],
        [syntaxify.regexpDoubleQuotedString.source],
        [&quot;\\b\\d+(?:\\.\\d+(?:[eE][\\+-]\\d+)?)?\\b&quot;] // Numbers
    ],
    delimiters: [[&quot;[\\{\\}]&quot;],[&quot;[\\(\\)]&quot;],[&quot;[\\[\\]]&quot;]]
}, 
css: {
    multiLineComments: [[syntaxify.regexpCMultiLineComment.source]],
    keywords: [
        // Keywords appearing on the LHS of expressions
        ['ascent', 'azimuth', 'background-attachment', 'background-color',
        'background-image', 'background-position',  'background-repeat',
        'background', 'baseline', 'bbox', 'border-collapse', 'border-color',
        'border-spacing', 'border-style', 'border-top',  'border-right',
        'border-bottom', 'border-left', 'border-top-color',
        'border-right-color', 'border-bottom-color', 'border-left-color',
        'border-top-style', 'border-right-style', 'border-bottom-style',
        'border-left-style', 'border-top-width', 'border-right-width',
        'border-bottom-width', 'border-left-width', 'border-width', 'border',
        'bottom', 'cap-height', 'caption-side', 'centerline', 'clear', 'clip',
        'color',  'content', 'counter-increment', 'counter-reset', 'cue-after',
        'cue-before', 'cue', 'cursor', 'definition-src', 'descent',
        'direction', 'display', 'elevation', 'empty-cells', 'float',
        'font-size-adjust', 'font-family', 'font-size', 'font-stretch',
        'font-style', 'font-variant', 'font-weight', 'font',  'height', 'left',
        'letter-spacing', 'line-height', 'list-style-image',
        'list-style-position', 'list-style-type', 'list-style', 'margin-top',
        'margin-right', 'margin-bottom', 'margin-left', 'margin',
        'marker-offset', 'marks', 'mathline', 'max-height', 'max-width',
        'min-height', 'min-width', 'orphans',  'outline-color',
        'outline-style', 'outline-width', 'outline', 'overflow', 'padding-top',
        'padding-right', 'padding-bottom', 'padding-left', 'padding', 'page',
        'page-break-after', 'page-break-before', 'page-break-inside', 'pause',
        'pause-after', 'pause-before', 'pitch', 'pitch-range', 'play-during',
        'position', 'quotes', 'richness', 'right', 'size', 'slope', 'src',
        'speak-header', 'speak-numeral', 'speak-punctuation', 'speak',
        'speech-rate', 'stemh', 'stemv', 'stress', 'table-layout',
        'text-align', 'text-decoration', 'text-indent', 'text-shadow',
        'text-transform', 'unicode-bidi', 'unicode-range', 'units-per-em',
        'vertical-align', 'visibility', 'voice-family', 'volume',
        'white-space', 'widows', 'width', 'widths', 'word-spacing', 'x-height',
        'z-index'],
        // Treat !important as a different kind of keyword
        [&quot;important&quot;]
    ],
    literals: [
        // Literals appearing on the RHS of expressions
        ['above', 'absolute', 'all', 'always', 'aqua', 'armenian', 'attr',
        'aural', 'auto', 'avoid', 'baseline', 'behind', 'below',
        'bidi-override', 'black', 'blink', 'block', 'blue', 'bold', 'bolder',
        'both', 'bottom', 'braille', 'capitalize', 'caption', 'center',
        'center-left', 'center-right', 'circle', 'close-quote', 'code',
        'collapse', 'compact', 'condensed', 'continuous', 'counter',
        'counters', 'crop', 'cross', 'crosshair', 'cursive', 'dashed',
        'decimal', 'decimal-leading-zero', 'default', 'digits', 'disc',
        'dotted', 'double', 'embed', 'embossed', 'e-resize', 'expanded',
        'extra-condensed', 'extra-expanded', 'fantasy', 'far-left',
        'far-right', 'fast', 'faster', 'fixed', 'format', 'fuchsia', 'gray',
        'green', 'groove', 'handheld', 'hebrew', 'help', 'hidden', 'hide',
        'high', 'higher', 'icon', 'inline-table', 'inline', 'inset', 'inside',
        'invert', 'italic', 'justify', 'landscape', 'large', 'larger',
        'left-side', 'left', 'leftwards', 'level', 'lighter', 'lime',
        'line-through', 'list-item', 'local', 'loud', 'lower-alpha',
        'lowercase', 'lower-greek', 'lower-latin', 'lower-roman', 'lower',
        'low', 'ltr', 'marker', 'maroon', 'medium', 'message-box', 'middle',
        'mix', 'move', 'narrower', 'navy', 'ne-resize', 'no-close-quote',
        'none', 'no-open-quote', 'no-repeat', 'normal', 'nowrap', 'n-resize',
        'nw-resize', 'oblique', 'olive', 'once', 'open-quote', 'outset',
        'outside', 'overline', 'pointer', 'portrait', 'pre', 'print',
        'projection', 'purple', 'red', 'relative', 'repeat', 'repeat-x',
        'repeat-y', 'ridge', 'right', 'right-side', 'rightwards', 'rtl',
        'run-in', 'screen', 'scroll', 'semi-condensed', 'semi-expanded',
        'separate', 'se-resize', 'show', 'silent', 'silver', 'slower', 'slow',
        'small', 'small-caps', 'small-caption', 'smaller', 'soft', 'solid',
        'speech', 'spell-out', 'square', 's-resize', 'static', 'status-bar',
        'sub', 'super', 'sw-resize', 'table-caption', 'table-cell',
        'table-column', 'table-column-group', 'table-footer-group',
        'table-header-group', 'table-row', 'table-row-group', 'teal',
        'text-bottom', 'text-top', 'thick', 'thin', 'top', 'transparent',
        'tty', 'tv', 'ultra-condensed', 'ultra-expanded', 'underline',
        'upper-alpha', 'uppercase', 'upper-latin', 'upper-roman', 'url',
        'visible', 'wait', 'white', 'wider', 'w-resize', 'x-fast', 'x-high',
        'x-large', 'x-loud', 'x-low', 'x-slow', 'x-small', 'x-soft',
        'xx-large', 'xx-small', 'yellow'],
        // Font literals
        ['[mM]ono(?:space)?', '[tT]ahoma', '[vV]erdana', '[aA]rial',
        '[hH]elvetica', '[sS]ans(?:-serif)?', '[sS]erif', '[Cc]ourier'],
        // Measurement literals
        [&quot;\\b\\d+(?:\\.\\d+)?(?:em|pt|px|cm|in|pc|mm)\\b&quot;],
        // Color literals
        ['(?:\\#[a-fA-F0-9]{6}\\b|\\#[a-fA-F0-9]{3}\\b|rgb\\(\\s*\\d+\\s*,\\s*\\d+\\s*,\\s*\\d+\\s*\\))']
    ],
    identifiers: [[&quot;\\.[a-zA-Z_]\\w*&quot;],[&quot;\\#[a-zA-Z_]\\w*&quot;]],
    delimiters: [[&quot;[\\{\\}]&quot;]]
}, 
xml: {
    multiLineComments: [
        [&quot;&lt;[^!&gt;]*!--\\s*(?:(?:.|(?:\\r)?\\n)(?!--))*?(?:(?:.|(?:\\r)?\\n)(?=--))?\\s*--[^&gt;]*?&gt;&quot;],
        ['&lt;\\!\\[[\\w\\s]*?\\[(?:(?:.|(?:\\r)?\\n)(?!\\]\\]&gt;))*?(?:(?:.|(?:\\r)?\\n)(?=\\]\\]&gt;))?\\]\\]&gt;']
    ],
    customFormatters: [{
        name: &quot;tag&quot;,
        match: &quot;&lt;[/\\?]?[^&gt;]*?&gt;&quot;,
        handler: function(w) {
            var formatter = new Formatter(syntaxify.xmlTagFormatters);
            var wikifier = new Wikifier(w.matchText, formatter, w.highlightRegExp, w.tiddler);
            wikifier.subWikify(w.output, null);
        }
    }]
}};

config.formatterHelpers.customClassesHelper = function(w) {
    var lookaheadRegExp = (typeof(this.lookaheadRegExp) == &quot;undefined&quot;)?(new RegExp(this.lookahead,&quot;mg&quot;)):this.lookaheadRegExp;
    lookaheadRegExp.lastIndex = w.matchStart;
    var lookaheadMatch = lookaheadRegExp.exec(w.source);
    var language = (typeof(this.language) == &quot;undefined&quot;)?lookaheadMatch[1]:this.language;
    if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart)
    {
        var isByLine = (typeof(this.byLine) == &quot;undefined&quot;)?(lookaheadMatch[2] == &quot;\n&quot;):this.byLine;
        var p = createTiddlyElement(w.output,isByLine ? &quot;div&quot; : &quot;span&quot;,null,language);
        w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
        if(typeof(syntaxify.formatters[language]) != &quot;undefined&quot;) {
            var d = createTiddlyElement(w.output,isByLine?&quot;div&quot;:&quot;span&quot;,
				        null,&quot;syntaxify &quot;+language);
            var formatter = new Formatter(syntaxify.formatters[language]);
            if(typeof(this.termRegExp) == &quot;undefined&quot;) {
                var text = lookaheadMatch[1];  
            } else {
                this.termRegExp.lastIndex = w.nextMatch;
                var terminatorMatch = this.termRegExp.exec(w.source);
                var text = w.source.substr(w.nextMatch, terminatorMatch.index-w.nextMatch);
            }
            if(config.browser.isIE) text = text.replace(/\n/g,&quot;\r&quot;);  
            if (isByLine) {
                var l = createTiddlyElement(d,&quot;ol&quot;);
                var li = createTiddlyElement(l,&quot;li&quot;);
                var wikifier = new Wikifier(text, formatter, w.highlightRegExp, w.tiddler);
                wikifier.subWikify(li, null);
                if(!l.childNodes[l.childNodes.length-1].hasChildNodes())
                    l.removeChild(l.childNodes[l.childNodes.length-1]);
            } else {
	      var wikifier = new Wikifier(text,formatter,w.highlightRegExp,w.tiddler);
	      wikifier.subWikify(d, null);
            }
            if(typeof(this.termRegExp) != &quot;undefined&quot;)
                w.nextMatch = terminatorMatch.index + terminatorMatch[0].length;
            else
                w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;  
        } else {
		w.subWikify(p,this.terminator);
/*
            if(isByLine)
                var e = createTiddlyElement(w.output,&quot;code&quot;,null,null,text);  
            else
                var e = createTiddlyElement(w.output,&quot;pre&quot;,null,null,text);  
*/
        }
    }
}

syntaxify.formatters = {};

syntaxify.addLanguages = function(languages) {
    for(lang in languages) {
        syntaxify.formatters[lang] = new Array();
        for(var i=0;i&lt;syntaxify.commonFormatters.length;i++)
            syntaxify.formatters[lang].push(syntaxify.commonFormatters[i]);
        var addSpanClass = function(rule, spaces, wordbreak) {
            if(typeof(languages[lang][rule]) != &quot;undefined&quot;) {
                for(var j=0;j&lt;languages[lang][rule].length;j++) {
                    syntaxify.formatters[lang].push({
                        name: rule+((j==0)?&quot;&quot;:j),
                        match: wordbreak?(&quot;(?:\\b&quot;+languages[lang][rule][j].join(&quot;\\b|\\b&quot;)+&quot;\\b)&quot;)
                                        :(&quot;(?:&quot;+languages[lang][rule][j].join(&quot;|&quot;)+&quot;)&quot;),
                        hasSpaces: spaces,
                        handler: syntaxify.handleSpanClass
                    });
                }
            }
        };
        addSpanClass(&quot;singleLineComments&quot;, true, false);
        addSpanClass(&quot;multiLineComments&quot;, true, false);
        addSpanClass(&quot;keywords&quot;, false, true);
        addSpanClass(&quot;literals&quot;, true, false);
        addSpanClass(&quot;delimiters&quot;, false, false);
        addSpanClass(&quot;identifiers&quot;, false, false);
        if(typeof(languages[lang].customFormatters) != &quot;undefined&quot;) 
            syntaxify.formatters[lang] = syntaxify.formatters[lang].concat(languages[lang].customFormatters);
    }
}

syntaxify.addLanguages(syntaxify.languages);

// Override the several built-in TiddlyWiki language-specific &lt;pre&gt; formatters
for(var i=0;i&lt;config.formatters.length;i++) {  
  if(config.formatters[i].name == &quot;monospacedByLineForPlugin&quot;) {  
    config.formatters[i].language = &quot;javascript&quot;;
    config.formatters[i].byLine = true;
    config.formatters[i].handler = config.formatterHelpers.customClassesHelper;  
  }  
  if(config.formatters[i].name == &quot;monospacedByLineForCSS&quot;) {  
    config.formatters[i].language = &quot;css&quot;;
    config.formatters[i].byLine = true;
    config.formatters[i].handler = config.formatterHelpers.customClassesHelper;  
  }  
  if(config.formatters[i].name == &quot;monospacedByLineForTemplate&quot;) {  
    config.formatters[i].language = &quot;xml&quot;;
    config.formatters[i].byLine = true;
    config.formatters[i].handler = config.formatterHelpers.customClassesHelper;  
  }  
  if(config.formatters[i].name == &quot;customClasses&quot;) {
    config.formatters[i].handler = config.formatterHelpers.customClassesHelper;  
    if(typeof(config.formatters[i].termRegExp) == &quot;undefined&quot;)
        config.formatters[i].termRegExp = new RegExp(config.formatters[i].terminator, &quot;mg&quot;);
  }
}

// make syntaxify reliably accessible from dependent plugins even under IE.
config.macros.syntaxify = syntaxify;
//}}}
</pre>
</div>
<div title="SyntaxifyPlugin: Haskell" modifier="Conal Elliott" modified="200701292254" created="200612261943" tags="systemConfig 2006-12-24 SyntaxifyPlugin">
<pre>/***
|Author|[[Conal Elliott|http://conal.net]]|
|Date|2007-01-28|
|Version|1.1|
|LoadDependencies|SyntaxifyPlugin|
!Description
Add support for [[Haskell| http://haskell.org]] syntax highlighting, as an extension to SyntaxifyPlugin.
!Use
{{{
{{haskell{
&lt;haskell code goes here&gt;
}}} 
}}}
or &lt;html&gt;&lt;code&gt;{{haskell{inline code}}}&lt;/code&gt;&lt;/html&gt;.
!Example
{{haskell{
-- Define the data types and conversion:
type Line = String

silly :: Line -&gt; Line
silly src = src ++ toU &quot; oho &quot; ++ reverse src
 where
   toU = map toUpper
}}}
or {{haskell{if foo then &quot;bar&quot; else &quot;baz&quot;}}}.
!History
* Version 1.1
** Smarter {{haskell{identifiers}}} pattern, to avoid false hits for expressions (especially in-line).
** {{haskell{{- Multi-line comments -} }}} 
!To Do
* Type coloring.
!See Also
* SyntaxifyPlugin
* [[RewritePlugin: Haskell]] for a more convenient notation (especially with literate Haskell programming).
!Code
***/
//{{{
version.extensions.syntaxifyHaskell =
  {major: 1, minor: 1, revision: 0, date: new Date(2007,1,28)};

config.macros.syntaxify.addLanguages({
  haskell:
      { singleLineComments: [[new RegExp('-- .*$', &quot;g&quot;).source]]
      , keywords: 
          [ [ 'as', 'case', 'class', 'data', 'default'
            , 'deriving', 'do', 'else', 'forall', 'hiding', 'if'
            , 'import', 'in', 'infix', 'infixl', 'infixr'
            , 'instance', 'let', 'module', 'newtype', 'of'
            , 'qualified', 'then', 'type', 'where', '_'
            ]
          , [&quot;\\b[A-Z][a-zA-Z0-9]*\\b&quot;] 
          ]
      , literals:
	  [ [&quot;'(?:\\\\.|[^\\\\'])'&quot;] // char literals
	  , [config.macros.syntaxify.regexpDoubleQuotedString.source]
	  , [&quot;\\b\\d+(?:\\.\\d+(?:[eE][\\+-]\\d+)?)?\\b&quot;] // Numbers
	  ]
      // def or decl.  id in &quot;id ... = ...&quot; or &quot;id :: ...&quot;.  Ids can have tick marks.
      // The &quot;...&quot; must not contain symbols.  (Not strictly true in Haskell, but too hard
      // to describe fully with regexps.)
      , identifiers: [[&quot;^[a-z][a-zA-Z0-9']*\\b'*(?=(?:[^=&lt;&gt;:+-]*=|\\s*::)[^=&lt;&gt;:+-])&quot;]]
      , delimiters: [/*[&quot;[\\{\\}]&quot;],*/[&quot;[\\(\\)]&quot;],[&quot;[\\[\\]]&quot;]]
      , multiLineComments: [[&quot;{-(?:.|\n)*?-}&quot;]]
      }
});
//}}}
</pre>
</div>
<div title="TTSideBarOptions" modifier="Conal Elliott" modified="200702100331" created="200610230306">
<pre>/%

TIDDLER CONTENTS COPIED FROM: SideBarOptionsFull

%/{{fine{{{floatright{&lt;&lt;tiddler ExpandSlidersScript with: &quot;sidebar&quot; &quot;expand&quot; &quot;collapse&quot;&gt;&gt;}}}}}}++++(goto)[goto]...{{borderleft{
	&lt;&lt;tiddler SiteMenuGoto&gt;&gt;}}}===
++++(search)[search]...{{borderleft{
	&lt;&lt;tiddler SiteMenuSearch&gt;&gt;}}}===
{{floatright{&lt;&lt;tiddler ToggleReadOnly&gt;&gt;}}}+++(file)[file]...{{borderleft{
	&lt;&lt;tiddler SiteMenuFile&gt;&gt;}}}===
+++(edit)[edit]...{{borderleft{
	&lt;&lt;tiddler SiteMenuEdit&gt;&gt;}}}===
+++(view)[view]...{{borderleft{
	&lt;&lt;tiddler SiteMenuView&gt;&gt;}}}===
+++(options)[options]...{{borderleft{
	&lt;&lt;tiddler SiteMenuOptions&gt;&gt;}}}===
+++(calendar)[calendar]...{{borderleft{
	{{groupbox{{{small{&lt;&lt;calendar thismonth&gt;&gt;&lt;script&gt;
		place.lastChild.style.width=&quot;100%&quot;;
	&lt;/script&gt;}}}}}}}}}===</pre>
</div>
<div title="TV" modifier="Conal Elliott" modified="200703061834" created="200701031948" tags="2007-01-03 project">
<pre>See Haskell wiki [[TV page| http://haskell.org/haskellwiki/TV]].
* ''Next action'' Larger IO example.  Fix the mapf.
* To do ++++
*  IO examples
*  Move modules.  Use top-level {{{Interface}}} name and then things like module {{{Interface.Graphics.UI.Phooey}}} or module {{{Graphics.UI.Phooey.Interface}}}.  Fix all of the doc references in the wiki.
*  Discuss defaults?
*  Re-think the module choices for TV, now that very little of it (ten lines of code plus five lines of import and one for the module) is UI.  Thoughts:++++
*   It's sort of about interfacing with &quot;foreign&quot; entities, so it could go in Foreign, along with Foreign.C and Foreign.Marshal.  It's a stretch.
*   Ask the folks on libraries@haskell.org.  Give them a description and ask for suggestions.  Or just pick something, put it out there, and then ask for suggestions.  Change the location in an update.
   === 
*  Wiki page: http://haskell.org/haskellwiki/TV.
*  Decide on examples style.  Like DeepArrow (haddock'd Examples) or like Phooey?
*  Maybe factor out a [[cofunctor package]].
*  Add to http://haskell.org/haskellwiki/Libraries_and_tools/Graphics and what else?
*  Larger IO example.  Fix the mapf.
*  Reconcile this list and the [[project release check-list]].
*  Re-think the name &quot;TV&quot;.  Is it suitably general?  I'll stick with it for now.
*  Learn to set up trac, and do it.
*  Use ICompose to make a dynamically bounded slider example.
*  Explore combining arrows, like UI &amp; KIO, for file reading in a GUI app.
*  Find an application for HAppS.  See thoughts on [[2007-01-03]].
*  Consider additional approach to UI &amp; IO: make an {{{Output UI (IO ())}}} that consumes the IO by executing it.  Is that possible in the (Phooey) UI arrow?
  === 
* Done +++
*  Eliminate {{{intIn}}}.  Change the examples that use it.  First present pure GUI examples, then show that in some cases, we can render a TV in more than one way.
*  Some re-arranging.  Introduce {{{Tangible}}} module, defining {{{TV}}}, and knowing nothing about {{{Common}}} or UI, or IO.
*  Show off TV currying/uncurrying.
*  Get DeepArrow-0.0 and the phooey-0.0 done and on the web, with docs.  Check that the doc links all work.
*  Wiki page
*  Docs with source &amp; comment pointers
*  Come up with some compelling composition examples.
*  Write up a [[TV description]].
*  Write up an explanation of the library.  The resulting clarity may enlighten me about name and module choices.
  === 
</pre>
</div>
<div title="TV description" modifier="Conal Elliott" modified="200701070417" created="200701052007" tags="TV 2007-01-05">
<pre>* See also [[notes on Tangible Values]]
* Descriptive words: interface, output, present, glue, compose, connect, composable interfaces.  Go with &quot;composable interfaces&quot;.
* Purpose: Interfacing/connecting with pure values.  Value and interface combined for convenience but separable, for composability.
</pre>
</div>
<div title="TabTimeline" modifier="Conal Elliott" modified="200611040205" created="200611040203">
<pre>&lt;&lt;timeline&gt;&gt;</pre>
</div>
<div title="TiddlyWiki" modifier="Conal Elliott" created="200612311636" tags="2006-12-31 definition">
<pre>Great fun.  See http://tiddlywiki.com.</pre>
</div>
<div title="TiddlyWiki hacking" modifier="Conal Elliott" modified="200611232112" created="200611182240" tags="2006-11-18 project">
<pre>* Rounded corners as in http://TiddlyWikiTips.com.  Did tags &amp; tagging.
* Reduce indentation for bulleted &amp; numbered paragraphs.
* wysiwyg.  See [[2006-10-31]].
* A better smiley plugin, using prettier images.  Abandon self-contained.
* Revisit my ~ZiddlyWiki organization.  Can I have one Zope instance handling several independent ~TWs and separate user permissions?  See [[2006-10-31]].
* Factor out my plugins into javascript code that lives on the server.
* Eliminate the right panel.  Move the really useful controls to the top, hide some under a drop-down, and move some to a tiddler.
* Learn to have a nice logo image [[like this one|http://conal.net/images/misc/feeding-hungry-ducks-shadow-thumb.png]].
* Surf for even more plugins.</pre>
</div>
<div title="ToggleLeftSidebar" modifier="Conal Elliott" created="200702100101" tags="script 2007-02-09">
<pre>/%
|Name|ToggleLeftSidebar|
|Source|http://www.TiddlyTools.com/#ToggleLeftSidebar|
|Version|0.0.0|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;&lt;br&gt;&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|script|
|Requires||
|Overrides||
|Description||
%/&lt;script label=&quot;show/hide left sidebar&quot;&gt;
	var show=document.getElementById('mainMenu').style.display=='none';
	if (!show) {
		document.getElementById('mainMenu').style.display='none';
		var margin='1em';
	}
	else {
		document.getElementById('mainMenu').style.display='block';
		var margin=config.options.txtDisplayAreaLeftMargin?config.options.txtDisplayAreaLeftMargin:&quot;&quot;;
	}
	place.innerHTML=(show?&quot;&amp;lt;&amp;lt;&amp;lt;&quot;:&quot;&amp;gt;&amp;gt;&amp;gt;&quot;); // SET LINK TEXT
	place.title=show?&quot;hide sidebar&quot;:&quot;show sidebar&quot;; // SET TOOLTIP
	document.getElementById('displayArea').style.marginLeft=margin;
	config.options.chkShowLeftSidebar=show;
	saveOptionCookie('chkShowLeftSidebar');
	var sm=document.getElementById(&quot;storyMenu&quot;); if (sm) config.refreshers.content(sm);
	return false;
&lt;/script&gt;&lt;script&gt;
	if (config.options.chkShowLeftSidebar==undefined)
		config.options.chkShowLeftSidebar=true;
	if (!config.options.txtDisplayAreaLeftMargin||!config.options.txtDisplayAreaLeftMargin.length)
		config.options.txtDisplayAreaLeftMargin=&quot;13em&quot;;
	var show=config.options.chkShowLeftSidebar;
	document.getElementById('mainMenu').style.display=show?&quot;block&quot;:&quot;none&quot;;
	document.getElementById('displayArea').style.marginLeft=show?config.options.txtDisplayAreaLeftMargin:&quot;1em&quot;;
	place.lastChild.innerHTML=(show?&quot;&amp;lt;&amp;lt;&amp;lt;&quot;:&quot;&amp;gt;&amp;gt;&amp;gt;&quot;); // SET LINK TEXT
	place.lastChild.title=show?&quot;hide sidebar&quot;:&quot;show sidebar&quot;; // SET TOOLTIP
	place.lastChild.style.fontWeight=&quot;normal&quot;;
&lt;/script&gt;</pre>
</div>
<div title="ToggleRightSidebar" modifier="Conal Elliott" modified="200709050338" created="200702100055" tags="script 2007-02-09" changecount="1">
<pre>/%
|Name|ToggleRightSidebar|
|Source|http://www.TiddlyTools.com/#ToggleRightSidebar|
|Version|0.0.0|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;&lt;br&gt;&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|script|
|Requires||
|Overrides||
|Description||
%/&lt;script label=&quot;show/hide right sidebar&quot;&gt;
	var show=document.getElementById('sidebar').style.display=='none';
	if (!show) {
		document.getElementById('sidebar').style.display='none';
		var margin='1em';
	}
	else {
		document.getElementById('sidebar').style.display='block';
		var margin=config.options.txtDisplayAreaRightMargin?config.options.txtDisplayAreaRightMargin:&quot;&quot;;
	}
	place.innerHTML=(show?&quot;Need More Room?&quot;:&quot;Need the Sidebar?&quot;); // SET LINK TEXT
	place.title=show?&quot;hide sidebar&quot;:&quot;show sidebar&quot;; // SET TOOLTIP
	document.getElementById('displayArea').style.marginRight=margin;
	config.options.chkShowRightSidebar=show;
	saveOptionCookie('chkShowRightSidebar');
	var sm=document.getElementById(&quot;storyMenu&quot;); if (sm) config.refreshers.content(sm);
	return false;
&lt;/script&gt;&lt;script&gt;
	if (config.options.chkShowRightSidebar==undefined)
		config.options.chkShowRightSidebar=true;
	if (!config.options.txtDisplayAreaRightMargin||!config.options.txtDisplayAreaRightMargin.length)
		config.options.txtDisplayAreaRightMargin=&quot;15em&quot;;
	var show=config.options.chkShowRightSidebar;
	document.getElementById('sidebar').style.display=show?&quot;block&quot;:&quot;none&quot;;
	document.getElementById('displayArea').style.marginRight=show?config.options.txtDisplayAreaRightMargin:&quot;1em&quot;;
	place.lastChild.innerHTML=(show?&quot;Hide Sidebar;&quot;:&quot;Show Sidebar;&quot;); // SET LINK TEXT
	place.lastChild.title=show?&quot;hide sidebar&quot;:&quot;show sidebar&quot;; // SET TOOLTIP
	place.lastChild.style.fontWeight=&quot;normal&quot;;
&lt;/script&gt;</pre>
</div>
<div title="Tools" modifier="Conal Elliott" modified="200703091756" created="200703091755" tags="resource 2007-03-09">
<pre>* [[Pandoc| http://sophos.berkeley.edu/macfarlane/pandoc]] &quot;is a Haskell library for converting from one markup format to another, and a command-line tool that uses this library. It can read markdown  and (subsets of) reStructuredText, HTML, and LaTeX, and it can write markdown, reStructuredText, HTML, LaTeX, RTF, DocBook XML, and S5 HTML slide shows.&quot;</pre>
</div>
<div title="UseDependencies" modifier="Conal Elliott" modified="200612311650" created="200612311628" tags="2006-12-31 TiddlyWiki definition">
<pre>Some [[plugin]]s define formatters etc whose use (rendering) builds on other plugins.  Unlike LoadDependencies, a plugin may be loaded before or after its UseDependencies.

When UseDependencies are also LoadDependencies, I list them only as LoadDependencies.</pre>
</div>
<div title="ViewTemplate" modifier="Conal Elliott" modified="200701220002" created="200701210320">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar -closeTiddler closeOthers collapseTiddler  collapseOthers +editTiddler permalink references revisions comments'&gt;&lt;/div&gt;
&lt;div&gt;
&lt;span class='title' macro='view title'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='subtitle'&gt;(edited &lt;span macro='view modified date [[MM/DD/YY]]'&gt;&lt;/span&gt;, created &lt;span macro='view created date [[MM/DD/YY]]'&gt;&lt;/span&gt;) 
 &amp;nbsp;| &lt;span class='comments' macro='haloscan comments'&gt;&lt;/span&gt; &lt;!-- | &lt;span  class='comments' macro='haloscan trackbacks'&gt;&lt;/span&gt; --&gt;
| &lt;span class='tagged' macro='tags'&gt;&lt;/span&gt;
&lt;/span&gt;
&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;span class='tagging' macro='tagging'&gt;&lt;/span&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!-- &lt;div class='commentsHaloscan' macro='haloscan' style='float: right;'&gt;&lt;/div&gt;&lt;br /&gt; --&gt;
&lt;!-- &lt;div class='comments' macro='comments'&gt;&lt;/div&gt; --&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="Was literate Haskell plugin" modifier="Conal Elliott" modified="200701272319" created="200701010117" tags="systemConfig_not 2006-12-30 editing Haskell NestedFormatterMacro">
<pre>/***
|Author|[[Conal Elliott|http://conal.net]]|
|Date|2006-12-30|
|Version|1.0|
|LoadDependencies|NestedFormatterMacro|
|UseDependencies|[[SyntaxifyPlugin: Haskell]]|
!Description
Support for [[Haskell| http://haskell.org]] literate programming.  A syntactic alternative to [[SyntaxifyPlugin: Haskell]].
!Use
{{{
\begin{code}
&lt;haskell code goes here&gt;
\end{code}
}}}
or {{{@if foo then &quot;bar&quot; else &quot;baz&quot;@}}}
!Examples
\begin{code}
type Task = (String,Double) -- name and task score
 
parseTasks :: String -&gt; [Task]
parseTasks src = map (split.words) (lines src)
 where
   split [name,mark] = (name, read mark)
\end{code}
!Code
***/
//{{{
config.formatters.push(
  config.macros.nestedFormatter.substAndWikify(
    &quot;haskellCode&quot;,
    &quot;^\\\\begin{code}\n&quot;,
    &quot;^\\\\end{code}\n&quot;,
    function (s) { return &quot;{{haskell{\n&quot;+s+&quot;}}}&quot;; }
  ));
//}}}
</pre>
</div>
<div title="WasStyleSheetLayout" modifier="Conal Elliott" modified="200701212243" created="200610282245" tags="2006-10-28">
<pre>/***
!Sections in this Tiddler:
*Generic rules
**Links styles
**Link Exceptions
*Header
*Main menu
*Sidebar
**Sidebar options
**Sidebar tabs
*Message area
*Popup
*Tabs
*Tiddler display
**Viewer
**Editor
*Misc. rules
!Generic Rules /%==============================================%/
***/
/*{{{*/
body {
	font-size: .75em;
	font-family: arial,helvetica;
	position: relative;
	margin: 0;
	padding: 0;
}

h1,h2,h3,h4,h5 {
	font-weight: bold;
	text-decoration: none;
	padding-left: 0.4em;
}

h1 {font-size: 1.35em;}
h2 {font-size: 1.25em;}
h3 {font-size: 1.1em;}
h4 {font-size: 1em;}
h5 {font-size: .9em;}

hr {
	height: 1px;
}

a{
	text-decoration: none;
}

ol { list-style-type: decimal }
ol ol { list-style-type: lower-alpha }
ol ol ol { list-style-type: lower-roman }
ol ol ol ol { list-style-type: decimal }
ol ol ol ol ol { list-style-type: lower-alpha }
ol ol ol ol ol ol { list-style-type: lower-roman }
ol ol ol ol ol ol ol { list-style-type: decimal }
/*}}}*/
/***
''General Link Styles'' /%-----------------------------------------------------------------------------%/
***/
/*{{{*/
.externalLink {
	text-decoration: underline;
}

.tiddlyLinkExisting {
	font-weight: bold;
}

.tiddlyLinkNonExisting {
	font-style: italic;
}

/* the 'a' is required for IE, otherwise it renders the whole tiddler a bold */
a.tiddlyLinkNonExisting.shadow {
	font-weight: bold;
}
/*}}}*/
/***
''Exceptions to common link styles'' /%------------------------------------------------------------------%/
***/
/*{{{*/

#mainMenu .tiddlyLinkExisting, 
#mainMenu .tiddlyLinkNonExisting,
#sidebarTabs .tiddlyLinkExisting,
#sidebarTabs .tiddlyLinkNonExisting{
 font-weight: normal;
 font-style: normal;
}

/*}}}*/
/***
!Header /%==================================================%/
***/
/*{{{*/

.header {
		position: relative;
}

.header a:hover {
	background: transparent;
}

.headerShadow {
	position: relative;
	padding: 4.5em 0em 1em 1em;
	left: -1px;
	top: -1px;
}

.headerForeground {
	position: absolute;
	padding: 4.5em 0em 1em 1em;
	left: 0px;
	top: 0px;
}

.siteTitle {
	font-size: 3em;
}

.siteSubtitle {
	font-size: 1.2em;
}

/*}}}*/
/***
!Main menu /%==================================================%/
***/
/*{{{*/
#mainMenu {
	position: absolute;
	left: 0;
	width: 10em;
	text-align: right;
	line-height: 1.6em;
	padding: 1.5em 0.5em 0.5em 0.5em;
	font-size: 1.1em;
}

/*}}}*/
/***
!Sidebar rules /%==================================================%/
***/
/*{{{*/
#sidebar {
	position: absolute;
	right: 3px;
	width: 16em;
	font-size: .9em;
}
/*}}}*/
/***
''Sidebar options'' /%----------------------------------------------------------------------------------%/
***/
/*{{{*/
#sidebarOptions {
	padding-top: 0.3em;
}

#sidebarOptions a {
	margin: 0em 0.2em;
	padding: 0.2em 0.3em;
	display: block;
}

#sidebarOptions input {
	margin: 0.4em 0.5em;
}

#sidebarOptions .sliderPanel {
	margin-left: 1em;
	padding: 0.5em;
	font-size: .85em;
}

#sidebarOptions .sliderPanel a {
	font-weight: bold;
	display: inline;
	padding: 0;
}

#sidebarOptions .sliderPanel input {
	margin: 0 0 .3em 0;
}
/*}}}*/
/***
''Sidebar tabs'' /%-------------------------------------------------------------------------------------%/
***/
/*{{{*/

#sidebarTabs .tabContents {
	width: 15em;
	overflow: hidden;
}

/*}}}*/
/***
!Message area /%==================================================%/
***/
/*{{{*/
#messageArea {
position:absolute; top:0; right:0; margin: 0.5em; padding: 0.5em;
}

*[id='messageArea'] {
position:fixed !important; z-index:99;}

.messageToolbar {
display: block;
text-align: right;
}

#messageArea a{
	text-decoration: underline;
}
/*}}}*/
/***
!Popup /%==================================================%/
***/
/*{{{*/
.popup {
	font-size: .9em;
	padding: 0.2em;
	list-style: none;
	margin: 0;
}

.popup hr {
	display: block;
	height: 1px;
	width: auto;
	padding: 0;
	margin: 0.2em 0em;
}

.popup li.disabled {
	padding: 0.2em;
}

.popup li a{
	display: block;
	padding: 0.2em;
}
/*}}}*/
/***
!Tabs /%==================================================%/
***/
/*{{{*/
.tabset {
	padding: 1em 0em 0em 0.5em;
}

.tab {
	margin: 0em 0em 0em 0.25em;
	padding: 2px;
}

.tabContents {
	padding: 0.5em;
}

.tabContents ul, .tabContents ol {
	margin: 0;
	padding: 0;
}

.txtMainTab .tabContents li {
	list-style: none;
}

.tabContents li.listLink {
	 margin-left: .75em;
}
/*}}}*/
/***
!Tiddler display rules /%==================================================%/
***/
/*{{{*/
#displayArea {
	margin: 1em 17em 0em 14em;
}


.toolbar {
	text-align: right;
	font-size: .9em;
	visibility: hidden;
}

.selected .toolbar {
	visibility: visible;
}

.tiddler {
	padding: 1em 1em 0em 1em;
}

.missing .viewer,.missing .title {
	font-style: italic;
}

.title {
	font-size: 1.6em;
	font-weight: bold;
}

.missing .subtitle {
 display: none;
}

.subtitle {
	font-size: 1.1em;
}

/* I'm not a fan of how button looks in tiddlers... */
.tiddler .button {
	padding: 0.2em 0.4em;
}

.tagging {
margin: 0.5em 0.5em 0.5em 0;
float: left;
display: none;
}

.isTag .tagging {
display: block;
}

.tagged {
margin: 0.5em;
float: right;
}

.tagging, .tagged {
font-size: 0.9em;
padding: 0.25em;
}

.tagging ul, .tagged ul {
list-style: none;margin: 0.25em;
padding: 0;
}

.tagClear {
clear: both;
}

.footer {
	font-size: .9em;
}

.footer li {
display: inline;
}
/*}}}*/
/***
''The viewer is where the tiddler content is displayed'' /%------------------------------------------------%/
***/
/*{{{*/
* html .viewer pre {
	width: 99%;
	padding: 0 0 1em 0;
}

.viewer {
	line-height: 1.4em;
	padding-top: 0.5em;
}

.viewer .button {
	margin: 0em 0.25em;
	padding: 0em 0.25em;
}

.viewer blockquote {
	line-height: 1.5em;
	padding-left: 0.8em;
	margin-left: 2.5em;
}

.viewer ul, .viewer ol{
	margin-left: 0.5em;
	padding-left: 1.5em;
}

.viewer table {
	border-collapse: collapse;
	margin: 0.8em 1.0em;
}

.viewer th, .viewer td, .viewer tr,.viewer caption{
	padding: 3px;
}

.viewer pre {
	padding: 0.5em;
	margin-left: 0.5em;
	font-size: 1.2em;
	line-height: 1.4em;
	overflow: auto;
}

.viewer code {
	font-size: 1.2em;
	line-height: 1.4em;
}
/*}}}*/
/***
''The editor replaces the viewer in the tiddler'' /%------------------------------------------------%/
***/
/*{{{*/
.editor {
font-size: 1.1em;
}

.editor input, .editor textarea {
	display: block;
	width: 100%;
	font: inherit;
}

.editorFooter {
	padding: 0.25em 0em;
	font-size: .9em;
}

.editorFooter .button {
padding-top: 0px; padding-bottom: 0px;}

.fieldsetFix {border: 0;
padding: 0;
margin: 1px 0px 1px 0px;
}
/*}}}*/
/***
!Misc rules /%==================================================%/
***/

/*{{{*/
.sparkline {
	line-height: 1em;
}

.sparktick {
	outline: 0;
}

.zoomer {
	font-size: 1.1em;
	position: absolute;
	padding: 1em;
}

.cascade {
	font-size: 1.1em;
	position: absolute;
	overflow: hidden;
}
#ZiddlyFormats,#ZiddlyPowered{margin:5px}
/*}}}*/</pre>
</div>
<div title="WasStyleSheetPrint" modifier="Conal Elliott" modified="200701212242" created="200612021948">
<pre>/*{{{*/
@media print {
 #mainMenu, #sidebar, #messageArea,
 .toolbar, .tagged, .tagging, .header, .headerForeground, #topMenu {display: none ! important;}
 .subtitle {font-size: 70%}

#displayArea {margin: 1em 1em 0em 1em;}
/* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
noscript {display:none;}
}
/*}}}*/</pre>
</div>
<div title="ask about Asus A8Js" modifier="Conal Elliott" modified="200701291731" created="200701262345">
<pre>Questions to ask Portable One about their version of the [[Asus A8Js| http://laptopsinc.com/Merchant2/merchant.mvc?Screen=PROD&amp;Product_Code=MXA8JS&amp;Category_Code]].  I talked to Ivan, who was very helpful. ++++
* Q: How does it differ from the standard Asus A8Js?  A: They specially treat the CPU and GPU for improved temperature management.  Throw in some special software.
* Q: What does it mean that the video card is user upgradeable?  To what?  Could I even upgrade it to a DX10 card in the future (nVidia GeForce 8 series)?  A: The A8Js uses a [[MXM| http://www.nvidia.com/page/mxm.html]] slot, which allows the card to be upgraded by future MXM-friendly cards.  The future card would have to fit in the same foot print and work the the available power supply.
* Q: Is there a free memory slot, and can I add 2Gb memory next to the 1Gb?  A: Yes, though there may be some loss of speed (drop from double data rate to single) if the modules are not identical.
* Q: return policy: 30 days for the Asus models (14 for some others).  Return or exchange, whatever I want.
* Ivan loves the Asus V1 machine: carbon fiber: 15.4\&quot;, SXVGA+, 6 pounds, spill-proof keyboard.  The only catch: an ATI graphics card.  The techs might be willing to swap the card for an nvidia.  They'd have to ask Asus for an okay to do so without voiding the warranty.  I can email support.
=== 
Heard back from Ivan: &quot;Will not work, BIOS will not even let machine boot without the ATI card.&quot;</pre>
</div>
<div title="auto-capitalize plugin" modifier="Conal Elliott" created="200701122200" tags="2007-01-12 idea TiddlyWiki">
<pre>write a TiddlyWiki plugin that automatically capitalizes words while rendering.  that way, i can write in lower case and get capitalization.  have it use a tiddler of special capitalizations, like &quot;TiddlyWiki&quot;.</pre>
</div>
<div title="blogging topics" modifier="Conal Elliott" modified="200701210357" created="200701201734" tags="2007-01-20 project">
<pre>* To write ++++
*  Cofunctor.
*  Cabal-make.
*  Namespace hierarchy.  Alternatives?
  === 
* In progress ++++
*  [[software releases 2007-01]]
*  [[interfaces -- combined and separable]]
  === 
</pre>
</div>
<div title="cabal hacking" modifier="Conal Elliott" modified="200701140548" created="200701140545">
<pre>* To do ++++
*  Add and test a Cabal Haddock flag {{{--no-use-packages}}}
*  Do something about {{{-optP-P}}}.  Wrote but haven't send email.
*  Record &amp; darcs-send patch to Isaac (asking for ack).
  === 
* Done +++
*  Add flag {{{--haddock-arg}}}.
  === 

</pre>
</div>
<div title="cabal tips" modifier="Conal Elliott" modified="200703161924" created="200612302240" tags="2006-12-30 [[how to]]">
<pre>{{{
ghc --make Setup.*hs -o setup
./setup configure --prefix=c:/Haskell/packages --datadir=c:/Haskell/packages
./setup build
./setup haddock
./setup install
}}}
I added shell aliases:
{{{
alias cabal-config='ghc --make Setup.*hs -o setup &amp;&amp; ./setup configure --prefix=c:/Haskell/packages --datadir=c:/Haskell/packages'
alias cabal-build='./setup build'
alias cabal-install='./setup install'
}}}</pre>
</div>
<div title="cabal-make" modifier="Conal Elliott" modified="200701142022" created="200701140508" tags="2007-01-13 Haskell project Cabal libraries make">
<pre>* Overview: A &quot;{{{make}}}&quot; include file &quot;{{{cabal-make.inc}}}&quot; to ease building of Haskell libraries.   A &quot;{{{make}}}&quot; partner for [[Cabal| http://haskell.org/cabal]].
* Features ++++
*  The [[Haddock| http://haskell.org/haddock]] docs contain Web-based links to libraries you use (base, mtl, monadLib, etc), so that we get a web of documentation for users to follow from library to library.
*  Uses [[hscolour| http://www.cs.york.ac.uk/fp/darcs/hscolour]] to created a syntax-colored copy of your source code (in HTML) and per-definition anchors.  The Haddock docs for your package, modules, and entities (top-level definition in modules) point to these HTML files and anchors.
*  Adds links to comments pages (with a convenient default on the Haskell wiki) for the project and for each module.
*  There's very little to say in describing your library ++++
*   Package name
*   Optionally, user name and {{{scp}}} target for your doc files
*   Web docs and logical {{{.haddock}}} specs for the libraries you use
   === 
*  Customizable ++++
*   Arguments for Cabal configure (e.g., {{{prefix}}} and {{{datadir}}})
*   Location of project wiki comments pages
*   Remote location for your docs (for {{{scp}}})
   === 
  === 
* To do ++++
*  Get my [[haddock hacking]] into the latest haddock so people can use {{{cabal-make.inc}}}.
*  Revise [[tips on using hscolour]] and decide what to do with it.
*  Blog.
*  Put in a darcs repo on {{{darcs.haskell.org}}}.
*  Give it a Haskell wiki page.
*  Announce, asking for alpha testing &amp; feedback.
  === 
* Done +++
  === </pre>
</div>
<div title="chronology map" modifier="Conal Elliott" modified="200701022101" created="200701022100" tags="view SiteMapMacroPlugin">
<pre>&lt;&lt;siteMap year&gt;&gt;</pre>
</div>
<div title="comments on the word " modifier="Conal Elliott" modified="200612120016" created="200612120001" tags="2006-12-11 essay">
<pre>//(Originally written in response to a comment of Roger's.)//

I'm making a separate response to the &quot;trainer&quot; comment.  I got a lot of energy stirred up in me while writing it, as you'll probably see below.
&gt; P.S. For those who object to the word &quot;trainer&quot; (as I do), I regret using it. But, it shortened the amount of typing I had to do.
I intend to share my perspective widely, which leads me to a request.  I'd appreciate your comments on what I've written, including what might make this message more understandable and more inspiring to others.  

About the word &quot;trainer&quot;, I've had two different objections.  If I understand you, only the first one applies to your use of the word.
* It's a label.  I'd rather practice what I believe and teach about labeling.  And when I run into difficulty expressing myself clearly &amp; succinctly without labels, I'd rather go through the effort of retraining myself into new habits than reinforcing old ones.  I made this effort with the Emergence document.  It was hard for me and well worthwhile.  (I don't do compromise.)  Not only did I get the practice (and it gets easier every time), but I believe the document came out more clearly //and// consisely as a result.  The reason I care about other NVC folks' use of labeling is that I long for community support in deepening, integrating, and strengthening the new consciousness and habits.  It's easier for me to speak Jackal because I grew up with it, but //not// because Jackal is a more fitting language for what I want to communicate.  With practice, Giraffe is becoming easier &amp; easier.  Statements like &quot;it's easier to label&quot; (or clearer, more succinct, etc), &quot;compromise is necessary&quot;, or &quot;violence is inevitable to resolve conflicts&quot;, are self-fulfilling prophecies.  More precise and life-connected would be &quot;I have a habit of labeling, so I can do it with little conscious effort&quot;.
* I hear some PSNCC/~NWCompass folks (including Mel, Patty, Holly E, and Moreah) consistently use the word &quot;trainer&quot; not in the simple &amp; direct sense of the word as &quot;one who trains&quot;, but rather in an indirect sense of someone who is //approved// by others to train.  Despite what I said above, I'm relatively comfortable with the direct usage of the word, as I hear it to be simply shorthand for saying what what a person //does//.  I strongly dislike the implicit approval usage, because (a) it eliminates a simple word for a meaning I care a lot about, namely one who trains, and (b) it hides the fact that external approval is involved.  I'm highly suspicious of unconscious habits in relation to external approval systems, so I want language use to be very explicit in such a case, as support for us to live in partnership consciousness rather than domination.
I have mixed feelings about using the &quot;trainer&quot; word.  I'm discouraged about raising awareness and shifting habits.  Maybe there's some kind of support I could ask for. (Request-making is my nvc weak point.)  Now I wonder if a more effective strategy to get the language shift I'm wanting is to simply use the word the way I want to use it (the direct &amp; conventional English meaning of one who trains) and let others deal with their confusion.  As an extreme example, I've considered starting to label myself a &quot;certified NVC trainer&quot; in that I train and I've certified myself, and I believe most people in my workshops certified me as well.

I understand the implicit-approval usage of &quot;trainer&quot; as being in direct conflict with a deep teaching of Marshall's.  He shifts labeling language to relationship language, such as reflecting &quot;That's a terrible picture&quot; into &quot;Oh, you don't like the picture?&quot; I've heard him call that principle [[&quot;never let anyone tell you who you are&quot;| http://www.cnvc.org/downlds/20020714.mp3]].  I believe applying or withholding the label &quot;trainer&quot; but really meaning approved-by-someone trainer is telling them who they are, in Marshall's sense.  I'd rather hear an observation or a feeling or a need.  A more life-connected alternative might be &quot;I trust that person to present NVC in a way I agree with.&quot;  Even &quot;certified trainer&quot; is still a label and doesn't say certified //by whom//, which I understand to be the basic //Amtsprache// trick of using language that obscures personal connection and responsibility.  A clear observation would be &quot;I heard that CNVC certified Suzy&quot;.  Still -- yuck; I'd rather just remove my personal energy from the whole certification mindset and focus on support, learning, and community.  I'm //much// more comfortable with &quot;trainer&quot; as a shorthand for &quot;one who trains&quot;, which I'm pretty sure is what Roger means.

I have another request and an offer.  The request is to let me know whether any of the above resonates with and inspires you and if you would like to join me in community around using practicing label-free, clear &amp; succinct communication.  Given my experience and interest, my offer is to work with you to eliminate labeling from your own communications while improving clarity &amp; conciseness.  My needs-payoff includes community, play, learning, and integrity (living what I believe).
</pre>
</div>
<div title="community NVC blog" modifier="Conal Elliott" modified="200612221546" created="200612221532" tags="2006-12-22 project nvc community">
<pre>//Roger suggested a regular newsletter to be sent to folks in the psncc/nwcompass database. Here's my response.  Hm.  I could instead make this post in a new tribe.net tribe.//

How about a blog instead of a newsletter?  Here are some advantages:
* Connection.  People can leave comments on articles.  Others can leave comments on the comments, etc. If you write an article or comment, you can get notified by email when there's a reply.
* Aliveness.  People contribute whenever they're inspired, and the subscribers can get updates as soon as they want.  Because of this immediacy, replies are much more likely to reach the author while the issue is still alive.
* Learning community.  Articles and comments are archived indefinitely, so someone who discovers the community after it's begun has full access to the history, can leave new comments, etc.
* Ease, scalability, self-empowerment.  Once the community blog is set up, it requires little or no maintenance.  People create their own accounts, choose the options they want, make their own posts, etc.
* Flexibility, adaptability.  Content volume naturally fluctuates, and a blog supports any level of volume and (in)consistency.  No stress over filling up a newsletter or editing down or rejecting contributions, to meet artificial expectations.  Similarly, contributions can range from a succinct question or quote to an extended essay.

Oh!  There's a a rich, active, and mature community foundation that a few of us are already using, namely [[tribe.net|http://tribe.net]].  Tribe is all about community and includes discussion forums, blogging, event announcements, and personal referrals.  There are zillions of communities, including http://nvc.tribe.net.</pre>
</div>
<div title="composition and interfaces" modifier="Conal Elliott" modified="200702050134" created="200702010634" tags="Haskell TV 2007-01-31">
<pre>Explore the composition operators for Input &amp; Output (specializing to fmap and cofmap).  How do this form of composition and the DeepArrow algebra work together?  Look at some examples and how I'd like them to work out.
An input primitive.
\begin{code}
stringIn :: CInput String
stringIn = iPrim getString
\end{code}
Now add some interpretation:
\begin{code}
readIn :: Read a =&gt; a -&gt; CInput a
readIn dflt = fmap (readD dflt) stringIn
\end{code}
Equivalently,
\begin{code}
readIn dflt = stringIn `iCompose` pure (readD dflt)
\end{code}
Without @iCompose@,
\begin{code}
readIn dflt = iPrim (getString &gt;&gt;&gt; pure (readD dflt))
\end{code}
An output primitive.
\begin{code}
stringOut :: COutput String
stringOut = oPrim putString
\end{code}
Now add some rendering:
\begin{code}
showOut :: Show a =&gt; COutput a
showOut = cofmap show stringOut
\end{code}
Equivalently,
\begin{code}
showOut = pure show `oCompose` stringOut
\end{code}
Without @oCompose@,
\begin{code}
showOut = oPrim (pure show &gt;&gt;&gt; putString)
\end{code}
An @oLambda@.
\begin{code}
interactLine :: COutput (String -&gt; String)
interactLine = oLambda stringIn stringOut
\end{code}
Massage both input and output:
\begin{code}
interactRSOut :: (Read a, Show b) =&gt; a -&gt; COutput (a -&gt; b)
interactRSOut dflt = oLambda (readIn dflt) showOut
\end{code}
or, using @cofmap@,
\begin{code}
interactRSOut dflt = cofmap (wrapF show (readD dflt)) interactLine
\end{code}
This is the tricky part. We may want to compose the result of @interactRSOut@ with another function-valued output.  Composition wants to deconstruct as @oLambda@'s, and the @cofmap@/@wrapF@ formulation hides the @oLambda@ structure.

Idea: define a function @wrapO@ like @wrapF@.
\begin{code}
wrapO :: (b -&gt; b') -&gt; (a' -&gt; a)
      -&gt; Output (~&gt;) (a -&gt; b) -&gt; Output (~&gt;) (a' -&gt; b')
\end{code}
Define @wrapO@ as a specialization of @wrapAO@.
\begin{code}
wrapO g f = wrapAO (pure g) (pure f)

wrapAO :: (b ~&gt; b') -&gt; (a' ~&gt; a)
       -&gt; Output (~&gt;) (a -&gt; b) -&gt; Output (~&gt;) (a' -&gt; b')
\end{code}
Then we get an elegant definition of @interactRSOut@:
\begin{code}
interactRSOut dflt = wrapO show (readD dflt) interactLine
\end{code}

Does implementing @wrapAO@ still require @iCompose@?  Not for @interactRSOut@, since the composition shows up right next to the primitives and so can be folded in.  Consider other cases, such as pairs.

Consider using the DeepArrow algebra instead of @wrapAO@, or as an implementation of @wrapAO@.  In that case, I'll want to transform inputs as well as outputs, which suggests using @OIFun@ (as in Eros) instead of just @OFun@ (as in the current TV).
\begin{code}
type OX a b = Output a -&gt; Output b
type IX b a = Input  b -&gt; Input  a

type OIX a b = (OX a b, IX b a)

newtype OIFun a b = OIFun (OIX a b)
\end{code}
For instance,
\begin{code}
showReadOI :: (Read a, Show a) =&gt; a -&gt; OIFun String a
showReadOI dflt = OIFun (cofmap show, fmap (readD dflt))
\end{code}

Oops!  All this @wrap@ stuff is a confusion.  I want the conversions going the other way.
</pre>
</div>
<div title="computer shopping 2007-01" modifier="Conal Elliott" modified="200702011651" created="200701250550" tags="2007-01-24">
<pre>* [[Dell XPS M1710| http://www.dell.com/content/products/productdetails.aspx/xpsnb_m1710?c=us&amp;cs=19&amp;l=en&amp;s=dhs&amp;~section=overview#tabtop]].  This is //the// high-end graphics notebook.  17\&quot; WUXGA (1920x1200), nVidia GeForce Go 7950 GTX Graphics 512 MB (or 7900 256MB),  Intel Core 2 Duo, DVI, Component video, S/PDIF digital audio out, 8.8lbs.  $3000 with the 12% Microsoft employee/alumni discount and  beefed up max graphics.
* Toshiba Satellite P105-S9722 ([[CNET review| http://reviews.cnet.com/Toshiba_Satellite_P105_S9722/4505-3121_7-32103848.html]]). 7.1 pounds, Intel Core 2 Duo, 2GHz, DVI, 17\&quot; 1440x900, nVidia GeForce Go 7900, 200GB 4200 drives, $1924.
* [[Asus G1| http://asus.com/products4.aspx?modelmenu=2&amp;model=1447&amp;l1=5&amp;l2=74&amp;l3=464]]: Reviews: [[CNET| http://reviews.cnet.com/ASUS_G1_Core_2_Duo_2GHz_2GB_RAM_160GB_HDD/4505-3121_7-32152982.html?tag=pdtl-list]], [[notebookreview| http://www.notebookreview.com/default.asp?newsID=3454]] and [[xoticpc| http://www.xoticpc.com/article_info.php/articles_id/25]].  Intel Core 2 Duo 2GHz, 2GB DDR2 667, nVidia GeForce Go 7700 512MB, DVI, 15.4\&quot; WSXGA+, 160Gb 5400rpm drive, 1.3Mp camera, Bluetooth 2.0, 6.84 pounds, vertical scrolling touchpad, &quot;Direct Messenger Display&quot;.  $1775 at [[NewEgg| http://www.newegg.com/Product/Product.asp?Item=N82E16834220098]] and [[at Directron| http://www.directron.com/asusg1.html]].
* [[Asus F3T| http://asus.com/products4.aspx?modelmenu=2&amp;model=1412&amp;l1=5&amp;l2=26&amp;l3=316]]. dual core, nVidia GeForce Go 7600, up to WSXGA+, DVI, 6.5 pounds.
* ASUS V6J-8022P. Intel Core Duo T2500 2GHz 2MB L2, 15.0\&quot; SXGA+, 1GB RAM, 100GB 5400rpm, nVidia GeForce Go 7400, no DVI, 5.4 pounds.  $1700 [[at NewEgg| http://www.newegg.com/Product/Product.asp?Item=N82E16834220048]].
* [[Asus A8Js| http://www.asus.com/products.aspx?l1=5&amp;l2=26&amp;l3=270&amp;model=1373&amp;modelmenu=1]]. Reviews: [[CNET| http://reviews.cnet.com/ASUS_A8Js_4S034P_Core_2_Duo_T7200_2_GHz_14_TFT/4507-3121_7-32309309.html?tag=sub]], [[notebookreview| http://www.notebookreview.com/default.asp?newsID=3313&amp;review=Asus+A8Js]]. Intel Core 2 Duo T7200 2GHz, 4MB L2, 1GB (in one slot), 120GB 4500rpm, 14\&quot; 1440x900, nVidia GeForce Go 7700 512MB, DVI, Bluetooth 2.0, 0.35Mp camera, 5.25 lbs.  $1600 [[at Portable One| http://laptopsinc.com/Merchant2/merchant.mvc?Screen=PROD&amp;Product_Code=MXA8JS&amp;Category_Code]] with 120Gb 5400rpm drive.
* ASUS Lamborghini VX1-5E003P. Intel Core Duo 2GHz, 2GB RAM, 15\&quot; SXGA+, nVidia GeForce Go 7400 512 MB, 5.3 pounds, no DVI. [[$2300 at NewEgg| http://www.newegg.com/Product/Product.asp?Item=N82E16834220041]].
* Asus W7J-3P076P. ([[Zdnet review| http://review.zdnet.com/Asus_W7J/4505-3121_16-32143112.html?subj=fdba&amp;part=rss&amp;tag=MR_Laptops]]) Intel Core 2 Duo T5500(1.66GHz), 4.3 pounds, 2MB L2, 13.3\&quot; WXGA, 1GB, 100GB 5400rpm, nVidia GeForce Go 7400, no DVI.  I've seen reports of poor battery life.  Also, no scroll in touchpad.  [[$1450 at NewEgg| http://www.newegg.com/Product/Product.asp?Item=N82E16834220097]].  [[$1450 from| https://www.datavis.com/webapp/commerce/command/ProductDisplay?prrfnbr=465480&amp;prmenbr=2000]] or [[$1490 via Amazon| http://www.amazon.com/exec/obidos/ASIN/B000JLD160/mysimon-ce00-20/ref=nosim]].
* [[Sony Vaio SZ series| http://www.learningcenter.sony.us/Notebooks/SZSeries]]. 3.7 pounds, 13.3\&quot; screen, nVidia GeForce Go 7400 (can be switched to integrated to save power).  No DVI or HDMI.  Called the &quot;Sony Style&quot; retail store at University Village (206-525-1200).  They have the SZ 381 in stock.  It's $2899 with 2.16GHz processor and 160Gb hard drive.
Notes:
* NewEgg has a //no-return// policy on computers, which makes buying from them risky.  Look for alternative sellers through Amazon &amp; Google.
Weighing Asus G1 vs Asus A8Js.  The G1 has/is ++++
* 30% heavier (6.84 lbs vs 5.25 lbs -- //minus//)
* 36% higher res (1680x1050 vs 1440x900)
* 33% more spacious drive (160Gb vs 120Gb)
* larger screen (15\&quot; vs 14\&quot;)
* older PCMCIA card slot vs newer [[Express Card| http://en.wikipedia.org/wiki/ExpressCard]] slot -- //minus//
* &quot;Asus Splendid Video Intelligent Technology&quot; vs &quot;[[Color Shine| http://www.screentekinc.com/asus-colorshine-lcd-screens.shtml]]&quot;
* 433% higher res web camera (1.3Mp vs 0.3Mp)
* USB ports all in the back -- //minus//
* cute &quot;Direct Messenger&quot; OLED message display
* flashing gaming lights (perhaps //not// a plus)
* twice the RAM (2Gb vs 1Gb), though the A8Js has a free slot for more memory (1Gb or 2Gb)
* $175 more (until I add memory)
Flipped around, the A8Js has/is ++++
* 23% lighter (5.25 lbs vs 6.84 lbs)
* 27% lower res (1440x900 vs 1680x1050)
* 25% smaller drive (120Gb vs 160Gb), though I can upgrad to faster drive
* smaller screen (14\&quot; vs 15\&quot;)
* newer [[Express Card| http://en.wikipedia.org/wiki/ExpressCard]] slot vs older PCMCIA card slot
* &quot;[[Color Shine| http://www.screentekinc.com/asus-colorshine-lcd-screens.shtml]]&quot; vs &quot;Asus Splendid Video Intelligent Technology&quot; 
* 77% lower res web camera (0.3Mp vs 1.3Mp)
* USB ports are some side &amp; some rear
* no cute &quot;Direct Messenger&quot; OLED message display
* no flashing gaming lights
* half the RAM (1Gb vs 2Gb), though there's a free slot for more memory (1Gb or 2Gb)
* $175 less (until I add memory)
</pre>
</div>
<div title="conal's home page" modifier="Conal Elliott" created="200610312133" tags="experiment">
<pre>http://conal.net</pre>
</div>
<div title="conditional WikiLink formatter" modifier="Conal Elliott" modified="200701010647" created="200701010616" tags="systemConfig_not 2006-12-31">
<pre>/***
|Synopsis|Customized startup code|
|Author|[[Conal Elliott|http://conal.net]]|
|Date|2006-12-31|
|Version|1.0|
|LoadDependencies|[[conditional WikiLink formatter]]|
!Description
I neutralized this plugin.  (Note the &lt;&lt;tag systemConfig_not&gt;&gt; tag.)  Use the friendlier DisableWikiLinksPlugin instead.

I end up ~TwiddlePrefixing a lot of CamelCase words that I'm not intending as WikiLinks.   This tweaking of the &quot;wikiLink&quot; formatter gives one the option to render such words as links only if the tiddler exists.  That policy would save me a lot of twiddling but still let me conveniently refer to system tiddlers.
 
''Note'': This tweak does not change any behavior.  It only introduces //option// of the new formatting.  To activate it, put the following code into a systemConfig tiddler:
{{{
findObject(config.formatters,'name',&quot;wikiLink&quot;).linkIfUnknown = false;
}}}
I would like to see this tweak become part of the TiddlyWiki core, leaving activation to users.
!Code
***/
//{{{
// findObj: Find object in an array of the object whose given field has the
// given value.  Otherwise null;
function findObject(array,field,value) {
    for (var i=0;i&lt;array.length;i++)
	if (array[i][field] == value)
	    return array[i];
    return null;
};
 
// Find and replace the wikiLink formatter.  See &quot;linkIfUnknown&quot; field intro &amp; use below.
{
    var wl = findObject(config.formatters,'name',&quot;wikiLink&quot;);
    if (wl == null) {
	alert(&quot;Oops -- didn't find wikiLink formatter.&quot;);
    } else {
        wl.linkIfUnknown = true;  // new flag, used in new handler
 	wl.handler = function (w)
	{
		var preRegExp = new RegExp(config.textPrimitives.anyLetter,&quot;mg&quot;);
		var preMatch = null;
		if(w.matchStart &gt; 0)
			{
			preRegExp.lastIndex = w.matchStart-1;
			preMatch = preRegExp.exec(w.source);
			}
		if(preMatch &amp;&amp; preMatch.index == w.matchStart-1)
			w.outputText(w.output,w.matchStart,w.nextMatch);
		else if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink)
			w.outputText(w.output,w.matchStart + 1,w.nextMatch);
		else {
			var link = createTiddlyLink(w.output,w.matchText,false);
			if(!store.tiddlerExists(w.matchText)) {
				if(store.isShadowTiddler(w.matchText))
					addClass(link,&quot;shadow&quot;);
				else if(this.linkIfUnknown)
                                	addClass(link,&quot;missing&quot;);
                                else {
                                        // treat as text after all
                                        w.outputText(w.output,w.matchStart,w.nextMatch);
                                        return;
                                }
                        } else {
				removeClass(link,&quot;shadow&quot;);
				removeClass(link,&quot;missing&quot;);
                        }
			w.outputText(link,w.matchStart,w.nextMatch);
		}
	}
    }
}
//}}}
</pre>
</div>
<div title="darcs tips" modifier="Conal Elliott" modified="200805182312" created="200612190645" tags="2006-12-18 [[how to]]" changecount="1">
<pre>See also [[project release check-list]].
* To get a Haskell project going, fill in some structure.  Then ++++
*   Initialize darcs repository with {{{darcs initialize}}}
*   Add everything via &quot;{{{darcs add -r -v --dry-run .}}}&quot; and check the output.  If I like the choices, do it again without &quot;{{{-v --dry-run}}}&quot;.  If I don't like something (included or omitted), consider updating {{{~/.darcs/boring}}}.
*   Record it all with {{{darcs record}}}.
  === 
* Set up files in {{{~/.darcs}}}.++++
*  {{{author}}}, so that darcs no longer asks me for an email address when I record my first patch.+++
{{{
Conal Elliott &lt;conal@conal.net&gt;
}}}
=== 
*  {{{boring}}}, to exclude some files from automatic adds.+++
{{{
# My additional boring files, for Haskell projects.  Exclude executable,
# distribution directories, cabal .*-config files, hasktags or etags
# output, and my Junk code modules (tossed code).
\.exe$
(^|/)dist($|/)
(^|/).*-config$
(^|/)tags$
(^|/)TAGS$
(^|/)[jJ]unk.*$
}}}
   === 
*  {{{defaults}}}, to specify default arguments so I don't have to repeat them, e.g., {{{record all}}}.
  === 
* Set up the project on the Haskell darcs server. +++
{{{
darcs put conal@darcs.haskell.org:/home/darcs/packages/ProjectFoo
}}}
 For a project called &quot;ProjectFoo&quot;. === Using [[cabal-make]], just say {{{make repo}}}.
* After making and recording changes, do {{{darcs push}}}.
* I used to have problems with {{{ammend-record}}}. +++
//Revisit this one.//  Be sure //not// to use the darcs {{{amend-record}}} command, or the {{{darcs push}}} will hang.  I accidentally created ten zombie processes that dragged down the server for quite a while.  Well, now I'm using a different darcs &amp; ssh (PuTTY-based), so try again.  Seems fine now. === 
* With someone else's code, when I cannot push the patches myself (no write access to repo), do {{{darcs send -o FILE}}} and email the file as an attachment.
* List non-boring files that are not in the repo: {{{darcs whatsnew -l | grep &quot;a .&quot;}}} .
</pre>
</div>
<div title="del.icio.us/TiddlyWikiPlugin" modifier="Conal Elliott" modified="200610260102" created="200610260005" tags="RSSFeeds">
<pre>&lt;&lt;rssReader asHtml proxy.cgi?url=http://del.icio.us/rss/TiddlyWiki&gt;&gt;
</pre>
</div>
<div title="emergence meeting of 2006-10-27" modifier="Conal Elliott" modified="200610312156" created="200610282211" tags="2006-10-27 conversation">
<pre>We met at Sandy's home to talk about the [[Emergence proposal|http://emergence.awakeningcompassion.com]].  Present: Holly C, Sandy, Barb, Doug, Patty, Elana, Pan, Roger, and me.  I hadn't expected Doug &amp; Elana.

I'm thrilled with how the meeting went.  Some highlights:
* Early on, there were the usual worries about how to make sure people are really teaching NVC and //just// NVC (not &quot;co-mingled with other modalities&quot;).
* In answer to questions, I talked about slashdot and match.com.  The latter seemed especially helpful and connecting.  I gave specific examples of match.com for Holly &amp; me.
* People started getting the sense of feedback within the system and how it could self-regulate.
* Patty was still quite opposed to letting go of oversight of the purity of the NVC.  I asked whether she meant the &quot;process&quot; or the &quot;consciousness&quot;, and she said both.
* In response to Patty's fears, Holly shared that the four steps won't go away until something so compelling comes along that people won't be able to stand not embracing it.
* A good way into the meeting, Doug made quite a shift:
** He got it that the NVC process is just one strategy.  He shared that if he lived in a world of that consciousness, with all needs being met, and there were no NVC four steps, he'd be quite content.  //And// that he expects the NVC process to be around for quite a while before it's replaced by something better.
** He got it and shared that NVC has been evolving all along.  In particular, //Needs// were absent from Marshall's early formulation.
** He shared his sadness over how often a wonderful vision is lost in the process of erecting protection around it, as in the case of Christianity.
** I could see how touched he was at the idea of letting go of our control of our current approved process and trusting evolution.
* When Doug expressed what Holly already had, then Patty got great reassurance.  She trusts Doug. This example reinforces the validity and importance of the &quot;chains of trust&quot; principle.
We intended to do the sociocracy process, but Doug pointed out that my proposal is //way// to long to be a sociocratic proposal, which would be under forty words and actionable.  He suggested splitting into four proposals, following the four main bullet points.  We didn't really do that.  In retrospect, we couldn't have.  All we were ready for was understanding the vision and getting feedback on clarity and reactions.

There were some lovely group moments in the last hour.  We (most of us) shared some giggles over the idea of CNVC grappling with this transformative idea.

At the end, I realized that a huge shift is now in progress from control to trust, from fear to curiosity, from a static view of NVC to a view of its ongoing evolution.  And to excitement about being in the middle of the great transformation and expansion.  That is the shift I want as the basis of my community.

</pre>
</div>
<div title="essay" modifier="Conal Elliott" created="200611190332">
<pre>Essays, thoughts for essays, growing into articles.</pre>
</div>
<div title="experiments with Output destructuring" modifier="Conal Elliott" modified="200701051827" created="200612290527" tags="2006-12-28 Eros Haskell">
<pre>Experimenting with an alternative to asOLambda/asOPair:

Current style:
\begin{code}
firstO :: OX a c -&gt; OX (a,b) (c,b)
firstO f ab = OPair (f a) b where (a,b) = asOPair ab
\end{code}
First, have asOPair return an output rather than a pair of outputs:
\begin{code}
asOPair o@OPair{} = o
asOPair _         = OPair OEmpty OEmpty
\end{code}
Then apply asOPair only when the typical pattern fails:
\begin{code}
firstO f (OPair a b) = OPair (f a) b
firstO f o           = firstO f (asOPair o)
\end{code}
But there are more complicated examples with nested structure:
\begin{code}
lAssocO :: OX (a,(b,c)) ((a,b),c)
\end{code}
Current style (with asOPair returning pairs):
\begin{code}
lAssocO oabc = OPair (OPair oa ob) oc
  where (oa,obc) = asOPair oabc
        (ob,oc ) = asOPair obc
\end{code}
The alternative is messier than I'd like:
\begin{code}
lAssocO (OPair a (OPair b c)) = OPair (OPair a b) c
lAssocO (OPair a bc)          = lAssocO (OPair a (asOPair bc))
lAssocO o                     = lAssocO (asOPair o)
\end{code}
Oh!  Notice that {{{asOPair == firstO id}}}, and we can get deeper canonicalization, by nesting applications of firstO.
\begin{code}
lAssoc (OPair a (OPair b c)) = OPair (OPair a b) c
lAssoc o                     = lAssocO $ firstO (firstO id) o
\end{code}
Eliminate asOPair altogether by inlining it in firstO:
\begin{code}
firstO f (OPair a b) = OPair (f a) b
firstO f _           = firstO f (OPair OEmpty OEmpty)
\end{code}
Everything done above with pairing can be done with lambda also.

On the other hand, do I really ever want to make these pairs and lambdas of OEmpty?  Alternatively, I could just make an OEmpty.
\begin{code}
firstO f (OPair a b) = OPair (f a) b
firstO _ _ = OEmpty

lAssoc (OPair a (OPair b c)) = OPair (OPair a b) c
lAssoc _ = OEmpty
\end{code}
Hm.  Maybe I can use parametricity (once I understand it) to deduce properties of polymorphic functions and from there synthesize how it rearranges output structures.

----

Now consider titles.  I have this constructor:
\begin{code}
data Output arr :: * -&gt; * where
  ...
  -- | Title/label an output
  OTitle :: String -&gt; Output arr a -&gt; Output arr a
\end{code}
and a similar one for Input.  If an OLambda is wrapped in an OTitle and then gets destructured as an OLambda, I can make new titles for the input and output parts.  Similarly for pairs.
\begin{code}
asOLambda :: Output arr (a-&gt;b) -&gt; (Input arr a, Output arr b)
asOLambda (OLambda a b ) = (a,b)
asOLambda (OTitle  s ab) = ( ITitle (&quot;input of &quot; ++s) a
                           , OTitle (&quot;output of &quot;++s) b )
 where
   (a,b) = asOLambda ab
asOLambda _              = (iEmpty, oEmpty)
 
asOPair :: Output arr (a,b) -&gt; (Output arr a, Output arr b)
asOPair (OPair  a b ) = (a,b)
asOPair (OTitle s ab) = ( OTitle (&quot;first of &quot; ++s) a
                        , OTitle (&quot;second of &quot;++s) b )
 where
   (a,b) = asOPair ab
asOPair _             = (oEmpty, oEmpty)
\end{code}
So, this destructuring is really buying me something.

Suppose I compose two functions, say reversals
\begin{code}
tv2 :: CTV (String -&gt; String)
tv2 = tv (oTitle &quot;reverse&quot; interactLine) reverse
 
tv2Twice :: CTV (String -&gt; String)
tv2Twice = tv2 `pipe` tv2
\end{code}
Under this destructuring scheme, I get &quot;input of reverse&quot; and &quot;output of reverse&quot;, each as half of a tv2.  If I threw something in the middle, its titles would disappear completely.  Where to go with this observation?  
* I could make the labels more expressive, so I get something like &quot;reverse of reverse&quot;.  Ultimately, I'd end up with an awkward English description of a functional program.
* Separate labels from what the functions are doing, and make them about the meaning of the data.
The latter direction looks more promising to me.  It also suggests discarding function labels when destructuring a function.
\begin{code}
asOLambda (OTitle _ ab) = asOLambda ab
\end{code}
</pre>
</div>
<div title="feedback system for writing" modifier="Conal Elliott" created="200612251436">
<pre>These ideas are inspired by this [[wiki talk page| http://haskell.org/haskellwiki/Talk:SantaClausProblem]] Simon PJ set up to gather feedback on an article draft.  

One benefit of such a feedback wiki page is that people can see if someone else has already pointed out a typo or asked a question.  A quick search spares the reader and the author of redundant work.

I'd like the feedback more organized, however.  What happens when I revise the paper?  Some comments are obsolete and others aren't.  Idea: tag each comment with a paper version, as well as &quot;typo&quot;, &quot;question&quot;, etc.  Have the feedback system initialize tags automatically with guesses and make it easy to add other tags.  The contributor can easily alter tags when the guess is wrong.  When the author releases a revised paper version, the default version for comments changes.  As typos etc are fixed, the author adds a &quot;resolved&quot; tag.  When an issue is left unresolved, the author edits &amp; adjusts references in the comment (e.g., page &amp; section number).  Better, make references smart so that they can be shown relative to any version of the paper.  And not just references.  Parts of a comment may be addressed and others not.
</pre>
</div>
<div title="functional graphics channel" modifier="Conal Elliott" modified="200612220158" created="200612212235" tags="2006-12-21 kyte">
<pre>&lt;html&gt;
&lt;div style=&quot;padding: 10px 0px 10px 12px;&quot;&gt;
&lt;div&gt;
&lt;object width=&quot;425&quot; height=&quot;380&quot; classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot;http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0&quot;&gt;
&lt;param name=&quot;flashvars&quot; value=&quot;applicationurl=http%3A%2F%2Fwww.kyte.tv%2Fflash%2FMarbachViewerEmbedded.swf&amp;classpath=http%3A%2F%2Fwww.kyte.tv%2Fflash%2F&amp;appconfigkey=GLOBAL_FLASHVARS&amp;server=www.kyte.tv&amp;port=8036&amp;uri=channels/209&quot;/&gt;
&lt;param name=&quot;movie&quot; value=&quot;http://www.kyte.tv/flash/MarbachLoader.swf&quot;/&gt;
&lt;param name=&quot;wmode&quot; value=&quot;transparent&quot;/&gt;
&lt;embed width=&quot;425&quot; height=&quot;380&quot; type=&quot;application/x-shockwave-flash&quot; src=&quot;http://www.kyte.tv/flash/MarbachLoader.swf&quot; flashvars=&quot;applicationurl=http%3A%2F%2Fwww.kyte.tv%2Fflash%2FMarbachViewerEmbedded.swf&amp;classpath=http%3A%2F%2Fwww.kyte.tv%2Fflash%2F&amp;appconfigkey=GLOBAL_FLASHVARS&amp;server=www.kyte.tv&amp;port=8036&amp;uri=channels/209&quot; wmode=&quot;transparent&quot;&gt;&lt;/embed&gt;
&lt;/object&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;img src=&quot;http://www.kyte.tv/images/tv/buttons/standard.gif&quot; width=&quot;417&quot; height=&quot;33&quot; border=&quot;0&quot; alt=&quot;&quot; style=&quot;margin-left:4px&quot; usemap=&quot;#standard_Map&quot;&gt;
&lt;map name=&quot;standard_Map&quot;&gt;
&lt;area shape=&quot;rect&quot; alt=&quot;Be on this TV&quot; coords=&quot;6,5,103,27&quot; href=&quot;http://www.kyte.tv/create/createShow.html?uri=channels/209&quot;&gt;
&lt;area shape=&quot;rect&quot; alt=&quot;Tell your Friends&quot; coords=&quot;109,5,206,27&quot; href=&quot;http://www.kyte.tv/channels/share.html?uri=channels/209&quot;&gt;
&lt;area shape=&quot;rect&quot; alt=&quot;Embed this TV&quot; coords=&quot;212,5,309,27&quot; href=&quot;http://www.kyte.tv/channels/place.html?uri=channels/209&quot;&gt;
&lt;area shape=&quot;rect&quot; alt=&quot;Start your Channel&quot; coords=&quot;315,5,412,27&quot; href=&quot;http://www.kyte.tv/create/createChannel.html&quot;&gt;
&lt;/map&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/html&gt;
</pre>
</div>
<div title="haddock for library illustration" modifier="Conal Elliott" created="200701112203" tags="2007-01-11 idea Haskell tools haddock">
<pre>I've been writing general intro documentation for TV by adding a long Haddock comment in the main TV module (as with [[Phooey| http://darcs.haskell.org/packages/phooey/doc]]).  I use examples from an {{{Examples}}} module.  Here's another idea.

Instead of commenting the main library module, comment the example module.  That way, even the names for examples can be linked.  And, of course, I could make several such modules, and other people could make them also.

There's a lot of redundancy between the code in comments and the actual code.  Moreover, the comment version has to be edited to wrap single quotes around names and to put backslashes before double quotes so they're not taken to be module name markup.  What I'd //really// like is to write my code once and have the markup generated automatically.  Because the code is the real thing, I can count on all names being resolvable, so there's no harm in linking all of them.

Create a tool that transforms a literate Haskell module into a non-literate module that contains module &amp; import declarations, and a single module-level Haddock comment.  The created module imports the source module and everything imported by the source module.  Every block of code gets turned into a Haddock comment version of that code (as I've been doing manually), with links and tweaks for strings and other markup.

I'd probably want to write my example modules in literate Haskell style, so throw in an {{{unlit}}} stage.
</pre>
</div>
<div title="haddock hacking" modifier="Conal Elliott" modified="200701140522" created="200701132329" tags="2007-01-12 project">
<pre>* To do ++++
*  Record &amp; darcs-send changes and email Simon (asking for ack)
  === 
* Done +++
*  Type operators
*  Futz with precedences until it's all perfect.
  === 
</pre>
</div>
<div title="how to" modifier="Conal Elliott" created="200611151639">
<pre>I like learning and recording [[how to]] do things.</pre>
</div>
<div title="ideas for Awakening Compassion" modifier="Conal Elliott" created="200701202114" tags="idea [[Awakening Compassion]]">
<pre>* Invite Sunrise Identity people to a Marshall movie night.</pre>
</div>
<div title="installing Gtk2Hs" modifier="Conal Elliott" modified="200701260325" created="200701260324" tags="Haskell library GUI 2007-01-25">
<pre>* Downloaded and ran [[the installer| http://haskell.org/gtk2hs/download]].  I got a complaint, asing me to reinstall GHC 6.2.2 or 6.4.1.  I have 6.6.
* Reading the [[installation instructions for Windows| http://haskell.org/gtk2hs/archives/2005/06/24/installing-on-windows]], I see that I'll have to build from source.
* Following the [[build directions| http://haskell.org/gtk2hs/archives/2005/06/24/building-from-source-on-windows]], I see to [[intall Gtk+| http://gladewin32.sourceforge.net/modules/wfdownloads/viewcat.php?cid=1]].  I chose version 2.8 and then specifically gtk+-dev-2.8.20-win32-1.  Running, I took the defaults of registering for cygwin and msys.  Heeding the install directions (&quot;You must install Gtk+ into a directory with no spaces in the name (i.e. not under C:/Program Files/&quot;), I chose {{{C:\GTK\2.0\}}}.  Install finished quietly.
* Deviated from instructions here.  Instead of downloading and unpacking {{{gtk2hs-0.9.10.tar.gz}}}, I did {{{darcs get http://darcs.haskell.org/gtk2hs}}}.  Oh -- I could have used {{{--partial}}} to bypass some of the 1267 patches.  Redid with {{{--partial}}}, and got just 325 patches.
* Tried to configure via {{{./configure --prefix=C:/Haskell/packages/Gtk2Hs}}}.  Got {{{./configure: No such file or directory}}}.  Read {{{INSTALL}}}.  The first step says &quot;Run the configure script&quot;, which I take to mean {{{install-sh}}}.  Hm: &quot;{{{install: no input file specified}}}&quot;.  Looked at {{{install-sh}}} but didn't make sense of it.
* Bailing on my darcs deviation.
* Unpacked {{{gtk2hs-0.9.10.tar.gz}}} to {{{c:/Haskell}}}.  Cd'd to the {{{c:/Haskell/gtk2hs-0.9.10/}}} and ran {{{./configure --prefix=C:/Gtk2Hs}}}.  Got syntax error.  Maybe because my {{{/bin/sh}}} is really bash.  Changed the first line in {{{configure}}} from {{{#! /bin/sh}}} to {{{#! /bin/ash}}}.  Still syntax error.  In desparation (and remembering the build directions' mention that building under cygwin is untested), I tried {{{#! c:/msys/1.0/bin/sh.exe}}}.
* Got: {{{configure: error: expected an absolute directory name for --prefix: 0}}}.  None of my variations worked, so I dropped the prefix.  Then configure chugged a while until saying &quot;{{{error: no acceptable C compiler found in $PATH}}}&quot;.  Hrmf.  Apparently I didn't include gcc when I re-installed cygwin.
* Installing it now (gcc-core but not g++ etc).  The cygwin installer asked me to reboot soon.
* Re-running {{{./configure}}}.  Ended with {{{error: ghc-pkg not found. (But ghc exists!?)}}}.  Hm.  More cygwin-vs-msys confusion?  Maybe related to earlier message &quot;{{{/usr/bin/sed: -e expression #1, char 14: strings for `y' command are different lengths}}}&quot;.  Reboot before continuing.
* Rebooted &amp; retried.  Same error.
* I do have msys after all, though I didn't think so.  Configuring from msys: {{{./configure --prefix=C:/Gtk2Hs}}}.  Got much further. +++&gt;
{{{
make[1]: Leaving directory `/c/Haskell/gtk2hs-0.9.10'
&lt;no location info&gt;: can't find file: glib/System/Glib/Types.hs
make: *** [glib/libHSglib_a.deps] Error 1
make: *** Deleting file `glib/libHSglib_a.deps'
}}}
  === 
* Got on #haskell.  Duncan (dcoutts) pointed me to {{{http://haskell.org/gtk2hs/gtk2hs-0.9.10.5.tar.gz}}}.  Unpacked, configured, built (&quot;make&quot;), installed (&quot;make install&quot;), and built demos (&quot;make installcheck&quot;).  An error cropped up in the last step.  (&quot;{{{Could not find module `System.Posix.Files'}}}&quot;).  I sent Duncan C a note.
* This library is huge, and it took forever to compile.
</pre>
</div>
<div title="interfaces -- combined and separable" modifier="Conal Elliott" modified="200701300053" created="200701202130" tags="2007-01-20">
<pre>I'm very excited about [[TV| http://haskell.org/haskellwiki/TV]], which is a means for cleanly combining &quot;genuinely functional&quot; (effect-free, semantically simple) code with its &quot;interfaces&quot; (GUIs, IO, networking, etc).

TV has two main algebras:
* //Composable interfaces// support the specification of interfaces to (or &quot;visualizations&quot; of) pure values (typically functions), as separate from those values.
* //Tangible values// (&quot;TVs&quot;) combine interfaces with values, while leaving them separable, so that they may be intelligently composed.  The combination makes TVs directly //usable//, while the separability makes them //reusable//.
At first I intended TV for only graphical user interfaces.  Then I read a [[blog post| http://cgi.cse.unsw.edu.au/~dons/blog/2006/12/16]] by Don Stewart, in which he gives a Haskell solution to the &quot;class grade&quot; problem.  In reading the Haskell code, I noticed a familiar &quot;[[yuk| http://en.wikipedia.org/wiki/Image:Newyuk.png]]&quot; reaction that I have when I see IO and functional code mixed.  I got to noodling over how to more crisply separate function from IO, and discovered that I could apply the TV ideas, if generalized from GUIs.

Fortunately, the presentation function that turns interfaces into Phooey UIs is very simple, and, except for layout, uses only the Arrow interface to UIs.  Extending to {{{IO}}} is then trivial: promote {{{IO}}} to a Kleisli arrow.  And, of course, the same trick applies to //any// monad, not just {{{IO}}}.

Next, Shae Erisson (shapr), mentioned to me that he's working on [[HAppS| http://happs.org]].  In checking out the [[HAppS tutorial| http://happs.org/HAppS/doc/tutorial.html]], I read this phrase ++++&gt;
[...] lets your app be simply a set of functions with types like:
{{{
       SomeInputType -&gt; MACID SomeOutputType
}}}
  === Slapping a {{{Kleisli}}} constructor on that type gives another arrow to try out with TV.
</pre>
</div>
<div title="junk" modifier="Conal Elliott" modified="200611160043" created="200611152317">
<pre>Here's an audio player (odeo): &lt;html&gt;&lt;embed src=&quot;http://odeo.com/flash/audio_player_tiny_gray.swf&quot; quality=&quot;high&quot; width=&quot;145&quot; height=25 name=&quot;audio_player_tiny_gray&quot; align=&quot;middle&quot; allowScriptAccess=&quot;always&quot; wmode=&quot;transparent&quot;  type=&quot;application/x-shockwave-flash&quot; flashvars=&quot;audio_id=1463913&amp;audio_duration=477.257&amp;valid_sample_rate=true&amp;external_url=http://www.podtech.net/audio/news/070706_News_Peter_Sokolowski_New_Tech_Words.mp3&quot; pluginspage=&quot;http://www.macromedia.com/go/getflashplayer&quot; /&gt;&lt;/embed&gt;&lt;/html&gt;
And another (google): &lt;html&gt;&lt;iframe src=&quot;http://mail.google.com/mail/html/audio.swf?audioUrl=http://www.podtech.net/audio/news/070706_News_Peter_Sokolowski_New_Tech_Words.mp3&quot; style=&quot;width: 250px; height: 25px; border: 1px solid #aaa;&quot; id=&quot;musicPlayer&quot;&gt;&lt;/iframe&gt;&lt;/html&gt;

&lt;html&gt;&lt;iframe src=&quot;http://mail.google.com/mail/html/audio.swf?audioUrl=http://www.itconversations.com/audio/download/itconversations-1332.mp3&quot; style=&quot;border: 1px solid rgb(170, 170, 170); width: 500px; height: 25px;&quot; id=&quot;musicPlayer&quot;&gt;&lt;/iframe&gt;&lt;/html&gt;

&lt;html&gt;&lt;iframe src=&quot;http://mail.google.com/mail/html/audio.swf?audioUrl=http://slewwho.audioacrobat.com/download/af9c9917-4c0e-0dab-cae1-ba47f4539b82.mp3&quot; style=&quot;border: 1px solid rgb(170, 170, 170); width: 500px; height: 25px;&quot; id=&quot;musicPlayer&quot;&gt;&lt;/iframe&gt;&lt;/html&gt;

&lt;html&gt;&lt;iframe src=&quot;http://mail.google.com/mail/html/audio.swf?audioUrl=
http://www.cnvc.org/downlds/20020714.mp3&quot; style=&quot;border: 1px solid rgb(170, 170, 170); width: 500px; height: 25px;&quot; id=&quot;musicPlayer&quot;&gt;&lt;/iframe&gt;&lt;/html&gt;

Marshall sound byte:
&lt;html&gt;&lt;iframe src=&quot;http://mail.google.com/mail/html/audio.swf?audioUrl=http://www.cnvc.org/downlds/20020714.mp3&quot; style=&quot;width: 250px; height: 25px; border: 1px solid #aaa;&quot; id=&quot;musicPlayer&quot;&gt;&lt;/iframe&gt;&lt;/html&gt;
&lt;html&gt;&lt;embed src=&quot;http://odeo.com/flash/audio_player_tiny_gray.swf&quot; quality=&quot;high&quot; width=&quot;145&quot; height=25 name=&quot;audio_player_tiny_gray&quot; align=&quot;middle&quot; allowScriptAccess=&quot;always&quot; wmode=&quot;transparent&quot;  type=&quot;application/x-shockwave-flash&quot; flashvars=&quot;audio_id=1463913&amp;audio_duration=477.257&amp;valid_sample_rate=true&amp;external_url=http://www.cnvc.org/downlds/20020714.mp3&quot; pluginspage=&quot;http://www.macromedia.com/go/getflashplayer&quot; /&gt;&lt;/embed&gt;&lt;/html&gt;

{{{audioPlayer}}}: &quot;Never let someone in authority tell you what you are&quot; &lt;&lt;audioPlayer http://www.cnvc.org/downlds/20020714.mp3&gt;&gt;

&lt;html&gt;&lt;iframe src=&quot;http://mail.google.com/mail/html/audio.swf?audioUrl=http://www.cnvc.org/downlds/20020714.mp3&quot; style=&quot;width: 250px; height: 25px; border: 1px solid #aaa;&quot; id=&quot;musicPlayer&quot;&gt;&lt;/iframe&gt;&lt;/html&gt;

{{{&lt;html&gt;&lt;iframe src=&quot;http://www.audioacrobat.com/playweb?audioid=WVk1h0ZQ&amp;amp;buffer=5&amp;amp;fc=FFCC00&amp;amp;pc=AAAAFF&amp;amp;kc=888800&amp;amp;bc=FFFFFF&amp;amp;autoplay=0&amp;amp;player=ap99&quot; height=&quot;57&quot; width=&quot;240&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot;&gt;&lt;/iframe&gt;&lt;/html&gt;}}}
</pre>
</div>
<div title="kyte notes" modifier="Conal Elliott" modified="200612221959" created="200612212209" tags="2006-12-21">
<pre>* I like cursors in text entry boxes.  Otherwise, I'm unsure where focus is.
* Slide show:
** Hurray for multiple file upload!  Saves me the tedium of monitoring the ploads.
** Previews even while loading.  Neat.  Wow -- they keep previewing while I'm editing text.  Wonderfully live feel.
** I want to re-order my slides, and I don't see how to.  My preference is dragging is the view that has all of my slides.
** How about web links in the text?
** I'd like to apply formatting (italics &amp; bold) to parts of the text.
* I expected that a show would have more than one page, e.g., a title page and content.  Now I think just one page per show.
* Once I discovered that &quot;/&quot; meant edit a show, I was in business.  Very easy to edit and see the result.  I sweated some before finding &quot;/&quot;.  The tool-tip definitely helped.
* I love the view shared between watching a show and chatting about it.
* I want to rename my channel and don't see how.
* Failing rename, I'd like to make a new channel, move my show(s) from the old channel to the new, and delete the old.  I don't see a way to move shows between channels.
* I love the idea of a channel design.
* At first I didn't get user-vs-channel-vs-show.  I thought of a &quot;show&quot; as a bigger thing that the user could navigate through, so I figured I'd have a &quot;graphics&quot; show, with some parts in it.  I didn't know why I'd want more than one channel, so I gave my channel a silly name (&quot;Conal's Miscellany&quot;).  Now I see that I want a &quot;graphics&quot; channel with shows like &quot;spirals&quot;, &quot;inversions&quot; etc.
* I'm not sure I like the channels having to be uniquely named.  I went for &quot;Functional Graphics&quot;, as descriptive.  Being an early user, I could have gone for &quot;Graphics&quot;, but I don't want to claim all of graphics.  Someone else will, and then I'll be annoyed.  How about having the combination of user &amp; channel name be unique instead?  Then you can combine them for the URL, e.g., www.kyte.tv/conal/graphics.  And just www.kyte.tv/conal for my profile page.
* Please add sound to chat, so I know when a message comes up.

Sent these comments to feedback@kyte.tv.  More:
* I'd like all chats for my channels saved automatically, so I can see what people say.
* I expected &quot;Watch it Big&quot; to make the show appear on a bigger TV.  As far as I can tell, it doesn't. 

* Show more statistics on viewers.  Graphics for viewers per day, and peak simultaneous viewers.
* Lack of text cursor often leaves me confused.  similarly, if i drag over text to copy or cut, i don't get feedback.  probably you guys know about that one.</pre>
</div>
<div title="last tiddler change" modifier="Conal Elliott" modified="200610311951" created="200610311950">
<pre>&lt;script&gt;
       var tiddlers=store.getTiddlers(&quot;modified&quot;);
       var last=tiddlers[tiddlers.length-1];
       var when=last.modified.formatString(&quot;MM/DD/YYYY at 0hh:0mm:0ss&quot;);
       return &quot;Last tiddler change ('&quot;+last.title+&quot;') was on &quot;+when
&lt;/script&gt;</pre>
</div>
<div title="men's group kick-off note" modifier="Conal Elliott" modified="200701102126" created="200701102122" tags="2007-01-10 [[men's group]] note">
<pre>I want to have a kick-off gathering to talk about what we'd each like in a men's group.  I'm imagining something informal at my house, with pot-luck snacks, for around 1 1/2 to two hours.  If you're interested in the group and unsure, please come to the kick-off and see how you feel.

My intention for this group is that it be an environment for mutual support, personal growth, and friendship.  I'd like it to be leaderless (or with shared leadership), among peers &amp; friends, providing support to all of us, and without any monetary cost to any of us.  I'm thinking we'd have it in someone's home, perhaps different homes different times, given availability &amp; inclination.  These choices are up for grabs, and we'll see what emerges at the kick-off.

Instead of one person in the middle to juggle schedules, I'm using [[TimeToMeet| http://timetomeet.info]].  Each of us can then enter his own free times, and the site will figure out what the common free times are.  From there, I'll send out a confirmation.  If you don't check your email daily or so, please let me know that.  You'll get a separate email directing you to the TimeToMeet site.  If it doesn't work for you, please let me know.

Please phone (or email) me if you have any questions, or just want to talk.
</pre>
</div>
<div title="misc to do" modifier="Conal Elliott" modified="200702100359" created="200610251630">
<pre>Record &quot;to-do&quot; items below.  Move them into journal entries when done.  See also &lt;&lt;tag project&gt;&gt;. ++++
* Work on [[blogging topics]].
* Switch from html-mode to css-mode for my uses of hscolour.  Imagine what kinds of flexibility I could exploit.
* Play with Emacs outline minor mode.  Maybe use it with Haskell code &amp; Haddock documentation.
* Work on simple &amp; clear explanations of my various projects, to tell people when they ask.
=== </pre>
</div>
<div title="mmm-mode for Haddock comments" modifier="Conal Elliott" created="200701122341" tags="2007-01-12 idea Emacs Haskell">
<pre>Show coloring for markup, which would reveal a missed closing {{{/}}} or {{{@}}} and show the difference between strings and modules.  Maybe change to longlines mode.</pre>
</div>
<div title="more recursive tiddler processing" modifier="Conal Elliott" modified="200611192313" created="200610312140" tags="idea TiddlyWiki 2006-10-31">
<pre>Examples:
* Suppose I have a tiddler called &quot;conal's home page&quot;, containing the text &lt;&lt;tiddler &quot;conal's home page&quot;&gt;&gt;.  Then I'd like to say {{{[[conal's home page|&lt;&lt;tiddler &quot;conal's home page&quot;&gt;&gt;]]}}}.  Sadly, the {{{tiddler}}} macro doesn't get called: [[conal's home page|&lt;&lt;tiddler &quot;conal's home page&quot;&gt;&gt;]].  I'd like the macro to get called for either the label or target of a link.  Fixed in TW 2.1?</pre>
</div>
<div title="my timeline format" modifier="Conal Elliott" modified="200701122335" created="200701122329" tags="systemConfig">
<pre>/***
|Author|[[Conal Elliott|http://conal.net]]|
|Date|2007-01-12|
|Version|1.0|
!Description
Use my preferred date format for the timeline.
!Code
***/
//{{{
config.macros.timeline.dateFormat = &quot;DD MMM YYYY&quot;;
//}}}
</pre>
</div>
<div title="note about TiddlyWiki and Haskell" modifier="Conal Elliott" created="200701102156" tags="2007-01-10 TiddlyWiki Haskell note">
<pre>I've been fantasizing about integrating another tool with Haskell programming, namely TiddlyWiki (http://tiddlywiki.com).  TW is like a wiki but also quite different.  In most cases, clicking on a link causes the linked-to content to //join// the current page rather than replacing it.  Such content, called a &quot;tiddler&quot;, is usually &quot;micro-content&quot;, such as a single paragraph.  You can grab &amp; re-arrange tiddlers and close or collapse them (given a few TW plugins).  The result is that reading a document causes just the content of interest to populate the view.  It all works via Javascript.  It's great fun, and if you haven't tried it yet, I encourage you to.  I use TW constantly for my daily journaling.

See also [[using TiddlyWiki to view programs]].
</pre>
</div>
<div title="note to Chris Klimas about twee (2007-01-04)" modifier="Conal Elliott" modified="200701050146" created="200701050145" tags="2007-01-04 TiddlyWiki">
<pre>Hi Chris,

Mode-spammed, eh?  better tighten those email filters.  Oops -- another one slipped through.  I thought I was done twee-mode-hacking for a while, but I guess I'm hooked.

I see that http://gimcrackd.com/etc/src/twee.el is still the Oct 18 version.  When you've updated it, I'd like folks on the tiddlywiki google group to know.  I could tell them, or you could.  i see you have a tweecode group, which I just joined.

I copy &amp; paste between emacs &amp; my tiddlywiki, rather than actually converting between .tw and .html.  I tried converting once and got a version mismatch, I think, and then didn't pursue it.  But then I tried again today, and it worked fine except for two points:
* One blank line gets added between tiddlers on every tweebox/untwee round trip.
* One syntax error in SyntaxifyPlugin.  I'll look into it.
If I start actually converting my whole TW between .html &amp; .tw, I'll probably want to work on your first two items below.  The third one (mmm-mode) I already want for included Javascript and Haskell code.  Maybe html and css also.  I've done some mmm-hacking for literate Haskell programs (Haskell in text and Haskell in LaTeX), and I like it a lot.

Another dream I've been noodling on is TiddlyWiki as container for literate programs (especially Haskell programs). I'm imagining auto-linking of name references to defining tiddlers (using some existing tools to help), and custom fields for type info and maybe other stuff.  I'll want automatic conversion between forms for compilation and for web-viewing.

Is [[this| http://gimcrackd.com/etc/src/#%5B%5BConvert%20an%20existing%20TiddlyWiki%20to%20Twee%20format%20online%5D%5D]] my best bet for .html-&gt;.tw conversion?  Do you have a standalone program I could use to automate the process?
</pre>
</div>
<div title="note to Sandy about giving one's word" modifier="Conal Elliott" modified="200611022316" created="200611022231">
<pre>{{{
From: Conal Elliott
To: Sandy Fox
Cc: Holly Croydon
Date: Nov 2, 2006 10:42 AM
Subject: Re: NVC Academy &amp; PSNCC
}}}

How about you &amp; I have this conversation with Mary Mackenzie before the core team meeting?  In NVC, rather than saying &quot;no&quot;, we say the needs that interfere with saying &quot;yes&quot;.  Then instead of getting stuck, we can always come back to the unmet needs.

I also want to prod you to re-examine your beliefs &amp; habits around having given your word.  In my learning &amp; living of NVC consciousness, I let go of the idea of promises and any notion of integrity that's tied to what I used to intend, and I embrace a notion of integrity with what's true &amp; alive in each moment.  Promises get  me into the embalming fluids of static thinking and duty &amp; obligation.  Instead, I can talk about my current intentions and predictions.  For instance, I might say to Mary, &quot;I'm discovering that I was mistaken when I believed that I'd want to distribute your fliers to our group.  And I'd love to share with you the needs that are interfering with me granting your request.&quot;  Or, I might start with &quot;Wow -- I'm feeling torn between personal integrity and [whatever need might be tugging me to do what I said I'd do instead of what's congruent with what I now understand].&quot;  Or if I imagine she'd object to my changing my yes to a no, I might check out my guess by asking her &quot;Do you still want me to grant your request even though I now don't know how to do it joyfully?&quot;  Or &quot;... even though it now conflicts with my personal integrity?&quot;  Do you know Marshall's [[&quot;hungry duck&quot; quote|http://www.cnvc.org/downlds/20020802.mp3]]?  And if regret comes up for you about the impact of your mistaken prediction on someone else, there's [[mourning vs apology|http://www.cnvc.org/downlds/20011116.mp3]].

If you'd like, I'd be happy to support you in looking whether your ideas about giving your word are genuinely coming from needs-centered, life-centered consciousness or from some habitual right/wrong thinking.  I've noticed that it's easy for NVC folks to accept giraffe-sounding descriptions (as far as I can tell) of jackal thinking.  If you'd like, I'll challenge you to go deeper, without telling you what you &quot;should&quot; end up doing.

Reactions?

  Love, Conal</pre>
</div>
<div title="note to Sandy about server software and the power of computers" modifier="Conal Elliott" modified="200701132116" created="200701130635" tags="2007-01-12 note [[Sandy Fox]] computers [[big ideas]]">
<pre>&gt; I didn't know that software could be installed on a server.  To educate me can you share a couple of examples of software that are installed server?
Everything you do on the web is talking to software running on a server.  I'll give a few examples.  Pan might have some more.
* Web server software accepts URLs (like http://conal.net/Pan/Gallery), figures out what the corresponding file on the server is, reads in the file, and sends it back out to your web browser.
* SurveyMonkey has a program that interacts with you to create a description of a survey and another that presents your questions and gets people's answers.  There are probably a bunch of little programs on their server.  I don't know whether they made that software themselves or they got it from someone else and installed it and dressed it up with their own look.
* A blog engine gets installed on a server to let one person (or many) write blog entries and to deliver them to other people.  Kind of like a regular, &quot;static&quot; web page, but much more alive.  Example: http://conal-elliott.blogspot.com and http://www.goesping.org/categories/justthinkin/nvc.  I found the latter by searching: http://www.google.com/search?q=nvc+blog and clicking on the first hit.  This week my little brother Joseph installed the popular blog engine WordPress on his server for my mom to start blogging on her web site (http://murraycreek.net/).  She's bursting with creativity.
* Wiki engines, like the one that runs Wikipedia.  Their engine (the software that manages the Wikipedia) is called Wikimedia and is freely available for anyone to install on their own server for their own content.  The software is much more general than running encyclopedias.  There are hundreds of installations of Wikimedia for all kinds of purposes.  The Wikimedia foundation itself has several different uses: http://wikimedia.org/.   Oh -- I just found the Little Prince quotation page: http://en.wikiquote.org/wiki/The_Little_Prince.  I love the Little Prince.  My favorite: &quot;Here is my secret. It is very simple: It is only with the heart that one can see rightly; what is essential is invisible to the eye.&quot;
* Emergence will be software that can be installed on other people's servers if I choose to offer it.  Note that the server software (sometimes called an &quot;engine&quot;) is distinct from the particular collection of data it uses.  So sharing the software doesn't mean sharing the data.  The power of that separation is that people can use a single engine for many different things.  One important trick is to make even the visual style be part of the data, interpreted by the engine, so that sites running the same software can look completely different.
* Meanwhile, Pan's friend Mikol showed us http://elgg.net.  Their engine http://elggspaces.com is freely available and is what we'll probably install &amp; use for the first approximation of Emergence.
Maybe that's enough to get the idea and a hint of the possibilities.

What's radically powerful about the computer is that it's a &quot;universal machine&quot; -- one that can interpret the description of another machine and act like that machine.  Thus machines are data that can be communicated &amp; manipulated by other machines.  This is an incredibly powerful idea.  Now with the internet, those &quot;soft&quot; machines can also be replicated and transported great distances very quickly.  As an example, [[this page| http://conal.net/Pajama/examples/inverting_tiled_bilerp.html]] contains an image that is interactive, infinite in extent, and infinite in detail.  That interactive image is represented as a program (soft machine) that is generated by another program from a succinct mathematical description.  That original description goes through at least six layers of translation and/or interpretation by the time it actually downloads and runs on your computer.

My big technical dream project is to take this incredible expressive power and make it accessible in a &quot;artistic&quot; (right-brain, holistic, visual, concrete, Feminine) creative mode.  I had a breakthrough and have been making spurts of progress on that dream over the last two years.  I believe such a thing could have at least as powerful an effect on human culture as verbal literacy, and provide a balance to the masculinizing nature (linear, left-brain, sequential) of verbal literacy.  (See Leonard Shlain's book &quot;The Alphabet vs the Goddess&quot;, which rocked my world.)

Enough for now.  Thanks for the stimulating request. 

    Hugs,  - Conal</pre>
</div>
<div title="notes from 2006-10-23 evening certification candidate call" modifier="Conal Elliott" modified="200611072025" created="200611062241">
<pre>* 25:00: Confusion about how the certification/assessment process will proceed.
* 26:00: Alexandra offered some channeled information.
* 27:00: Frustration over being stalled after four years of pursuit.  Wants to trust that the certification process will proceed consistently with NVC.
* 31:00: Scott's sense that many people share the frustration and confusion over what's required and how it's possible to get through the certification process.
* 37:30: Inspiration about contributing to clarity and supporting CNVC.
* 39:00: Scott: standardization vs partnership consciousness
* 40:00: Certification process as domination.
* 43:40: Jeff Brown (who's on the GCC): doesn't see the certification program changing significantly (no structural or functional changes).  Rita Herzog is the head of the committee and is leading the process to select a &quot;couple more people&quot; to replace Robert &amp; meet the increasing demand.  Rita will take on some candidates in the meanwhile.  &quot;There's a very large increasing demand&quot;.
* 46:50: Jeff Brown himself heard domination in the certification system and so has everyone who's involved in the process struggle with this issue, especially Marshall.  An &quot;evolutionary process that is very much in deveopment&quot;.
* 48:00: Tewa in Kauai: sees certification coming out of the old paradigm, and now ongoing dance while we're evolving toward the new paradigm.
* 51:00: Certification gives some valued support but also brings in external approval.
* 52:20: Strategies: Wade: sharing information about how to get through the process
* 58:00: Preference of voice over email.  More feeling of connection.
</pre>
</div>
<div title="notes from 2006-10-23 morning certification candidate call" modifier="Conal Elliott" modified="200611061928" created="200611061732">
<pre>10 AM Eastern ([[listen|http://www.audioacrobat.com/play/WVk1h0ZQ]],[[download|http://slewwho.audioacrobat.com/download/95ee8266-9465-23ba-5f68-ea19d8af33a0.mp3]]). Notes:
* 3:20: Reminder of needs expressed.  Areas:
** Clarity, understanding, open communication
** Growth as trainer (teaching opportunities)
** Structure &amp; support for completing the certification program
* 19:30: ~AnnMarie Mackelvie: Liv Monroe is retiring as assessor in March, so have to get done before then or will be out in the cold.  (Concern about changing requirements.)
* //... skimmed through technical difficulties making phone connection with the GCC ...//
* 1:02:00 ~AnnMarie: suggested a representative from the candidates on the GCC.
* 1:14:00 Mercedes: wanting more play/dance in certification.  Conal: alternatives to certification.  
* 1:16:10 Conal: overview of the emergence vision

</pre>
</div>
<div title="notes on CSS" modifier="Conal Elliott" modified="200701052034" created="200610282257" tags="2006-10-28 [[how to]]">
<pre>From http://www.w3schools.com.
* Basic form: {{{selector { property: value; ... }}}} 
* The selector could be a tag like ({{{body}}}, or a {{{tag.class}}} like ({{{body.resume}}}, or just {{{.class}}} for any tag with a given class.
* Instead of a {{{tag.class}}}, we can use {{{tag#id}}} or drop the {{{tag}}}.
* Instead of a single selector, one can use several, separated by commas.
* In the {{{&lt;head&gt;}}} section, include an &quot;external style sheet&quot; like this: {{{&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;mystyle.css&quot; /&gt;}}}
* Or (still in the {{{&lt;head&gt;}}}, put style specs between {{{&lt;link&gt;}}} and {{{&lt;/link&gt;}}} instead of the {{{href}}}.
* &quot;//Cascading// style sheets&quot; means that inline styles override internal, which override external, which override browser defaults.
* Specify inline like this: {{{&lt;p style=&quot;color: sienna; margin-left: 20px&quot;&gt;}}}
</pre>
</div>
<div title="notes on Tangible Values" modifier="Conal Elliott" modified="200612280645" created="200612280642">
<pre>Spewing some notes here.
----
TV is a library that combines the user-friendliness of ~GUIs with the composability of libraries.
----
Unix provides two different composition mechanisms: programming libraries and pipes.
----
We want our software to be easy and safe to use.  Different users, however, have different requirements for ease and safety, so software generally targets only some users or compromises suitability for all.  Can we design software that suits all users ideally?  In particular, we address three different styles of use:
* Interactive, via ~GUIs.  [Hmm. not a user class.]
* Text-oriented
* Use by other code, i.e., program composition  
----
In software design, user-friendliness and reusability are at odds with each other.  When a program packages up functionality for convenience of a human user, it is awkward or impossible to reuse as a component of another program.  Suitability of code //use// depends on the code's interface.  Humans like graphical or text-oriented interfaces, while other code likes data-oriented interfaces.
 
Unix provides a clever compromise.  Piping //text// between programs allows direct use as well as composition, but at a considerable cost.  Text is not ideal for humans or for programs.  Besides, piping gives only linear composition, which does not always suffice.  Also, interactivity is lost.  (Clarify.)
----
programs vs program libraries.  no reuse in UI.  and what is the interface?  (strings)
----
We'd like our programs to be friendly to users and to programmers.  
----
</pre>
</div>
<div title="notes on the heart of NVC" modifier="Conal Elliott" modified="200701180249" created="200701180244" tags="2007-01-17 NVC">
<pre>* What are you looking for in this exchange?
* I'm here because I want to enjoy the human community more, and I want everyone to.  I want more fun, understanding &amp; compassion.
* Any prior exposure to MBR's &quot;NVC&quot;?
* We're here to talk about communication, but only as a means to an end.  We really want to get to our thinking, and especially our unconscious, habitual thinking that shows up in our communication.  I want to improve our experience of life substantially, and that means changing the way we think.
* You probably hear some new &amp; strange ideas during our time together.  I want you to try them on for yourself, rather than agree or disagree.  Don't take my word or anyone else's.  Play with the ideas and make them your own.
* Where are we now?  We're about 8,000 years into an era of domination-based thinking.  Our language was shaped by this era to fit the agenda of Kings (power over others).  (//Aspects from [[Context and Principles|http://awakeningcompassion.com/contextandprinciples.htm]].//)  Domination thinking and language doesn't create a fun, joyful &amp; self-empowered society, because it's not meant to.
* The thinking and language of NVC has a different agenda: ++++
*  intimate connection
*  joyful giving &amp; receiving
*  personal choice
  === &quot;Power-With&quot;, rather than &quot;Power-Over&quot;.
* We give longer classes full of principles and techniques, but today I want to say essentially one thing, in a few ways, and invite you to try it out. ++++
&gt;Everyone does everything they do for one reason, which is to get their needs met the best way they know how.
The practice of NVC boils down to bringing my curiosity back to the question of what universal human needs are behind someone's action.  Whatever they are, I have the same precious needs.
  === 
* Rephrasing ++++&gt;
No one ever does anything wrong.
  === Let's try that on.
* Or ++++&gt;
All anyone ever says is say here's what I need.
  === The tricky part is that we've been educated to express our needs in really obscure ways, like demand, accusation, and criticism.  So we learn to decode this language in ourselves &amp; others.
</pre>
</div>
<div title="parametric tiddlers" modifier="Conal Elliott" modified="200611062305" created="200610251706" tags="idea TiddlyWiki 2006-10-25">
<pre>Let tiddlers abstract over parameters.  Add tiddler parameters, like {{{&lt;&lt;tiddler foo arg1 ...&gt;&gt;}}}.  Or maybe just {{{&lt;&lt;foo arg1 ...&gt;&gt;}}}.  How to refer to parameters?  Surround formal parameter references with angle brackets, like {{{&lt;&lt;x&gt;&gt;}}}.  Where are formal parameters specified?  In a field, just like tags.

Maybe implement parametric tiddlers by a simple conversion into javascript.

Found this: http://tiddlywiki.abego-software.de/#TiddlerWithParamsPlugin </pre>
</div>
<div title="phone call with Rita Herzog and Sandy Fox" modifier="Conal Elliott" modified="200610300502" created="200610270611" tags="2006-10-26 conversation">
<pre>Rita said that some people do see the CNVC process as authoritarian, and she offered the diagnosis that &quot;They're just projecting&quot;.

Rita said she wants to go in the direction of peer support and that they haven't gotten there yet. From 1995 on, it was just Marshall deciding who was certified, which Rita said was very &quot;authoritative&quot;.  And that Marshall had a sense of their spiritual orientation rather than more detailed information. About five years ago, they started moving in a new direction, which Rita described as based in &quot;mutuality&quot;, in that it's a &quot;mutual decision&quot; about whether someone gets certified.  (Didn't ring true with me.)  It's a &quot;huge wonderful improvement&quot; over what it was before.  She said certification is not about a credential.  It's a commitment to the organization. Rita's idea: &quot;an independent studies masters degree&quot;.

Rita said that Seattle has a strong group, and so we're ready for something else.  (To certify on our own?)  I don't know if she really heard that we were talking about evolving beyond certification altogether.

About the needs behind CNVC certification:
* Trust that there is a core group of people who are passing on NVC skills with accuracy.
* Getting a body of trainers to work with CNVC.
I asked why the goal of getting people to work with CNVC?
* They ask that trainers renew and give monetary commission.
* The organization can talk about work going on the world, which help them get grants.  (Though they miss the accomplishments of non-certified folks, don't they?) 
* Certification means that (qualified) trainers contribute to the organization, so the organization can survive.
* Without certification, CNVC has no way to say that some people are //not// qualified to teach NVC.  
She said that many people want to get credentialed.  And they want to do so without much time &amp; effort. 
 
I brought back her description of the certification process as being &quot;mutual&quot;.  How can the process be &quot;mutual&quot;?  What happens when assessor and candidate disagree?  Rita says they talk about it and it is mutual. Then there is an appeal process.  If that fails, then it's bumped up again.  Eventually, if disagreement persists, the candidate is simply told no.  Of course, this whole time, the candidate is //not// certified, so it's hard for me to see how it's a genuinely mutual process.

In various parts of the conversation, Rita went on about things we weren't asking.  I'm guessing she was on the defensive from the start, and that some of my challenging questions and comments triggered more defensiveness.  Sandy noticed that Rita interrupted me several times but when I tried to interrupt her, she kept talking.  Easy to interpret as more hierarchy &amp; domination.

I ended up feeling frustrated and discouraged with the conversation.  Also grateful about my choice to work outside of authoritarian systems -- to work //on// the system rather than //in// the system.  And grateful for Sandy's support and encouragement.  I want to offer another vision that meets people's better and then allow Emergence to operate.  Hierarchy only gets to play Power Over when people are willing to play Power Under.
</pre>
</div>
<div title="phooey-0.0 release note" modifier="Conal Elliott" modified="200612242251" created="200612120625" tags="2006-12-11 announcement Phooey release">
<pre>Announcing [[Phooey|http://conal.net/phooey]], a functional UI library for Haskell.

~GUIs are usually programmed in an &quot;unnatural&quot; style, in that implementation dependencies are inverted, relative to logical dependencies. This reversal results directly from the imperative orientation of most GUI libraries. While outputs depend on inputs from a user and semantic point of view, the imperative approach imposes an implementation dependence of inputs on outputs.

Phooey (&quot;''Ph''unctional ''oo''s''e''r ''y''nterfaces&quot;) retains the functional style, in which outputs are expressed in terms of inputs. In addition, Phooey supports dynamic input bounds, flexible layout, and mutually-referential widgets. 

As an example of Phooey's style, below is a simple shopping list GUI.  The //total// displayed at the bottom of the window always shows the sum of the values of the //apples// and //bananas// input sliders.  When a user changes the inputs, the output updates accordingly.
&gt;[img[http://conal.net/phooey/images/ui1.png]]
Phooey is structured as an arrow, and this example uses arrow notation.  The code:
{{{
ui1 :: UI () ()
ui1 = title &quot;Shopping List&quot; $
      proc () -&gt; do
	a &lt;- title &quot;apples&quot;  (islider 3) -&lt; (0,10)
	b &lt;- title &quot;bananas&quot; (islider 7) -&lt; (0,10)
	title &quot;total&quot; showDisplay        -&lt; a+b
}}}
I am working on a paper about Phooey. For now, please see [[the Haddock documentation| http://darcs.haskell.org/packages/phooey/doc]] (which includes more examples), and try the code via
&gt;darcs get http://darcs.haskell.org/packages/phooey
Directions for building are in the [[README| http://darcs.haskell.org/packages/phooey/README]] file.  Distribution tarballs are [[here| http://darcs.haskell.org/packages/phooey/dist]].

Comments and collaboration are very welcome!

Cheers, - Conal

P.S. I'm very grateful for Don Stewart's recent pointers on how to create &amp; release Haskell projects.

</pre>
</div>
<div title="plugin" modifier="Conal Elliott" created="200612311632" tags="2006-12-31 TiddlyWiki definition">
<pre>A TiddlyWiki plugin is a tiddler that contains Javascript code and is tagged &lt;&lt;tag systemConfig&gt;&gt;.  There are some conventions and mechanisms that make such code pretty to read.</pre>
</div>
<div title="project" modifier="Conal Elliott" created="200611190330" tags="2006-11-18 tag">
<pre>A tag for notes on various projects</pre>
</div>
<div title="project release check-list" modifier="Conal Elliott" modified="200805182315" created="200701142053" tags="[[how to]]" changecount="5">
<pre>Here is a check-list for releasing Haskell project.  See also [[How to write a Haskell program| http://haskell.org/haskellwiki/How_to_write_a_Haskell_program#Releases]]. Replace {{{phooey}}} by your project name. 
* Clean rebuild: {{{make clean all}}}.
* Check over README
* Compare the .cabal's Extensions against the OPTIONS lines (use tags-search).
* Do {{{darcs changes}}} and {{{darcs whatsnew}}} and make sure CHANGES is current.
* How do the examples look?
* Run test examples (if not automated).
* Check documentation, including links to external libraries, colorized source code, and wiki comment pages.
* Does my release depend on my own changes to other libraries?  If so, make sure those changes libraries get integrated and into the repo and that I list the detailed dependency in my .cabal.
* Make or update wiki page, including TODO.
* {{{darcs record}}}
* Tag the repo, e.g., {{{make tag}}}
* If this is the first release, set up a new repository on the server: {{{make repo}}}.
* {{{darcs push}}}.
* Get and build in a new directory: {{{make test-get-build}}}.
* Copy the docs to the server and check them out via {{{make web-doc-see}}}.
* Make a tarball and and copy to server dist directory: {{{make darcs-dist}}}
* [[Tell Hackage| http://hackage.haskell.org/packages/hackage.html]].
* Email announcement.</pre>
</div>
<div title="quotation TiddlyWiki" modifier="Conal Elliott" modified="200701130537" created="200701130528" tags="2007-01-12 idea TiddlyWiki quote">
<pre>Put all of my quotations into a TiddlyWiki, one quote per tiddler.  How would TiddlyWiki enhance the experience?  Specifically, how would I exploit tagging and linking?  Tag each quote with the author's name and some key words about the quote, such as themes and images.  When someone reads the quote, s/he will see the tags and click on them to see other quotes related in many ways.

How to name the tiddlers?  Use the first few words of the quote, followed by &quot;...&quot;.

For example, [[Gamble everything for love, ...]].

When ZiddlyWiki has custom fields, use one for the author.  Uses:
* Automatically generate an author index.  Alternatively, I could make a tiddler for each author with some info, at least a Wikipedia pointer, and then tag those tiddlers with &quot;author&quot;.
* Automatically format the view with the author's name in a consistent way.
</pre>
</div>
<div title="reply on the " modifier="Conal Elliott" modified="200612010530" created="200612010234" tags="2006-11-30 conversation">
<pre>Thanks Jeff, Susan and Jim for your request for clear observations around &quot;top-down assessment bottleneck&quot;.  I love the question, as helping create anchor point in the conversation.

My belief in a &quot;top-down assessment bottleneck&quot; comes from the following sources.  Some are observation, some interpretation, and some extrapolation.  I would love for others to share their reasons as well.
* Our local NVC organization has its own certification process.  I have been disappointed in my own attempts to inspire those with certification to come to my trainings.  While I'm delighted with the quality of my trainings from my own sense and the feedback of those attending, the lack of attendance by already-certified folks translated into lack of support by the organization, particularly welcoming my presence on the group web-site to advertise my trainings and other NVC offerings.  I've heard similar disappointment and discouragement from others in the group.
* In the Certification Support Program calls (facilitated by Scott Lewis), I've heard others expressing frustration with difficulty in getting time &amp; attention from their assessors.  I've understood some of them to be so discouraged with their difficulty and disconnection with underlying needs (rather than requirements) that I doubt they would continue if they had a supportive alternative.  I would like people with those experiences to share their observations on this discussion group.
* Considering the number of people registered in the certification process vs the number of assessors, I imagine that a bottleneck is inevitable, whether now or later.  (There's a bit more detail in Emergence document section [[&quot;the top-down assessment bottleneck&quot;| http://emergence.awakeningcompassion.com/#%5B%5Bthe%20top-down%20assessment%20bottleneck%5D%5D]].)  In reading the book &quot;Emergence&quot; by Steven Johnson, I realized that such bottlenecks are inherent in //any// top-down quality control strategy, but not in the bottom-up strategies found in living systems.
* This one is more subjective, based on my own internal experience and empathic connection with some others.  I've noticed how my own interest &amp; energy moved toward certification, and the more I worked at getting others' recognition &amp; validation, the less connection I felt with my original fired-up, life-transforming inspiration about living &amp; sharing NVC consciousness.  In listening empathically to some others, I've heard a similar loss of energy, replaced with a less-than-joyful willingness to slog through a set of requirements that do not resonate with their life energy.  In this sense, though I hadn't thought if it before I wrote the Emergence document, I see my own and others' interest in certification as being a bottleneck to the energy inspired to life and action by Marshall's insights and teachings.
Hm.  I'm feeling anxious at this point.  I want to be understood I'm not saying CNVC certification should be any different from what it is, considering that it //is// an external certification process (external rather than self-certification).  Rather, I want to see an alternative process with alternative goals that gives ~NVC-enlivened people direction and support that they can stay connected with and pursue with satisfaction and joy, and which do not have a built-in conflict between quality/health and growth.  Concretely, my goals include
* visibility of everybody who shares NVC;
* learning community (i.e. a //community// that learns);
* a support system for people who are passionate in their discovery of nvc, providing mentorship, freedom, resources on sharing effectively, and //feedback// on their sharing, and that does so without imposing top-down evaluation;
* rapid growth //and// high degree of quality/health.
</pre>
</div>
<div title="reply to Jeremy Ruston about dependencies" modifier="Conal Elliott" modified="200612300218" created="200612300217" tags="2006-12-29 idea TiddlyWiki">
<pre>I see what you mean about the flexibility of the NOTYET approach.  It does have a performance problem, namely //O(n^^2^^)// worst case for //n// plugins.  Making dependencies explicit allows a standard topological sort algorithm, which is linear in the number of plugins + actual dependencies.

About your metadata point: plugins already do rely on a piece of metadata, namely the systemConfig tag.

I'm confused about some aspects of the NOTYET idea:
* Suppose my plugin can work with &quot;pluginA OR pluginB installed&quot;, but prefers pluginB.  I don't know how it could decide when to settle for pluginA and when to hold out in hope of pluginB.
* Mechanical: how can a plugin //return// NOTYET or any value at all?  Isn't plugin code simply evaluated for its side-effect?
I'm wondering whether CSS has a similar dependency issue.  When I want to override a CSS spec in some tiddler (like StyleSheetLayout), I don't know how to do that reliably.  (Well, maybe I do, now with Bob's lexical ordering tip.)  I think the one that shows up //last// in the html wins.  And I don't know how to guarantee that mine ends up last.  So I have the same problem as plugin dependencies.  The explicit dependency approach (with top-sort) would apply to CSS as well as plugins, but the NOTYET solution depends on there being executable code.  Right?

BTW, while we're on the topic of plugins &amp; dependencies, I'd love to have specification and mechanism for pulling in tiddlers (plugins, CSS, marked up text) from //external// sources.  That way, I can save a lot of duplication and consistency management.  Ideally, I'd like my ~TWs to be really tight -- free of any redundant information, like my programs are.  Anything reusable would be put in a library and imported.  Rather than simply ordering the processing of my plugins (as we've been discussing in this thread), the listed dependencies (or the plugin code) would be used to actively load depended-on code if it's not local to the TW and if it hasn't already been loaded.

One thing I really love about TiddlyWiki is that it stimulates my imagination whenever I use it.  I start out just wanting to type in my journal and the tool itself inspires my creativity.  Last night I got the idea of organizing my Haskell program modules as ~TWs and using Haskell's module discipline for ~TWs in general.  The code would be rendered beautifully and have automatic links from name uses to defining tiddlers.  I got so excited about this idea I couldn't sleep.
</pre>
</div>
<div title="reply to Shulamit Day on 2006-11-26" modifier="Conal Elliott" modified="200611262216" created="200611262211" tags="2006-11-26 conversation">
<pre>I enjoyed your rant for its thoughts and feistiness.  Thanks for sharing it with me. Besides this overall reaction, here are some bits that caught my interest:
* &quot;Certified&quot;.  Do we really want to look to others to certify us?  Isn't that just more of the old external-approval / power-under game?  I think I'm finally getting over my desire for certification, though I'd like more community and more support in my marketing.  What if the people who were inspired with NVC, instead of putting their life energy into making it through an unsupportive and uninspiring system, put their energy into creating a genuinely empowering alternative and then thriving in it?
* Yow!  I'm with you about evolving beyond top-down control.  (In response to &quot;Then the NVC organization would have to trust in its own values ...&quot;.)
* About wanting a &quot;curriculum&quot; from CNVC, wouldn't you be asking for more external authority?  Instead I suggest we clearly articulate the essence of //NVC consciousness//, and teach ourselves and others how to set up and observe feedback systems that tell us which of our practices (wherever they originate) support that NVC consciousness and which undermine it.  Marshall has offered a set of practices that resonate very well with me and apparently with many others as well.  Rather than take them or anything as dogma, let's experiment and compare notes.  And let's do this experiment visibly &amp; globally.  I bet we'd learn a lot, and we'd contribute to the evolution of NVC in the process.  More importantly, we may reach a lot more people.
* I was surprised to hear you seeing NVC as a governance system and seeing sociocracy as out-of-sync with NVC.  Maybe I've gotten a different impression of the role &quot;bosses&quot; in a genuinely sociocratic organization.
* Empathy collective??
Now a rant of my own.  I'm very suspicious about what's behind the use of the word &quot;trainer&quot; in NVC circles, by both the people claiming the label and those wanting it.  I used to be in confusion and then in pain in our local organization around that word.  I came to see that folks mostly use the word &quot;trainer&quot; not for its common meaning of &quot;one who trains&quot; but rather to mean &quot;one //approved// to train&quot;.  Sometimes people bother to say &quot;certified&quot;, though even then they don't say certified by whom.  For instance, I'm happy with my understanding and teaching of NVC, so I've certified myself.  My guess is that the language is implicit because people are uncomfortable about the part they're omitting (external approval), and that they're uncomfortable because it's so out of sync with NVC consciousness and skills.  I invite you to join me in challenging this implicit language and shifting our own speaking to more clarity, power and consistency with NVC consciousness.

Does anything I've said grab you?  If so, I hope you'll let me know.

</pre>
</div>
<div title="safe &amp; efficient internet computing" modifier="Conal Elliott" modified="200612051633" created="200612051630" tags="idea 2006-12-05">
<pre>''Goal'': Create a simple, safe &amp; efficient foundation for zapping &quot;code&quot; around the Internet.
''Motivation'': conciseness, reuse, expressive power.

''Idea'': A typed &quot;wire protocol&quot;, consisting of the following pieces:
* A collection of known &amp; trusted //effectful procedures//, with different implementations for different architectures.
* A collection of known //pure values//, some literal and some named, including functions (e.g., &quot;1&quot;, &quot;pi&quot;, and &quot;cos&quot;).
* A simple //glue language//, namely tupling, application, lambda, and definition modules.
* A simple, statically checkable //type system// for the pieces above.
Client-side implementations could either interpret or compile.

''Question'': ~NeWS and client-side Java are similar ideas.  Why didn't they catch on?
</pre>
</div>
<div title="sand box" modifier="Conal Elliott" modified="200804250532" created="200611152348" changecount="39">
<pre></pre>
</div>
<div title="self-organizing FAQs" modifier="Conal Elliott" modified="200701050241" created="200611092147" tags="2006-11-09 idea">
<pre>Thoughts on a self-organizing frequently-asked-questions list:
* Anyone can add a question
* Anyone can add an answer to a given question
* Both questions and answers are sorted automatically by heuristics that estimate interest.
** For a question, clicking on it (to reveal answers) suggests interest.
** For an answer, the reader is asked how helpful the answer was (e.g., out of five stars).  //Or// invite the user to do something with the answer, such as &quot;add to favorites&quot;.  This option applies to questions also.  ([[&quot;Passive&quot; rather than &quot;active&quot; filtering| http://en.wikipedia.org/wiki/Collaborative_filtering#Types]].)
** Newness also adds to estimated interest.
** Factor in a prediction based on the author's track record.
* Tailor as much as possible to the particular user:
** Newness //to the user//.  Has the user seen a question or answer and passed it over?
** Remember //the user's// own favorite questions &amp; posters.
** Combine the user's preferences with other people's preferences.
** Notice correlations in preferences to make more predictions, i.e., [[collaborative filtering| http://en.wikipedia.org/wiki/Collaborative_filtering]].  I think this is the sort of thing Amazon does.
There are [[free software libraries| http://en.wikipedia.org/wiki/Collaborative_filtering#Software_libraries]] for collaborative filtering.</pre>
</div>
<div title="separating IO from logic" modifier="Conal Elliott" modified="200701210036" created="200612200404" tags="2006-12-19 idea">
<pre>Compare (a) separating logic from user interface and (b) separating logic from &quot;real world interface&quot; (side-effects).  I have a &quot;[[yuk| http://en.wikipedia.org/wiki/Image:Newyuk.png]]&quot; reaction when I see IO and functional code mixed.

Here's an example [[from Don Stewart's blog| http://cgi.cse.unsw.edu.au/~dons/blog/2006/12/16#programming-haskell-intro]]:
\begin{code}
main = do
    src &lt;- readFile &quot;grades&quot;
    let pairs   = map (split.words) (lines src)
	grades  = foldr insert empty pairs
    mapM_ (draw grades) (sort (keys grades))
  where
    insert (s, g) = insertWith (++) s [g]
    split [name,mark] = (name, read mark)

draw g s = printf &quot;%s\t%s\tAverage: %f\n&quot; s (show marks) avg
  where
    marks = findWithDefault (error &quot;No such student&quot;) s g
    avg   = sum marks / fromIntegral (length marks) :: Double
\end{code}
What's the type of the &quot;pure&quot; part?  It could be simply
\begin{code}
grading :: String -&gt; String
\end{code}
Then replace the //mapM_// and //printf// with a single //putStr//, and have the logic do the formatting.

The IO part, in TV/Eros style:
\begin{code}
gio :: Output (String -&gt; String)
gio = oLambda (readFile &quot;grades&quot;) putStrLn
\end{code}
Wow -- can I generalize TV beyond ~UIs, to include IO as well?  Yes!  The TV definitions use //UI// mostly through the Arrow interface.  Only the primitives (slider, showDisplay, readFile, writeFile) are specific to a particular arrow.  Therefore, make the arrow a parameter.
\begin{code}
data Input (~&gt;) :: * -&gt; * where
  IPrim :: (() ~&gt; a) -&gt; Input (~&gt;) a
  IPair :: Input (~&gt;) a -&gt; Input (~&gt;) b -&gt; Input (~&gt;) (a,b)

data Output (~&gt;) :: * -&gt; * where
  OPrim   :: (a ~&gt; ()) -&gt; Output (~&gt;) a
  OLambda :: Input (~&gt;)  a -&gt; Output (~&gt;) b -&gt; Output (~&gt;) (a-&gt;b)
  OPair   :: Output (~&gt;) a -&gt; Output (~&gt;) b -&gt; Output (~&gt;) (a,b)

data TV (~&gt;) a = TV (Output (~&gt;) a) a
\end{code}
Rename &quot;TV&quot; to something more general.

There are other possibilities for the type of //grading//.  Think of the string representation as an accomodation to file storage and thus part of IO.  Define the data types and conversion:
\begin{code}
type In  = [(String,Int)]
type Out = [(String,[Float],Float)]

parse :: String -&gt; In
unparse :: Out -&gt; String
\end{code}
Then
\begin{code}
main = tv gio grading

grading :: In -&gt; Out

gio' :: Output (In -&gt; Out)
gio' = oLambda (fmap parse (readFile &quot;grades&quot;))
	       (mapf unparse putStr)
\end{code}
Better yet,
\begin{code}
gio' = mapf wrapG gio

wrapG :: ([Task] -&gt; [Grade]) -&gt; (String -&gt; String)
wrapG = wrapF unparseGrades parseTasks
\end{code}
The //wrapF// combinator is generally useful:
\begin{code}
wrapF :: (c-&gt;d) -&gt; (a-&gt;b) -&gt; ((b-&gt;c) -&gt; (a-&gt;d))
wrapF after before f = after . f . before
\end{code}
The benefit here is that {{{gio'}}} is more conveniently reusable than {{{gio}}}, since it deals with the model data types rather than the string presentations.

This approach generalizes the standard &quot;interact&quot; function:
\begin{code}
interact f = do s &lt;- getContents
		putStr (f s)
\end{code}
Note that [[part 2 of Don Stewart's tutorial blog article| http://cgi.cse.unsw.edu.au/~dons/blog/2006/12/17#programming-haskell-part-2]] mentions interact.  It also gives this spell-check example:
\begin{code}
main = do
    [s] &lt;- getArgs
    f   &lt;- readFile &quot;/usr/share/dict/words&quot;
    g   &lt;- readFile s
    let dict = fromList (lines f)
    mapM_ (spell dict) (words g)

spell d w = when (w `notMember` d) (putStrLn w)
\end{code}
This example has two new twists: getArgs and reading from a static file.  
</pre>
</div>
<div title="separating IO from logic -- example" modifier="Conal Elliott" modified="200702270208" created="200701281721" tags="Haskell TV example article 2007-01-28">
<pre>! Introduction /% -*-Twee-*- (http://www.gimcrackd.com/etc/src/twee.el) %/
The example in this post illustrates an approach to separating logic and IO using the [[TV| http://haskell.org/haskellwiki/TV]] library.  The example is [[from Don Stewart's blog| http://cgi.cse.unsw.edu.au/~dons/blog/2006/12/16#programming-haskell-intro]]. My thanks to Don, as this example inspired me to play with alternatives, which led to generalizing TV from GUIs to a more general notion of &quot;interfaces&quot;. The TV approach clarifies the pure logic part and the IO part and is more conveniently composable than the mixed logic/IO formulation.

! What's this?
This post is a literate Haskell program, as well as a TiddlyWiki passage (tiddler).  To run the program, double-click on the entry, copy the markup into file called &quot;Grading.lhs&quot;, install [[TV| http://haskell.org/haskellwiki/TV]] 0.1 or later (and the libraries on which TV [[depends| http://darcs.haskell.org/packages/TV/TV.cabal]]).  I recommend TV 0.2 or later, which does not require GUI support (moved out to [[GuiTV| http://haskell.org/haskellwiki/GuiTV]]).

In the text below, you can click boxed &quot;&gt;&quot; symbols to show more detail and click boxed &quot;&lt;&quot; symbols to show less detail.  For example, we begin with a module header. +++
\begin{code}
module Grading where

import Data.List (sort)
import Data.Map (Map,empty,keys,insertWith,findWithDefault)
import Text.Printf

import Interface.TV
import Interface.TV.OFun()  -- work around GHC bug.  ticket #1145
\end{code}
=== 

! Original example
Here's the original version that mixes logic and I/O:
\begin{code}
grades = do
    src &lt;- readFile &quot;tasks&quot;
    let pairs  = map (split.words) (lines src)
        grades = foldr insert empty pairs
    mapM_ (draw grades) (sort (keys grades))
  where
    insert (s, g) = insertWith (++) s [g]
    split [name,mark] = (name, read mark)
    draw g s = printf &quot;%s\t%s\tAverage: %f\n&quot; s (show marks) avg
      where
        marks = findWithDefault (error &quot;No such student&quot;) s g
        avg   = sum marks / fromIntegral (length marks) :: Double
\end{code}

! Separating logic and interface
!! A bit of massaging
As a first step, have @draw@ yield a string to be concat'd, rather than performing a side-effect. Then we can easily isolate the pure code and separate out an @IO@ driver. +++
\begin{code}
gradingStr src = concatMap (draw grades) (sort (keys grades))
  where
    pairs  = map (split.words) (lines src)
    grades = foldr insert empty pairs
    
    insert (s, g) = insertWith (++) s [g]
    split [name,mark] = (name, read mark)
    draw g s = printf &quot;%s\t%s\tAverage: %f\n&quot; s (show marks) avg
      where
        marks = findWithDefault (error &quot;No such student&quot;) s g
        avg   = sum marks / fromIntegral (length marks) :: Double
\end{code}
=== 
\begin{code}
type GradingStr = String -&gt; String

gradingStr :: GradingStr

grades_2 = readFile &quot;tasks&quot; &gt;&gt;= return . gradingStr &gt;&gt;= putStr
\end{code}

Let's look at the driver definition (@grades_2@).  It contains three parts: external input (@readFile &quot;tasks&quot;@), logic (@gradingStr@), and external output (@putStr@).  By &quot;external&quot;, I mean external to the world of pure values.

!! Declarative interface specification
This plumbing pattern used for @grades_2@ can be abstracted out and used with any pure function.  That style of abstraction would be very useful, but not universal, because it only applies to functions.

A more general approach is to split @grades_2@ into //two// parts (rather than three). One is the pure value (the @gradingStr@ function in this case) and the other is a way to &quot;output&quot; that value, i.e., an //interface//. One way to output a function is to combine a way to input arguments and a way to output results.
\begin{code}
gradingStrOut = oLambda (fileIn &quot;tasks&quot;) stringOut
\end{code}
The TV functions @fileIn@ and @stringOut@ are trivial wrappers around @readFile@ and @putStr@.

Combining this interface with the pure value, we get a &quot;TV&quot; (tangible value):
\begin{code}
gradingStrT :: TV KIO GradingStr
gradingStrT = tv gradingStrOut gradingStr
\end{code}

We can re-express @grades@ simply as running this TV. +++
{{{
*Grading&gt; grades_3
Alonzo	[70.0,99.0]	Average: 84.5
Bob	[80.0,90.0]	Average: 85.0
Don	[69.0,97.0]	Average: 83.0
Henk	[79.0,89.0]	Average: 84.0
Oleg	[77.0,85.0]	Average: 81.0
Simon	[94.0,45.0]	Average: 69.5
}}}
=== 
\begin{code}
grades_3 = runTV gradingStrT
\end{code}

To see the input file, we can use @gradingStrOut@ (defined above) as an interface to the identity function. +++
{{{
*Grading&gt; runTV (tv gradingStrOut id)
Simon	94
Henk	79
Alonzo	70
Don	69
Bob	80
Oleg	77
Henk	89
Bob	90
Simon	45
Alonzo	99
Oleg	85
Don	97
}}}
This pattern of using an identity function and a file is generally useful, so it has a name, &quot;[[fromFile| http://darcs.haskell.org/packages/TV/doc/html/Interface-TV-IO.html#fromFile]]&quot;.  The command above is equivalent to &quot;@runTV (fromFile &quot;tasks&quot;)@&quot;.  (There is also &quot;[[toFile| http://darcs.haskell.org/packages/TV/doc/html/Interface-TV-IO.html#toFile]]&quot;.)
=== 

! Deeper interfaces
The string representations used in @grading@ are also aspects of &quot;interfacing&quot; (to file representation and human reader).  To factor out these aspects, re-express @gradingStr@ as a composition of parsing, grading, and unparsing: 
\begin{code}
gradingStr_2 = unparseGrades . grading . parseTasks
\end{code}

Since this sort of wrapping (of @grading@) is common, we have a name for it (@wrapF@ in [[Interface.TV.Misc| http://darcs.haskell.org/packages/TV/doc/html/Interface-TV-Misc.html]]).
\begin{code}
gradingStr_3 :: GradingStr
gradingStr_3 = wrapF unparseGrades parseTasks grading
\end{code}

The data types and conversions result from refactoring @gradingStr@. +++
\begin{code}
type Task    = (String,Double)          -- name and task score
type Grade   = (String,[Double],Double) -- name, scores, average
type Grading = [Task] -&gt; [Grade]

parseTasks    :: String -&gt; [Task]
unparseGrades :: [Grade] -&gt; String
grading       :: Grading

parseTasks src = map (split.words) (lines src)
 where
   split [name,mark] = (name, read mark)

unparseGrades = concatMap draw
 where
   draw (s,marks,avg) = printf &quot;%s\t%s\tAverage: %f\n&quot; s (show marks) avg

grading tasks = map (summary grades) (sort (keys grades))
 where
   grades       = foldr insert empty tasks
   insert (s,g) = insertWith (++) s [g]
   summary g s  = (s,marks,avg)
     where
       marks = findWithDefault (error &quot;No such student&quot;) s g
       avg   = sum marks / fromIntegral (length marks) :: Double
\end{code}
=== 

Now we can make a @Grading@ output that parses on the way in and unparses on the way out.
\begin{code}
gradingOut = oLambda (fmap parseTasks (fileIn &quot;tasks&quot;))
                     (cofmap unparseGrades stringOut)
\end{code}

Better, define @gradingOut@ via @gradingStrOut@, dual to the formulation of @gradingStr@ via @grading@:
\begin{code}
gradingOut_2 :: Output KIO Grading
gradingOut_2 = wrapO unparseGrades parseTasks gradingStrOut
\end{code}

Finally, combine the interface and the logic:
\begin{code}
gradingT :: TV KIO Grading
gradingT = tv gradingOut_2 grading
\end{code}

\begin{code}
grades_4 = runTV gradingT
\end{code}

! Composition
Above we've made TVs directly, from interface and value.  We can also compose them from simpler TVs.  Here's a simple decomposition of @grading@ into two phases: coalesce tasks for each student, and compute average grades.
\begin{code}
type Coalesced = Map String [Double]

coalesce  :: [Task]    -&gt; Coalesced
summarize :: Coalesced -&gt; [Grade]

grading_2 :: Grading
grading_2 = summarize . coalesce
\end{code}
The implementation is just a refactoring of @grading@. +++
\begin{code}
coalesce tasks = foldr insert empty tasks
 where
   insert (s,g) = insertWith (++) s [g]

summarize grades = map (summary grades) (sort (keys grades))
 where
   summary g s = (s,marks,avg)
     where
       marks = findWithDefault (error &quot;No such student&quot;) s g
       avg   = sum marks / fromIntegral (length marks) :: Double
\end{code}
=== 

Let's give each of these pieces its own interface.
\begin{code}
coalesceT = tv (oLambda (fmap parseTasks (fileIn &quot;tasks&quot;)) showOut)
	       coalesce

summarizeT = tv (oLambda (readIn empty)
	                 (cofmap unparseGrades defaultOut))
		summarize
\end{code}

We can run these TVs independently.  First @coalesceT@, with input from the tasks file:
{{{
*Grading&gt; runTV coalesceT
fromList [(&quot;Alonzo&quot;,[70.0,99.0]),(&quot;Bob&quot;,[80.0,90.0]),(&quot;Don&quot;,[69.0,97.0]),(&quot;Henk&quot;,[79.0,89.0]),(&quot;Oleg&quot;,[77.0,85.0]),(&quot;Simon&quot;,[94.0,45.0])]
}}}
Running the second phase (pasting in the first phase output as second phase input) gives our summary output. +++
{{{
*Grading&gt; runTV summarizeT
fromList [(&quot;Alonzo&quot;,[70.0,99.0]),(&quot;Bob&quot;,[80.0,90.0]),(&quot;Don&quot;,[69.0,97.0]),(&quot;Henk&quot;,[79.0,89.0]),(&quot;Oleg&quot;,[77.0,85.0]),(&quot;Simon&quot;,[94.0,45.0])]
Alonzo	[70.0,99.0]	Average: 84.5
Bob	[80.0,90.0]	Average: 85.0
Don	[69.0,97.0]	Average: 83.0
Henk	[79.0,89.0]	Average: 84.0
Oleg	[77.0,85.0]	Average: 81.0
Simon	[94.0,45.0]	Average: 69.5
}}}
=== 

We can also compose the two TVs and run the result.
\begin{code}
gradingT_2 = coalesceT -&gt;| summarizeT

grades_5 = runTV gradingT_2
\end{code}
This composition does less work than running each phase separately.  The matching input and output vanish during composition, eliminating conversion of the map to and from a string representation, as well as the writing and reading of those strings.  This same elimination applies to other kinds of interfaces as well, such as GUIs.
</pre>
</div>
<div title="setting up CGIs" modifier="Conal Elliott" modified="200611141128" created="200611130706" tags="2006-11-12 [[how to]]">
<pre>Understanding cgi permissions.  Grabbed the following from {{{/etc/httpd/conf/httpd.conf}}}:
{{{
&lt;Directory &quot;/var/www/cgi-bin&quot;&gt;
    AllowOverride None
    Options None
    Order allow,deny
    Allow from all
&lt;/Directory&gt;
}}}
And from conal.net's httpd.conf:
{{{
    ScriptAlias /cgi-bin/ &quot;/home/conal/domains/conal/htdocs/cgi-bin/&quot;
}}}
The latter seems to be sufficient by itself.  With this approach, however, I don't know how to get just one file executed but not another.  For instance, my .css files are getting executed.

So here's another angle:
{{{
    AddHandler cgi-script .cgi .pl .py

# The darcs directory has executables and other stuff, so use +ExecCGI rather than ScriptAlias
&lt;Directory &quot;/home/conal/domains/conal/htdocs/darcsweb/&quot;&gt;
  Options FollowSymLinks +ExecCGI
  AllowOverride None
&lt;/Directory&gt;
}}}
Notes:
* The essential thing here is the {{{+ExecCGI}}} inside of the {{{Directory}}} tag.
* I wanted to allow Perl and Python modules to have their usual suffixes, so I added the {{{AddHandler}}} line.  I guess the .cgi one is in the main Apache config file.  On second thought, maybe I'd prefer to use .cgi since the name is externally visible.
* I want the convenience of symlinks, hence the {{{FollowSymLinks}}} option.
* Omitting the {{{AllowOverride}}} means that a {{{.htaccess}} file could change privileges, which is probably fine for me.
* Omitting the specified directory in {{{Directory}}} allows //all// directories in the domain to have executable content, which is handy also.

</pre>
</div>
<div title="site map" modifier="Conal Elliott" modified="200801120324" created="200610260347" tags="view SiteMapMacroPlugin" changecount="1">
<pre>See also [[chronology map]].
|&lt;&lt;siteMap 2008&gt;&gt;&lt;&lt;siteMap 2007&gt;&gt;|&lt;&lt;siteMap project&gt;&gt;&lt;&lt;siteMap idea&gt;&gt;&lt;&lt;siteMap essay&gt;&gt; &lt;&lt;siteMap conversation&gt;&gt;&lt;&lt;siteMap [[how to]]&gt;&gt;|&lt;&lt;siteMap systemConfig&gt;&gt;|

</pre>
</div>
<div title="smart quotes" modifier="Conal Elliott" modified="200701272013" created="200612290334" tags="systemConfig 2006-12-31 editing">
<pre>/***
|Author|[[Conal Elliott|http://conal.net]]|
|Creation date|2006-12-31|
!Description
Turn regular quotes into &quot;curly quotes&quot;.  Or backslashify to get \&quot;straight quotes\&quot;.

You'll probably have to increase your browser's text size to see the difference.
!Use
{{{Turn regular quotes into &quot;curly quotes&quot;.  Or backslashify to get \&quot;straight quotes\&quot;.}}}
!Code
***/
//{{{
config.formatters.push(
{
    name: &quot;dumbQuote&quot;,
    match: &quot;\\\\\&quot;&quot;,
    handler: function(w) {
	createTiddlyElement(w.output,&quot;span&quot;).innerHTML = &quot;\&quot;&quot;;
    }
});
config.formatters.push(
{
    name: &quot;smartQuote&quot;,
    match: &quot;\&quot;&quot;,
    // toggle flag and pick left or close quote
    wasLeft: false,  // mutable: whether last quote was an left quote
    nextSymbol: function (w) {
	this.wasLeft = !this.wasLeft;
	return this.wasLeft ? &quot;&amp;ldquo;&quot;:&quot;&amp;rdquo;&quot;;
    },
    // For robustness, reset the state every time we switch tiddlers.
    // Otherwise an odd number of quotes in one tiddler would throw off
    // all of the subsequently rendered ones.
    lastTiddler: null,  // mutable
    checkReset: function (tiddler) {
	if (this.lastTiddler != tiddler) {
	    this.wasLeft = false;
	    this.lastTiddler = tiddler;
	}
    },
    handler: function(w) {
	this.checkReset(w.tiddler);
	createTiddlyElement(w.output,&quot;span&quot;).innerHTML = this.nextSymbol();
    }
});
//}}}
</pre>
</div>
<div title="software releases 2007-01" modifier="Conal Elliott" modified="200701210406" created="200701202104" tags="2007-01-20 article">
<pre>Last week I released three Haskell libraries: [[DeepArrow| http://haskell.org/haskellwiki/DeepArrow]] 0.0, [[Phooey| http://haskell.org/haskellwiki/Phooey]] 0.1, and [[TV| http://haskell.org/haskellwiki/TV]] 0.0.

These libraries came from [[Eros| http://conal.net/papers/Eros]], which aims at creating a right-brain-friendly (concrete, non-linguistic) &quot;programming&quot; process.  I've had a growing intuition over the last fifteen years that media authoring tools can be usefully looked at as environments for functional programming.  I'd been wondering how to map a user's gestures into operations on a functional program.  Lots of noodling led to ideas of composable interfaces and &quot;tangible values&quot; (term thanks to Sean Seefried) and gestural composition in Eros.

Eros is more complicated than I like, so I started splitting it into pieces:
* Phooey is a functional GUI library that has much of Eros's GUI implementation techniques, but much more carefully structured than in the Eros paper.
* ~DeepArrow has the general notion of &quot;deep application&quot;.
* TV has the algebra of ''composable interfaces'', or visualizations of pure values, and it has ''tangible values'', which are separable combinations of interface and value.  It uses Phooey to generate GUIs very simply from interfaces.
Although these libraries came from Eros, I'd like to see other applications as well.

Where am I going with library development?
* Figure out how to support simple GUIs and Eros's //gesturally composable// GUIs, without code/library replication.
* Re-implement Eros on top of simpler pieces.
* Refactor [[Pajama| http://conal.net/Pajama]] into reusable libraries and release. ++++
*  Building and optimizing &quot;expressions&quot;
*  Common sub-expression elimination
*  Generation of Java code
*  Perhaps other back-ends besides Java
*  Pajama, on top of these pieces
  ===</pre>
</div>
<div title="startup" modifier="Conal Elliott" modified="200701010649" created="200701010541" tags="systemConfig_not 2006-12-31">
<pre>/***
|Synopsis|Customized startup code|
|Author|[[Conal Elliott|http://conal.net]]|
|Date|2006-12-31|
|Version|1.0|
|LoadDependencies|[[conditional WikiLink formatter]]|
!Description
Code to run at TiddlyWiki startup.  Some reusable code and initialization.

Uses [[conditional WikiLink formatter]] to make unknown WikiNames show up as regular text.  Well, no it doesn't.  I learned about DisableWikiLinksPlugin.  Besides, it may always suffice to use options in plugins instead of having a startup plugin like this one.
!Code
***/
//{{{
// My personal settings:
// findObject(config.formatters,'name',&quot;wikiLink&quot;).linkIfUnknown = false;
//}}}
</pre>
</div>
<div title="test" modifier="Conal Elliott" modified="200610312135" created="200610312134">
<pre>&lt;&lt;tiddler &quot;conal's home page&quot;&gt;&gt;

See [[conal's home page|&lt;&lt;tiddler &quot;conal's home page&quot;&gt;&gt;]]</pre>
</div>
<div title="the evolution of Nonviolent Communication" modifier="Conal Elliott" modified="200611182254" created="200611182249" tags="2006-10-28 essay">
<pre>Essay ideas:
*  Gather and present info about how it's evolved so far.  Present directions for it to keep evolving.  Gently and clearly challenge the whole idea of &quot;preserving the integrity&quot; of NVC.
* &quot;Life&quot; as a theme:[&gt;img[http://conal.net/Pan/Gallery/xorgonRings/with-center/cwdata/g.jpg]]
** &quot;Nonviolent Communication: A Language of Life&quot;
** &quot;What's alive right now&quot;
** &quot;Let's make life wonderful&quot;
** My power design emerges from the sacred geometry design called &quot;The Seed of Life&quot;
** For a living system, &quot;preserving the integrity&quot; is an oxymoron.  Preservation is for death, as in cryogenics or embalming.  Evolution is in integrity with life.
</pre>
</div>
<div title="tiddlers in your favorite editor" modifier="Conal Elliott" modified="200701110808" created="200701102155" tags="idea editing Emacs TiddlyWiki 2007-01-10">
<pre>I mostly write my tiddlers in my favorite editor (Emacs) and make only small changes in TiddlyWiki.  I get the convenience, famiarity, and power of my editor, but copy &amp; paste is a hassle, and there's plenty of opportunity for inconsistencies to creep in.  Here's what I want instead:

When I edit a tiddler, have the tiddler open not in my browser but in a new editor window, in [[twee| http://gimcrackd.com/etc/src/#Twee]] [[mode| http://gimcrackd.com/etc/src/#%5B%5BDownload%20Twee%20syntax%20modes%5D%5D]], including the title and tags line.

Here's roughly how it might work:
* On edit, write out the tiddler to a file, prefixed with a Twee-style title line (&quot;{{{::YourTiddler [aTag anotherTag]}}}&quot;).  Give the file name a {{{.tw}}} suffix, so that the editor can open it in twee mode.
* Invoke your editor of choice, and wait for it to return.  Use the {{{$EDITOR}}} environment variable (at least on Linux and Windows) to determine the editor.
* Read the (presumably modified) buffer, parse out the first line into title and tags and save the tiddler.
Hmm.  Blocking is probably a bad idea, since it would block the TW //and// probably the browser as well.  Is there a way not to block, so the TW could asynchronously get messages saying that the tiddler had been updated?  Of course, we'd want to implement the scheme in a cross-platform (OS &amp; browser) way.

Here's some info on [[using Emacs as a Server| http://www.gnu.org/software/emacs/manual/html_node/Emacs-Server.html]].  From the emacs end, there's nothing to do but add one or two lines to {{{.emacs}}} and set the {{{EDITOR}}} environment variable to {{{emacsclient}}} or {{{gnuclient}}}.  After editing, save and pass control back to TW using Emacs's {{{C-x #}}}.

----

I sent this note to the TiddlyWiki &amp; twee-code google groups.  Bob McElrath responded, pointing me to some FireFox plugins.  Now I'm using [[It's All Text!| https://addons.mozilla.org/firefox/4125]].  With a bit of Emacs hacking, I have twee-mode started up automatically and in the big font I like.  (Hack: twee-mode whether or not I'm editing a tiddler.)  This plugin works in other text areas, though not a gmail message body (maybe because it's an html area).

As Bob pointed out, the FireFox plugin eliminates the cut&amp;paste parts.  Remaining pieces are creating &amp; reading the title/tag line, and automatically invoking the editor (instead of right click &amp; select).
</pre>
</div>
<div title="tiddlywiki mixins" modifier="Conal Elliott" modified="200611092149" created="200610251653" tags="idea TiddlyWiki 2006-10-25">
<pre>Extend the TW mechanism of &quot;shadow tiddlers&quot; into a more flexible notion of inheritance and overriding.  A TW would explicitly specify its prototype ~TWs, override some inherited tiddlers and add others.  &quot;TW mixins&quot;.  Explore how issues in the design of object-oriented languages may apply, especially
* multiple inheritance
* prototype-based rather than class-based
* possible &quot;before&quot; and &quot;after&quot; methods, as in CLOS
Explore inheritance at the tiddler level as well, and/or [[parametric tiddlers]].</pre>
</div>
<div title="tips on using hscolour" modifier="Conal Elliott" modified="200701142019" created="200701111921" tags="2007-01-11 note Haskell hscolour tools">
<pre>''To be revised''.  See [[cabal-make]].

I've been spending a lot of time working some Haskell libraries to release and  with the support tools [[Cabal| http://haskell.org/cabal]], [[Haddock| http://haskell.org/haddock]], and [[hscolour| http://www.cs.york.ac.uk/fp/darcs/hscolour]].  I've run into some snags and learned some tricks that may be helpful to others.

To use {{{hscolour}}}, I have to have a list of source file names.  My Cabal file already lists the modules, [[so| http://c2.com/cgi/wiki?DontRepeatYourself]] I want to extract the source files from the module.  The following rule does the trick (where I've defined {{{pkg}}} to be my Cabal package name.)
{{{
sources = $(patsubst %,src/%.hs,\
            $(shell egrep '^[ \t]+[A-Z][_0-9A-Za-z.]+.$$' $(pkg).cabal \
                  | sed 's/\./\//g' ))

}}}
A few points of explanation ++++
* The first {{{egrep}}} pattern matches lines that have only a module name, so I make sure that module lists in {{{$(pkg).cabal}}} start on a new line.
* The &quot;{{{$$}}}&quot; is to quote the end-of-line pattern (&quot;{{{$}}}&quot;) from expansion by {{{make}}}.
* The final &quot;.&quot; (character wild-card) is to pick up a possible {{{CR}}} character in DOS-text-style cabal files (like mine).
* The {{{sed}}} call replaces module name dots with file system slashes.
* The {{{patsubst}}} prepends &quot;{{{src/}}}&quot; and appends &quot;{{{.hs}}}&quot;.
  === This definition is complicated enough that I want to see if it really works, so I have a testing rule:
{{{
show-sources:
    @echo $(sources)
}}}

Now I'm ready to invoke {{{hscolour}}}, using a variation of [[Malcolm's incantation| http://www.cs.york.ac.uk/fp/darcs/hscolour]].  (My thanks to [[Don Stewart (dons)| http://cgi.cse.unsw.edu.au/~dons]] the tip about &quot;{{{mkdir -p}}}&quot;.)
{{{
doc=dist/doc/html

hscolour:
    for file in $(sources); do \
      mkdir -p $(docDir)/`dirname $$file`; \
      do HsColour -anchorHTML $$file &gt;$(doc)/`dirname $$file`/`basename $$file`.html; \
    done
}}}

(Malcolm: how about putting this incantation on the hscolour page?)
</pre>
</div>
<div title="to read" modifier="Conal Elliott" modified="200710102232" created="200611270335" tags="project" changecount="1">
<pre>* [[Rewriting Haskell Strings| http://www.cse.unsw.edu.au/~dons/papers/fusion.pdf]]
* [[Monad Transformers Step by Step| http://uebb.cs.tu-berlin.de/~magr/pub/Transformers.pdf]]
* [[Haskell Communities and Activities Report| http://www.haskell.org/communities/11-2006/html/report.html]]
* [[Haskell Weekly News: December 05, 2006| http://sequence.complete.org/hwn/20061205]], especially &quot;Blog noise&quot;
* [[Beautiful concurrency| http://haskell.org/haskellwiki/Talk:SantaClausProblem]]: STM
* Other STM [[papers and video|http://research.microsoft.com/Users/simonpj/papers/stm/index.htm]]
* [[Non-standard analysis, automatic differentiation, Haskell, and other stories| http://vandreev.wordpress.com/2006/12/04/non-standard-analysis-and-automatic-differentiation]]
* [[The Role of Composition in Computer Programming| http://www.dbmcintyre.pwp.blueyonder.co.uk/index_f/menu_f/j_f/apl95.pdf]]: Iverson's //J// language
* [[Data Parallel Haskell: a status report| http://research.microsoft.com/%7Esimonpj/papers/ndp/ndp.pdf]]
* [[Collaborative Diffusion: Programming Antiobjects| http://www.cs.colorado.edu/~ralex/papers/PDF/OOPSLA06antiobjects.pdf]]
* [[Applicative Programming with Effects| http://www.soi.city.ac.uk/~ross/papers/Applicative.html]]
* [[Ontology is Overrated: Categories, Links, and Tags| http://www.shirky.com/writings/ontology_overrated.html]] by Clay Shirky.
* [[Haskell, bondage-and-discipline and separation-of-concerns programming| http://syntaxfree.wordpress.com/2007/01/08/haskell-bondage-and-discipline-and-separation-of-concerns-programming/#more-12]]
* Path of Least Resistance: Learning to Become the Creative Force in Your Own Life, by Robert Fritz
* [[The Genuine Sieve of Eratosthenes| http://www.cs.hmc.edu/~oneill/papers/Sieve-JFP.pdf]]
* [[The Derivative of a Regular Type is its Type of One-Hole Contexts| http://citeseer.ist.psu.edu/cache/papers/cs/24136/http:zSzzSzwww.dur.ac.ukzSz~dcs1ctmzSzdiff.pdf/mcbride01derivative.pdf]]
* [[MysticalProgramming| http://c2.com/cgi/wiki?MysticalProgramming]]
* [[Imagining the Tenth Dimension| http://www.tenthdimension.com/flash2.php]]
* [[An algebra of scans |http://www.informatik.uni-bonn.de/~ralf/publications/MPC2004.pdf]]
* [[The Essence of Dataflow Programming| http://cs.ioc.ee/~tarmo/papers/essence.pdf]] (comonads)
* [[Another essence of dataflow programming| http://geocities.com/bdenckla@sbcglobal.net/LtU/mainEss.pdf]] (applicative functors)
* [[The Mind of the Swarm| http://www.sciencenews.org/articles/20061125/bob10.asp]]
* [[Evaluating cellular automata is comonadic| http://sigfpe.blogspot.com/2006/12/evaluating-cellular-automata-is.html]]
* [[Efficient Interpretation by Transforming Data Types and Patterns to Functions| http://www.cs.nott.ac.uk/~nhn/TFP2006/Papers/03-JansenKoopmanPlasmeijer-EfficientInterpretation.pdf]]
* [[Developing Nonviolent Communication: An Integral Approach| http://groups.yahoo.com/group/nvccertificationcandidates/files/Articles%20and%20Information]]
* Tangible Programming ++++
*  [[Tangible Programming Bricks: An approach to making programming accessible to everyone| http://alumni.media.mit.edu/~mcnerney/tangible-programming.html]]
*  [[From turtles to Tangible Programming Bricks: explorations in physical
language design| http://alumni.media.mit.edu/~mcnerney/personal-ubicomp.pdf]]
*  [[Designing Tangible Programming Languages for Classroom Use| http://www.cs.tufts.edu/~jacob/papers/tei07.horn.pdf]]
*  [[Tangible and Embedded Interaction| http://tei-conf.org]]
  === 
* Software for your Head
* [[Before the Dawn: Recovering the Lost History of Our Ancestors| http://www.amazon.com/Before-Dawn-Recovering-History-Ancestors/dp/1594200793]]
* Nonviolent Communication: The Basics As I Know and Use Them, by [[Wayland Myers| http://www.waylandmyers.com]], Ph.D.  Also, &quot;Nonviolent Communication for Couples&quot; (in progress as of 2007-04).
* Push-based web services ++++
*  [[Towards Expressive Publish/Subscribe Systems| http://www.cs.cornell.edu/johannes/papers/2006/2006-edbt-cayuga.pdf]]
*  [[Engineering Push-Based Web Services| http://citeseer.ist.psu.edu/brenna06engineering.html]]
*  [[WAIF: Web of Asynchronous Information Filters| http://citeseer.ist.psu.edu/johansen03waif.html]]
  === 
* [[Incremental Rewriting| http://citeseer.ist.psu.edu/vandermeulen94incremental.html]]
* [[Delimited continuations in operating systems| http://okmij.org/ftp/papers/context-OS.pdf]]
* [[Packrat Parsing - Simple, Powerful, Lazy, Linear Time| http://pdos.csail.mit.edu/~baford/packrat/icfp02]]
* [[Multi-cultural visualization : how functional programming can enrich visualization (and vice versa)| http://eprints.whiterose.ac.uk/archive/00001895/]]
* [[Encoding Information Flow in Haskell| http://www.cis.upenn.edu/~stevez/papers/LZ06a.pdf]]
* [[A Principled Approach to Version Control| http://www.cs.nott.ac.uk/~wss/Publications/PrincipledVersionControl.pdf]]

Other stuff to pursue:
* http://www.interraproject.org
* http://WizzyMouse.com.  Seaton Gras. 206.442.9038
* leaf.peterson@gmail.com.  Met at Sharon Burks party in Woodinville.  I think he works for Intel Research in the Bay Area and is into functional programming.  He worked on TIL at CMU.
</pre>
</div>
<div title="two-sided printing" modifier="Conal Elliott" modified="200703021809" created="200611011814" tags="[[how to]]">
<pre>I've often gotten confused about how to print two-sided on one-sided printers.  My requirements:
* Works for odd or even number of pages
* Ends up in the output tray exactly as I want, so I don't have to reverse the sheets manually (//O(n)//).  I'm okay with flipping the whole stack (//O(1)//).
Technique:
* Print odd numbered pages first, without reversing the pages
* Take out the stack, reverse and feed back in.
* Print even numbered pages, again without reversing.
* If there's an odd number of pages, remove the last unfed sheed from the input paper feeder and add it to the end.
</pre>
</div>
<div title="using TiddlyWiki to view programs" modifier="Conal Elliott" created="200701102157" tags="2007-01-10 TiddlyWiki Haskell idea">
<pre>I want to use TiddlyWiki to view and maybe edit programs (in Haskell, for starters).  I'm imagining auto-linking of name references to defining tiddlers (using some existing tools to help), and custom fields for type info and maybe other stuff.  I'll want automatic conversion between forms for compilation and for web-viewing.</pre>
</div>
<div title="visit with Patty Z on 2006-10-24" modifier="Conal Elliott" modified="200610260355" created="200610251730" tags="conversation 2006-10-24">
<pre>I visited Patty Z at her home to bring her the proposal and talk about her concerns about my distributing it widely.  We talked for about 90 minutes.  Notes:
* She has a lot of difficulty using the web.  She cannot click on a link in email and get to the page in her browser.  (She thinks that to have email &amp; browser linked would mean her phone line would be tied up constantly.)  She also has some kind of dislexia, so when she tries to type in ~URLs, she often gets them wrong.  Very stressful situation.
* So, she hadn't seen any of the material on my two wikis.  And she's worried that anything she says or writes is showing up publicly without her getting to know what it is.
* She was curious about wikis.  I told her the basics, and she had a lot of questions &amp; concerns, which we discussed.
** Who gets to see and do what?
** People might come along and change my writing.
** How do I know what to believe if anybody might be saying things.
* She was curious about the [[matching system|http://emergence.awakeningcompassion.com/#%5B%5Bmatching%20system%5D%5D]].  I described it in terms of online date-finding services like match.com.  We talked through a lot of specific ideas:
** Search for a practice group, specifying open times and proximity.  Patty liked this idea a lot.
** Search for NVC sharers referred/endorsed by someone you know and trust
** Search for a sharer experienced in mediation, or more specifically mediation in the workplace.
* We talked a lot about questions that boil down to trust.  I got inspired with a principle of &quot;chains of trust&quot;.  There's direct trust, meaning what I know first-hand.  Then indirect trust, when a person or organization whom I trust vouches for someone I don't know (blind date, dentist, NVC sharer).  My thesis is that we can support chains of trust more effectively and flexibly using an online system.  Certification and diplomas are special cases.  We can include such systems while going further and eliminating our dependency on them.
* Patty shared some impressions she'd had, and we got to dispel them:
** In my proposal, she thought people would use computers //instead of// face-to-face learning and connection.
** She thought that I want to put everyone on &quot;equal&quot; status of credibility, with equal expectation of learning NVC from each other, from newbies to Marshall.
** She thought that Holly &amp; I were newbies
* Patty asked me about my NVC background, and I shared my story and enthusiasm with her.
I think she got big shifts in how she sees me and her understanding and interest in the proposal.  We parted feeling much more relaxed and fond of each other.
</pre>
</div>
<div title="wiki haddock" modifier="Conal Elliott" modified="200701100556" created="200701100534" tags="idea 2007-01-09">
<pre>Suppose Haddock's documentation language (&quot;-- | ...&quot;) were an extended form of a common wiki markup language, and specifically Wikimedia's, because the Haskell wiki uses it.  Instead of converting to HTML, Haddock could then pass through most markup unchanged and make wiki links out of its current link markup (modules &amp; entities).  Some benefits:
* We'd all get a much richer (and extensible) markup language.
* We'd have only a single markup language (Wikimedia's) to learn instead of two, and no need to convert between them manually.
* Automatically generated links to user-comment pages would be wiki links, so one could tell by looking at them whether there are any comments already there.
</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->

<!--POST-BODY-END-->
<script type="text/javascript">
//<![CDATA[
//
// Please note:
// 
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project Subversion repository at http://svn.tiddlywiki.org/Trunk/core/
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
// 

//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5 // Depth of cascade animation
};

// Adaptors
config.adaptors = {};

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayStartupTime: false,
	txtBackupFolder: "",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8"
	};
config.optionsDesc = {};

// List of notification functions to be called when certain tiddlers are changed or deleted
config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that shouldn't really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","sync","importTask","tweak","plugins"];

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	sparkline: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {},
	edit: {},
	tagChooser: {},
	toolbar: {},
	br: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: config.userAgent.indexOf("gecko") != -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(config.browser.isBadSafari) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.urlPattern = "[a-z]{3,8}:[^\\s:'\"][^\\s'\"]*(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true;}
	],
	currBrowser: null,
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "<!--{{{-->\n<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/>\n<!--}}}-->",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	ImportTiddlers: '<<importTiddlers>>'
};

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki", action: saveChanges},
	sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#DownloadSoftware for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<\%0>>",
	macroErrorDetails: "Error while executing macro <<\%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
	});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
	sizeTemplates:
		[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
		]});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'}
			]}
	});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]}
	});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Reveal further commands"
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	openError: "There were problems fetching the tiddlywiki file",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			]}
	});

merge(config.macros.sync,{
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Server Type', field: 'serverType', title: "Server type", type: 'String'},
			{name: 'Server Host', field: 'serverHost', title: "Server host", type: 'String'},
			{name: 'Server Workspace', field: 'serverWorkspace', title: "Server workspace", type: 'String'},
			{name: 'Status', field: 'status', title: "Synchronisation status", type: 'String'},
			{name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
			],
		rowClasses: [
			],
		buttons: [
			{caption: "Sync these tiddlers", name: 'sync'}
			]},
	wizardTitle: "Synchronize with external servers and files",
	step1Title: "Choose the tiddlers you want to synchronize",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	syncLabel: "sync",
	syncPrompt: "Sync these tiddlers",
	hasChanged: "Changed while unplugged",
	hasNotChanged: "Unchanged while unplugged",
	syncStatusList: {
		none: {text: "...", color: "none"},
		changedServer: {text: "Changed on server", color: '#80ff80'},
		changedLocally: {text: "Changed while unplugged", color: '#80ff80'},
		changedBoth: {text: "Changed while unplugged and on server", color: '#ff8080'},
		notFound: {text: "Not found on server", color: '#ffff80'},
		putToServer: {text: "Saved update on server", color: '#ff80ff'},
		gotFromServer: {text: "Retrieved update from server", color: '#80ffff'}
		}
	});

merge(config.macros.annotations,{
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.commands.syncing,{
	text: "syncing",
	tooltip: "Control synchronisation of this tiddler with a server or external file",
	currentlySyncing: "<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</"+"div><div>host: <span class='popupHighlight'>%1</span></"+"div><div>workspace: <span class='popupHighlight'>%2</span></"+"div>", // Note escaping of closing <div> tag
	notCurrentlySyncing: "Not currently syncing",
	captionUnSync: "Stop synchronising this tiddler",
	chooseServer: "Synchronise this tiddler with another server:",
	currServerMarker: "\u25cf ",
	notCurrServerMarker: "  "});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
			],
		rowClasses: [
			],
		buttons: [
			]}});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "GettingStarted",
	MainMenu: "GettingStarted",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "https://web.archive.org/web/20130827021950/http://www.tiddlywiki.com/",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options »" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately before the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColours: "This shadow tiddler contains CSS definitions related to the color of page elements",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
	});

//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
config.parsers = {}; // Hashmap of alternative parsers for the wikifier
var anim = new Animator(); // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = config.browser.isSafari || config.browser.isOpera;

// Starting up
function main()
{
	var t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	store.loadFromDiv("storeArea","store",true);
	t2 = new Date();
	loadShadowTiddlers();
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins();
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	t6 = new Date();
	store.notifyAll();
	t7 = new Date();
	restart();
	t8 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	for(var m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	if(!readOnly)
		backstage.init();
	t9 = new Date();
	if(config.options.chkDisplayStartupTime) {
		displayMessage("Load in " + (t2-t1) + " ms");
		displayMessage("Loadshadows in " + (t3-t2) + " ms");
		displayMessage("Loadplugins in " + (t5-t4) + " ms");
		displayMessage("Notify in " + (t7-t6) + " ms");
		displayMessage("Restart in " + (t8-t7) + " ms");
		displayMessage("Total startup in " + (t9-t0) + " ms");
	}
	startingUp = false;
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		var defaultParams = store.getTiddlerText("DefaultTiddlers").parseParams("open",null,false);
		invokeParamifier(defaultParams,"onstart");
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
	delete shadows;
}

function loadPlugins()
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers("systemConfig");
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	for(var i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name;
		if(n)
			map[n] = p;
		n = p.Source;
		if(n)
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			for(var i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++)
		visit(installedPlugins[i]);
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce"))
		return verifyTail(plugin,true,config.messages.pluginForced);
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0]) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1]) - version.minor;
		if(w == 0 && coreVersion[2])
		 	w = parseInt(coreVersion[2]) - version.revision;
		if(w > 0)
			return verifyTail(plugin,false,config.messages.pluginVersionError);
		}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable"))
		return verifyTail(plugin,false,config.messages.pluginDisabled);
	return true;
}

function verifyTail(plugin,result,message)
{
	plugin.log.push(message);
	return result;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler)
			m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);
		else
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURI(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var t=1; t<params.length; t++) {
		var p = config.paramifiers[params[t].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[t].value);
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		var tagged = store.getTaggedTiddlers(v,"title");
		for(var t=0; t<tagged.length; t++)
			story.displayTiddler("bottom",tagged[t].title,null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly) {
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if (s=="bgcolor")
				s = "backgroundColor";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if (link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1){
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},

	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					this.rowHandler(w,createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow"),prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if (!baseType)
			   baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if (listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^\\{\\{\\{\\n",
	lookaheadRegExp: /^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForCSS",
	match: "^/\\*\\{\\{\\{\\*/\\n",
	lookaheadRegExp: /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\/\*\}\}\}\*\/$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForPlugin",
	match: "^//\\{\\{\\{\\n",
	lookaheadRegExp: /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\/\/\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForTemplate",
	match: "^<!--\\{\\{\\{-->\\n",
	lookaheadRegExp: /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^<!--\}\}\}-->$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "wikifyCommentForPlugin",
	match: "^/\\*\\*\\*\\n",
	termRegExp: /(^\*\*\*\/\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "wikifyCommentForTemplate",
	match: "^<!---\\n",
	termRegExp: /(^--->\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "unWikiLink",
	match: config.textPrimitives.unWikiLink+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		w.outputText(w.output,w.matchStart+1,w.nextMatch);
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords == true || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				addClass(e,"imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3])
				img.title = lookaheadMatch[3];
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "boldByChar",
	match: "''",
	termRegExp: /('')/mg,
	element: "strong",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "italicByChar",
	match: "//",
	termRegExp: /(\/\/)/mg,
	element: "em",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "underlineByChar",
	match: "__",
	termRegExp: /(__)/mg,
	element: "u",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "strikeByChar",
	match: "--(?!\\s|$)",
	termRegExp: /((?!\s)--|(?=\n\n))/mg,
	element: "strike",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "superscriptByChar",
	match: "\\^\\^",
	termRegExp: /(\^\^)/mg,
	element: "sup",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "subscriptByChar",
	match: "~~",
	termRegExp: /(~~)/mg,
	element: "sub",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "monospacedByChar",
	match: "\\{\\{\\{",
	lookaheadRegExp: /\{\{\{((?:.|\n)*?)\}\}\}/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "styleByChar",
	match: "@@",
	termRegExp: /(@@)/mg,
	handler: function(w)
	{
		var e = createTiddlyElement(w.output,"span");
		var styles = config.formatterHelpers.inlineCssHelper(w);
		if(styles.length == 0)
			e.className = "marked";
		else
			config.formatterHelpers.applyCssHelper(e,styles);
		w.subWikifyTerm(e,this.termRegExp);
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\\\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
},

{
	name: "customClasses",
	match: "\\{\\{",
	termRegExp: /(\}\}\})/mg,
	lookaheadRegExp: /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch) {
			var e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			w.subWikifyTerm(e,this.termRegExp);
		}
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source && source != "") {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		wikifier.subWikifyUnterm(output);
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikifyUnterm(e);
		html = e.innerHTML;
		removeNode(e);
	}
	return html;
}

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source && source != "") {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	this.subWikify(e);
	var text = getPlainText(e);
	removeNode(e);
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	if(terminator)
		this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
	else
		this.subWikifyUnterm(output);
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	// Get the first matches for the formatter and terminator RegExps
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

//--
//-- Macro definitions
//--

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text;
	if(params[0])
		text = now.formatString(params[0].trim());
	else
		text = now.toLocaleString();
	createTiddlyElement(place,"span",null,null,text);
};

config.macros.version.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,version.major + "." + version.minor + "." + version.revision + (version.beta ? " (beta " + version.beta + ")" : ""));
};

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] ? params[0] : "all";
	var list = document.createElement("ul");
	place.appendChild(list);
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for(var t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		createTiddlyLink(li,typeof results[t] == "string" ? results[t] : results[t].title,true);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li =createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
	}
};

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] ? params[0] : "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	var dateFormat = params[2] ? params[2] : this.dateFormat;
	for(var t=tiddlers.length-1; t>=last; t--) {
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay) {
			var theDateList = document.createElement("ul");
			place.appendChild(theDateList);
			createTiddlyElement(theDateList,"li",null,"listTitle",tiddler[field].formatString(dateFormat));
			lastDay = theDay;
		}
		var theDateListItem = createTiddlyElement(theDateList,"li",null,"listLink");
		theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));
	}
};

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick);
	var txt = createTiddlyElement(place,"input",null,"txtOptionInput");
	if(params[0])
		txt.value = params[0];
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var e = ev ? ev : window.event;
	switch(e.keyCode) {
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			config.macros.search.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(this.value.length > 2) {
		if(this.value != this.getAttribute("lastSearchText")) {
			if(config.macros.search.timeout)
				clearTimeout(config.macros.search.timeout);
			var txt = this;
			config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);
		}
	} else {
		if(config.macros.search.timeout)
			clearTimeout(config.macros.search.timeout);
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("name",null,true,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] ? names[1] : null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className);
	if(!args) {
		wrapper.setAttribute("refresh","content");
		wrapper.setAttribute("tiddler",tiddlerName);
	}
	var text = store.getTiddlerText(tiddlerName);
	if(text) {
		var stack = config.macros.tiddler.tiddlerStack;
		if(stack.indexOf(tiddlerName) !== -1)
			return;
		stack.push(tiddlerName);
		try {
			var n = args ? Math.min(args.length,9) : 0;
			for(var i=0; i<n; i++) {
				var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
				text = text.replace(placeholderRE,args[i]);
			}
			config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
		} finally {
			stack.pop();
		}
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName,params)
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0]);
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([tiddler.title]));
	for(var t=0; t<tiddler.tags.length; t++) {
		createTagButton(createTiddlyElement(theList,"li"),tiddler.tags[t],tiddler.title);
		if(t<tiddler.tags.length-1)
			createTiddlyText(theList,sep);
	}
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	theList.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([title,tagged.length]));
	for(var t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(theList,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(theList,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place)
{
	if(!readOnly)
		createTiddlyButton(place,this.label,this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var e = ev ? ev : window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var c = cookie ? cookie : "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute("type",typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute("option",opt);
	if(className)
		c.className = className;
	else
		c.className = typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute("title",config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != "no")
		createTiddlyText(place,config.optionsDesc[opt] ? config.optionsDesc[opt] : opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute("option");
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if (handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType);
		}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: "input",
		valueField: "value",
		eventName: "onkeyup",
		className: "txtOptionInput",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: "input",
		valueField: "checked",
		eventName: "onclick",
		className: "chkOptionInput",
		typeValue: "checkbox",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType)
{
	config.options[opt] = value;
	saveOptionCookie(opt);
	var nodes = document.getElementsByTagName(elementType);
	for(var t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute("option");
		if(opt == optNode)
			nodes[t][valueField] = value;
		}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var opt = (params[1] && params[1].name == "anon") ? params[1].value : getParam(params,"name",null);
	var className = (params[2] && params[2].name == "anon") ? params[2].value : getParam(params,"class",null);
	var desc = getParam(params,"desc","no");
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if (h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var showUnknown = getParam(params,"showUnknown","no");
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var chkUnknown = wizard.getElement("chkUnknown");
	chkUnknown.checked = showUnknown == "yes";
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue("listWrapper",listWrapper);
	this.refreshOptions(listWrapper,showUnknown == "yes");
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
	var opts = [];
	for(var n in config.options) {
		var opt = {};
		opt.option = "";
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if (h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,"no");
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue("listWrapper");
	removeChildren(listWrapper);
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	for(var t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined)
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		var now = new Date();
		title = now.formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	story.displayTiddler(null,title,template,false,null,null);
	var tiddlerElem = document.getElementById(story.idPrefix + title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string")
		story.getTiddlerField(title,"text").value = text.format([title]);
	for(var t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : "";
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

config.macros.sparkline.handler = function(place,macroName,params)
{
	var data = [];
	var min = 0;
	var max = 0;
	var v;
	for(var t=0; t<params.length; t++) {
		v = parseInt(params[t]);
		if(v < min)
			min = v;
		if(v > max)
			max = v;
		data.push(v);
	}
	if(data.length < 1)
		return;
	var box = createTiddlyElement(place,"span",null,"sparkline",String.fromCharCode(160));
	box.title = data.join(",");
	var w = box.offsetWidth;
	var h = box.offsetHeight;
	box.style.paddingRight = (data.length * 2 - w) + "px";
	box.style.position = "relative";
	for(var d=0; d<data.length; d++) {
		var tick = document.createElement("img");
		tick.border = 0;
		tick.className = "sparktick";
		tick.style.position = "absolute";
		tick.src = "data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B";
		tick.style.left = d*2 + "px";
		tick.style.width = "2px";
		v = Math.floor(((data[d] - min)/(max-min)) * h);
		tick.style.top = (h-v) + "px";
		tick.style.height = v + "px";
		box.appendChild(tick);
	}
};

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			removeNode(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
		}
	}
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier)
{
	var terminator = ">>";
	var panel;
	if(wikifier)
		panel = createTiddlyElement(place,"div",null,"gradient");
	else
		panel = place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	var t;
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	var colours = [];
	for(t=1; t<params.length; t++) {
		var c = new RGB(params[t]);
		if(c)
			colours.push(c);
	}
	drawGradient(panel,params[0] != "vert",colours);
	if(wikifier)
		wikifier.subWikify(panel,terminator);
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var m = config;
		var p = params[0].split(".");
		for(var t=0; t<p.length; t++) {
			if(p[t] in m)
				m = m[p[t]];
			else
				break;
		}
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value != undefined) {
			switch(params[1]) {
				case undefined:
					highlightify(value,place,highlightHack,tiddler);
					break;
				case "link":
					createTiddlyLink(place,value,true);
					break;
				case "wikified":
					wikify(value,place,highlightHack,tiddler);
					break;
				case "date":
					value = Date.convertFromYYYYMMDDHHMM(value);
					createTiddlyText(place,value.formatString(params[2] ? params[2] : config.views.wikified.dateFormat));
					break;
			}
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1];
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if(field != "text" && !rows) {
			e = createTiddlyElement(null,"input");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			e.setAttribute("edit",field);
			e.setAttribute("type","text");
			v = store.getValue(tiddler,field);
			if(!v)
				v = "";
			e.value = v;
			e.setAttribute("size","40");
			e.setAttribute("autocomplete","off");
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			e = createTiddlyElement(wrapper2,"textarea");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			v = store.getValue(tiddler,field);
			if(!v)
				v = "";
			e.value = v;
			rows = rows ? rows : 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
	}
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev ? ev : window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags();
	if(tags.length == 0)
		createTiddlyText(createTiddlyElement(popup,"li"),lingo.popupNone);
	for(var t=0; t<tags.length; t++) {
		var theTag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		theTag.setAttribute("tag",tags[t][0]);
		theTag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev ? ev : window.event;
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var title = tiddler.title;
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",title);
	}
};

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,theClass)
{
	if(typeof commandName != "string") {
		var c = null;
		for(var t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd;
			switch(command.type) {
				case "popup":
					cmd = this.onClickPopup;
					break;
				case "command":
				default:
					cmd = this.onClickCommand;
					break;
			}
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			if(theClass)
				addClass(btn,theClass);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyText ? command.readOnlyText : command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyTooltip ? command.readOnlyTooltip : command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev ? ev : window.event;
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev ? ev : window.event;
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	var tiddler = store.fetchTiddler(title);
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,theClass,event)
{
	var children = place.getElementsByTagName("a");
	for(var t=0; t<children.length; t++) {
		var c = children[t];
		if(hasClass(c,theClass) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	removeNode(this);
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++) {
		var c = params[t];
		switch(c) {
			case '>':
				var btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
				addClass(btn,"moreCommand");
				var e = createTiddlyElement(place,"span",null,"moreCommand");
				e.style.display = "none";
				place = e;
				break;
			default:
				var theClass = "";
				switch(c.substr(0,1)) {
					case "+":
						theClass = "defaultCommand";
						c = c.substr(1);
						break;
					case "-":
						theClass = "cancelCommand";
						c = c.substr(1);
						break;
				}
				if(c in config.commands)
					this.createCommand(place,c,tiddler,theClass);
				break;
		}
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = document.getElementById(story.idPrefix + title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	story.focusTiddler(title,"text");
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if (config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if (deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	for(var r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.syncing.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var serverType = tiddler.getServerType();
	var serverHost = tiddler.fields['server.host'];
	var serverWorkspace = tiddler.fields['server.workspace'];
	if(!serverWorkspace)
		serverWorkspace = "";
	if(serverType) {
		var e = createTiddlyElement(popup,"li",null,"popupMessage");
		e.innerHTML = config.commands.syncing.currentlySyncing.format([serverType,serverHost,serverWorkspace]);
	} else {
		createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.notCurrentlySyncing);
	}
	if(serverType) {
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var btn = createTiddlyButton(createTiddlyElement(popup,"li"),this.captionUnSync,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type","");
	}
	createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
	createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.chooseServer);
	var feeds = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<feeds.length; t++) {
		var f = feeds[t];
		var feedServerType = store.getTiddlerSlice(f.title,"Type");
		if(!feedServerType)
			feedServerType = "file";
		var feedServerHost = store.getTiddlerSlice(f.title,"URL");
		if(!feedServerHost)
			feedServerHost = "";
		var feedServerWorkspace = store.getTiddlerSlice(f.title,"Workspace");
		if(!feedServerWorkspace)
			feedServerWorkspace = "";
		var caption = f.title;
		if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {
			caption = config.commands.syncing.currServerMarker + caption;
		} else {
			caption = config.commands.syncing.notCurrServerMarker + caption;
		}
		btn = createTiddlyButton(createTiddlyElement(popup,"li"),caption,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type",feedServerType);
		btn.setAttribute("server.host",feedServerHost);
		btn.setAttribute("server.workspace",feedServerWorkspace);
	}
};

config.commands.syncing.onChooseServer = function(e)
{
	var tiddler = this.getAttribute("tiddler");
	var serverType = this.getAttribute("server.type");
	if(serverType) {
		store.addTiddlerFields(tiddler,{
			'server.type': serverType,
			'server.host': this.getAttribute("server.host"),
			'server.workspace': this.getAttribute("server.workspace")
			});
	} else {
		store.setValue(tiddler,'server',null);
	}
	return false;
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var fields = {};
	store.forEachField(tiddler,function(tiddler,fieldName,value) {fields[fieldName] = value;},true);
	var items = [];
	for(var t in fields) {
		items.push({field: t,value: fields[t]});
	}
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = null;
	this.modifier = null;
	this.modified = new Date();
	this.created = new Date();
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	for(i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changeCount = this.fields['changecount'];
	if(changeCount === undefined)
		changeCount = 0;
	return changeCount > 0;
};

// Format the text for storage in an RSS item
Tiddler.prototype.saveToRss = function(url)
{
	var s = [];
	s.push("<item>");
	s.push("<title" + ">" + this.title.htmlEncode() + "</title" + ">");
	s.push("<description>" + wikifyStatic(this.text,null,this).htmlEncode() + "</description>");
	for(var t=0; t<this.tags.length; t++)
		s.push("<category>" + this.tags[t] + "</category>");
	s.push("<link>" + url + "#" + encodeURIComponent(String.encodeTiddlyLink(this.title)) + "</link>");
	s.push("<pubDate>" + this.modified.toGMTString() + "</pubDate>");
	s.push("</item>");
	return s.join("\n");
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields)
{
	this.assign(title,text,modifier,modified,tags,created,fields);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(this.text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(this.text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(this.text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var theModifier = this.modifier;
	if(!theModifier)
		theModifier = config.messages.subtitleUnknown;
	var theModified = this.modified;
	if(theModified)
		theModified = theModified.toLocaleString();
	else
		theModified = config.messages.subtitleUnknown;
	return config.messages.tiddlerLinkTooltip.format([this.title,theModifier,theModified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields && this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	if(serverType)
		return new config.adaptors[serverType];
	else
		return null;
};

//--
//-- TiddlyWiki() object contains Tiddler()s
//--

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		return tiddlers[title];
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for(var i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return typeof config.shadowTiddlers[title] == "string";
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		return tiddler.text;
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	if(this.isShadowTiddler(title))
		return config.shadowTiddlers[title];
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.slicesRE = /(?:[\'\/]*~?([\.\w]+)[\'\/]*\:[\'\/]*\s*(.*?)\s*$)|(?:\|[\'\/]*~?([\.\w]+)\:?[\'\/]*\|\s*(.*?)\s*\|)/gm;

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	do {
		var m = this.slicesRE.exec(text);
		if(m) {
			if(m[1])
				slices[m[1]] = m[2];
			else
				slices[m[3]] = m[4];
		}
	} while(m);
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var r = {};
	for(var t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"[[" + match[1] + "]]",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		this.incChangeCount(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	this.incChangeCount(title);
	this.notify(title,true);
	this.setDirty(true);
};

TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		created = created ? created : tiddler.created; // Preserve created date
		this.deleteTiddler(title);
	} else {
		created = created ? created : modified;
		tiddler = new Tiddler();
	}
	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields);
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler();
		tiddler.title = title;
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		for(var i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return store.getSaver().externalize(store);
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag)
{
	var candidates = this.reverseLookup("tags",excludeTag,false);
	var results = [];
	for(var t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			var n = true;
			for(var c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					n = false;
					results[c][1]++;
				}
			}
			if(n && excludeTag) {
				var t = store.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					n = false;
			}
			if(n)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++) {
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		for(var n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers) {
		if(typeof config.shadowTiddlers[t] == "string")
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == 'string') ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by '.'
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp('^'+fieldName+'\\.');
				var dirty = false;
				for(var n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	fieldName = fieldName.toLowerCase();
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		return accessor.get(t);
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	var n,result;
	for(n in t.fields) {
		result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(n in TiddlyWiki.standardFieldAccess) {
		if(n == "tiddler")
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			continue;
		result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
		if(result)
			return result;
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(container,idPrefix)
{
	this.container = container;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
}

Story.prototype.forEachTiddler = function(fn)
{
	var place = document.getElementById(this.container);
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
	}
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,title,template,animate,unused,customFields,toggle)
{
	var place = document.getElementById(this.container);
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem) {
		if(toggle)
			this.closeTiddler(title,true);
		else
			this.refreshTiddler(title,template,false,customFields);
	} else {
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = document.getElementById(this.container);
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
			case "top":
				before = place.firstChild;
				break;
			case "bottom":
				before = null;
				break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.idPrefix + title,"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields,tiddlerElem);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,tiddlerElem)
{
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ?  fields.decodeHashMap() : (fields ? fields : {});
	var serverType = tiddler.getServerType();
	var host = tiddler.fields['server.host'];
	var workspace = tiddler.fields['server.workspace'];
	if(!serverType | !host)
		return null;
	var sm = new SyncMachine(serverType,{
			start: function() {
				return this.openHost(host,"openWorkspace");
			},
			openWorkspace: function() {
				return this.openWorkspace(workspace,"getTiddler");
			},
			getTiddler: function() {
				return this.getTiddler(title,"gotTiddler");
			},
			gotTiddler: function(tiddler) {
				if(tiddler && tiddler.text) {
					var downloaded = new Date();
					if(!tiddler.created)
						tiddler.created = downloaded;
					if(!tiddler.modified)
						tiddler.modified = tiddler.created;
					store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
					autoSaveChanges();
				}
				delete this;
				return true;
			},
			error: function(message) {
				displayMessage("Error loading missing tiddler from %0: %1".format([host,message]));
			}
		});
	sm.go();
	return config.messages.loadingMissingTiddler.format([title,serverType,host,workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(tiddler) {
				var f = tiddler.fields;
				if(customFields)
					f = merge(customFields.decodeHashMap(),f);
				customFields = String.encodeHashMap(f);
			} else {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,[],version.date);
				} else {
					var text = template=="EditTemplate" ?
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText ? defaultText : text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			var me = this;
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			var html = this.getTemplateForTiddler(title,template,tiddler);
			tiddlerElem.innerHTML = html;
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(tiddlerElem,"isTag");
			else
				removeClass(tiddlerElem,"isTag");
			if(!store.tiddlerExists(title)) {
				if(store.isShadowTiddler(title))
					addClass(tiddlerElem,"shadow");
				else
					addClass(tiddlerElem,"missing");
			} else {
				removeClass(tiddlerElem,"shadow");
				removeClass(tiddlerElem,"missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
			forceReflow();
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = document.createElement("div");
	w.style.display = "none";
	place.appendChild(w);
	for(var t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function()
{
	var place = document.getElementById(this.container);
	var e = place.firstChild;
	if(!e)
		return;
	this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
	while((e = e.nextSibling) != null)
		this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	if(window.addClass instanceof Function)
		addClass(this,"selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	if(window.removeClass instanceof Function)
		removeClass(this,"selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev ? ev : window.event;
	var theTarget = resolveTarget(e);
	if(theTarget && theTarget.nodeName.toLowerCase() != "input" && theTarget.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	} else {
		return false;
	}
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev ? ev : window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
		case 9: // Tab
			if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
				replaceSelection(target,String.fromCharCode(9));
				consume = true;
			}
			if(config.isOpera) {
				target.onblur = function() {
					this.focus();
					this.onblur = null;
				};
			}
			break;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
		case 77: // Ctrl-Enter is "M" on some platforms
			if(e.ctrlKey) {
				blurElement(this);
				config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
				consume = true;
			}
			break;
		case 27: // Escape
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
			consume = true;
			break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	var e = null;
	if(tiddlerElem != null) {
		var children = tiddlerElem.getElementsByTagName("*");
		for(var t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = story.getTiddlerField(title,field);

	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	Story.prototype.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			removeNode(tiddlerElem);
			forceReflow();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = document.getElementById(this.container);
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ?	 text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	var titles = [];
	for(var t=0;t<matches.length;t++)
		titles.push(matches[t].title);
	this.displayTiddlers(null,titles);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([titles.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler"))
		e = e.parentNode;
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = document.getElementById(this.idPrefix + title);
	if(e != null) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		var tiddler = store.fetchTiddler(title);
		if(!tiddler)
			return false;
		for(var n in fields) {
			if(store.getValue(title,n) != fields[n])
				return true;
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title ? fields.title : title;
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.idPrefix + newTitle;
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		var extendedFields = store.tiddlerExists(newTitle) ? store.fetchTiddler(newTitle).fields : (newTitle!=title && store.tiddlerExists(title) ? store.fetchTiddler(title).fields : {});
		for(var n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
		}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

//--
//-- Backstage
//--

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = document.getElementById("backstageToolbar");
		this.button = document.getElementById("backstageButton");
		this.button.style.display = "block";
		var t = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
						function (e) {backstage.show(); return false;},null,"backstageShow");
		t = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
						function (e) {backstage.hide(); return false;},null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) {
			backstage.switchTab(null);
		};
		createTiddlyText(this.toolbar,cmb.prompt);
		for(t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			btn.setAttribute("task",taskName);
			addClass(btn,task.action ? "backstageAction" : "backstageTask");
			}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function () {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [
				{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}
			];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		this.showButton.style.display = "none";
		this.hideButton.style.display = "block";
		config.options.chkBackstage = true;
		saveOptionCookie("chkBackstage");
		addClass(this.content,"backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [
					{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}
				];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOptionCookie("chkBackstage");
			removeClass(this.content,"backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		displayMessage(task);
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e)
			{
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
			}
		if(tabName == backstage.currTabName)
			return;
		if(backstage.currTabElem) {
			removeClass(this.currTabElem,"backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			addClass(tabElem,"backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findWindowHeight() + "px";
		backstage.cloak.style.display = "block";
		removeChildren(backstage.panelBody);
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [
				{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}
			];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		backstage.currTabName = null;
		backstage.currTabElem = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) {backstage.cloak.style.display = "none";};
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		 } else {
			backstage.panel.style.display = "none";
			backstage.cloak.style.display = "none";
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	var place = wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	wizard.addStep(this.step1Title,this.step1Html);
	var s = wizard.getElement("selTypes");
	for(var t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = config.macros.importTiddlers.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = config.macros.importTiddlers.onBrowseChange;
	fileInput.onkeyup = config.macros.importTiddlers.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: config.macros.importTiddlers.onOpen}]);
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var tagged = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		this.selectedIndex = 0;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = "file://" + this.value;
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return false;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value;
	var adaptor = new config.adaptors[serverType];
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	var context = {};
	var ret = adaptor.openHost(url,context,wizard,config.macros.importTiddlers.onOpenHost);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	var ret = adaptor.getWorkspaceList(context,wizard,config.macros.importTiddlers.onGetWorkspaceList);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.addStep(config.macros.importTiddlers.step2Title,config.macros.importTiddlers.step2Html);
	var s = wizard.getElement("selWorkspace");
	s.onchange = config.macros.importTiddlers.onWorkspaceChange;
	for(var t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var list = workspaceList.parseParams("workspace",null,false,true);
		for(var n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	var workspace = wizard.getValue("feedWorkspace");
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: config.macros.importTiddlers.openLabel, tooltip: config.macros.importTiddlers.openPrompt, onClick: config.macros.importTiddlers.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value  = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = {};
	var ret = adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	var ret = adaptor.getTiddlerList(context,wizard,config.macros.importTiddlers.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetTiddlerList: " + context.statusText);
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		for(var n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(config.macros.importTiddlers.step3Title,config.macros.importTiddlers.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,config.macros.importTiddlers.listViewTemplate);
	wizard.setValue("listView",listView);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = config.macros.importTiddlers.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel},
			{caption: config.macros.importTiddlers.importLabel, tooltip: config.macros.importTiddlers.importPrompt, onClick:  config.macros.importTiddlers.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = config.macros.importTiddlers.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,config.macros.importTiddlers.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		config.macros.importTiddlers.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = new Array();
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(config.macros.importTiddlers.step4Title.format([rowNames.length]),config.macros.importTiddlers.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}
		],config.macros.importTiddlers.statusDoingImport);
	for(t=0; t<rowNames.length; t++) {
		var context = {};
		context.allowSynchronous = true;
		var inbound = adaptor.getTiddler(rowNames[t],context,wizard,config.macros.importTiddlers.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous)
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: config.macros.importTiddlers.doneLabel, tooltip: config.macros.importTiddlers.donePrompt, onClick: config.macros.importTiddlers.onCancel}
			],config.macros.importTiddlers.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Sync macro
//--

// Synchronisation handlers
config.syncers = {};

// Sync state.
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!wikifier.isStatic)
		this.startSync(place);
};

config.macros.sync.startSync = function(place)
{
	if(currSync)
		config.macros.sync.cancelSync();
	currSync = {};
	currSync.syncList = this.getSyncableTiddlers();
	this.createSyncTasks();
	this.preProcessSyncableTiddlers();
	var wizard = new Wizard();
	currSync.wizard = wizard;
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);
	this.processSyncableTiddlers();
	wizard.setButtons([
			{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}
		]);
};

config.macros.sync.getSyncableTiddlers = function ()
{
	var list = [];
	store.forEachTiddler(function(title,tiddler) {
		var syncItem = {};
		syncItem.serverType = tiddler.getServerType();
		syncItem.serverHost = tiddler.fields['server.host'];
		syncItem.serverWorkspace = tiddler.fields['server.workspace'];
		syncItem.tiddler = tiddler;
		syncItem.title = tiddler.title;
		syncItem.isTouched = tiddler.isTouched();
		syncItem.selected = syncItem.isTouched;
		syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? "changedLocally" : "none"];
		syncItem.status = syncItem.syncStatus.text;
		if(syncItem.serverType && syncItem.serverHost)
			list.push(syncItem);
		});
	list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	return list;
};

config.macros.sync.preProcessSyncableTiddlers = function()
{
	for(var t=0; t<currSync.syncList.length; t++) {
		si = currSync.syncList[t];
		var ti = si.syncTask.syncMachine.generateTiddlerInfo(si.tiddler);
		si.serverUrl = ti.uri;
	}
};

config.macros.sync.processSyncableTiddlers = function()
{
	for(var t=0; t<currSync.syncList.length; t++) {
		si = currSync.syncList[t];
		si.rowElement.style.backgroundColor = si.syncStatus.color;
	}
};

config.macros.sync.createSyncTasks = function()
{
	currSync.syncTasks = [];
	for(var t=0; t<currSync.syncList.length; t++) {
		var si = currSync.syncList[t];
		var r = null;
		for(var st=0; st<currSync.syncTasks.length; st++) {
			var cst = currSync.syncTasks[st];
			if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)
				r = cst;
		}
		if(r == null) {
			si.syncTask = this.createSyncTask(si);
			currSync.syncTasks.push(si.syncTask);
		} else {
			si.syncTask = r;
			r.syncItems.push(si);
		}
	}
};

config.macros.sync.createSyncTask = function(syncItem)
{
	var st = {};
	st.serverType = syncItem.serverType;
	st.serverHost = syncItem.serverHost;
	st.serverWorkspace = syncItem.serverWorkspace;
	st.syncItems = [syncItem];
	st.syncMachine = new SyncMachine(st.serverType,{
		start: function() {
			return this.openHost(st.serverHost,"openWorkspace");
		},
		openWorkspace: function() {
			return this.openWorkspace(st.serverWorkspace,"getTiddlerList");
		},
		getTiddlerList: function() {
			return this.getTiddlerList("gotTiddlerList");
		},
		gotTiddlerList: function(tiddlers) {
			for(var t=0; t<st.syncItems.length; t++) {
				var si = st.syncItems[t];
				var f = tiddlers.findByField("title",si.title);
				if(f !== null) {
					if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {
						si.syncStatus = config.macros.sync.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];
					}
				} else {
					si.syncStatus = config.macros.sync.syncStatusList.notFound;
				}
				config.macros.sync.updateSyncStatus(si);
			}
		},
		getTiddler: function(title) {
			return this.getTiddler(title,"onGetTiddler");
		},
		onGetTiddler: function(tiddler) {
			var syncItem = st.syncItems.findByField("title",tiddler.title);
			if(syncItem !== null) {
				syncItem = st.syncItems[syncItem];
				store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
				syncItem.syncStatus = config.macros.sync.syncStatusList.gotFromServer;
				config.macros.sync.updateSyncStatus(syncItem);
			}
		},
		putTiddler: function(tiddler) {
			return this.putTiddler(tiddler,"onPutTiddler");
		},
		onPutTiddler: function(tiddler) {
			var syncItem = st.syncItems.findByField("title",tiddler.title);
			if(syncItem !== null) {
				syncItem = st.syncItems[syncItem];
				store.resetTiddler(tiddler.title);
				syncItem.syncStatus = config.macros.sync.syncStatusList.putToServer;
				config.macros.sync.updateSyncStatus(syncItem);
			}
		}
	});
	st.syncMachine.go();
	return st;
};

config.macros.sync.updateSyncStatus = function(syncItem)
{
	var e = syncItem.colElements["status"];
	removeChildren(e);
	createTiddlyText(e,syncItem.syncStatus.text);
	syncItem.rowElement.style.backgroundColor = syncItem.syncStatus.color;
};

config.macros.sync.doSync = function(e)
{
	var rowNames = ListView.getSelectedRows(currSync.listView);
	for(var t=0; t<currSync.syncList.length; t++) {
		var si = currSync.syncList[t];
		if(rowNames.indexOf(si.title) != -1) {
			config.macros.sync.doSyncItem(si);
		}
	}
	return false;
};

config.macros.sync.doSyncItem = function(syncItem)
{
	var r = true;
	var sl = config.macros.sync.syncStatusList;
	switch(syncItem.syncStatus) {
		case sl.changedServer:
			r = syncItem.syncTask.syncMachine.go("getTiddler",syncItem.title);
			break;
		case sl.notFound:
		case sl.changedLocally:
		case sl.changedBoth:
			r = syncItem.syncTask.syncMachine.go("putTiddler",syncItem.tiddler);
			break;
		default:
			break;
	}
	if(r !== true)
		displayMessage("Error in doSyncItem: " + r);
};

config.macros.sync.cancelSync = function()
{
	currSync = null;
};

function SyncMachine(serverType,steps)
{
	this.serverType = serverType;
	this.adaptor = new config.adaptors[serverType];
	this.steps = steps;
}

SyncMachine.prototype.go = function(step,varargs)
{
	if(!step)
		step = "start";
	var h = this.steps[step];
	if(!h)
		return null;
	var a = [];
	for(var t=1; t<arguments.length; t++)
		a.push(arguments[t]);
	var r = h.apply(this,a);
	if(typeof r == "string")
		this.invokeError(r);
	return r;
};

SyncMachine.prototype.invokeError = function(message)
{
	if(this.steps.error)
		this.steps.error(message);
};

SyncMachine.prototype.openHost = function(host,nextStep)
{
	var me = this;
	return me.adaptor.openHost(host,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep);
	});
};

SyncMachine.prototype.getWorkspaceList = function(nextStep)
{
	var me = this;
	return me.adaptor.getWorkspaceList(null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,context.workspaces);
	});
};

SyncMachine.prototype.openWorkspace = function(workspace,nextStep)
{
	var me = this;
	return me.adaptor.openWorkspace(workspace,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep);
	});
};

SyncMachine.prototype.getTiddlerList = function(nextStep)
{
	var me = this;
	return me.adaptor.getTiddlerList(null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,context.tiddlers);
	});
};

SyncMachine.prototype.generateTiddlerInfo = function(tiddler)
{
	return this.adaptor.generateTiddlerInfo(tiddler);
};

SyncMachine.prototype.getTiddler = function(title,nextStep)
{
	var me = this;
	return me.adaptor.getTiddler(title,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,context.tiddler);
	});
};

SyncMachine.prototype.putTiddler = function(tiddler,nextStep)
{
	var me = this;
	return me.adaptor.putTiddler(tiddler,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,tiddler);
	});
};

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	removeChildren(listWrapper);
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var listView = ListView.create(listWrapper,plugins,this.listViewTemplate,this.onSelectCommand);
		wizard.setValue("listView",listView);
		wizard.setButtons([
				{caption: config.macros.plugins.removeLabel, tooltip: config.macros.plugins.removePrompt, onClick:  config.macros.plugins.doRemoveTag},
				{caption: config.macros.plugins.deleteLabel, tooltip: config.macros.plugins.deletePrompt, onClick:  config.macros.plugins.doDelete}
			]);
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		for(var t=0; t<rowNames.length; t++)
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			for(t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(linkText) {
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
	} else {
		e.appendChild(document.createTextNode(text));
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		removeChildren(msgArea);
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},

	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		if(force != null || changeList == null || changeList.indexOf(title) != -1) {
			removeChildren(e);
			wikify(store.getTiddlerText(title,title),e,null);
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute  && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = createTiddlyElement(document.body,"div");
	stash.style.display = "none";
	var display = document.getElementById("tiddlerDisplay");
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");
	if(!title)
		title = "PageTemplate";
	var html = store.getRecursiveTiddlerText(title,null,10);
	wrapper.innerHTML = html;
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = document.getElementById("tiddlerDisplay");
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div","tiddlerDisplay");
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	removeNode(stash);
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	var st = wikifyPlain("SiteTitle");
	var ss = wikifyPlain("SiteSubtitle");
	return st + ((st == "" || ss == "") ? "" : " - ") + ss;
}

function refreshStyles(title,doc)
{
	if(!doc)
		doc = document;
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles("StyleSheet");
	refreshStyles("StyleSheetPrint");
}

//--
//-- Options cookie stuff
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? "true" : "false";},
		set: function(name,value) {config.options[name] = value == "true";}
	}
};

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++) {
		var p = cookies[c].indexOf("=");
		if(p != -1) {
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			var optType = name.substr(0,3);
			if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
				config.optionHandlers[optType].set(name,value);
		}
	}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	var c = name + "=";
	var optType = name.substr(0,3);
	if(config.optionHandlers[optType] && config.optionHandlers[optType].get)
		c += config.optionHandlers[optType].get(name);
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

function encodeCookie(s)
{
	return escape(manualConvertUnicodeToUTF8(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,"")));});
}

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + store.getRecursiveTiddlerText(tiddlerName,"") + "\n");
}

function updateOriginal(original,posDiv)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				convertUnicodeToUTF8(store.allTiddlersAsHtml()) + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = convertUnicodeToUTF8(getPageTitle()).htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	// Get the URL of the document
	var originalPath = document.location.toString();
	// Check we were loaded from a file URL
	if(originalPath.substr(0,5) != "file:") {
		alert(config.messages.notFileUrlError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	// Load the original file
	var original = loadFile(localPath);
	if(original == null) {
		alert(config.messages.cantSaveError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	// Locate the storeArea div's
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return;
	}
	saveBackup(localPath,original);
	saveRss(localPath);
	saveEmpty(localPath,original,posDiv);
	saveMain(localPath,original,posDiv);
}

function saveBackup(localPath,original)
{
	// Save the backup
	if(config.options.chkSaveBackups) {
		var backupPath = getBackupPath(localPath);
		var backup = config.browser.isIE ? ieCopyFile(backupPath,localPath) : saveFile(backupPath,original);
		if(backup)
			displayMessage(config.messages.backupSaved,"file://" + backupPath);
		else
			alert(config.messages.backupFailed);
	}
}

function saveRss(localPath)
{
	if(config.options.chkGenerateAnRssFeed) {
		var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
		var rssSave = saveFile(rssPath,convertUnicodeToUTF8(generateRss()));
		if(rssSave)
			displayMessage(config.messages.rssSaved,"file://" + rssPath);
		else
			alert(config.messages.rssFailed);
	}
}

function saveEmpty(localPath,original,posDiv)
{
	if(config.options.chkSaveEmptyTemplate) {
		var emptyPath,p;
		if((p = localPath.lastIndexOf("/")) != -1)
			emptyPath = localPath.substr(0,p) + "/empty.html";
		else if((p = localPath.lastIndexOf("\\")) != -1)
			emptyPath = localPath.substr(0,p) + "\\empty.html";
		else
			emptyPath = localPath + ".empty.html";
		var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
		var emptySave = saveFile(emptyPath,empty);
		if(emptySave)
			displayMessage(config.messages.emptySaved,"file://" + emptyPath);
		else
			alert(config.messages.emptyFailed);
	}
}

function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function getLocalPath(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath)
{
	var backSlash = true;
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		backSlash = false;
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + (backSlash ? "\\" : "/") + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + "." + (new Date()).convertToYYYYMMDDHHMMSSMMM() + ".html";
	return backupPath;
}

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>en-us</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for (var t=tiddlers.length-1; t>=n; t--)
		s.push(tiddlers[t].saveToRss(u));
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

function convertUTF8ToUnicode(u)
{
	if(window.netscape == undefined)
		return manualConvertUTF8ToUnicode(u);
	else
		return mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return (fin.length > 0) ? s+fin : s;
}

function convertUnicodeToUTF8(s)
{
	if(window.netscape == undefined)
		return manualConvertUnicodeToUTF8(s);
	else
		return mozConvertUnicodeToUTF8(s);
}

function manualConvertUnicodeToUTF8(s)
{
	var re = /[^\u0000-\u007F]/g ;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	if(fin.length > 0)
		return u + fin;
	else
		return u;
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}

function saveFile(fileUrl,content)
{
	var r = null;
	if(!r)
		r = mozillaSaveFile(fileUrl,content);
	if(!r)
		r = ieSaveFile(fileUrl,content);
	if(!r)
		r = javaSaveFile(fileUrl,content);
	return r;
}

function loadFile(fileUrl)
{
	var r = null;
	if((r == null) || (r == false))
		r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return r;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest,source)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				file.create(0,0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file,0x20|0x02,00004,null);
			out.write(content,content.length);
			out.flush();
			out.close();
			return true;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				return null;
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file,0x01,00004,null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			return sInputStream.read(sInputStream.available());
		} catch(ex) {
			return false;
		}
	}
	return null;
}

function javaUrlToFilename(url)
{
	var f = "//web.archive.org/web/20130827021950/http://localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	if(i > 0)
		return url.substring(i-1);
	return url;
}

function javaSaveFile(filePath,content)
{
	try {
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
	} catch(ex) {
	}
	try {
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	} catch(ex) {
		return null;
	}
	return true;
}

function javaLoadFile(filePath)
{
	try {
		if(document.applets["TiddlySaver"])
			return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
	} catch(ex) {
	}
	var content = [];
	try {
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
	} catch(ex) {
		return null;
	}
	return content.join("\n");
}

//--
//-- Server adaptor for talking to static files
//--

function FileAdaptor()
{
	this.host = null;
	this.store = null;
	return this;
}

FileAdaptor.NotLoadedError = "TiddlyWiki file has not been loaded";
FileAdaptor.serverType = 'file';

// Open the specified host/server
FileAdaptor.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	if(!context)
		context = {};
	context.adaptor = this;
	context.callback = callback;
	context.userParams = userParams;
	var ret = loadRemoteFile(host,FileAdaptor.openHostCallback,context);
	return typeof(ret) == "string" ? ret : true;
};

FileAdaptor.openHostCallback = function(status,context,responseText,url,xhr)
{
	var adaptor = context.adaptor;
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file: " + xhr.statusText;
	} else {
		// Load the content into a TiddlyWiki() object
		adaptor.store = new TiddlyWiki();
		if(!adaptor.store.importTiddlyWiki(responseText))
			context.statusText = config.messages.invalidFileError.format([url]);
	}
	context.callback(context,context.userParams);
};

// Gets the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	if(!context)
		context = {};
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
FileAdaptor.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	if(!context)
		context = {};
	context.status = true;
	window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback)
{
	if(!this.store)
		return FileAdaptor.NotLoadedError;
	if(!context)
		context = {};
	context.tiddlers = [];
	this.store.forEachTiddler(function(title,tiddler)
		{
		var t = new Tiddler(title);
		t.text = tiddler.text;
		t.modified = tiddler.modified;
		t.modifier = tiddler.modifier;
		t.fields['server.page.revision'] = tiddler.modified.convertToYYYYMMDDHHMM();
		t.tags = tiddler.tags;
		context.tiddlers.push(t);
		});
	context.status = true;
	window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieves a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	if(!this.store)
		return FileAdaptor.NotLoadedError;
	if(!context)
		context = {};
	context.tiddler = this.store.fetchTiddler(title);
	if(context.tiddler) {
		context.tiddler.fields['server.type'] = FileAdaptor.serverType;
		context.tiddler.fields['server.host'] = this.host;
		context.tiddler.fields['server.page.revision'] = context.tiddler.modified.convertToYYYYMMDDHHMM();
	}
	context.status = true;
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		callback(context,userParams);
	} else {
		window.setTimeout(function() {callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	delete this.store;
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

//--
//-- Remote HTTP requests
//--

function loadRemoteFile(url,callback,params)
{
	return doHttp("GET",url,null,null,null,null,callback,params,null);
}

// HTTP status codes
var httpStatus = {
	OK: 200,
	ContentCreated: 201,
	NoContent: 204,
	Unauthorized: 401,
	Forbidden: 403,
	NotFound: 404,
	MethodNotAllowed: 405
};

function doHttp(type,url,data,contentType,username,password,callback,params,headers)
{
	// Get an xhr object
	var x = getXMLHttpRequest();
	if(!x)
		return "Can't create XMLHttpRequest object";
	// Install callback
	x.onreadystatechange = function() {
		if (x.readyState == 4 && callback && (x.status !== undefined)) {
			if([0, httpStatus.OK, httpStatus.ContentCreated, httpStatus.NoContent].contains(x.status))
				callback(true,params,x.responseText,url,x);
			else
				callback(false,params,null,url,x);
			x.onreadystatechange = function(){};
			x = null;
		}
	};
	// Send request
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	try {
		url = url + (url.indexOf("?") < 0 ? "?" : "&") + "nocache=" + Math.random();
		x.open(type,url,true,username,password);
		if (data)
			x.setRequestHeader("Content-Type", contentType ? contentType : "application/x-www-form-urlencoded");
		if (x.overrideMimeType)
			x.setRequestHeader("Connection", "close");
		if(headers) {
			for(n in headers)
				x.setRequestHeader(n,headers[n]);
		}
		x.setRequestHeader("X-Requested-With", "TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + (version.beta ? " (beta " + version.beta + ")" : ""));
		x.send(data);
	} catch (ex) {
		return exceptionText(ex);
	}
	return x;
}

function getXMLHttpRequest()
{
	try {
		var x = new XMLHttpRequest(); // Modern
	} catch(ex) {
		try {
			x = new ActiveXObject("Msxml2.XMLHTTP"); // IE 6
		} catch (ex2) {
			return null;
		}
	}
	return x;
}

//--
//-- TiddlyWiki-specific utility functions
//--

function createTiddlyButton(theParent,theText,theTooltip,theAction,theClass,theId,theAccessKey)
{
	var theButton = document.createElement("a");
	if(theAction) {
		theButton.onclick = theAction;
		theButton.setAttribute("href","javascript:;");
	}
	if(theTooltip)
		theButton.setAttribute("title",theTooltip);
	if(theText)
		theButton.appendChild(document.createTextNode(theText));
	if(theClass)
		theButton.className = theClass;
	else
		theButton.className = "button";
	if(theId)
		theButton.id = theId;
	if(theParent)
		theParent.appendChild(theButton);
	if(theAccessKey)
		theButton.setAttribute("accessKey",theAccessKey);
	return theButton;
}

function createTiddlyLink(place,title,includeText,theClass,isStatic,linkedFromTiddler,noToggle)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,theClass);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			classes.pushUnique("shadow");
		} else {
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
			classes.remove("shadow");
		}
	}
	if(config.annotations[title])
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

function createExternalLink(place,url)
{
	var theLink = document.createElement("a");
	theLink.className = "externalLink";
	theLink.href = url;
	theLink.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		theLink.target = "_blank";
	place.appendChild(theLink);
	return theLink;
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(e)
{
	if(!e) e = window.event;
	var theTarget = resolveTarget(e);
	var theLink = theTarget;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = theLink.getAttribute("tiddlyLink");
		fields = theLink.getAttribute("tiddlyFields");
		noToggle = theLink.getAttribute("noToggle");
		theLink = theLink.parentNode;
	} while(title == null && theLink != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		story.displayTiddler(theTarget,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler)
{
	var theTag = createTiddlyButton(place,tag,config.views.wikified.tag.tooltip.format([tag]),onClickTag);
	theTag.setAttribute("tag",tag);
	if(excludeTiddler)
		theTag.setAttribute("tiddler",excludeTiddler);
	return theTag;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev ? ev : window.event;
	var popup = Popup.create(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = store.getTaggedTiddlers(tag);
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var e = ev ? ev : window.event;
	var tag = this.getAttribute("tag");
	var tagged = store.getTaggedTiddlers(tag);
	var titles = [];
	for(var t=0; t<tagged.length; t++)
		titles.push(tagged[t].title);
	story.displayTiddlers(this,titles);
	return false;
}

function onClickError(ev)
{
	var e = ev ? ev : window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	for(var t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickTiddlyPopup(ev)
{
	var e = ev ? ev : window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
	for(p in src) {
		if(!preserveExisting || dst[p] === undefined)
			dst[p] = src[p];
	}
	return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description ? e.description : e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(!g.browsers[b]() && b < g.browsers.length-1)
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}
//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() // Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

// Map a 0..1 value to 0..1, but slow down at the start and end
Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
		case "-tw-vertScroll":
			window.scrollTo(findScrollX(),value);
			break;
		case "-tw-horizScroll":
			window.scrollTo(value,findScrollY());
			break;
		default:
			element.style[style] = value;
			break;
	}
};

Morpher.prototype.stop = function()
{
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template ? p.template : "%0";
			switch(p.format) {
				case undefined:
				case "style":
					var v = p.start + (p.end-p.start) * progress;
					this.assignStyle(this.element,p.style,template.format([v]));
					break;
				case "color":
					break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {removeNode(element);};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement,unused)
{
	var p = [
		{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}
	];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var left = findPosX(element);
	var width = element.scrollWidth;
	var height = element.scrollHeight;
	var winWidth = findWindowWidth();
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
			case "all":
				c = function(element,properties) {removeNode(element);};
				break;
			case "children":
				c = function(element,properties) {removeChildren(element);};
				break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,theClass)
{
	Popup.remove();
	var popup = createTiddlyElement(document.body,elem ? elem : "ol","popup",theClass ? theClass : "popup");
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev ? ev : window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(unused1,unused2)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup);
	addClass(curr.root,"highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,offset)
{
	if(!offset) var offset = {x:0, y:0};
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var rootHeight = root.offsetHeight;
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + rootHeight + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	if(popupLeft + popupWidth > winWidth)
		popupLeft = winWidth - popupWidth;
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.remove = function()
{
	if(Popup.stack.length > 0) {
		Popup.removeFrom(0);
	}
};

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		removeNode(p.popup);
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	if(this.formElem)
		this.formElem[name] = value;
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? this.formElem[name] : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,"form",null,"wizard");
	createTiddlyElement(this.formElem,"h1",null,null,title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
};

Wizard.prototype.clear = function()
{
	removeChildren(this.bodyElem);
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	removeChildren(this.footElem);
	for(var t=0; t<buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
		}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	removeChildren(this.bodyElem);
	var w = createTiddlyElement(this.bodyElem,"div");
	createTiddlyElement(w,"h2",null,null,stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className ? className : "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var r = createTiddlyElement(thead,"tr");
	for(var t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader)
			colType.createHeader(c,columnTemplate,t);
	}
	var tbody = createTiddlyElement(table,"tbody");
	for(var rc=0; rc<listObject.length; rc++) {
		rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				addClass(r,listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		for(var cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem)
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var hadOne = false;
	for(var t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<config.messages.sizeTemplates.length-1 && v<config.messages.sizeTemplates[t].unit)
					t++;
				createTiddlyText(place,config.messages.sizeTemplates[t].template.format([Math.round(v/config.messages.sizeTemplates[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createTiddlyText(createExternalLink(place,v),c ? c : v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				for(var t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
//--

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return c;
};

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	for(var i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	for(var t=0; t<this.length; t++) {
		if(this[t][field] == value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i=0; i<items.length; i++) {
		if (this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for (var i = 0; i<items.length; i++) {
		if (this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1) {
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
String.prototype.toJSONString = function()
{
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.pushUnique(p[t].value,unique);
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var results = [];
		for(var t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var r = {};
	for(var t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var r = [];
	for(var t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return String.zeroPad(this.getFullYear(),4) + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4);
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(d.substr(8,2),10),
			parseInt(d.substr(10,2),10),0,0));
};

//--
//-- Crypto functions and associated conversion routines
//--

// Crypto "namespace"
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	var be = Array();
	var len = Math.floor(str.length/4);
	var i, j;
	for(i=0, j=0; i<len; i++, j+=4) {
		be[i] = ((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
	}
	while (j<str.length) {
		be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
		j++;
	}
	return be;
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	var str = "";
	for(var i=0;i<be.length*32;i+=8)
		str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
	return str;
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	var hex = "0123456789ABCDEF";
	var str = "";
	for(var i=0;i<be.length*4;i++)
		str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
	return str;
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return Crypto.be32sToHex(Crypto.sha1Str(str));
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return Crypto.sha1(Crypto.strToBe32s(str),str.length);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	// Add 32-bit integers, wrapping at 32 bits
	add32 = function(a,b)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF);
		var msw = (a>>16)+(b>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Add five 32-bit integers, wrapping at 32 bits
	add32x5 = function(a,b,c,d,e)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
		var msw = (a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Bitwise rotate left a 32-bit integer by 1 bit
	rol32 = function(n)
	{
		return (n>>>31)|(n<<1);
	};

	var len = blen*8;
	// Append padding so length in bits is 448 mod 512
	x[len>>5] |= 0x80 << (24-len%32);
	// Append length
	x[((len+64>>9)<<4)+15] = len;
	var w = Array(80);

	var k1 = 0x5A827999;
	var k2 = 0x6ED9EBA1;
	var k3 = 0x8F1BBCDC;
	var k4 = 0xCA62C1D6;

	var h0 = 0x67452301;
	var h1 = 0xEFCDAB89;
	var h2 = 0x98BADCFE;
	var h3 = 0x10325476;
	var h4 = 0xC3D2E1F0;

	for(var i=0;i<x.length;i+=16) {
		var j,t;
		var a = h0;
		var b = h1;
		var c = h2;
		var d = h3;
		var e = h4;
		for(j = 0;j<16;j++) {
			w[j] = x[i+j];
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=16;j<20;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=20;j<40;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k2);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=40;j<60;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),(b&c)|(d&(b|c)),w[j],k3);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=60;j<80;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k4);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}

		h0 = add32(h0,a);
		h1 = add32(h1,b);
		h2 = add32(h2,c);
		h3 = add32(h3,d);
		h4 = add32(h4,e);
	}
	return Array(h0,h1,h2,h3,h4);
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	return "#" + ("0" + Math.floor(this.r.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.g.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.b.clamp(0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

function drawGradient(place,horiz,colours)
{
	for(var t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var f = t/100;
		var p = f*(colours.length-1);
		bar.style.backgroundColor = colours[Math.floor(p)].mix(colours[Math.ceil(p)],p-Math.floor(p)).toString();
	}
}

function createTiddlyText(theParent,theText)
{
	return theParent.appendChild(document.createTextNode(theText));
}

function createTiddlyCheckbox(theParent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	theParent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,theParent);
	return cb;
}

function createTiddlyElement(theParent,theElement,theID,theClass,theText)
{
	var e = document.createElement(theElement);
	if(theClass != null)
		e.className = theClass;
	if(theID != null)
		e.setAttribute("id",theID);
	if(theText != null)
		e.appendChild(document.createTextNode(theText));
	if(theParent != null)
		theParent.appendChild(e);
	return e;
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj['e'+type+fn] = fn;
		obj[type+fn] = function(){obj['e'+type+fn](window.event);};
		obj.attachEvent('on'+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent('on'+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}

function addClass(e,theClass)
{
	var currClass = e.className.split(" ");
	if(currClass.indexOf(theClass) == -1)
		e.className += " " + theClass;
}

function removeClass(e,theClass)
{
	var currClass = e.className.split(" ");
	var i = currClass.indexOf(theClass);
	while(i != -1) {
		currClass.splice(i,1);
		i = currClass.indexOf(theClass);
	}
	e.className = currClass.join(" ");
}

function hasClass(e,theClass)
{
	if(e.className) {
		if(e.className.split(" ").indexOf(theClass) != -1)
			return true;
	}
	return false;
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name ? name : "tagName";
	relative = relative ? relative : "parentNode";
	if(name == "className") {
		while(e && !hasClass(e,value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	var text = "";
	if(e.innerText)
		text = e.innerText;
	else if(e.textContent)
		text = e.textContent;
	return text;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth ? window.innerWidth : document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight ? window.innerHeight : document.documentElement.clientHeight;
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX ? window.scrollX : document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY ? window.scrollY : document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e != null && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Remove all children of a node
function removeChildren(e)
{
	while(e && e.hasChildNodes())
		removeNode(e.firstChild);
}

// Remove a node and all it's children
function removeNode(e)
{
	scrubNode(e);
	e.parentNode.removeChild(e);
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE)
		return;
	var att = e.attributes;
	if(att) {
		for(var t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== 'style' && (typeof e[n] === 'function' || (typeof e[n] === 'object' && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id,doc)
{
	if(!id)
		id = "customStyleSheet";
	if(!doc)
		doc = document;
	var n = doc.getElementById(id);
	if(doc.createStyleSheet) {
		// Test for IE's non-standard createStyleSheet method
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
	} else {
		if(n) {
			n.replaceChild(doc.createTextNode(s),n.firstChild);
		} else {
			n = doc.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(doc.createTextNode(s));
			doc.getElementsByTagName("head")[0].appendChild(n);
		}
	}
}

// Force the browser to do a document reflow when needed to workaround browser bugs
function forceReflow()
{
	if(config.browser.isGecko) {
		setStylesheet("body {top:-1em;margin-top:1em;}");
		setStylesheet("");
	}
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split('\n').length;
		var thisline = e.value.substr(0,e.selectionStart).split('\n').length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart('character', -text.length);
				range.select();
			}
		}
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = "";
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var tiddlers = [];
	for(var t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var tiddlers = store.getTiddlers("title");
	for(var t = 0; t < tiddlers.length; t++)
		results.push(this.externalizeTiddler(store,tiddlers[t]));
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if (node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMM(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMM(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var attrs = node.attributes;
	for(var i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if (attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if (!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created.convertToYYYYMMDDHHMM();
		var modified = tiddler.modified.convertToYYYYMMDDHHMM();
		var vdate = version.date.convertToYYYYMMDDHHMM();
		var attributes = tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified +'"';
		attributes += (usePre && created == vdate) ? "" :' created="' + created + '"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};

//--
//-- Deprecated code
//--

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
};

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead,"mg");
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
		var text = lookaheadMatch[1];
		if(config.browser.isIE)
			text = text.replace(/\n/g,"\r");
		createTiddlyElement(w.output,"pre",null,null,text);
		w.nextMatch = lookaheadRegExp.lastIndex;
	}
};

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br.handler = function(place)
{
	createTiddlyElement(place,"br");
};

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
	var i = this.indexOf(item);
	return i == -1 ? null : i;
};

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	return store.getLoader().internalizeTiddler(store,this,title,divRef);
};

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store,this);
};

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,unused3)
{
	story.displayTiddlers(srcElement,titles,template,animate);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,unused3)
{
	story.displayTiddler(srcElement,title,template,animate);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");
//--
//-- End of scripts
//--
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
<!--
     FILE ARCHIVED ON 02:19:50 Aug 27, 2013 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 01:52:38 Jul 12, 2025.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 0.674
  exclusion.robots: 0.032
  exclusion.robots.policy: 0.018
  esindex: 0.011
  cdx.remote: 75.462
  LoadShardBlock: 255.074 (3)
  PetaboxLoader3.datanode: 226.092 (4)
  load_resource: 324.074
  PetaboxLoader3.resolve: 209.499
-->