<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<script type="text/javascript" src="https://web-static.archive.org/_static/js/bundle-playback.js?v=1B2M2Y8A" charset="utf-8"></script>
<script type="text/javascript" src="https://web-static.archive.org/_static/js/wombat.js?v=1B2M2Y8A" charset="utf-8"></script>
<script>window.RufflePlayer=window.RufflePlayer||{};window.RufflePlayer.config={"autoplay":"on","unmuteOverlay":"hidden","showSwfDownload":true};</script>
<script type="text/javascript" src="https://web-static.archive.org/_static/js/ruffle/ruffle.js"></script>
<script type="text/javascript">
    __wm.init("https://web.archive.org/web");
  __wm.wombat("http://www.cs.utexas.edu:80/~joeraii/siglet/","20071203063511","https://web.archive.org/","web","https://web-static.archive.org/_static/",
	      "1196663711");
</script>
<link rel="stylesheet" type="text/css" href="https://web-static.archive.org/_static/css/banner-styles.css?v=1B2M2Y8A" />
<link rel="stylesheet" type="text/css" href="https://web-static.archive.org/_static/css/iconochive.css?v=1B2M2Y8A" />
<!-- End Wayback Rewrite JS Include -->
<script type="text/javascript">
var version = {major: 1, minor: 2, revision: 31, date: new Date(2005,8-1,5), extensions: {}};
</script>
<!--
TiddlyWiki 1.2.31 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Published under a BSD open source license
Incorporating improvements by: 
Isao Sonobe, http://www-gauge.scphys.kyoto-u.ac.jp/~sonobe/OgreKit/OgreKitWiki.html
Joseph Reisinger, http://www.cs.utexas.edu/~joeraii/siglet

Copyright (c) Osmosoft Limited, 14 April 2005

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>TiddlyWiki</title>
<script type="text/javascript">

// ---------------------------------------------------------------------------------
// Configuration repository
// ---------------------------------------------------------------------------------

var config = {
	// Options that can be set in the options panel and/or cookies
	options: {
		chkRegExpSearch: false,
		chkCaseSensitiveSearch: false,
		chkAnimate: true,
		txtUserName: "YourName",
		txtPassword: "YourPassword",
		chkSaveBackups: true,
		chkAutoSave: false,
		chkGenerateAnRssFeed: false,
		chkSaveEmptyTemplate: false,
		chkOpenInNewWindow: true,
		chkToggleLinks: false,
		txtMainTab: "tabTimeline",
		txtMoreTab: "moreTabAll"
		},
	// Hashmap of notification functions to be called when certain tiddlers are changed or deleted
	notifyNamedTiddlers: {
		SiteTitle: refreshTitle,
		SiteSubtitle: refreshSubtitle,
		MainMenu: refreshMenu,
		SideBarOptions: refreshSidebar,
		StyleSheet: refreshStyles
		},
	// List of notification functions to be called when any tiddler is changed or deleted
	notifyTiddlers: [
		refreshStory,
		refreshTabs
		],
	// Shadow tiddlers for emergencies
	shadowTiddlers: {
		SideBarOptions: "<<search>><<closeAll>><<permaview>><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel options 'Change TiddlyWiki advanced options'>>",
		OptionsPanel: "These InterfaceOptions for customising TiddlyWiki are saved in your browser\n\nYour username for signing your edits. Write it as a WikiWord (eg JoeBloggs)\n\n<<option txtUserName>>\n<<option chkSaveBackups>> SaveBackups\n<<option chkAutoSave>> AutoSave\n<<option chkGenerateAnRssFeed>> GenerateAnRssFeed\n<<option chkRegExpSearch>> RegExpSearch\n<<option chkCaseSensitiveSearch>> CaseSensitiveSearch\n<<option chkAnimate>> EnableAnimations\n\nSee AdvancedOptions",
		AdvancedOptions: "<<option chkOpenInNewWindow>> OpenLinksInNewWindow\n<<option chkSaveEmptyTemplate>> SaveEmptyTemplate\n<<option chkToggleLinks>> Clicking on links to tiddlers that are already open causes them to close\n^^(override with Control or other modifier key)^^",
		SideBarTabs: "<<tabs txtMainTab Timeline Timeline TabTimeline Tags 'All tags' TabTags More 'More lists' TabMore>>",
		TabTimeline: "<<timeline>>",
		TabTags: "<<allTags>>",
		TabMore: "<<tabs txtMoreTab All 'All tiddlers' TabMoreAll Missing 'Missing tiddlers' TabMoreMissing Orphans 'Orphaned tiddlers' TabMoreOrphans>>",
		TabMoreAll: "<<list all>>",
		TabMoreMissing: "<<list missing>>",
		TabMoreOrphans: "<<list orphans>>"
		},
	// Miscellaneous options
	numRssItems: 20, // Number of items in the RSS feed
	animFast: 0.12, // Speed for animations (lower == slower)
	animSlow: 0.01, // Speed for EasterEgg animations
	// Messages
	messages: {
		customConfigError: "Error in customConfig - %0",
		savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#DownloadSoftware for details",
		subtitleUnknown: "(unknown)",
		undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
		externalLinkTooltip: "External link to %0",
		noTags: "There are no tagged tiddlers",
		notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
		cantSaveError: "It's not possible to save changes using this browser. Use FireFox if you can",
		invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
		backupSaved: "Backup saved",
		backupFailed: "Failed to save backup file",
		rssSaved: "RSS feed saved",
		rssFailed: "Failed to save RSS feed file",
		emptySaved: "Empty template saved",
		emptyFailed: "Failed to save empty template file",
		mainSaved: "Main TiddlyWiki file saved",
		mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
		macroError: "Error executing macro '%0'",
		overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
		unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
		dates: {
			months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"],
			days: ["Sunday", "Monday","Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
			}
		},
	views: {
		wikified: {
			tag: {labelNoTags: "no tags", labelTags: "", tooltip: "Show tiddlers tagged with '%0'", openAllText: "Open all tiddlers tagged with '%0'", openAllTooltip: "Open all of these tiddlers", popupNone: "No other tiddlers tagged with '%0'"},
            toolbarCloseOthers: { text:"[^]", tooltip: "Close other tiddlers."},
			toolbarClose: {text: "[-]", tooltip: "Close this tiddler"},
			toolbarEdit: {text: "[@]", tooltip: "Edit this tiddler"},
            toolbarPermalink: {text: "->", tooltip: "Permalink for this tiddler"},
			toolbarReferences: {text: "references", tooltip: "Show tiddlers that link to this one", popupNone: "No references"},
			defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it"
			},
		editor: {
			tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
			tagChooser: {text: "tags", tooltip: "Choose existing tags to add to this tiddler", popupNone: "There are no tags defined", tagTooltip: "Add the tag '%0'"},
			toolbarDone: {text: "done", tooltip: "Save changes to this tiddler"},
			toolbarCancel: {text: "cancel", tooltip: "Undo changes to this tiddler"},
			toolbarDelete: {text: "delete", tooltip: "Delete this tiddler"},
			defaultText: "Type the text for '%0'"
			}
		},
	macros: { // Each has a 'handler' member that is inserted later
		today: {},
		version: {},
		search: {label: "search", prompt: "Search this TiddlyWiki", sizeTextbox: 15, successMsg: "%0 tiddlers found matching %1", failureMsg: "No tiddlers found matching %0"},
		tiddler: {},
		tag: {},
		timeline: {dateFormat: "DD MMM YYYY"},
		allTags: {tooltip: "Show tiddlers tagged with '%0'", noTags: "There are no tagged tiddlers"},
		list: {
			all: {prompt: ""},
			missing: {prompt: ""},
			orphans: {prompt: ""},
      important: {prompt: ""},
      personal: {prompt: ""},
      todo: {prompt: ""}
    },
		closeAll: {label: "close all", prompt: "Close all displayed tiddlers (except any that are being edited)"},
		permaview: {label: "permaview", prompt: "Link to an URL that retrieves all the currently displayed tiddlers"},
        saveSession: {label: "session", prompt: "Save the current session view."},
		saveChanges: {label: "save changes", prompt: "Save all tiddlers to create a new TiddlyWiki"},
		slider: {},
		option: {},
		newTiddler: {label: "new", prompt: "Create a new tiddler", title: "New Tiddler"},
		newJournal: {label: "new journal", prompt: "Create a new tiddler from the current date and time"},
		sparkline: {},
		tabs: {}
		}
};

// ---------------------------------------------------------------------------------
// Main
// ---------------------------------------------------------------------------------

// TiddlyWiki storage
var store = new TiddlyWiki();

// Animation engine
var anim = new Animator();

// Starting up
function main()
{
	setupRegexp();
	saveTest();
	loadOptionsCookie();
	var s;
	for(s in config.notifyNamedTiddlers)
		store.addNotification(s,config.notifyNamedTiddlers[s]);
	for(s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(null,config.notifyTiddlers[s]);
	store.loadFromDiv("storeArea","store");
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(var t=0; t<configTiddlers.length; t++)
		{
		var ex = processConfig(configTiddlers[t].text);
		if(ex)
			displayMessage(config.messages.customConfigError.format([ex]));
		}
	store.notifyAll();
	var start = store.getTiddlerText("DefaultTiddlers");
	if(window.location.hash)
		displayTiddlers(null,convertUTF8ToUnicode(decodeURI(window.location.hash.substr(1))),1,null,null);
	else if(start)
		displayTiddlers(null,start,1,null,null);
}

function saveTest()
{
	var saveTest = document.getElementById("saveTest");
	if(saveTest.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	saveTest.appendChild(document.createTextNode("savetest"));
}

// ---------------------------------------------------------------------------------
// Macro definitions
// ---------------------------------------------------------------------------------

config.macros.today.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,(new Date()).toLocaleString());
}

config.macros.version.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,version.major + "." + version.minor + "." + version.revision);
}

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] ? params[0] : "all";
	var theList = document.createElement("ul");
	place.appendChild(theList);
	if(this[type].prompt)
		createTiddlyElement(theList,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for (t = 0; t < results.length; t++)
		{
        // NOTE: changed this 
        theListItem = document.createElement("li");
        if( t % 2 == 0)
          theListItem.className = "sidebarContentEven";
        else
          theListItem.className = "sidebarContentOdd";
        var icon = document.createElement("div");
        if(results[t].tags)
        {
          //icon.setAttribute( "tags", results[t].tags[0] );
        }
          else
          icon.setAttribute( "tag", "none" );
        icon.className = "siglet";
        theListItem.appendChild(icon);
        
		theList.appendChild(theListItem);
		if(typeof results[t] == "string")
			createTiddlyLink(theListItem,results[t],true);
		else
			createTiddlyLink(theListItem,results[t].title,true);
		}
}

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
}

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
}

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
}

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags();
	var theDateList = createTiddlyElement(place,"ul",null,null,null);
	if(tags.length == 0)
		createTiddlyElement(theDateList,"li",null,"listTitle",this.noTags);
	for (t=0; t<tags.length; t++)
		{
		var theListItem =createTiddlyElement(theDateList,"li",null,null,null);
        if( t % 2 == 0)
          theListItem.className = "sidebarContentEven";
        else
          theListItem.className = "sidebarContentOdd";
        var icon = document.createElement("div");
        icon.setAttribute( "tag", tags[t][0] );
        icon.className = "siglet";
        theListItem.appendChild(icon);
        
        var theTag = createTiddlyButton(theListItem,tags[t][0] + " (" + tags[t][1] + ")",this.tooltip + tags[t][0],onClickTag);
		theTag.setAttribute("tag",tags[t][0]);
		}
}

config.macros.timeline.handler = function(place,macroName,params)
{
	var tiddlers = store.reverseLookup("tags","excludeLists",false,"modified");
	var lastDay = "";
	for (t=tiddlers.length-1; t>=0; t--)
		{
		var tiddler = tiddlers[t];
		var theDay = tiddler.modified.convertToYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay)
			{
			var theDateList = document.createElement("ul");
			place.appendChild(theDateList);
			createTiddlyElement(theDateList,"li",null,"listTitle",tiddler.modified.formatString(this.dateFormat));
			lastDay = theDay;
			}
		var theDateListItem = createTiddlyElement(theDateList,"li",null,"listLink",null);
        // NOTE: added this
        if( t % 2 == 0)
          theDateListItem.className = "sidebarContentEven";
        else
          theDateListItem.className = "sidebarContentOdd";
        //var icon = document.createElement("div");
        //icon.setAttribute( "tag", tiddler.tags[0] );
        //icon.className = "siglet";
        //theDateListItem.appendChild(icon);
        //NOTE: original:
        //theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));
        createTiddlyLink(theDateListItem,tiddler.title,true);
		}
}

config.macros.search.handler = function(place,macroName,params)
{
	var lastSearchText = "";
	var searchTimeout = null;
	var doSearch = function(txt)
		{
		closeAllTiddlers();
		var matches = store.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch,"title","excludeSearch");
		for(var t=matches.length-1; t>=0; t--)
			displayTiddler(null,matches[t].title,0,txt.value,config.options.chkCaseSensitiveSearch,false,false);
		var q = config.options.chkRegExpSearch ? "/" : "'";
		if(matches.length > 0)
			displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + txt.value + q]));
		else
			displayMessage(config.macros.search.failureMsg.format([q + txt.value + q]));
		lastSearchText = txt.value;
		};
	var clickHandler = function(e)
		{
		doSearch(this.nextSibling);
		};
	var keyHandler = function(e)
		{
		if (!e) var e = window.event;
		switch(e.keyCode)
			{
			case 27:
				this.value = "";
				clearMessage();
				break;
			}
		if((this.value.length > 2) && (this.value != lastSearchText))
			{
			if(searchTimeout)
				clearTimeout(searchTimeout);
			var txt = this;
			searchTimeout = setTimeout(function() {doSearch(txt);},200);
			}
		};
	var focusHandler = function(e)
		{
		this.select();
		};
	var btn = createTiddlyButton(place,this.label,this.prompt,clickHandler);
	var txt = createTiddlyElement(place,"input",null,null,null);
	if(params[0])
		txt.value = params[0];
	txt.onkeyup = keyHandler;
	txt.onfocus = focusHandler;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("autocomplete","off");
	if(navigator.userAgent.toLowerCase().indexOf("safari") == -1)
		txt.setAttribute("type","text");
	else
		{
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
		}
}

config.macros.tiddler.handler = function(place,macroName,params)
{
	var wrapper = createTiddlyElement(place,"span",null,params[1] ? params[1] : null,null);
	var text = store.getTiddlerText(params[0]);
	if(text)
		wikify(text,wrapper,null,null);
}

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0]);
}

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,closeAllTiddlers);
}

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,onClickPermaView);
}

config.macros.saveChanges.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,saveChanges);
}

config.macros.slider.onClickSlider = function(e)
{
	if (!e) var e = window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate)
		anim.startAnimating(new Slider(n,!isOpen,e.shiftKey || e.altKey,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
}

config.macros.slider.handler = function(place,macroName,params)
{
	var cookie = params[0] ? params[0] : "";
	var text = store.getTiddlerText(params[1]);
	var btn = createTiddlyButton(place,params[2],params[3],this.onClickSlider);
	var panel = createTiddlyElement(place,"div",null,"sliderPanel",null);
	panel.setAttribute("cookie",cookie);
	panel.style.display = config.options[cookie] ? "block" : "none";
	if(text)
		wikify(text,panel,null,null);
}

config.macros.option.onChangeOption = function(e)
{
	var opt = this.getAttribute("option");
	var elementType,valueField;
	if(opt)
		{
		switch(opt.substr(0,3))
			{
			case "txt":
				elementType = "input";
				valueField = "value";
				break;
			case "chk":
				elementType = "input";
				valueField = "checked";
				break;
			}
		config.options[opt] = this[valueField];
		saveOptionCookie(opt);
		var nodes = document.getElementsByTagName(elementType);
		for(var t=0; t<nodes.length; t++)
			{
			var optNode = nodes[t].getAttribute("option");
			if(opt == optNode)
				nodes[t][valueField] = this[valueField];
			}
		}
	return(true);
}

config.macros.option.handler = function(place,macroName,params)
{
	var opt = params[0];
	if(config.options[opt] == undefined)
		return;
	var c;
	switch(opt.substr(0,3))
		{
		case "txt":
			c = document.createElement("input");
			c.onkeyup = this.onChangeOption;
			c.setAttribute("option",opt);
			c.size = 15;
			c.value = config.options[opt];
			place.appendChild(c);
			break;
		case "chk":
			c = document.createElement("input");
			c.setAttribute("type","checkbox");
			c.onclick = this.onChangeOption;
			c.setAttribute("option",opt);
			c.checked = config.options[opt];
			place.appendChild(c);
			break;
		}
}

config.macros.newTiddler.onClick = function()
{
	displayTiddler(null,config.macros.newTiddler.title,2,null,null,false,false);
	var e = document.getElementById("editorTitle" + config.macros.newTiddler.title);
	e.focus();
	e.select();
}

config.macros.newTiddler.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.newJournal.handler = function(place,macroName,params)
{
	var now = new Date();
	var title = now.formatString(params[0].trim());
	var createJournal = function() {
		displayTiddler(null,title,2,null,null,false,false);
		var tagsBox = document.getElementById("editorTags" + title);
		if(tagsBox && params[1])
			tagsBox.value += " " + String.encodeTiddlyLink(params[1]);
		};
	createTiddlyButton(place,this.label,this.prompt,createJournal);
}

config.macros.sparkline.handler = function(place,macroName,params)
{
	var data = [];
	var min = 0;
	var max = 0;
	for(var t=0; t<params.length; t++)
		{
		var v = parseInt(params[t]);
		if(v < min)
			min = v;
		if(v > max)
			max = v;
		data.push(v);
		}
	if(data.length < 1)
		return;
	var box = createTiddlyElement(place,"span",null,"sparkline",String.fromCharCode(160));
	box.title = data.join(",");
	var w = box.offsetWidth;
	var h = box.offsetHeight;
	box.style.paddingRight = (data.length * 2 - w) + "px";
	box.style.position = "relative";
	for(var d=0; d<data.length; d++)
		{
		var tick = document.createElement("img");
		tick.border = 0;
		tick.className = "sparktick";
		tick.style.position = "absolute";
		tick.src = "data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B";
		tick.style.left = d*2 + "px";
		tick.style.width = "2px";
		var v = Math.floor(((data[d] - min)/(max-min)) * h);
		tick.style.top = (h-v) + "px";
		tick.style.height = v + "px";
		box.appendChild(tick);
		}
}

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(place,"div",null,cookie,null);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset",null);
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++)
		{
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("href","javascript:;");
		tab.onclick = this.onClickTab;
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
		}
	if(!validTab)
		config.options[cookie] = params[1];
	this.switchTab(tabset,config.options[cookie]);
}

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
}

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++)
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab)
			{
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
			}
		else
			nodes[t].className = "tab tabUnselected"
	if(theTab)
		{
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			tabset.parentNode.removeChild(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents",null);
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		wikify(store.getTiddlerText(theTab.getAttribute("content")),tabContent,null,null);
		if(cookie)
			{
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
			}
		}
}

// ---------------------------------------------------------------------------------
// Config and macro stuff
// ---------------------------------------------------------------------------------

// Merge a custom configuration over the top of the current configuration
// Returns a string error message or null if it went OK
function processConfig(customConfig)
{
	try
		{
		if(customConfig && customConfig != "")
			window.eval(customConfig);
		}
	catch(e)
		{
		return(e.toString());
		}
	return null;
}

// Render a macro
function insertMacro(place,macroName,macroParams)
{
	var params = macroParams.readMacroParams();
	try
		{
		var macro = config.macros[macroName];
		if(macro && macro.handler)
			macro.handler(place,macroName,params);
		else
			createTiddlyElement(place,"span",null,"errorNoSuchMacro","<<" + macroName + ">>");
		}
	catch(e)
		{
		displayMessage(config.messages.macroError.format([macroName]));
		displayMessage(e.toString());
		}
}

// ---------------------------------------------------------------------------------
// Tiddler() object
// ---------------------------------------------------------------------------------

function Tiddler()
{
	this.title = null;
	this.text = null;
	this.modifier = null;
	this.modified = new Date();
	this.links = [];
	this.tags = [];
	return this;
}

// Load a tiddler from an HTML DIV
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	var text = Tiddler.unescapeLineBreaks(divRef.firstChild ? divRef.firstChild.nodeValue : "");
	var modifier = divRef.getAttribute("modifier");
	var modified = Date.convertFromYYYYMMDDHHMM(divRef.getAttribute("modified"));
	var tags = divRef.getAttribute("tags");
	this.set(title,text,modifier,modified,tags);
	return this;
}

// Format the text for storage in an HTML DIV
Tiddler.prototype.saveToDiv = function()
{
	return '<div tiddler="' + this.title + '" modified="' +
							this.modified.convertToYYYYMMDDHHMM() + '" modifier="' + this.modifier +
							'" tags="' + this.getTags() + '">' +
							this.escapeLineBreaks().htmlEncode() + '</div>';
}

// Format the text for storage in an RSS item
Tiddler.prototype.saveToRss = function(url)
{
	var s = [];
	s.push("<item>");
	s.push("<title>" + this.title.htmlEncode() + "</title>");
	s.push("<description>" + this.text.replace(regexpNewLine,"<br />").htmlEncode() + "</description>");
	for(var t=0; t<this.tags.length; t++)
		s.push("<category>" + this.tags[t] + "</category>");
	s.push("<link>" + url + "#" + encodeURIComponent(String.encodeTiddlyLink(this.title)) + "</link>");
	s.push("<pubDate>" + this.modified.toGMTString() + "</pubDate>");
	s.push("</item>");
	return(s.join("\n"));
}

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else
		this.tags = [];
	this.changed();
	return this;
}

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	if(this.tags)
		{
		var results = [];
		for(var t=0; t<this.tags.length; t++)
			results.push(String.encodeTiddlyLink(this.tags[t]));
		return results.join(" ");
		}
	else
		return "";
}

var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");

// Static method to Convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	if(text && text != "")
		return text.replace(regexpBackSlashEn,"\n").replace(regexpBackSlashEss,"\\").replace(regexpCarriageReturn,"");
	else
		return "";
}

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.replace(regexpBackSlash,"\\s").replace(regexpNewLine,"\\n").replace(regexpCarriageReturn,"");
}

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var nextPos = 0;
	var theLink;
	do {
		var formatMatch = wikiNameRegExp.exec(this.text);
		if(formatMatch)
			{
			if(!formatMatch[1] && formatMatch[2] && formatMatch[2] != this.title)
				this.links.pushUnique(formatMatch[2]);
			else if(formatMatch[4] && store.tiddlers[formatMatch[5]] != undefined)
				this.links.pushUnique(formatMatch[5]);
			else if(formatMatch[6] && formatMatch[6] != this.title)
				this.links.pushUnique(formatMatch[6]);
			}
	} while(formatMatch);
	return;
}

Tiddler.prototype.getSubtitle = function()
{
	var theModifier = this.modifier;
	if(!theModifier)
		theModifier = config.messages.subtitleUnknown;
	var theModified = this.modified;
	if(theModified)
		theModified = theModified.toLocaleString();
	else
		theModified = config.messages.subtitleUnknown;
	return(theModifier + ", " + theModified);
}

// ---------------------------------------------------------------------------------
// TiddlyWiki() object contains Tiddler()s
// ---------------------------------------------------------------------------------

function TiddlyWiki()
{
	this.tiddlers = {}; // Hashmap by name of tiddlers
	this.namedNotifications = {}; // Hashmap by name of array of notification functions
	this.blanketNotifications = []; // Array of blanket notifications to be invoked on any change
	this.dirty = false;
}

// Set the dirty flag
TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
}

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	var notification = this.namedNotifications[title];
	if(notification)
		for(var t=0; t<notification.length; t++)
			notification[t](title);
	if(doBlanket)
		for(var n=0; n<this.blanketNotifications.length; n++)
			this.blanketNotifications[n](title);
}

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	var notifyTitle;
	for(notifyTitle in this.tiddlers)
		this.notify(notifyTitle,false);
	for(notifyTitle in config.shadowTiddlers)
		if(this.tiddlers[notifyTitle] == undefined)
			this.notify(notifyTitle,false);
	for(var n=0; n<this.blanketNotifications.length; n++)
		this.blanketNotifications[n]();
}

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	var notification;
	if(title)
		{
		notification = this.namedNotifications[title];
		if(!notification)
			{
			notification = [];
			this.namedNotifications[title] = notification;
			}
		}
	else
		notification = this.blanketNotifications;
	notification.push(fn);
	return this;
}

// Clear a TiddlyWiki so that it contains no tiddlers
TiddlyWiki.prototype.clear = function(src)
{
	this.tiddlers = {};
	this.dirty = false;
}

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.tiddlers[title];
	if(tiddler)
		{
		delete this.tiddlers[title];
		this.notify(title,true);
		this.dirty = true;
		}
}

TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return(defaultText);
	var tiddler = this.tiddlers[title];
	if(tiddler)
		return tiddler.text;
	else if(config.shadowTiddlers[title])
		return config.shadowTiddlers[title];
	else if(defaultText)
		return defaultText;
	else
		return null;
}

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,ignoreList)
{
	var childIgnoreList = ignoreList ? ignoreList : {};
	childIgnoreList[title] = true;
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,defaultText);
	if(text == null)
		return "";
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match)
			{
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1])
				{
				if(childIgnoreList[match[1]])
					textOut.push(match[1]);
				else
					{
					var subText = this.getRecursiveTiddlerText(match[1],match[1],childIgnoreList);
					textOut.push(subText);
					}
				}
			lastPos = match.index + match[1].length + 4;
			}
		else
			textOut.push(text.substr(lastPos));
	} while(match);
	delete childIgnoreList[title];
	return(textOut.join(""));
}

TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags)
{
	var tiddler = this.tiddlers[title];
	if(tiddler)
		delete this.tiddlers[title];
	else
		tiddler = new Tiddler();
	tiddler.set(newTitle,newBody,modifier,modified,tags);
	this.tiddlers[newTitle] = tiddler;
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.dirty = true;
	return tiddler;
}

TiddlyWiki.prototype.createTiddler = function(title)
{
	tiddler = this.tiddlers[title];
	if(!tiddler)
		{
		tiddler = new Tiddler();
		this.tiddlers[title] = tiddler;
		this.dirty = true;
		}
	return tiddler;
}

// Load contents of a tiddlywiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(srcID,idPrefix)
{
	if(document.normalize)
		document.normalize();
	var lenPrefix = idPrefix.length;
	var store = document.getElementById(srcID).childNodes;
	for(var t = 0; t < store.length; t++)
		{
		var e = store[t];
		var title = null;
		if(e.getAttribute)
			title = e.getAttribute("tiddler");
		if(!title && e.id && e.id.substr(0,lenPrefix) == idPrefix)
			title = e.id.substr(lenPrefix);
		if(title && title != "")
			{
			var tiddler = this.createTiddler(title);
			tiddler.loadFromDiv(e,title);
			}
		}
	this.dirty = false;
}

// Return an array of tiddlers matching a search string
TiddlyWiki.prototype.search = function(searchText,caseSensitive,useRegExp,sortField,excludeTag)
{
	if (!useRegExp)
		searchText = searchText.escapeRegExp();
	var regExp = new RegExp(searchText,caseSensitive ? "m" : "im");
	var candidates = this.reverseLookup("tags",excludeTag,false);
	var results = [];
	for(var t=0; t<candidates.length; t++)
		{
		if(regExp.test(candidates[t].title) || regExp.test(candidates[t].text))
			results.push(candidates[t]);
		}
	if(!sortField)
		sortField = "title";
	results.sort(function (a,b) {if(a[sortField] == b[sortField]) return(0); else return (a[sortField] < b[sortField]) ? -1 : +1; });
	return results;
}

// Return an array of all the tags in use. Each member of the array is another array where [0] is the name of the tag and [1] is the number of occurances
TiddlyWiki.prototype.getTags = function()
{
	var results = [];
	for(var t in this.tiddlers)
		{
		var tiddler = this.tiddlers[t];
		for(g=0; g<tiddler.tags.length; g++)
			{
			var tag = tiddler.tags[g];
			var f = false;
			for(var c=0; c<results.length; c++)
				if(results[c][0] == tag)
					{
					f = true;
					results[c][1]++;
					}
			if(!f)
				results.push([tag,1]);
			}
		}
	results.sort(function (a,b) {if(a[0] == b[0]) return(0); else return (a[0] < b[0]) ? -1 : +1; });
	return results;
}

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
}

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,exclude,sortField)
{
	return this.reverseLookup("links",title,true,sortField);
}

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	for(var t in this.tiddlers)
		{
		var tiddler = this.tiddlers[t];
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++)
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		if(f)
			results.push(tiddler);
		}
	if(!sortField)
		sortField = "title";
	results.sort(function (a,b) {if(a[sortField] == b[sortField]) return(0); else return (a[sortField] < b[sortField]) ? -1 : +1; });
	return results;
}

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field)
{
	var results = [];
	for(var t in this.tiddlers)
		results.push(this.tiddlers[t]);
	if(field)
		results.sort(function (a,b) {if(a[field] == b[field]) return(0); else return (a[field] < b[field]) ? -1 : +1; });
	return results;
}

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	var results = [];
	for(var t in this.tiddlers)
		{
		var tiddler = this.tiddlers[t];
		for(var n=0; n<tiddler.links.length;n++)
			{
			var link = tiddler.links[n];
			if(this.tiddlers[link] == null)
				results.pushUnique(link);
			}
		}
	results.sort();
	return results;
}

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	for(var t in this.tiddlers)
		if(this.getReferringTiddlers(t).length == 0)
			results.push(t);
	results.sort();
	return results;
}

// ---------------------------------------------------------------------------------
// Tiddler functions
// ---------------------------------------------------------------------------------

// Display several tiddlers from a list of space separated titles
function displayTiddlers(src,titles,state,highlightText,highlightCaseSensitive,animate,slowly)
{
	var tiddlerNames = titles.readBracketedList();
	for(var t = tiddlerNames.length-1;t>=0;t--)
		displayTiddler(src,tiddlerNames[t],state,highlightText,highlightCaseSensitive,animate,slowly);
}

// Display a tiddler with animation and scrolling, as though a link to it has been clicked on
//	src = source element object (eg link) for animation effects and positioning
//	title = title of tiddler to display
//	state = 0 is default or current state, 1 is read only and 2 is edittable
//	highlightText = text to highlight in the displayed tiddler
//	highlightCaseSensitive = flag for whether the highlight text is case sensitive
function displayTiddler(src,title,state,highlightText,highlightCaseSensitive,animate,slowly)
{
	var place = document.getElementById("tiddlerDisplay");
	var after = findContainingTiddler(src); // Which tiddler this one will be positioned after
	var before;
	if(after == null)
		before = place.firstChild;
	else if(after.nextSibling)
		before = after.nextSibling;
	else
		before = null;
	var theTiddler = createTiddler(place,before,title,state,highlightText,highlightCaseSensitive);
	if(src)
		{
		if(config.options.chkAnimate && (animate == undefined || animate == true))
			anim.startAnimating(new Zoomer(title,src,theTiddler,slowly),new Scroller(theTiddler,slowly));
		else
			window.scrollTo(0,ensureVisible(theTiddler));
		}
}

// Create a tiddler if it doesn't exist (with no fancy animating)
//	place = parent element
//	before = node before which to create/move the tiddler
//	title = title of tiddler to display
//	state = 0 is default or current state, 1 is read only and 2 is edittable
//	highlightText = text to highlight in the displayed tiddler
//	highlightCaseSensitive = flag for whether the highlight text is case sensitive
function createTiddler(place,before,title,state,highlightText,highlightCaseSensitive)
{
	var theTiddler = createTiddlerSkeleton(place,before,title);
	createTiddlerTitle(title,highlightText,highlightCaseSensitive);
	var theViewer = document.getElementById("viewer" + title);
	var theEditor = document.getElementById("editorWrapper" + title);
  // NOTE: added this
  unfoldTiddler(title);	
	switch(state)
		{
		case 0:
			if(!theViewer && !theEditor)
				{
				createTiddlerToolbar(title,false);
				createTiddlerViewer(title,highlightText,highlightCaseSensitive);
				createTiddlerFooter(title,false);
				}
			break;
		case 1: // Viewer
			if(theViewer)
				theViewer.parentNode.removeChild(theViewer);
			if(theEditor)
				theEditor.parentNode.removeChild(theEditor);
			createTiddlerToolbar(title,false);
			createTiddlerViewer(title,highlightText,highlightCaseSensitive);
			createTiddlerFooter(title,false);
			break;
		case 2: // Editor
			if(!theEditor)
      {
        var height = 0;
        if(theViewer)
        {
          height = theViewer.offsetHeight;
          theViewer.parentNode.removeChild(theViewer);
        }
				createTiddlerToolbar(title,true);
				createTiddlerEditor(title, height);
				createTiddlerFooter(title,true);
				}
			break;
		}
    // NOTE: ADDED THIS
    var theHandle = document.getElementById("title"+title); 
    Drag.init(theHandle, theTiddler, 0, 0, null, null);
    theTiddler.onDragStart = function(x,y,myElem) { myElem.fold = false; }
    theTiddler.onDrag = function(x,y,myElem) {
        myElem.fold = true;
        y = myElem.offsetTop;
        var next = myElem.nextSibling;
        var prev = myElem.previousSibling;
        if (next && y + myElem.offsetHeight > next.offsetTop + next.offsetHeight/2) { 
            myElem.parentNode.removeChild(myElem);
            next.parentNode.insertBefore(myElem, next.nextSibling);//elems[pos+1]);
            myElem.style["top"] = -next.offsetHeight/2+"px";
        refreshSidebar("SideBarOptions");
        }
        if (prev && y < prev.offsetTop + prev.offsetHeight/2) { 
            myElem.parentNode.removeChild(myElem);
            prev.parentNode.insertBefore(myElem, prev);
            myElem.style["top"] = prev.offsetHeight/2+"px";
        refreshSidebar("SideBarOptions");
        }
    };
    theTiddler.onDragEnd = function(x,y,myElem) {
      if( !myElem.fold )
      {
        if( myElem.folded )
          unfoldTiddler(myElem.id.substr(7));
        else
          foldTiddler(myElem.id.substr(7));
        myElem.folded = !myElem.folded;
      }
          
        myElem.style["top"] = "0px";
    }
  
    // NOTE: added this refresh
  refreshSidebar("SideBarOptions");
	return(theTiddler);
}

function refreshTiddler(title)
{
	var theViewer = document.getElementById("viewer" + title);
	if(theViewer)
		{
		theViewer.parentNode.removeChild(theViewer);
		createTiddlerViewer(title,null,null);
		}
}

function createTiddlerSkeleton(place,before,title)
{
	var theTiddler = document.getElementById("tiddler" + title);
	if(!theTiddler)
		{
		theTiddler = createTiddlyElement(null,"div","tiddler" + title,"tiddler",null);
		theTiddler.onmouseover = onMouseOverTiddler;
		theTiddler.onmouseout = onMouseOutTiddler;
		theTiddler.ondblclick = onDblClickTiddler;
		var theInnerTiddler = createTiddlyElement(theTiddler,"div",null,"unselectedTiddler",null);
		var theToolbar = createTiddlyElement(theInnerTiddler,"div","toolbar" + title,"toolbar", null);
		var theTitle = createTiddlyElement(theInnerTiddler,"a","title" + title,"title",null);
    //theTitle.onclick = onClickToolbarFold;
    //theTitle.setAttribute("href", "Javascript:;");
    // Setting this here avoids a weird safari bug.
    var tiddler = store.tiddlers[title];
		if(tiddler)
           theTitle.setAttribute("tag", tiddler.tags[0]);
    
    var theFooter = createTiddlyElement(theInnerTiddler,"div","footer" + title,"footer",null);
		var theBody = createTiddlyElement(theInnerTiddler,"div","body" + title,"body",null);
		place.insertBefore(theTiddler,before);
		}
	return(theTiddler);
}

function createTiddlerTitle(title,highlightText,highlightCaseSensitive)
{
	var theTitle = document.getElementById("title" + title);
	if(theTitle)
		{
		removeChildren(theTitle);
		if(highlightText == "")
			highlightText = null;
		var highlightRegExp,highlightMatch;
		if(highlightText)
			{
			highlightRegExp = new RegExp(highlightText,highlightCaseSensitive ? "mg" : "img");
			highlightMatch = highlightRegExp.exec(title);
			}
		highlightMatch = subWikify(theTitle,title,0,title.length,highlightRegExp,highlightMatch);
		var tiddler = store.tiddlers[title];
		if(tiddler)
        {
          //444 
          //var icon = document.createElement("div");
          //icon.setAttribute( "tag", tiddler.tags[0] );
          //icon.className = "siglet";
          //theTitle.appendChild(icon);
          
            //theTitle.setAttribute("tag",tiddler.tags[0]);
            theTitle.title = tiddler.getSubtitle();
            }
		}
}

// Create a tiddler toolbar according to whether it's an editor or not
function createTiddlerToolbar(title,isEditor)
{
	var theToolbar = document.getElementById("toolbar" + title);
	var lingo = config.views;
	if(theToolbar)
		{
		removeChildren(theToolbar);
		insertSpacer(theToolbar);
		if(isEditor)
			{
			// Editor toolbar
			lingo = lingo.editor;
			createTiddlyButton(theToolbar,lingo.toolbarDone.text,lingo.toolbarDone.tooltip,onClickToolbarSave);
			insertSpacer(theToolbar);
			createTiddlyButton(theToolbar,lingo.toolbarCancel.text,lingo.toolbarCancel.tooltip,onClickToolbarUndo);
			insertSpacer(theToolbar);
			createTiddlyButton(theToolbar,lingo.toolbarDelete.text,lingo.toolbarDelete.tooltip,onClickToolbarDelete);
			}
		else
			{
			// Viewer toolbar
			lingo = lingo.wikified;
			createTiddlyButton(theToolbar,lingo.toolbarClose.text,lingo.toolbarClose.tooltip,onClickToolbarClose);
      insertSpacer(theToolbar); 			
      createTiddlyButton(theToolbar,lingo.toolbarCloseOthers.text,lingo.toolbarCloseOthers.tooltip,onClickToolbarCloseOthers);
      
      //insertSpacer(theToolbar);
			//createTiddlyButton(theToolbar,lingo.toolbarEdit.text,lingo.toolbarEdit.tooltip,onClickToolbarEdit);
			insertSpacer(theToolbar);
			createTiddlyButton(theToolbar,lingo.toolbarPermalink.text,lingo.toolbarPermalink.tooltip,onClickToolbarPermaLink);
			//insertSpacer(theToolbar);
			//createTiddlyButton(theToolbar,lingo.toolbarReferences.text,lingo.toolbarReferences.tooltip,onClickToolbarReferences);
			}
		insertSpacer(theToolbar);
		}
}

function createTiddlerPopup(srcElement)
{
	var popup = document.getElementById("popup");
	if(popup && popup.nextSibling == srcElement)
		{
		hideTiddlerPopup();
		return null;
		}
	if(popup)
		popup.parentNode.removeChild(popup);
	popup = createTiddlyElement(null,"div","popup",null,null);
	popup.style.left = srcElement.offsetLeft + "px";
	popup.style.top = srcElement.offsetTop + srcElement.offsetHeight + "px";
	popup.style.display = "block";
	srcElement.onmouseout = onMouseOutTiddlerPopup;
	srcElement.appendChild(popup);
	return popup;
}

function scrollToTiddlerPopup(popup,slowly)
{
	if(config.options.chkAnimate)
		anim.startAnimating(new Scroller(popup,slowly));
	else
		window.scrollTo(0,ensureVisible(popup));
}

function onMouseOutTiddlerPopup(e)
{
	if (!e) var e = window.event;
	var related = (e.relatedTarget) ? e.relatedTarget : e.toElement;
	try
		{
		while (related != this && related && related.nodeName && related.nodeName.toLowerCase() != "body")
			related = related.parentNode;
		}
	catch(e)
		{
		related = null;
		}
	if(related != this)
		{
		this.onmouseout = null;
		hideTiddlerPopup();
		}
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

function hideTiddlerPopup()
{
	var popup = document.getElementById("popup");
	if(popup)
		popup.parentNode.removeChild(popup);
}

// Create the body section of a read-only tiddler
function createTiddlerViewer(title,highlightText,highlightCaseSensitive)
{
	var theBody = document.getElementById("body" + title);
	if(theBody)
		{
		var tiddler = store.tiddlers[title];
		var tiddlerText = store.getTiddlerText(title);
		var theViewer = createTiddlyElement(theBody,"div","viewer" + title,"viewer",null);
		if(tiddler)
			theViewer.setAttribute("tags",tiddler.tags.join(" "));
		if(tiddlerText == null)
			{
			tiddlerText = config.views.wikified.defaultText.format([title]);
			theViewer.style.fontStyle = "italic";
			}
		wikify(tiddlerText,theViewer,highlightText,highlightCaseSensitive);
		}
}

// Create the footer section of a tiddler
function createTiddlerFooter(title,isEditor)
{
	var theFooter = document.getElementById("footer" + title);
	var tiddler = store.tiddlers[title];
	if(theFooter && tiddler)
		{
		removeChildren(theFooter);
    // Remove this to unify FF and Safari. also fixes safari fold bug.
    //insertSpacer(theFooter);
		//if(isEditor)
		//	{
		//	}
		//else
    //  {
    //theFooter.setAttribute("tag",tiddler.tags[0]);
			var lingo = config.views.wikified.tag;
			var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
			var theTags = createTiddlyElement(theFooter,"div",null,"footerTags",prompt);
            theTags.className = "footerTags";
			for(var t=0; t<tiddler.tags.length; t++)
				{
				var theTag = createTagButton(theTags,tiddler.tags[t],tiddler.title);
				//insertSpacer(theTags);
				}
      
      var references = store.getReferringTiddlers(title);
			var theRefs = createTiddlyElement(theFooter,"div",null,"footerRefs",null);
            theRefs.className = "footerRefs";
		    for(var r=0; r<references.length; r++)
			    if(references[r].title != title)
				{
                createTiddlyLink(theRefs,references[r].title,true);
                //createTiddlyLink(theFooter,references[r].title,false);
		        }
			//}
		}
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler)
{
	var theTag = createTiddlyButton(place,tag,config.views.wikified.tag.tooltip.format([tag]),onClickTag);
	theTag.setAttribute("tag",tag);
	if(excludeTiddler)
		theTag.setAttribute("tiddler",excludeTiddler);
	return(theTag);
}

// Create the body section of an edittable tiddler
function createTiddlerEditor(title, height)
{
	var theBody = document.getElementById("body" + title);
	if(theBody)
		{
		var tiddlerText = store.getTiddlerText(title);
		var tiddlerExists = (tiddlerText != null);
		if(!tiddlerExists)
			tiddlerText = config.views.editor.defaultText.format([title]);
		var theEditor = createTiddlyElement(theBody,"div","editorWrapper" + title,"editor",null);
		theEditor.onkeypress = onEditKey;
		var theTitleBox = createTiddlyElement(theEditor,"input","editorTitle" + title,null,null);
		theTitleBox.setAttribute("type","text");
		theTitleBox.value = title;
		theTitleBox.setAttribute("size","40");
		var theTagsBox = createTiddlyElement(theEditor,"input","editorTags" + title,null,null);
		theTagsBox.setAttribute("type","text");
		var tiddler = store.tiddlers[title];
		theTagsBox.value = tiddler ? tiddler.getTags() : "";
		theTagsBox.setAttribute("size","40");
		var tagPrompt = createTiddlyElement(theEditor,"div",null,"editorFooter",config.views.editor.tagPrompt);
		insertSpacer(tagPrompt);
		var lingo = config.views.editor.tagChooser;
		var addTag = createTiddlyButton(tagPrompt,lingo.text,lingo.tooltip,onClickAddTag);
		addTag.setAttribute("tiddler",title);
		var theBodyBox = createTiddlyElement(theEditor,"textarea","editorBody" + title,null,null);
		theBodyBox.value = tiddlerText;
		//var rows = 10;
		//var lines = tiddlerText.match(regexpNewLine);
		//if(lines != null && lines.length > rows)
		//	rows = lines.length*1.4 + 5;
		//theBodyBox.setAttribute("rows",rows);
    if(height < 80)
      height = 80;
    theBodyBox.style.height = height;
    
    theBodyBox.focus();
		}
}

function saveTiddler(title)
{
	var titleBox = document.getElementById("editorTitle" + title);
	var newTitle = titleBox.value;
	if(store.tiddlers[newTitle])
		{
		if(newTitle != title && !confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
			{
			titleBox.focus();
			titleBox.select();
			return;
			}
		}
	var body = document.getElementById("editorBody" + title);
	var newBody = body.value;
	var newTags = document.getElementById("editorTags" + title).value;
	body.focus();
	body.blur();
	store.saveTiddler(title,newTitle,newBody,config.options.txtUserName,new Date(),newTags);
	displayTiddler(null,newTitle,1,null,null,null,false,false);
	// Close the old tiddler if this is a rename
	if(title != newTitle)
		{
		var oldTiddler = document.getElementById("tiddler" + title);
		var newTiddler = document.getElementById("tiddler" + newTitle);
		oldTiddler.parentNode.replaceChild(newTiddler,oldTiddler);
		}
	if(config.options.chkAutoSave)
		saveChanges();
  // NOTE: added this refresh
    refreshSidebar("SideBarOptions");
}

function selectTiddler(title)
{
	var e = document.getElementById("tiddler" + title);
	if(e != null)
		e.firstChild.className = "selectedTiddler";
}

function deselectTiddler(title)
{
	var e = document.getElementById("tiddler" + title);
	if(e != null)
		e.firstChild.className = "unselectedTiddler";
}

function deleteTiddler(title)
{
// NOTE: added this
  var areYouSure = confirm(
      "Are you sure you want to delete this tiddler?");
  if (areYouSure) {
	closeTiddler(title,false);
	store.removeTiddler(title);
	// Autosave
	if(config.options.chkAutoSave)
		saveChanges();
    }
  }

function closeTiddler(title,slowly)
{
	var tiddler = document.getElementById("tiddler" + title);
	if(tiddler != null)
		{
		scrubIds(tiddler);
		if(config.options.chkAnimate)
			anim.startAnimating(new Slider(tiddler,false,slowly,"all"));
		else
			tiddler.parentNode.removeChild(tiddler);
		}
    // NOTE: added this refresh
  refreshSidebar("SideBarOptions");
}

function scrubIds(e)
{
	if(e.id)
		e.id = null;
	var children = e.childNodes;
	for(var t=0; t<children.length; t++)
		{
		var c = children[t];
		if(c.id)
			c.id = null;
		}
}

function closeAllTiddlers()
{
	clearMessage();
	var place = document.getElementById("tiddlerDisplay");
	var tiddler = place.firstChild;
	var nextTiddler;
	while(tiddler)
		{
		nextTiddler = tiddler.nextSibling;
		if(tiddler.id)
			if(tiddler.id.substr(0,7) == "tiddler")
				{
				var title = tiddler.id.substr(7);
				if(!document.getElementById("editorWrapper" + title))
					place.removeChild(tiddler);
				}
		tiddler = nextTiddler;
		}
    // NOTE: added this refresh
  refreshSidebar("SideBarOptions");
}

// ---------------------------------------------------------------------------------
// Regular expression stuff
// ---------------------------------------------------------------------------------

var upperLetter = "[A-Z\u00c0-\u00de\u0150\u0170]";
var lowerLetter = "[a-z\u00df-\u00ff_0-9\\-\u0151\u0171]";
var anyLetter = "[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-\u0150\u0170\u0151\u0171]";
var anyDigit = "[0-9]";
var anyNumberChar = "[0-9\\.E]";
var wikiNamePattern = "(~?)((?:" + upperLetter + "+" + lowerLetter + "+" + upperLetter + anyLetter + "*)|(?:" + upperLetter + "{2,}" + lowerLetter + "+))";
var urlPattern = "((?:http|https|mailto|ftp):[^\\s'\"]+(?:/|\\b))";
var explicitLinkPattern = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
var bracketNamePattern = "\\[\\[([^\\]]+)\\]\\]";

var wikiNamePatterns;
var wikiNameRegExp;
var structurePatterns;
var stylePatterns;
var tableRegExp;
var tableRowColRegExp;
var invalidPreWikiNamePattern;

function setupRegexp()
{
	// Table rows pattern
	var rowPattern = "^\\|([^\\n]*\\|)([fhc]?)$";
	tableRegExp = new RegExp(rowPattern,"mg");
	// Table columns pattern
	var elementPattern = "(?:(?:BGCOLOR|bgcolor)\\(([^\\)]+)\\):)?" +
		"("+
		"("+explicitLinkPattern+")?"+
		"("+bracketNamePattern+")?" +
		"[^\\|]*"+
		")\\|";
	tableRowColRegExp = new RegExp(elementPattern,"g");
	// Link patterns
	wikiNamePatterns = "(?:" + wikiNamePattern +
		")|(?:" + urlPattern +
		")|(?:" + explicitLinkPattern +
		")|(?:" + bracketNamePattern +
		")";
	wikiNameRegExp = new RegExp(wikiNamePatterns,"mg");
	invalidPreWikiNamePattern = anyLetter;
	// Structural patterns
	var breakPattern = "\\n";
	var horizontalRulePattern = "^----$\\n?";
	var headerPattern = "^!{1,5}";
	var bulletListItemPattern = "^\\*+";
	var numberedListItemPattern = "^#+";
	var tablePattern = "(?:^\\|[^\\n]*$\\n?)+";
	var blockquotePattern = "(?:^>[^\\n]*$\\n?)+";
	var blockquotePattern2 = "^<<<\\n((?:^(?!<<<)[^\\n]*\\n)+)(^<<<$\\n?)";
	var imagePattern = "\\[[Ii][Mm][Gg]\\[(?:([^\\|]+)\\|)?([^\\[\\]\\|]+)\\]\\]";
	var verbatimPattern = "^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)";
	var macroPattern = "<<([^>\\s]+)(?:\\s*)([^>]*)>>";
	structurePatterns = "(" + breakPattern +
		")|(" + horizontalRulePattern +
		")|(" + headerPattern +
		")|(" + bulletListItemPattern +
		")|(" + numberedListItemPattern +
		")|(" + tablePattern +
		")|(" + blockquotePattern +
		")|(?:" + blockquotePattern2 +
		")|(?:" + imagePattern +
		")|(?:" + verbatimPattern +
		")|(?:" + macroPattern +
		")";
	// Style patterns
	var boldPattern = "''((?:[^']+(?:'[^'])?)+)''";
	var strikePattern = "==([^=]+)==";
	var underlinePattern = "__([^_]+)__";
	var italicPattern = "//([^/]+)//";
	var supPattern = "\\^\\^([^\\^]+)\\^\\^";
	var subPattern = "~~([^~]+)~~";
	var monoPattern = "\\{\\{\\{(.*?)\\}\\}\\}";
	var colorPattern = "@@(?:color\\(([^\\)]+)\\):|bgcolor\\(([^\\)]+)\\):){0,2}([^@]+)@@";
	stylePatterns = "(?:" + boldPattern +
		")|(?:" + strikePattern +
		")|(?:" + underlinePattern +
		")|(?:" + italicPattern +
		")|(?:" + supPattern +
		")|(?:" + subPattern +
		")|(?:" + colorPattern +
		")|(?:" + monoPattern +
		")";
}

// Create child text nodes and link elements to represent a wiki-fied version of some text
function wikify(text,parent,highlightText,highlightCaseSensitive)
{
	// Prepare the regexp for the highlighted selection
	if(highlightText == "")
		highlightText = null;
	var highlightRegExp,highlightMatch;
	if(highlightText)
		{
		highlightRegExp = new RegExp(highlightText,highlightCaseSensitive ? "mg" : "img");
		highlightMatch = highlightRegExp.exec(text);
		}
	wikifyStructures(parent,text,text,0,text.length,highlightRegExp,highlightMatch);
}


function wikifyStructures(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
	var body = parent;
	var structureRegExp = new RegExp(structurePatterns,"mg");
	var theList = []; // theList[0]: don't use
	var isInListMode = false;
	var isInHeaderMode = false;
	var isNewline = false;
	// The start of the fragment of the text being considered
	var nextPos = 0;
	// Loop through the bits of the body text
	do {
		// Get the next formatting match
		var formatMatch = structureRegExp.exec(targetText);
		var matchPos = formatMatch ? formatMatch.index : targetText.length;
		// Subwikify the plain text before the match
		if(nextPos < matchPos)
			{
			isNewline = false;
			highlightMatch = wikifyStyles(body,text,targetText.substring(nextPos,matchPos),startPos+nextPos,startPos+matchPos,highlightRegExp,highlightMatch);
			}
		// Dump out the formatted match
		var level;
		var theBlockquote;
		if(formatMatch)
			{
			// Dump out the link itself in the appropriate format
			if(formatMatch[1])
				{
				if(isNewline && isInListMode)
					{
					theList = [];
					body = parent;
					isInListMode = false;
					}
				else if(isInHeaderMode)
					{
					body = parent;
					isInHeaderMode = false;
					}
				else
					{
					isNewline = true;
					body.appendChild(document.createElement("br"));
					}
				}
			else if(formatMatch[2])
				{
				isNewline = false;
				body.appendChild(document.createElement("hr"));
				}
			else if(formatMatch[3])
				{
				level = formatMatch[3].length;
				isNewline = false;
				isInHeaderMode = true;
				var theHeader = document.createElement("h" + level);
				parent.appendChild(theHeader);
				body = theHeader;
				}
			else if(formatMatch[4])
				{
				level = formatMatch[4].length;
				isNewline = false;
				isInListMode = true;
				if (theList[level] == null)
					{
					theList[level] = document.createElement("ul");
					body.appendChild(theList[level]);
					}
				theList = theList.slice(0,level + 1);
				body = document.createElement("li");
				theList[level].appendChild(body);
				}
			else if(formatMatch[5])
				{
				level = formatMatch[5].length;
				isNewline = false;
				isInListMode = true;
				if (theList[level] == null)
					{
					theList[level] = document.createElement("ol");
					body.appendChild(theList[level]);
					}
				theList = theList.slice(0,level + 1);
				body = document.createElement("li");
				theList[level].appendChild(body);
				}
			else if(formatMatch[6])
				{
				isNewline = false;
				highlightMatch = wikifyTable(body,text,formatMatch[6],startPos+matchPos,startPos+structureRegExp.lastIndex,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[7])
				{
				isNewline = false;
				var quotedText = formatMatch[7].replace(new RegExp("^>(>*)","mg"),"$1");
				theBlockquote = document.createElement("blockquote");
				var newHighlightRegExp,newHighlightMatch;
				if (highlightRegExp) {
					newHighlightRegExp = new RegExp(highlightRegExp.toString(), "img");
					newHighlightMatch = newHighlightRegExp.exec(quotedText);
				}
				wikifyStructures(theBlockquote,quotedText,quotedText,0,quotedText.length,newHighlightRegExp,newHighlightMatch);
				body.appendChild(theBlockquote);
				}
			else if(formatMatch[8])
				{
				isNewline = false;
				theBlockquote = document.createElement("blockquote");
				highlightMatch = wikifyStructures(theBlockquote,text,formatMatch[8],startPos+matchPos+4,startPos+structureRegExp.lastIndex-formatMatch[9].length,highlightRegExp,highlightMatch);
				body.appendChild(theBlockquote);
				}
			else if(formatMatch[11])
				{
				isNewline = false;
				var theImage = document.createElement("img");
				theImage.alt = formatMatch[10];
				theImage.src = formatMatch[11];
				body.appendChild(theImage);
				}
			else if(formatMatch[12])
				{
				isNewline = false;
				var theVerbatim = document.createElement("pre");
				theVerbatim.appendChild(document.createTextNode(text.substr(startPos+matchPos+4,startPos+structureRegExp.lastIndex-formatMatch[13].length-startPos-matchPos-4)));
				body.appendChild(theVerbatim);
				}
			else if(formatMatch[14])
				{
				isNewline = false;
				insertMacro(body,formatMatch[14],formatMatch[15]);
				}
			}
		// Move the next position past the formatting match
		nextPos = structureRegExp.lastIndex;
	} while(formatMatch);
	return highlightMatch;
}

function wikifyLinks(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
	// The start of the fragment of the text being considered
	var nextPos = 0;
	// Loop through the bits of the body text
	var theLink;
	do {
		// Get the next formatting match
		var formatMatch = wikiNameRegExp.exec(targetText);
		var matchPos = formatMatch ? formatMatch.index : targetText.length;
		// Subwikify the plain text before the match
		if(nextPos < matchPos)
			highlightMatch = subWikify(parent,text,startPos+nextPos,startPos+matchPos,highlightRegExp,highlightMatch);
		// Dump out the formatted match
		if(formatMatch)
			{
			// Dump out the link itself in the appropriate format
			if(formatMatch[2])
				{
				if(formatMatch[1])
					{
					theLink = parent;
					matchPos++;
					}
				else if(matchPos > 0 && new RegExp(invalidPreWikiNamePattern,"").exec(targetText.charAt(matchPos - 1)))
					theLink = parent;
				else
					theLink = createTiddlyLink(parent,formatMatch[2],false);
				highlightMatch = subWikify(theLink,text,startPos+matchPos,startPos+wikiNameRegExp.lastIndex,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[3])
				{
				theLink = createExternalLink(parent,formatMatch[3]);
				highlightMatch = subWikify(theLink,text,startPos+matchPos,startPos+wikiNameRegExp.lastIndex,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[4])
				{
				if(store.tiddlers[formatMatch[5]] != undefined)
					theLink = createTiddlyLink(parent,formatMatch[5],false);
				else
					theLink = createExternalLink(parent,formatMatch[5]);
				highlightMatch = subWikify(theLink,text,startPos+matchPos+2,startPos+matchPos+2+formatMatch[4].length,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[6])
				{
				theLink = createTiddlyLink(parent,formatMatch[6],false);
				highlightMatch = subWikify(theLink,text,startPos+matchPos+2,startPos+wikiNameRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			}
		// Move the next position past the formatting match
		nextPos = wikiNameRegExp.lastIndex;
	} while(formatMatch);
	return highlightMatch;
}

function wikifyStyles(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
	var formatRegExp = new RegExp(stylePatterns,"mg");
	// The start of the fragment of the text being considered
	var nextPos = 0;
	// Loop through the bits of the body text
	do {
		// Get the next formatting match
		var formatMatch = formatRegExp.exec(targetText);
		var matchPos = formatMatch ? formatMatch.index : targetText.length;
		// Subwikify the plain text before the match
		if(nextPos < matchPos)
			highlightMatch = wikifyLinks(parent,text,targetText.substring(nextPos,matchPos),startPos+nextPos,startPos+matchPos,highlightRegExp,highlightMatch);
		// Dump out the formatted match
		if(formatMatch)
			{
			// Dump out the link itself in the appropriate format
			if(formatMatch[1])
				{
				var theBold = createTiddlyElement(parent,"b",null,null,null);
				highlightMatch = wikifyStyles(theBold,text,formatMatch[1],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[2])
				{
				var theStrike = createTiddlyElement(parent,"strike",null,null,null);
				highlightMatch = wikifyStyles(theStrike,text,formatMatch[2],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[3])
				{
				var theUnderline = createTiddlyElement(parent,"u",null,null,null);
				highlightMatch = wikifyStyles(theUnderline,text,formatMatch[3],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[4])
				{
				var theItalic = createTiddlyElement(parent,"i",null,null,null);
				highlightMatch = wikifyStyles(theItalic,text,formatMatch[4],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[5])
				{
				var theSup = createTiddlyElement(parent,"sup",null,null,null);
				highlightMatch = wikifyStyles(theSup,text,formatMatch[5],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[6])
				{
				var theSub = createTiddlyElement(parent,"sub",null,null,null);
				highlightMatch = wikifyStyles(theSub,text,formatMatch[6],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[9])
				{
				var theSpan;
				if ((formatMatch[7] == "" || formatMatch[7] == null) && (formatMatch[8] == "" || formatMatch[8] == null))
					{
					theSpan = createTiddlyElement(parent,"span",null,"marked",null);
					}
					else
					{
					theSpan = createTiddlyElement(parent,"span",null,null,null);
					if (formatMatch[7] != "") theSpan.style.color = formatMatch[7];
					if (formatMatch[8] != "") theSpan.style.background = formatMatch[8];
					}
				highlightMatch = wikifyStyles(theSpan,text,formatMatch[9],startPos+formatRegExp.lastIndex-2-formatMatch[9].length,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[10])
				{
				var theCode = createTiddlyElement(parent,"code",null,null,null);
				highlightMatch = wikifyStyles(theCode,text,formatMatch[10],startPos+matchPos+3,startPos+formatRegExp.lastIndex-3,highlightRegExp,highlightMatch);
				}
			}
		// Move the next position past the formatting match
		nextPos = formatRegExp.lastIndex;
	} while(formatMatch);
	return highlightMatch;
}

// Create a table
function wikifyTable(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
	// The start of the fragment of the text being considered
	var nextPos = 0;
	var theTable = document.createElement("table");
	var bodyRowLen = 0;
	var headRowLen = 0;
	var footRowLen = 0;
	var bodyRows = [];
	var headRows = [];
	var footRows = [];
	var theCaption = null;
	// Loop through the bits of the body text
	do {
		// Get the next formatting match
		var formatMatch = tableRegExp.exec(targetText);
		var matchPos = formatMatch ? formatMatch.index : targetText.length;
		// Dump out the formatted match
		if(formatMatch) {
			if (formatMatch[2] == "c") {
				var cap = formatMatch[1].substring(0,formatMatch[1].length-1);
				theCaption = document.createElement("caption");
				highlightMatch = wikifyStyles(theCaption,text,cap,startPos+matchPos+1,startPos+cap.length,highlightRegExp,highlightMatch);
				if (bodyRowLen == 0 && headRowLen == 0 && footRowLen == 0) {
					theCaption.setAttribute("align", "top");
				} else {
					theCaption.setAttribute("align", "bottom");
				}
			} else if (formatMatch[2] == "h") {
				highlightMatch = wikifyTableRow(headRows,headRowLen,text,formatMatch[1],startPos+matchPos,startPos+matchPos+formatMatch[1].length,highlightRegExp,highlightMatch);
				headRowLen++;
			} else if (formatMatch[2] == "f") {
				highlightMatch = wikifyTableRow(footRows,footRowLen,text,formatMatch[1],startPos+matchPos,startPos+matchPos+formatMatch[1].length,highlightRegExp,highlightMatch);
				footRowLen++;
			} else {
				highlightMatch = wikifyTableRow(bodyRows,bodyRowLen,text,formatMatch[1],startPos+matchPos,startPos+matchPos+formatMatch[1].length,highlightRegExp,highlightMatch);
				bodyRowLen++;
			}
		}
		nextPos = tableRegExp.lastIndex;
	} while(formatMatch);

	if (theCaption != null) {
		theTable.appendChild(theCaption);
	}

	if (headRowLen > 0) {
		var theTableHead = document.createElement("thead");
		createTableRows(headRows,theTableHead);
		theTable.appendChild(theTableHead);
	}

	if (bodyRowLen > 0) {
		var theTableBody = document.createElement("tbody");
		createTableRows(bodyRows,theTableBody);
		theTable.appendChild(theTableBody);
	}

	if (footRowLen > 0) {
		var theTableFoot = document.createElement("tfoot");
		createTableRows(footRows,theTableFoot);
		theTable.appendChild(theTableFoot);
	}

	parent.appendChild(theTable);
	return highlightMatch;
}

function wikifyTableRow(rows,rowIndex,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
	// The start of the fragment of the text being considered
	var eIndex = 0;
	var elements = [];
	// Loop through the bits of the body text
	do {
		// Get the next formatting match
		var formatMatch = tableRowColRegExp.exec(targetText);
		var matchPos = formatMatch ? formatMatch.index : targetText.length;
		if(formatMatch) {
			var eText = formatMatch[2];
			if (eText == "~" || eText == ">") {
				elements[eIndex] = eText;
			} else {
				var eTextLen = eText.length;
				var align = "";
				if (eTextLen >= 1 && eText.charAt(0) == " ") {
					if (eTextLen >= 3 && eText.charAt(eTextLen - 1) == " ") {
						align = "center";
						eText = eText.substring(1,eTextLen - 1);
						//eTextLen -= 2;
						eTextLen--;
					} else {
						align = "right";
						eText = eText.substring(1);
						eTextLen--;
					}
				} else if (eTextLen >= 2 && eText.charAt(eTextLen - 1) == " ") {
					align = "left";
					eText = eText.substring(0,eTextLen - 1);
					//eTextLen--;
				}
				var theElement;
				if (eTextLen >= 1 && eText.charAt(0) == "!") {
					theElement = document.createElement("th");
					eText = eText.substring(1);
					eTextLen--;
				} else {
					theElement = document.createElement("td");
				}
				if (align != "") {
					theElement.align = align;
				}
				if (formatMatch[1]) {
					theElement.style.background = formatMatch[1];
				}
				highlightMatch = wikifyStyles(theElement,text,eText,startPos+tableRowColRegExp.lastIndex-eTextLen,startPos+tableRowColRegExp.lastIndex-1,highlightRegExp,highlightMatch);
				elements[eIndex] = theElement;
			}
			eIndex++;
		}
	} while(formatMatch);
	rows[rowIndex] = elements;
	return highlightMatch;
}

function createTableRows(rows,parent)
{
	var i, j, k, cols;
	for (i = 0; i < rows.length; i++) {
		cols = rows[i];
		var theRow = document.createElement("tr");
		for (j = 0; j < cols.length; j++) {
			if (cols[j] == "~") continue;
			var rowspan = 1;
			for (k = i+1; k < rows.length; k++) {
				if (rows[k][j] != "~") break;
				rowspan++;
			}
			var colspan = 1;
			for (; j < cols.length - 1; j++) {
				if (cols[j] != ">") break;
				colspan++;
			}
			var theElement = cols[j];
			if (rowspan > 1) {
				theElement.setAttribute("rowSpan",rowspan);
				theElement.setAttribute("rowspan",rowspan);
				theElement.valign = "center";
			}
			if (colspan > 1) {
				theElement.setAttribute("colSpan",colspan);
				theElement.setAttribute("colspan",colspan);
			}
			theRow.appendChild(theElement);
		}
		parent.appendChild(theRow);
	}
}

// Helper for wikify that handles highlights within runs of text
function subWikify(parent,text,startPos,endPos,highlightRegExp,highlightMatch)
{
	// Check for highlights
	while(highlightMatch && (highlightRegExp.lastIndex > startPos) && (highlightMatch.index < endPos) && (startPos < endPos))
		{
		// Deal with the plain text before the highlight
		if(highlightMatch.index > startPos)
			{
			parent.appendChild(document.createTextNode(text.substring(startPos,highlightMatch.index)));
			startPos = highlightMatch.index;
			}
		// Deal with the highlight
		var highlightEnd = Math.min(highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(parent,"span",null,"highlight",text.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		// Nudge along to the next highlight if we're done with this one
		if(startPos >= highlightRegExp.lastIndex)
			highlightMatch = highlightRegExp.exec(text);
		}
	// Do the unhighlighted text left over
	if(startPos < endPos)
		{
		parent.appendChild(document.createTextNode(text.substring(startPos,endPos)));
		//startPos = endPos;
		}
	return(highlightMatch);
}

// ---------------------------------------------------------------------------------
// Message area
// ---------------------------------------------------------------------------------

function displayMessage(text,linkText)
{
	var msgArea = document.getElementById("messageArea");
	var msg;
	if(linkText)
		{
		msg = createTiddlyElement(msgArea,"div",null,null,null);
		var link = createTiddlyElement(msg,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
		}
	else
		msg = createTiddlyElement(msgArea,"div",null,null,text);
	msgArea.style.display = "block";
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	removeChildren(msgArea);
	msgArea.style.display = "none";
}

// ---------------------------------------------------------------------------------
// Menu and sidebar functions
// ---------------------------------------------------------------------------------

function refreshStory(hint)
{
	var hits = hint ? store.getReferringTiddlers(hint) : null;
	var displayNodes = document.getElementById("tiddlerDisplay").childNodes;
	for(var t=0;t<displayNodes.length;t++)
		{
		var theId = displayNodes[t].id;
		if(theId && theId.substr(0,7) == "tiddler")
			{
			var title = theId.substr(7);
			if(hint)
				{
				var f = false;
				for(var h=0; h<hits.length; h++)
					if(hits[h].title == title)
						f = true
				if(f)
					refreshTiddler(title);
				}
			else
				refreshTiddler(title);
			}
		}
}

function refreshTabs(hint)
{
	refreshSpecialItem("sidebarTabs","SideBarTabs","SideBarTabs");
}

function refreshMenu(title)
{
	refreshSpecialItem("mainMenu",title,"MainMenu");
}

function refreshTitle(title)
{
	refreshSpecialItem("siteTitle",title,"SiteTitle");
	refreshPageTitle();
}

function refreshSubtitle(title)
{
	refreshSpecialItem("siteSubtitle",title,"SiteSubtitle");
	refreshPageTitle();
}

function refreshPageTitle()
{
  // NOTE: ignore subtitle for page title
	document.title = getElementText("siteTitle");// + " - " + getElementText("siteSubtitle");
}

function refreshSidebar(title)
{
	refreshSpecialItem("sidebarOptions",title,"SideBarOptions");
}

function refreshSpecialItem(elementID,title,defaultText)
{
	var place = document.getElementById(elementID);
	removeChildren(place);
	wikify(store.getTiddlerText(title,defaultText),place,null,null);
}

function refreshStyles(title)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,""));
}

// ---------------------------------------------------------------------------------
// Options cookie stuff
// ---------------------------------------------------------------------------------

function loadOptionsCookie()
{
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++)
		{
		var p = cookies[c].indexOf("=");
		if(p != -1)
			{
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			switch(name.substr(0,3))
				{
				case "txt":
					config.options[name] = unescape(value);
					break;
				case "chk":
					config.options[name] = value == "true";
					break;
				}
			}
		}
}

function saveOptionCookie(name)
{
	var c = name + "=";
	switch(name.substr(0,3))
		{
		case "txt":
			c += escape(config.options[name].toString());
			break;
		case "chk":
			c += config.options[name] ? "true" : "false";
			break;
		}
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

// ---------------------------------------------------------------------------------
// Saving
// ---------------------------------------------------------------------------------

var saveUsingSafari = false;
var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// Check if there any unsaved changes before exitting
function checkUnsavedChanges()
{
	if(store.dirty)
		{
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
		}
}

// Save this tiddlywiki with the pending changes
function saveChanges()
{
	clearMessage();
	// Get the URL of the document
	var originalPath = document.location.toString();
	// Check we were loaded from a file URL
	if(originalPath.substr(0,5) != "file:")
		{
		alert(config.messages.notFileUrlError);
		displayTiddler(null,"SaveChanges",0,null,null,false,false);
		return;
		}
	// Remove any location part of the URL
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert to a native file format assuming
	// "file:///web.archive.org/web/20071203063511/http://x/path/path/path..." - pc local file --> "x:\path\path\path..."
	// "file://///server/share/path/path/path..." - FireFox pc network file --> "\\server\share\path\path\path..."
	// "file:///web.archive.org/web/20071203063511/http://path/path/path..." - mac/unix local file --> "/path/path/path..."
	// "file://server/share/path/path/path..." - pc network file --> "\\server\share\path\path\path..."
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	// Load the original file
	var original = loadFile(localPath);
	if(original == null)
		{
		alert(config.messages.cantSaveError);
		displayTiddler(null,"SaveChanges",0,null,null,false,false);
		return;
		}
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var posClosingDiv = original.lastIndexOf(endSaveArea);
	if((posOpeningDiv == -1) || (posClosingDiv == -1))
		{
		alert(config.messages.invalidFileError.format([localPath]));
		return;
		}
	// Save the backup
	if(config.options.chkSaveBackups)
		{
		var backupPath = localPath.substr(0,localPath.lastIndexOf(".")) + "." + (new Date()).convertToYYYYMMDDHHMMSSMMM() + ".html";
		var backup = saveFile(backupPath,original);
		if(backup)
			displayMessage(config.messages.backupSaved,"file://" + backupPath);
		else
			alert(config.messages.backupFailed);
		}
	// Save Rss
	if(config.options.chkGenerateAnRssFeed)
		{
		var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
		var rssSave = saveFile(rssPath,convertUnicodeToUTF8(generateRss()));
		if(rssSave)
			displayMessage(config.messages.rssSaved,"file://" + rssPath);
		else
			alert(config.messages.rssFailed);
		}
	// Save empty template
	if(config.options.chkSaveEmptyTemplate)
		{
		var emptyPath,p;
		if((p = localPath.lastIndexOf("/")) != -1)
			emptyPath = localPath.substr(0,p) + "/empty.html";
		else if((p = localPath.lastIndexOf("\\")) != -1)
			emptyPath = localPath.substr(0,p) + "\\empty.html";
		else
			emptyPath = localPath + ".empty.html";
		var empty = original.substr(0,posOpeningDiv + startSaveArea.length) + convertUnicodeToUTF8(generateEmpty()) + original.substr(posClosingDiv);
		var emptySave = saveFile(emptyPath,empty);
		if(emptySave)
			displayMessage(config.messages.emptySaved,"file://" + emptyPath);
		else
			alert(config.messages.emptyFailed);
		}
	// Save new file
	var revised = original.substr(0,posOpeningDiv + startSaveArea.length) + 
				convertUnicodeToUTF8(allTiddlersAsHtml()) + "\n\t\t" +
				original.substr(posClosingDiv);
	var save = saveFile(localPath,revised);
	if(save)
		{
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
		}
	else
		alert(config.messages.mainFailed);
}

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl",null);
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title>" + store.getTiddlerText("SiteTitle","").htmlEncode() + "</title>");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + store.getTiddlerText("SiteSubtitle","").htmlEncode() + "</description>");
	s.push("<language>en-us</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified");
	var n = config.numRssItems > tiddlers.length ? tiddlers.length : tiddlers.length-config.numRssItems;
	for (var t=tiddlers.length-1; t>=n; t--)
		s.push(tiddlers[t].saveToRss(u));
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

function generateEmpty()
{
	var systemTiddlers = store.getTaggedTiddlers("systemTiddlers");
	var savedTiddlers = [];
	for(var s=0;s<systemTiddlers.length;s++)
		savedTiddlers.push(systemTiddlers[s].saveToDiv());
	return savedTiddlers.join("\n");
}

function allTiddlersAsHtml()
{
	var savedTiddlers = [];
	var tiddlers = store.getTiddlers("modified");
	for (var t = 0; t < tiddlers.length; t++)
		savedTiddlers.push(tiddlers[t].saveToDiv());
	return savedTiddlers.join("\n");
}

// UTF-8 encoding rules:
// 0x0000 - 0x007F:	0xxxxxxx
// 0x0080 - 0x07FF:	110xxxxx 10xxxxxx
// 0x0800 - 0xFFFF:	1110xxxx 10xxxxxx 10xxxxxx

function convertUTF8ToUnicode(u)
{
	var s = "";
	var t = 0;
	var b1, b2, b3;
	while(t < u.length)
		{
		b1 = u.charCodeAt(t++);
		if(b1 < 0x80)
			s += String.fromCharCode(b1);
		else if(b1 < 0xE0)
			{
			b2 = u.charCodeAt(t++);
			s += String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			}
		else
			{
			b2 = u.charCodeAt(t++);
			b3 = u.charCodeAt(t++);
			s += String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			}
	}
	return(s);
}

function convertUnicodeToUTF8(s)
{
	if(saveUsingSafari)
		return s;
	else if(window.Components)
		return mozConvertUnicodeToUTF8(s);
	else
		return manualConvertUnicodeToUTF8(s);
}

function manualConvertUnicodeToUTF8(s)
{
	var u = [];
	for(var t=0;t<s.length;t++)
		{
		var c = s.charCodeAt(t);
		if(c <= 0x7F)
			u.push(String.fromCharCode(c));
		else
			u.push("&#" + c.toString() + ";");
		}
	return(u.join(""));
}

function mozConvertUnicodeToUTF8(s)
{
	netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
	var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
	converter.charset = "UTF-8";
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	if(fin.length > 0)
		return u + fin;
	else
		return u;
}

function saveFile(fileUrl, content)
{
	var r = null;
	if(saveUsingSafari)
		r = safariSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = mozillaSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = ieSaveFile(fileUrl, content);
	return(r);
}

function loadFile(fileUrl)
{
	var r = null;
	if(saveUsingSafari)
		r = safariLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	return(r);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath, content)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		}
	catch(e)
		{
		//alert("Exception while attempting to save\n\n" + e.toString());
		return(null);
		}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return(true);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		}
	catch(e)
		{
		//alert("Exception while attempting to load\n\n" + e.toString());
		return(null);
		}
	var file = fso.OpenTextFile(filePath,1);
	var content = file.ReadAll();
	file.Close();
	return(content);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath, content)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				file.create(0, 0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file, 0x20 | 0x02, 00004,null);
			out.write(content, content.length);
			out.flush();
			out.close();
			return(true);
			}
		catch(e)
			{
			//alert("Exception while attempting to save\n\n" + e);
			return(false);
			}
	return(null);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				return(null);
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file, 0x01, 00004, null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			return(sInputStream.read(sInputStream.available()));
			}
		catch(e)
			{
			//alert("Exception while attempting to load\n\n" + e);
			return(false);
			}
	return(null);
}

function safariFilenameToUrl(filename) {
	return ("file://" + filename);
}

function safariLoadFile(url)
{
	url = safariFilenameToUrl(url);
	var plugin = document.embeds["tiddlyWikiSafariSaver"];
	return plugin.readURL(url);
}

function safariSaveFile(url,content)
{
	url = safariFilenameToUrl(url);
	var plugin = document.embeds["tiddlyWikiSafariSaver"];
	return plugin.writeStringToURL(content,url);
}

// Lifted from http://developer.apple.com/internet/webcontent/detectplugins.html
function detectPlugin()
{
	var daPlugins = detectPlugin.arguments;
	var pluginFound = false;
	if (navigator.plugins && navigator.plugins.length > 0)
		{
		var pluginsArrayLength = navigator.plugins.length;
		for (pluginsArrayCounter=0; pluginsArrayCounter < pluginsArrayLength; pluginsArrayCounter++ )
			{
			var numFound = 0;
			for(namesCounter=0; namesCounter < daPlugins.length; namesCounter++)
				{
				if( (navigator.plugins[pluginsArrayCounter].name.indexOf(daPlugins[namesCounter]) >= 0) || 
						(navigator.plugins[pluginsArrayCounter].description.indexOf(daPlugins[namesCounter]) >= 0) )
					numFound++;
				}
			if(numFound == daPlugins.length)
				{
				pluginFound = true;
				break;
				}
			}
	}
	return pluginFound;
} // detectPlugin

// ---------------------------------------------------------------------------------
// Event handlers
// ---------------------------------------------------------------------------------

function onEditKey(e)
{
	if (!e) var e = window.event;
	clearMessage();
	var consume = false;
	switch(e.keyCode)
		{
      // NOTE: switched these
      case 27: // Escape
			if(this.id && this.id.substr(0,13) == "editorWrapper")
				{
				saveTiddler(this.id.substr(13));
				consume = true;
				}
			break;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
		case 77: // Ctrl-Enter is "M" on some platforms
			if(e.ctrlKey && this.id && this.id.substr(0,13) == "editorWrapper")
				{
				displayTiddler(null,this.id.substr(13),1,null,null,false,false);
				consume = true;
				}
			break;
		}
	e.cancelBubble = consume;
	if(consume)
		if (e.stopPropagation) e.stopPropagation();
	return(!consume);

}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var theLink = theTarget;
	var title = null;
	do {
		title = theLink.getAttribute("tiddlyLink");
		theLink = theLink.parentNode;
	} while(title == null && theLink != null);
	if(title)
		{
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		var opening;
		if(toggling && document.getElementById("tiddler" + title))
			closeTiddler(title,e.shiftKey || e.altKey);
		else
			displayTiddler(theTarget,title,0,null,null,true,e.shiftKey || e.altKey);
		}
	clearMessage();
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for mouse over a tiddler
function onMouseOverTiddler(e)
{
	var tiddler;
	if(this.id.substr(0,7) == "tiddler")
		tiddler = this.id.substr(7);
	if(tiddler)
		selectTiddler(tiddler);
}

// Event handler for mouse out of a tiddler
function onMouseOutTiddler(e)
{
	var tiddler;
	if(this.id.substr(0,7) == "tiddler")
		tiddler = this.id.substr(7);
	if(tiddler)
		deselectTiddler(tiddler);
}

// Event handler for double click on a tiddler
function onDblClickTiddler(e)
{
	clearMessage();
	if(document.selection)
		document.selection.empty();
	var tiddler;
	if(this.id.substr(0,7) == "tiddler")
		tiddler = this.id.substr(7);
	if(tiddler)
		displayTiddler(null,tiddler,2,null,null,false,false);
}

// Event handler for clicking on toolbar close
function onClickToolbarClose(e)
{
	if (!e) var e = window.event;
	clearMessage();
	if(this.parentNode.id)
		closeTiddler(this.parentNode.id.substr(7),e.shiftKey || e.altKey);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for clicking on toolbar permalink
function onClickToolbarPermaLink(e)
{
	if(this.parentNode.id)
		{
		var title = this.parentNode.id.substr(7);
		var t = encodeURIComponent(String.encodeTiddlyLink(title));
		if(window.location.hash != t)
			window.location.hash = t;
		}
}

// Event handler for clicking on toolbar close
function onClickToolbarDelete(e)
{
	clearMessage();
	if(this.parentNode.id)
		deleteTiddler(this.parentNode.id.substr(7));
}

// Event handler for clicking on the toolbar references button
function onClickToolbarReferences(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = createTiddlerPopup(this);
	if(popup && this.parentNode.id)
		{
		var title = this.parentNode.id.substr(7);
		var references = store.getReferringTiddlers(title);
		var c = false;
		for(var r=0; r<references.length; r++)
			if(references[r].title != title)
				{
				createTiddlyLink(popup,references[r].title,true);
				c = true;
				}
		if(!c)
			popup.appendChild(document.createTextNode(config.views.wikified.toolbarReferences.popupNone));
		}
	scrollToTiddlerPopup(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for clicking on a tiddler tag
function onClickTag(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = createTiddlerPopup(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag)
		{
		var tagged = store.getTaggedTiddlers(tag);
		var c = false;
		for(var r=0;r<tagged.length;r++)
			if(tagged[r].title != title)
				{
				createTiddlyLink(popup,tagged[r].title,true);
				c = true;
				}
		var lingo = config.views.wikified.tag;
		if(c)
			{
			popup.insertBefore(document.createElement("hr"),popup.firstChild);
			var openAll = createTiddlyButton(null,lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			popup.insertBefore(openAll,popup.firstChild);
			}
		else
			popup.appendChild(document.createTextNode(lingo.popupNone.format([tag])));
		}
	scrollToTiddlerPopup(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(e)
{
	if (!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var tagged = store.getTaggedTiddlers(tag);
	for(var t=tagged.length-1; t>=0; t--)
		displayTiddler(this,tagged[t].title,0,null,null,false,e.shiftKey || e.altKey);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for clicking on the 'add tag' button
function onClickAddTag(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = createTiddlerPopup(this);
	var tiddler = this.getAttribute("tiddler");
	var tags = store.getTags();
	var lingo = config.views.editor.tagChooser;
	if(tags.length == 0)
		createTiddlyElement(popup,"div",null,null,lingo.popupNone);
	for (t=0; t<tags.length; t++)
		{
		var theTag = createTiddlyButton(popup,tags[t][0],lingo.tagTooltip.format([tags[t][0]]),onClickAddTagPopup);
		theTag.setAttribute("tag",tags[t][0]);
		theTag.setAttribute("tiddler",tiddler);
		}
	window.scrollTo(0,ensureVisible(popup));
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for clicking on a tag in the 'add tag' popup
function onClickAddTagPopup(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var tiddler = this.getAttribute("tiddler");
	var tag = this.getAttribute("tag");
	var tagsBox = document.getElementById("editorTags" + tiddler);
	if(tagsBox)
		tagsBox.value += " " + String.encodeTiddlyLink(tag);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for clicking on toolbar close
function onClickToolbarEdit(e)
{
	clearMessage();
	if(this.parentNode.id)
		displayTiddler(null,this.parentNode.id.substr(7),2,null,null,false,false);
}

// Event handler for clicking on toolbar save
function onClickToolbarSave(e)
{
	if(this.parentNode.id)
		saveTiddler(this.parentNode.id.substr(7));
}

// Event handler for clicking on toolbar save
function onClickToolbarUndo(e)
{
	if(this.parentNode.id)
		displayTiddler(null,this.parentNode.id.substr(7),1,null,null,false,false);
}

// Eek... it's bad that this is done via a function rather than a normal, copy-able href
function onClickPermaView()
{
	var tiddlerDisplay = document.getElementById("tiddlerDisplay");
	var links = [];
	for(var t=0;t<tiddlerDisplay.childNodes.length;t++)
		{
		var tiddlerName = tiddlerDisplay.childNodes[t].id.substr(7);
		links.push(String.encodeTiddlyLink(tiddlerName));
		}
	window.location.hash = encodeURIComponent(links.join(" "));
}

// ---------------------------------------------------------------------------------
// Animation engine
// ---------------------------------------------------------------------------------

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() // Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0)
		{
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},25);
		}
	this.running += arguments.length;
}

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a<me.animations.length)
		{
		var animation = me.animations[a];
		animation.progress += animation.step;
		if(animation.progress < 0 || animation.progress > 1)
			{
			animation.stop();
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
			}
		else
			{
			animation.tick();
			a++;
			}
		}
}

// Map a 0..1 value to 0..1, but slow down at the start and end
Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
}

// ---------------------------------------------------------------------------------
// Zoomer animation
// ---------------------------------------------------------------------------------

function Zoomer(text,startElement,targetElement,slowly)
{
	this.element = document.createElement("div");
	this.element.appendChild(document.createTextNode(text));
	this.element.className = "zoomer";
	document.body.appendChild(this.element);
	this.startElement = startElement;
	this.startLeft = findPosX(this.startElement);
	this.startTop = findPosY(this.startElement);
	this.startWidth = this.startElement.offsetWidth;
	this.startHeight = this.startElement.offsetHeight;
	this.targetElement = targetElement;
	this.targetLeft = findPosX(this.targetElement);
	this.targetTop = findPosY(this.targetElement);
	this.targetWidth = this.targetElement.offsetWidth;
	this.targetHeight = this.targetElement.offsetHeight;
	this.progress = 0;
	this.step = slowly ? config.animSlow : config.animFast;
	this.targetElement.style.opacity = 0;
	return this;
}

Zoomer.prototype.stop = function()
{
	this.element.parentNode.removeChild(this.element);
	this.targetElement.style.opacity = 1;
}

Zoomer.prototype.tick = function()
{
	var f = Animator.slowInSlowOut(this.progress);
	this.element.style.left = this.startLeft + (this.targetLeft-this.startLeft) * f + "px";
	this.element.style.top = this.startTop + (this.targetTop-this.startTop) * f + "px";
	this.element.style.width = this.startWidth + (this.targetWidth-this.startWidth) * f + "px";
	this.element.style.height = this.startHeight + (this.targetHeight-this.startHeight) * f + "px";
	this.element.style.display = "block";
	this.targetElement.style.opacity = this.progress;
	this.targetElement.style.filter = "alpha(opacity:" + this.progress * 100 + ")";
}

// ---------------------------------------------------------------------------------
// Scroller animation
// ---------------------------------------------------------------------------------

function Scroller(targetElement,slowly)
{
	this.targetElement = targetElement;
	this.startScroll = findScrollY();
	this.targetScroll = ensureVisible(targetElement);
	this.progress = 0;
	this.step = slowly ? config.animSlow : config.animFast;
	return this;
}

Scroller.prototype.stop = function()
{
	window.scrollTo(0,this.targetScroll);
}

Scroller.prototype.tick = function()
{
	var f = Animator.slowInSlowOut(this.progress);
	window.scrollTo(0,this.startScroll + (this.targetScroll-this.startScroll) * f);
}

// ---------------------------------------------------------------------------------
// Slider animation
// ---------------------------------------------------------------------------------

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,slowly,deleteMode)
{
	this.element = element;
	element.style.display = "block";
	this.deleteMode = deleteMode;
	this.element.style.height = "auto";
	this.realHeight = element.offsetHeight;
	this.opening = opening;
	this.step = slowly ? config.animSlow : config.animFast;
	if(opening)
		{
		this.progress = 0;
		element.style.height = "0px";
		element.style.display = "block";
		}
	else
		{
		this.progress = 1;
		this.step = -this.step;
		}
	element.style.overflow = "hidden";
	return this;
}

Slider.prototype.stop = function()
{
	if(this.opening)
		this.element.style.height = "auto";
	else
		{
		switch(this.deleteMode)
			{
			case "none":
				this.element.style.display = "none";
				break;
			case "all":
				this.element.parentNode.removeChild(this.element);
				break;
			case "children":
				removeChildren(this.element);
				break;
			}
		}
}

Slider.prototype.tick = function()
{
	var f = Animator.slowInSlowOut(this.progress);
	var h = this.realHeight * f;
	this.element.style.height = h + "px";
	this.element.style.opacity = f;
}

// ---------------------------------------------------------------------------------
// Augmented methods for the JavaScript Number(), Array() and String() objects
// ---------------------------------------------------------------------------------

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return c;
}

// Find an entry in an array. Returns the array index or null
Array.prototype.find = function(item)
{
	var p = null;
	for(var t=0; t<this.length; t++)
		if(this[t] == item)
			{
			p = t;
			break;
			}
	return p;
}

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique != undefined && unique == false)
		this.push(item);
	else
		{
		if(this.find(item) == null)
			this.push(item);
		}
}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	if(n < this.length)
		return this.slice(this.length-n);
	else
		return this;
}

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	var regexpTrim = new RegExp("^\\s*(.*)\\s*$","mg");
	return(this.replace(regexpTrim,"$1"));
}

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = new RegExp("(?:%(\\d+))","mg");
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1])
			{
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
			}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
}

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	return(this.replace(new RegExp("[\\\\\\^\\$\\*\\+\\?\\(\\)\\=\\!\\|\\,\\{\\}\\[\\]\\.]","g"),"\\$&"));
}

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	var regexpAmp = new RegExp("&","mg");
	var regexpLessThan = new RegExp("<","mg");
	var regexpGreaterThan = new RegExp(">","mg");
	var regexpQuote = new RegExp("\"","mg");
	return(this.replace(regexpAmp,"&amp;").replace(regexpLessThan,"&lt;").replace(regexpGreaterThan,"&gt;").replace(regexpQuote,"&quot;"));
}

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '', [[]] or left unquoted (and therefore space-separated)
String.prototype.readMacroParams = function()
{
	var regexpMacroParam = new RegExp("(?:\\s*)(?:(?:\"([^\"]*)\")|(?:'([^']*)')|(?:\\[\\[([^\\]]*)\\]\\])|([^\"'\\s]\\S*))","mg");
	var params = [];
	do {
		var match = regexpMacroParam.exec(this);
		if(match)
			{
			if(match[1]) // Double quoted
				params.push(match[1]);
			else if(match[2]) // Single quoted
				params.push(match[2]);
			else if(match[3]) // Double-square-bracket quoted
				params.push(match[3]);
			else if(match[4]) // Unquoted
				params.push(match[4]);
			}
	} while(match);
	return params;
}

// Process a string list of tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var bracketedPattern = "\\[\\[([^\\]]+)\\]\\]";
	var unbracketedPattern = "[^\\s$]+";
	var pattern = "(?:" + bracketedPattern + ")|(" + unbracketedPattern + ")";
	var re = new RegExp(pattern,"mg");
	var tiddlerNames = [];
	do {
		var match = re.exec(this);
		if(match)
			{
			if(match[1]) // Bracketed
				tiddlerNames.pushUnique(match[1],unique);
			else if(match[2]) // Unbracketed
				tiddlerNames.pushUnique(match[2],unique);
			}
	} while(match);
	return(tiddlerNames);
}

// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	if(title.indexOf(" ") == -1)
		return(title);
	else
		return("[[" + title + "]]");
}

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return(s);
}

// ---------------------------------------------------------------------------------
// RGB colour object
// ---------------------------------------------------------------------------------

// Construct an RGB colour object from a '#rrggbb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string")
		{
		if(r.substr(0,1) == "#")
			{
			this.r = parseInt(r.substr(1,2),16)/255;
			this.g = parseInt(r.substr(3,2),16)/255;
			this.b = parseInt(r.substr(5,2),16)/255;
			}
		else
			{
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/ ;
			var c = r.match(rgbPattern);
			if (c)
				{
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
				}
			}
		}
	else
		{
		this.r = r;
		this.g = g;
		this.b = b;
		}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
}

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	var r = this.r.clamp(0,1);
	var g = this.g.clamp(0,1);
	var b = this.b.clamp(0,1);
    return("#" + ("0" + Math.floor(r * 255).toString(16)).right(2) +
                 ("0" + Math.floor(g * 255).toString(16)).right(2) +
                 ("0" + Math.floor(b * 255).toString(16)).right(2));
}

// ---------------------------------------------------------------------------------
// Augmented methods for the JavaScript Date() object
// ---------------------------------------------------------------------------------

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	template = template.replace("YYYY",this.getFullYear());
	template = template.replace("YY",String.zeroPad(this.getFullYear()-2000,2));
	template = template.replace("MMM",config.messages.dates.months[this.getMonth()]);
	template = template.replace("0MM",String.zeroPad(this.getMonth()+1,2));
	template = template.replace("MM",this.getMonth()+1);
	template = template.replace("DDD",config.messages.dates.days[this.getDay()]);
	template = template.replace("0DD",String.zeroPad(this.getDate(),2));
	template = template.replace("DD",this.getDate());
	template = template.replace("hh",this.getHours());
	template = template.replace("mm",this.getMinutes());
	template = template.replace("ss",this.getSeconds());
	return template;
}

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return(String.zeroPad(this.getFullYear(),4) + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2));
}

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return(String.zeroPad(this.getFullYear(),4) + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + "." + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2) + String.zeroPad(this.getSeconds(),2) + String.zeroPad(this.getMilliseconds(),4));
}

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	var theDate = new Date(parseInt(d.substr(0,4),10),
							parseInt(d.substr(4,2),10)-1,
							parseInt(d.substr(6,2),10),
							parseInt(d.substr(8,2),10),
							parseInt(d.substr(10,2),10),0,0);
	return(theDate);
}

// ---------------------------------------------------------------------------------
// DOM utilities - many derived from www.quirksmode.org 
// ---------------------------------------------------------------------------------

function createTiddlyElement(theParent,theElement,theID,theClass,theText)
{
	var e = document.createElement(theElement);
	if(theClass != null)
		e.className = theClass;
	if(theID != null)
		e.setAttribute("id",theID);
	if(theText != null)
		e.appendChild(document.createTextNode(theText));
	if(theParent != null)
		theParent.appendChild(e);
	return(e);
}

function createTiddlyButton(theParent,theText,theTooltip,theAction,theClass,theId)
{
	var theButton = document.createElement("a");
	theButton.className = "button";
	if(theAction)
		{
		theButton.onclick = theAction;
		theButton.setAttribute("href","JavaScript:;");
		}
	theButton.setAttribute("title",theTooltip);
	if(theText)
		theButton.appendChild(document.createTextNode(theText));
	if(theClass)
		theButton.className = theClass;
	if(theId)
		theButton.id = theId;
	if(theParent)
		theParent.appendChild(theButton);
	return(theButton);
}

function createTiddlyLink(place,title,includeText)
{
	var text = includeText ? title : null;
	var subTitle;
  // NOTE: all tags here are mine
  var tags = "";
	var tiddler = store.tiddlers[title];
	if(tiddler)
    {
    tags = tiddler.tags[0];
	subTitle = tiddler.getSubtitle();
    }
    else
		subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
        
        
  //1313131
  var cat = document.createElement("div");
  cat.className = "siglet";
  cat.setAttribute( "tag", tags );
  place.appendChild(cat);
        
    var theClass = tiddler ? "tiddlyLinkExisting tiddlyLink" : "tiddlyLinkNonExisting tiddlyLink";
	var btn = createTiddlyButton(place,text,subTitle,onClickTiddlerLink,theClass);
	btn.setAttribute("tiddlyLink",title);
  //131313
  btn.setAttribute("tag", tags)
	return(btn);
}

function createExternalLink(place,url)
{
	var theLink = document.createElement("a");
	theLink.className = "externalLink";
	theLink.href = url;
	theLink.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		theLink.target = "_blank";
	place.appendChild(theLink);
	return(theLink);
}

// Find the tiddler instance (if any) containing a specified element
function findContainingTiddler(e)
{
	if(e == null)
		return(null);
	do {
		if(e != document)
			{
			if(e.id)
				if(e.id.substr(0,7) == "tiddler")
					return(e);
			}
		e = e.parentNode;
	} while(e != document);
	return(null);
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if (e.target)
		obj = e.target;
	else if (e.srcElement)
		obj = e.srcElement;
	if (obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return(obj);
}

// Return the content of an element as plain text with no formatting
function getElementText(elementID)
{
	var e = document.getElementById(elementID);
	var text = "";
	if(e.innerText)
		text = e.innerText;
	else if(e.textContent)
		text = e.textContent;
	return text;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop)
		return(posTop);
	else if(posBot > winBot)
		{
		if(e.offsetHeight < winHeight)
			return(posTop - (winHeight - e.offsetHeight));
		else
			return(posTop);
		}
	else
		return(winTop);
}

// Get the current height of the display window
function findWindowHeight()
{
	return(window.innerHeight ? window.innerHeight : document.body.clientHeight);
}

// Get the current vertical page scroll position
function findScrollY()
{
	return(window.scrollY ? window.scrollY : document.body.scrollTop);
}

function findPosX(obj)
{
	var curleft = 0;
	while (obj.offsetParent)
		{
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
		}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while (obj.offsetParent)
		{
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
		}
	return curtop;
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Remove all children of a node
function removeChildren(e)
{
	while(e.hasChildNodes())
		e.removeChild(e.firstChild);
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id)
{
	if(!id)
		id = "customStyleSheet";
	var n = document.getElementById(id);
	if(document.createStyleSheet) // Test for IE's non-standard createStyleSheet method
		{
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		document.body.insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
		}
	else
		{
		if(n)
			n.replaceChild(document.createTextNode(s),n.firstChild);
		else
			{
			var n = document.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(document.createTextNode(s));
			document.getElementsByTagName("head")[0].appendChild(n);
			}
		}
}

// ---------------------------------------------------------------------------------
// End of scripts
// ---------------------------------------------------------------------------------

</script>
<style type="text/css">

body {
	background-color: #ffffff;
	margin: 0em 0em 0em 0em;
	z-index: 0;
}

a:link, a:visited {
	text-decoration: none;
}

a:hover, a:active {
	text-decoration: none;
}

#contentWrapper {
}

#header {
}

#titleLine {
	color: #ffffff;
}

#titleLine a {
	color: #CCFF66;
}

#displayArea {
}

#tiddlerDisplay {
}

#messageArea {
	background-color: #993300;
	color: #ffffff;
	padding: 0.5em 0.5em 0.5em 0.5em;
	display: none;
}

#messageArea a:link, #messageArea a:visited {
	display: inline;
	text-decoration: underline;
	color: #cc9900;
}

#messageArea a:hover {
	color: #996633;
}

#messageArea a:active {
	color: #ffffff;
}

#popup {
	display: none;
	position: absolute;
	padding: 0.25em 0.25em 0.25em 0.25em;
	z-index: 10;
}

#popup a {
	display: block;
	color: #ccff66;
}

.tabset {
	padding: 1em 0em 0em 0.5em;
}

.tab {
	margin: 0em 0em 0em 0.25em;
	padding: 2px 2px 2px 2px;
}

.selectedTiddler {
	padding: 1em 1em 0em 1em;
}

.unselectedTiddler {
	padding: 1em 1em 0em 1em;
}

.toolbar {
	visibility: hidden;
}

.selectedTiddler .toolbar {
	visibility: visible;
}

.viewer {
  line-height: 130%;
}

.viewer a:link, .body a:visited {
	text-decoration: none;
}

.viewer a:hover {
	text-decoration: none;
}

.viewer .button {
}

.viewer .button:hover {
	background-color: #eeeeaa;
	color: #cc9900;
}

.viewer blockquote {
	font-size: 8pt;
	line-height: 150%;
	border-left: 3px solid #666666;
	padding-left: 0.8em;
	margin-left: 2.5em;
}

.viewer ul {
	margin-left: 0.5em;
	padding-left: 1.5em;
}

.viewer ol {
	margin-left: 0.5em;
	padding-left: 1.5em;
}

.viewer h1,h2,h3,h4,h5 {
	font-weight: normal;
	text-decoration: none;
  padding-left: 0.4em;
  padding-bottom: 0.1em;
}

.viewer h1 {
	font-size: 12pt;
}

.viewer h2 {
	font-size: 11pt;
}

.viewer h3 {
	font-size: 10pt;
}

.viewer h4 {
	font-size: 9pt;
}

.viewer h5 {
padding: 0em;
display: inline;
font-size: 12pt;
}

.viewer table {
	border-collapse: collapse;
	border: 2px solid #303030;
	margin-left: 1.0em;
	margin-right: 1.0em;
	margin-top: 0.8em;
	margin-bottom: 0.8em;
	font-size: 100%;
}

.viewer th {
	background-color: #999966;
	border: 1px solid #606060;
	color: #ffffff;
	padding: 3px;
}

.viewer td, tr {
	border: 1px solid #606060;
	padding: 3px;
}

.viewer caption {
	padding: 3px;
}

.viewer pre, .viewer code {
	font-size: 100%;
	line-height: 1.4em;
}

.viewer hr {
	border-top: dashed 1px #606060;
	border-left: none;
	border-right: none;
	border-bottom: none;
	height: 1px;
	color: #666666;
}

.highlight, .marked {
	color: #000000;
	background-color: #ffe72f;
}

.editor {
}

.editor input {
	display: block;
	border: 1px solid black;
	width: 100%;
}

.editor textarea {
	display: block;
	font: inherit;
	border: 1px solid black;
	width: 100%;
}

.editorFooter {
	padding: 0.25em 0em 0.25em 0em;
	font-size: 8pt;
	color: #aaaaaa;
}

.editorFooter A {
	padding: 0.2em 0.4em 0.2em 0.4em;
	color: #993300;
}

.editorFooter A:hover {
	text-decoration: none;
	background-color: #993300;
}

.editorFooter A:active {
	color: #ffffff;
	background-color: #cc9900;
}

.tabContents ul, .tabContents ol {
	margin: 0;
	padding: 0;
}

.tabContents li {
	list-style: none;
}

#sidebarOptions input {
	margin: 0.4em 0em 0.3em 1em;
}

#sidebarOptions .sliderPanel {
	padding: 0.5em 0.5em 0.5em 0.5em;
	font-size: 7pt;
	background-color: #eeeeaa;
}

#sidebarOptions .sliderPanel A {
	color: #993300;
	font-weight: bold;
}

#sidebarOptions .sliderPanel A:hover {
	color: #ccff66;
	background-color: #993300;
}

#sidebarOptions .sliderPanel A:active {
	color: #993300;
	background-color: #ccff66;
}

#sidebarOptions .sliderPanel input {
	margin: 0em 0em 0.3em 0em;
}

.sidebarSubHeading {
	font-size: 7pt;
	color: #330000;
}

#licensePanel {
	padding: 0.5em 0em 0.5em 0em;
}

#licensePanel A {
	display: block;
	padding: 0.2em 0.2em 0.2em 0.2em;
	color: #993300;
}

#licensePanel A:hover {
	text-decoration: none;
	color: #ccff66;
	background-color: #993300;
}

#licensePanel A:active {
	color: #993300;
	background-color: #ccff66;
}

#storeArea, #copyright {
	display: none;
}

.sparkline {
	background-color: #eeeeaa;
	border: none;
	line-height: 100%;
}

.sparktick {
	background-color: #993300;
	outline: 0;
}

.errorNoSuchMacro {
	color: #ffff00;
	background-color: #ff0000;
}

.zoomer {
	font-size: 10pt;
	display: none;
color: #000;
	position: absolute;
	padding: 1em 1em 1em 1em;
border: 1px solid #000;
}

#saveTest {
	display: none;
}

@media print {

#mainMenu, #sidebar, #messageArea {
	display: none ! important;
}

#displayArea {
	margin: 1em 1em 0em 1em;
}

}

</style>
<noscript>
<style type="text/css">

#contentWrapper {
	display: none;
}

#storeArea {
	display: block;
	margin: 4em 17em 3em 17em;
}

#storeArea div {
 padding: 0.5em; 0.5em; 0.5em; 0.5em;
 margin: 1em 0em 0em 0em;
 border-color: #f0f0f0 #606060 #404040 #d0d0d0;
 border-style: solid;
 border-width: 2px;
 height: 7em;
 overflow: auto;
}

#javascriptWarning {
	width: 100%;
	text-align: center;
	font-weight: bold;
	background-color: #dd1100;
	color: #ffffff;
	padding:1em 0em 1em 0em;
}

</style>
</noscript>
</head>
<body onload="main();" onunload="checkUnsavedChanges();">
	<script>
	if (detectPlugin("TiddlyWiki Saver"))
		{
		document.write('<embed style="display: none" name="tiddlyWikiSafariSaver" width="0" height="0" type="application/x-webkit-tiddlywiki-saver"></embed>'); 
		saveUsingSafari = true;
		}
	</script>
	<div id="copyright">
	Welcome to TiddlyWiki by Jeremy Ruston, Copyright &copy; 2005 Osmosoft Limited
	</div>
	<noscript>
		<div id="javascriptWarning">This page requires JavaScript to function properly</div>
	</noscript>
	<div id="saveTest"></div>
	<div id="contentWrapper">
		<div id="header">
			<div id="titleLine">
				<div id="siteTitle"></div>
				<div id="siteSubtitle"></div>
			</div>
		</div>
		<div id="sidebar">
			<div id="sidebarOptions"></div>
			<div id="sidebarTabs"></div>
		</div>
		<div id="mainMenu"></div>
		<div id="displayArea">
			<div id="messageArea"></div>
			<div id="tiddlerDisplay"></div>
		</div>
	</div>
  <div id="storeArea">

<div tiddler="!TODO Movies" modified="200507121946" modifier="joeraii" tags="todo personal movies">8 1/2  (1963)
Ai no corrida (1976)
The Apartment
Bob le Flambeur (1955)
Bicycle Thieves (1948, 8.4)
Der Untergang (2004)
Double Indemnity
Fallen Idol (1948, Caroll Reed)
Following
His Girl Friday (1940)
Kiss Me Deadly (1955)
La Dolce Vita (1960)
La Regle du Jeu (1939)**
Marnie
Mouchette (1967)
Night of the Hunter (1955)
The Others (2001)
The Seventh Seal (Det Sjunde inseglet, 1957)
They Live by Night (1949)
Tokyo Story (1953)
Waiting for Guffman
Witness for the Prosecution (1957)</div>
<div tiddler="AdvancedOptions" modified="200507132144" modifier="joeraii" tags="systemTiddlers">&lt;&lt;option chkOpenInNewWindow&gt;&gt; Open Links in New Window
&lt;&lt;option chkSaveEmptyTemplate&gt;&gt; Save Empty Template</div>
<div tiddler="AlternatingLists" modified="200507141649" modifier="joeraii" tags="addition">Compared to [[Siglets]], Alternating color in list views was an easy hack. You can see the results to the left. This makes it much simpler to read the list view, especially when you have Tiddlers that might take up more than one line (as mine tend to do). The corresponding CSS required to manipulate the colors is in StyleSheet .</div>
<div tiddler="Apologia" modified="200507151611" modifier="joeraii" tags="introduction apologia">To Jeremy, and whoever else may look at the code, I apologize profusely for its resemblence to a cancer, or some other malignant disease. The TiddlyWiki code as of the most current release is becoming very clean and pristine, with well defined ways for adding extensions, but I completely ignored this and grafted my hacks into hallowed places, rendering them blighted and unsightly. I apologize. 

Yes, there are lots of bugs. 
* The CSS is rickety, and probably doesn't work in IE.

-- [[Joe|http://www.cs.utexas.edu/~joeraii]]</div>
<div tiddler="Book: Developmental Biology" modified="200507141513" modifier="joeraii" tags="book biology development research">//Scott Gilbert//

[[Developmental Biology|http://www.amazon.com/gp/reader/0878932585/ref=sib_dp_pt/104-7094928-2123921#reader-link]]</div>
<div tiddler="Cargo Cult Science" modified="200507141412" modifier="joeraii" tags="clipping academic">//Richard Feynman//

During the Middle Ages there were all kinds of crazy ideas, such as that a piece of of rhinoceros horn would increase potency. Then a method was discovered for separating the ideas--which was to try one to see if it worked, and if it didn't work, to eliminate it. This method became organized, of course, into science. And it developed very well, so that we are now in the scientific age. It is such a scientific age, in fact, that we have difficulty in understanding how witch doctors could ever have existed, when nothing that they proposed ever really worked--or very little of it did.

But even today I meet lots of people who sooner or later get me into a conversation about UFO's, or astrology, or some form of mysticism, expanded consciousness, new types of awareness, ESP, and so forth. And I've concluded that it's not a scientific world.

Most people believe so many wonderful things that I decided to investigate why they did. And what has been referred to as my curiosity for investigation has landed me in a difficulty where I found so much junk that I'm overwhelmed. First I started out by investigating various ideas of mysticism and mystic experiences. I went into isolation tanks and got many hours of hallucinations, so I know something about that. Then I went to Esalen, which is a hotbed of this kind of thought (it's a wonderful place; you should go visit there). Then I became overwhelmed. I didn't realize how MUCH there was.

At Esalen there are some large baths fed by hot springs situated on a ledge about thirty feet above the ocean. One of my most pleasurable experiences has been to sit in one of those baths and watch the waves crashing onto the rocky slope below, to gaze into the clear blue sky above, and to study a beautiful nude as she quietly appears and settles into the bath with me.

One time I sat down in a bath where there was a beatiful girl sitting with a guy who didn't seem to know her. Right away I began thinking, "Gee! How am I gonna get started talking to this beautiful nude woman?"

I'm trying to figure out what to say, when the guy says to her, "I'm, uh, studying massage. Could I practice on you?" "Sure," she says. They get out of the bath and she lies down on a massage table nearby. I think to myself, "What a nifty line! I can never think of anything like that!" He starts to rub her big toe. "I think I feel it," he says. "I feel a kind of dent--is that the pituitary?" I blurt out, "You're a helluva long way from the pituitary, man!" They looked at me, horrified--I had blown my cover--and said, "It's reflexology!" I quickly closed my eyes and appeared to be meditating.

That's just an example of the kind of things that overwhelm me. I also looked into extrasensory perception, and PSI phenomena, and the latest craze there was Uri Geller, a man who is supposed to be able to bend keys by rubbing them with his finger. So I went to his hotel room, on his invitation, to see a demonstration of both mindreading and bending keys. He didn't do any mindreading that succeeded; nobody can read my mind, I guess. And my boy held a key and Geller rubbed it, and nothing happened. Then he told us it works better under water, and so you can picture all of us standing in the bathroom with the water turned on and the key under it, and him rubbing the key with his finger. Nothing happened. So I was unable to investigate that phenomenon.

But then I began to think, what else is there that we believe? (And I thought then about the witch doctors, and how easy it would have been to check on them by noticing that nothing really worked.) So I found things that even more people believe, such as that we have some knowledge of how to educate. There are big schools of reading methods and mathematics methods, and so forth, but if you notice, you'll see the reading scores keep going down--or hardly going up--in spite of the fact that we continually use these same people to improve the methods. There's a witch doctor remedy that doesn't work. It ought to be looked into; how do they know that their method should work? Another example is how to treat criminals. We obviously have made no progress--lots of theory, but no progress--in decreasing the amount of crime by the method that we use to handle criminals.

Yet these things are said to be scientific. We study them. And I think ordinary people with commonsense ideas are intimidated by this pseudoscience. A teacher who has some good idea of how to teach her children to read is forced by the school system to do it some other way--or is even fooled by the school system into thinking that her method is not necessarily a good one. Or a parent of bad boys, after disciplining them in one way or another, feels guilty for the rest of her life because she didn't do "the right thing," according to the experts.

So we really ought to look into theories that don't work, and science that isn't science.

I think the educational and psychological studies I mentioned are examples of what I would like to call cargo cult science. In the South Seas there is a cargo cult of people. During the war they saw airplanes with lots of good materials, and they want the same thing to happen now. So they've arranged to make things like runways, to put fires along the sides of the runways, to make a wooden hut for a man to sit in, with two wooden pieces on his head to headphones and bars of bamboo sticking out like antennas--he's the controller--and they wait for the airplanes to land. They're doing everything right. The form is perfect. It looks exactly the way it looked before. But it doesn't work. No airplanes land. So I call these things cargo cult science, because they follow all the apparent precepts and forms of scientific investigation, but they're missing something essential, because the planes don't land.

Now it behooves me, of course, to tell you what they're missing. But it would be just about as difficult to explain to the South Sea islanders how they have to arrange things so that they get some wealth in their system. It is not something simple like telling them how to improve the shapes of the earphones. But there is one feature I notice that is generally missing in cargo cult science. That is the idea that we all hope you have learned in studying science in school--we never say explicitly what this is, but just hope that you catch on by all the examples of scientific investigation. It is interesting, therefore, to bring it out now and speak of it explicitly. It's a kind of scientific integrity, a principle of scientific thought that corresponds to a kind of utter honesty--a kind of leaning over backwards. For example, if you're doing an experiment, you should report everything that you think might make it invalid--not only what you think is right about it: other causes that could possibly explain your results; and things you thought of that you've eliminated by some other experiment, and how they worked--to make sure the other fellow can tell they have been eliminated.

Details that could throw doubt on your interpretation must be given, if you know them. You must do the best you can--if you know anything at all wrong, or possibly wrong--to explain it. If you make a theory, for example, and advertise it, or put it out, then you must also put down all the facts that disagree with it, as well as those that agree with it. There is also a more subtle problem. When you have put a lot of ideas together to make an elaborate theory, you want to make sure, when explaining what it fits, that those things it fits are not just the things that gave you the idea for the theory; but that the finished theory makes something else come out right, in addition.

In summary, the idea is to give all of the information to help others to judge the value of your contribution; not just the information that leads to judgement in one particular direction or another.

The easiest way to explain this idea is to contrast it, for example, with advertising. Last night I heard that Wesson oil doesn't soak through food. Well, that's true. It's not dishonest; but the thing I'm talking about is not just a matter of not being dishonest; it's a matter of scientific integrity, which is another level. The fact that should be added to that advertising statement is that no oils soak through food, if operated at a certain temperature. If operated at another temperature, they all will--including Wesson oil. So it's the implication which has been conveyed, not the fact, which is true, and the difference is what we have to deal with.

We've learned from experience that the truth will come out. Other experimenters will repeat your experiment and find out whether you were wrong or right. Nature's phenomena will agree or they'll disagree with your theory. And, although you may gain some temporary fame and excitement, you will not gain a good reputation as a scientist if you haven't tried to be very careful in this kind of work. And it's this type of integrity, this kind of care not to fool yourself, that is missing to a large extent in much of the research in cargo cult science.

A great deal of their difficulty is, of course, the difficulty of the subject and the inapplicability of the scientific method to the subject. Nevertheless, it should be remarked that this is not the only difficulty. That's why the planes don't land--but they don't land.

We have learned a lot from experience about how to handle some of the ways we fool ourselves. One example: Millikan measured the charge on an electron by an experiment with falling oil drops, and got an answer which we now know not to be quite right. It's a little bit off because he had the incorrect value for the viscosity of air. It's interesting to look at the history of measurements of the charge of an electron, after ~Millikan. If you plot them as a function of time, you find that one is a little bit bigger than Millikan's, and the next one's a little bit bigger than that, and the next one's a little bit bigger than that, until finally they settle down to a number which is higher.

Why didn't they discover the new number was higher right away? It's a thing that scientists are ashamed of--this history--because it's apparent that people did things like this: When they got a number that was too high above Millikan's, they thought something must be wrong--and they would look for and find a reason why something might be wrong. When they got a number close to Millikan's value they didn't look so hard. And so they eliminated the numbers that were too far off, and did other things like that. We've learned those tricks nowadays, and now we don't have that kind of a disease.

But this long history of learning how to not fool ourselves--of having utter scientific integrity--is, I'm sorry to say, something that we haven't specifically included in any particular course that I know of. We just hope you've caught on by osmosis

The first principle is that you must not fool yourself--and you are the easiest person to fool. So you have to be very careful about that. After you've not fooled yourself, it's easy not to fool other scientists. You just have to be honest in a conventional way after that.

I would like to add something that's not essential to the science, but something I kind of believe, which is that you should not fool the layman when you're talking as a scientist. I am not trying to tell you what to do about cheating on your wife, or fooling your girlfriend, or something like that, when you're not trying to be a scientist, but just trying to be an ordinary human being. We'll leave those problems up to you and your rabbi. I'm talking about a specific, extra type of integrity that is not lying, but bending over backwards to show how you're maybe wrong, that you ought to have when acting as a scientist. And this is our responsibility as scientists, certainly to other scientists, and I think to laymen.

For example, I was a little surprised when I was talking to a friend who was going to go on the radio. He does work on cosmology and astronomy, and he wondered how he would explain what the applications of his work were. "Well," I said, "there aren't any." He said, "Yes, but then we won't get support for more research of this kind." I think that's kind of dishonest. If you're representing yourself as a scientist, then you should explain to the layman what you're doing-- and if they don't support you under those circumstances, then that's their decision.

One example of the principle is this: If you've made up your mind to test a theory, or you want to explain some idea, you should always decide to publish it whichever way it comes out. If we only publish results of a certain kind, we can make the argument look good. We must publish BOTH kinds of results.

I say that's also important in giving certain types of government advice. Supposing a senator asked you for advice about whether drilling a hole should be done in his state; and you decide it would be better in some other state. If you don't publish such a result, it seems to me you're not giving scientific advice. You're being used. If your answer happens to come out in the direction the government or the politicians like, they can use it as an argument in their favor; if it comes out the other way, they don't publish at all. That's not giving scientific advice.

Other kinds of errors are more characteristic of poor science. When I was at Cornell, I often talked to the people in the psychology department. One of the students told me she wanted to do an experiment that went something like this--it had been found by others that under certain circumstances, X, rats did something, A. She was curious as to whether, if she changed the circumstances to Y, they would still do A. So her proposal was to do the experiment under circumstances Y and see if they still did A.

I explained to her that it was necessary first to repeat in her laboratory the experiment of the other person--to do it under condition X to see if she could also get result A, and then change to Y and see if A changed. Then she would know the the real difference was the thing she thought she had under control.

She was very delighted with this new idea, and went to her professor. And his reply was, no, you cannot do that, because the experiment has already been done and you would be wasting time. This was in about 1947 or so, and it seems to have been the general policy then to not try to repeat psychological experiments, but only to change the conditions and see what happened.

Nowadays, there's a certain danger of the same thing happening, even in the famous field of physics. I was shocked to hear of an experiment being done at the big accelerator at the National Accelerator Laboratory, where a person used deuterium. In order to compare his heavy hydrogen results to what might happen with light hydrogen, he had to use data from someone else's experiment on light hydrogen, which was done on different apparatus. When asked why, he said it was because he couldn't get time on the program (because there's so little time and it's such expensive apparatus) to do the experiment with light hydrogen on this apparatus because there wouldn't be any new result. And so the men in charge of programs at NAL are so anxious for new results, in order to get more money to keep the thing going for public relations purposes, they are destroying--possibly--the value of the experiments themselves, which is the whole purpose of the thing. It is often hard for the experimenters there to complete their work as their scientific integrity demands.

All experiments in psychology are not of this type, however. For example, there have been many experiments running rats through all kinds of mazes, and so on--with little clear result. But in 1937 a man named Young did a very interesting one. He had a long corridor with doors all along one side where the rats came in, and doors along the other side where the food was. He wanted to see if he could train the rats to go in at the third door down from wherever he started them off. No. The rats went immediately to the door where the food had been the time before.

The question was, how did the rats know, because the corridor was so beautifully built and so uniform, that this was the same door as before? Obviously there was something about the door that was different from the other doors. So he painted the doors very carefully, arranging the textures on the faces of the doors exactly the same. Still the rats could tell. Then he thought maybe the rats were smelling the food, so he used chemicals to change the smell after each run. Still the rats could tell. Then he realized the rats might be able to tell by seeing the lights and the arrangement in the laboratory like any commonsense person. So he covered the corridor, and still the rats could tell.

He finally found that they could tell by the way the floor sounded when they ran over it. And he could only fix that by putting his corridor in sand. So he covered one after another of all possible clues and finally was able to fool the rats so that they had to learn to go in the third door. If he relaxed any of his conditions, the rats could tell.

Now, from a scientific standpoint, that is an A-number-one experiment. That is the experiment that makes rat-running experiments sensible, because it uncovers that clues that the rat is really using-- not what you think it's using. And that is the experiment that tells exactly what conditions you have to use in order to be careful and control everything in an experiment with rat-running.

I looked up the subsequent history of this research. The next experiment, and the one after that, never referred to ~Mr. ~Young. They never used any of his criteria of putting the corridor on sand, or being very careful. They just went right on running the rats in the same old way, and paid no attention to the great discoveries of ~Mr. Young, and his papers are not referred to, because he didn't discover anything about the rats. In fact, he discovered all the things you have to do to discover something about rats. But not paying attention to experiments like that is a characteristic example of cargo cult science.

Another example is the ESP experiments of ~Mr. Rhine, and other people. As various people have made criticisms--and they themselves have made criticisms of their own experiements--they improve the techniques so that the effects are smaller, and smaller, and smaller until they gradually disappear. All the para-psychologists are looking for some experiment that can be repeated--that you can do again and get the same effect--statistically, even. They run a million rats--no, it's people this time--they do a lot of things are get a certain statistical effect. Next time they try it they don't get it any more. And now you find a man saying that is is an irrelevant demand to expect a repeatable experiment. This is science?

This man also speaks about a new institution, in a talk in which he was resigning as Director of the Institute of ~Parapsychology. And, in telling people what to do next, he says that one of things they have to do is be sure the only train students who have shown their ability to get PSI results to an acceptable extent--not to waste their time on those ambitious and interested students who get only chance results. It is very dangerous to have such a policy in teaching--to teach students only how to get certain results, rather than how to do an experiment with scientific integrity.

So I have just one wish for you--the good luck to be somewhere where you are free to maintain the kind of integrity I have described, and where you do not feel forced by a need to maintain your position in the organization, or financial support, or so on, to lose your integrity. May you have that freedom.</div>
<div tiddler="Clippings" modified="200507141447" modifier="joeraii" tags="clipping research">[[Cargo Cult Science]]
[[Contract Thinking]]
[[Rich Sutton]]
[[What's Wrong with Artificial Intelligence]]
[[Verification, the Key to AI]]</div>
<div tiddler="Contract Thinking" modified="200507141517" modifier="joeraii" tags="culture clipping philosophy japan">Momus:
&gt;"About the thing about "status thinking" versus "contract thinking". Discoveries like today's should make you veer towards a "contract" model of Japanese society. You should avoid the conclusion that a contract-based society governed my mutual interests and consensual understandings is a conspiracy."
Momus:
&gt;"I think the biggest problem Marxy and I have is that Marxy is a "status thinker" and I'm a "contract thinker". Marxy, in other words, believes that everything revolves around "the truth of the situation" whereas I believe that everything revolves around a consensual contract between the actors involved. In this I am way more "Japanese" than ~Marxy."
Marxy:
&gt;"A contract is not necessarily a conspiracy, but I think there's much reason to question exclusionary agreements or contracts not formed with equal access to perfect-information - both of which are dominant in Japanese society."</div>
<div tiddler="DefaultTiddlers" modified="200507151518" modifier="joeraii" tags="systemTiddlers">HelloThere NeededFunctionality [[Clippings]]</div>
<div tiddler="Evolvability and Static vs. Dynamic Fitness" modified="200507112050" modifier="joeraii" tags="paper evolvability research">Type the text for 'Evolvability and Static vs. Dynamic Fitness' here.</div>
<div tiddler="HelloThere" modified="200509061235" modifier="joeraii" tags="introduction culture">Welcome to Siglet, showcasing some hacked-on features for JeremyRuston's [[TiddlyWiki|http://www.tiddlywiki.com]] (using the ServerSide backend [[pytw]]). First is [[Siglets]], little bits of CSS code based on the first tag of a Tiddly that show off its type (i.e. TODO, Research, Work, Personal, etc). Second is AlternatingLists, which are generally useful for displaying lists with Tiddlys that have long names. You can see these both in action on the left. Finally, the list of tiddlers in the upper left displays what tiddlers are currently open, and gives you a nice clean way of managing the display list without having to scroll all the way down.

This implementation is just proof-of-concept, I can't really vouch for its lack of bugs (in fact, at the moment it has several). If you like the concept, I encourage you to look at the implementation and try to improve upon it, if possible (it should be easy :).
          
It is my sincere hope that these features are "nifty" enough to warrant eventual inclusion in the mainstream TiddlyWiki. First, because the code is an ugly hack (see [[Apologia]]), and second because I don't have time to hack javascript all day (thats why god invented Python).

!!!Update 9/6/05
* Added drag and drop tiddler reordering, ala [[dragn|http://www.cs.utexas.edu/~joeraii/dragn]].

!!!Update 8/10/05
* Sync with TW 1.2.31
* Merge with [[pytw|http://www.cs.utexas.edu/~joeraii/pytw]]
* New StyleSheet
* Added folding (from Steve Rumsby's [[YATWA|http://www.rumsby.org/yatwa/]]). Just click on the Tiddler title to fold the tiddler.

!!!Update 7/27/05 and older
*Sync with TW 1.2.29
*Fixed some of the annoying layout rendering bugs in firefox.
*Made the Tidder List in the sidebar update in response to opening/closing tiddlers. This gives you an executive summary of what is currently open, and allows you to close whatever you want, without having to hunting in the display area.
*tiddlyLink styles are now respected across all views (in tag lists as well) including border and font colors. With the current configuration, siglets are used in the sidebar, and color-coded tiddly links are used in the main view. Both styles are available in both views, however.
*The toolbar button "ref" has been relocated "under" the tiddler name. This is a more natural place. However...
*All of the tiddlers linking to a certain page are listed opposite the tags.
*Color coded the tags themselves. This helps me immensely. Also moved the references button to the TiddlerTitle. This is more natural and saves toolbar space (considering I've already added "close all" and I intend to add "fold").
*Fixed some unicode problems. Now you can say things like: [[]] or [[-evolution]]

TiddlyWiki is (c) osmosoft, and Siglet is all BSD-license code. </div>
<div tiddler="Interesting: General" modified="200507141452" modifier="joeraii" tags="research general academic">@@bgcolor(#ff4300):Neuroscientific basis for art. [[Ramachandran]].@@
* Aesthetic fundamentals that transcend culture.

@@bgcolor(#71ff4f):Network and Complexity Theory@@
* Social Implications
* Culture
* Meme theory
* General Computation [[http://cscs.umich.edu/~crshalizi/notebooks/complex-networks.html|http://cscs.umich.edu/~crshalizi/notebooks/complex-networks.html]]
* Self organization, and emergence.

@@bgcolor(#9397ff):Improving Evolutionary Search@@
* Long-term evolution problem, lock in because target is not adaptive and/or it becomes too difficult to effect positive phenotypic change.
* Neutral network theory.
* Evo-devo in biology, but mostly in the context of improving search efficacy (learning a problem). 

@@bgcolor(#ff6900):Machine Learning@@
* Or at least how to reliably build models of large data sets. 
* Unsupervised learning
* Semi-supervised learning, including clustering and such.
* [[Rich Sutton]]'s work on ~TD-learning.

@@bgcolor(#9a00ff):Neural Networks@@
* Models of learning from the brain.
* Unsupervised, self-organizing vs. supervised training. 
* How can self-organization be employed to augment Neuro-evolution? Is evolution even the correct time scale to "learn" problems? Or should there be some component of "training" afterwards?

@@bgcolor(#00ffa9):Developmental Biology@@
* In general, developmental biology is really cool. At its most fundamental level development is equivalent to a computer program. The "code" is DNA, and the machinery is the cellular components. But unlike traditional computers where the results are displayed through some device, the "results" of a computation in developmental biology is the morphology, kinematics, and machinery associated with the organism itself. Thus development describes computers that can literally grow themselves from a seed. 
* Developmental programs are structured in a way much different from traditional programming -- the main differences include massive parallelism, shallow execution depth (shallow gene cascades, but exponential proliferation -- i.e. exploiting parallelism) tightly integrated modular reuse, etc.</div>
<div tiddler="ListOpen" modified="200507311427" modifier="joeraii" tags="macro systemConfig excludeLists">version.extensions.listOpen = {major: 0, minor: 1, revision: 0};

config.macros.listOpen = { text: "Hello" };

config.macros.listOpen.handler = function(place,macroName,params)
{
    var tiddlerDisplay = document.getElementById("tiddlerDisplay");
    for(var t=0;t&lt;tiddlerDisplay.childNodes.length;t++)
{
if( tiddlerDisplay.childNodes[t].id )
{
        var tiddlerName = tiddlerDisplay.childNodes[t].id.substr(7);
/*if( tiddlerName.length &gt; 25 )
tiddlerName = tiddlerName.substr(0,25) + "...";*/
createTiddlyLink(place,tiddlerName,true);
//createTiddlyElement(place,"br",null,null,"");
//refreshEditor(tiddlerName);
}
}
}</div>
<div tiddler="ListTags" modified="200507181947" modifier="joeraii" tags="macro systemConfig excludeLists">version.extensions.listTags = {major: 0, minor: 1, revision: 0};

config.macros.listTags = {
text: "Hello"
};

config.macros.listTags.handler = function(place,macroName,params)
{
   var tagged = store.getTaggedTiddlers(params[0]);
    for(var r=0;r&lt;tagged.length;r++)
{
if( tagged[r].title.toLowerCase() != params[0].toLowerCase() )
{
        createTiddlyLink(place,tagged[r].title,true);
 createTiddlyElement(place,"br",null,null,"");
}
}
}</div>
<div tiddler="MainMenu" modified="200507132001" modifier="joeraii" tags="systemTiddlers"> </div>
<div tiddler="Measuring Evolvability as the Rate of Complexity Increase" modified="200507112050" modifier="joeraii" tags="paper evolvability research">Type the text for 'Measuring Evolvability as the Rate of Complexity Increase' here.</div>
<div tiddler="NeededFunctionality" modified="200507141529" modifier="joeraii" tags="todo usability">*''"Link-neighborhood"'' representation. Simple representation in the header that shows what tiddlers ref this, but without the explicit "ref" button. Simple graphical would be good. 
          * ''delicious tag integration'' (show delicious entries with same tags)
** e.g. [[http://del.icio.us/rss/joeraii/mathematics,article|http://del.icio.us/rss/joeraii/mathematics,article]] can be scraped
* Export to plain text (latex?)
* Datagarden integration (upload a file to datagarden, have it visible here somewhere. pref: special files tag) This may be possible with the newest base version.
* Probably should make the toolbar follow the screen. This way it will never be somewhere out of access range.

!!!!TODO
''May be not our fault:''
* Having no tags is a state to which tags cannot be added.

!!!!GOAL
* Maximizing serendipity through preemptive search.  

!!!!Envisioning the perfect Text Editor
* ''Organize papers efficiently''. Attach notes to papers. Extract citation contexts (i.e. the last time I cited this paper, it was with this kind of reference). List these. Have searches show context, ala google search. In general scholar.google.com already does this. Maybe keep a wiki of read paper summaries?
* ''Delicious/search integration'' -- may be better realized through spotlight integration. Attach delicious links, or other websites, or documents to a certain word, ~EASILY. i.e. right click and say get spotlight results.
* ''Vim editing''. The vim gui editor sucks. Is there some way to extract just the text input widget and embed it in some kind of real GUI? Preferably with integrated TODO (iCal integrated) and autosave/session maintenance. Something like kVim for osx would be sweet.
* ''~Metadata...'' creation date, tag documents into certain categories. Allow many categories: i.e. URGENT, but also research, gecco, etc.
* Really what I want is a way to attach notes and tags to a folder and its contents. This should be fairly realizable through the automator. 
* Find related information about a document.</div>
<div tiddler="Notes: Evolvability" modified="200507141504" modifier="joeraii" tags="notes evolvability biology development">''Population vs. representational evolvability, or better: when is a dynamic fitness function necessary (when the representation is unable to perform estimation-of-distribution)?''

When a single organism has the local phenotypic distribution averaged into its fitness, then it can exhibit selection for evolvability. An alternate way of achieving this is through an adaptive fitness function, which ensures that "evolvable" phenotypes, i.e. those that learn the structure of the fitness function are rewarded.  

[[Designing Evolvable Representations]] / [[An Empirical Measure of Evolvability]] / (The rise of) [[Evolvability in Artificial Evolutionary Systems]]
!!!Short Term:
* Theorify the measurement process. Currently there are some issues: if an algorithm only lowers its baseline performance, does it have more evolvability than before? (can we take the log of the lowest point?) Adaptive fitness function necessary?
* Evolvability is the structure of the local space, more or less, what then, is the ability to choose the local space? Trick question: they're both the same thing.
* Work towards a journal publication. Risto will be able to help with this.
* Expand to more domains. More difficult kinds of symmetry? What can such a test elucidate?
* More theoretical approach to quantifying "information provided about underlying problem structure." Can this be described in an information-theoretic manner? Also can we pin down what training-response shapes are good?

!!!Long Term:
* Link "underlying problem structure" to the "human knowledge" from NFL work.
* What do we want ultimately? Good long-term behavior in evolutionary algorithms. Or really any machine learning algorithm. The problem is convergence and the decline of an easy increasing gradient once search reaches a certain place. The ratio of deleterious mutation to profitable ones becomes so low as to render improvement statistically impossible. Another explanation: it requires too many deleterious mutations to make the final improvement, i.e. we have to undo too much prior evolution in order to catch the remaining 5% or 1% fitness needed. So what we want instead is an algorithm that makes sure to structure early evolution such that these fitness targets are not lost later.

What methods can we use to extract underlying structure? Self-organization is a method already optimized for doing this.
</div>
<div tiddler="Notes: No Free Lunch" modified="200507141501" modifier="joeraii" tags="notes research nfl theorem">''No Free Lunch Refutation''
* Basically when we talk about things like "averaging over all possible problems" we get into issues discussed by Gregory Chaitin, e.g. most of the elements of the set of all possible problems are uncomputable numbers, e.g. purely random. This can be easily shown to render the search spaces purely random as well: the "number" that represents the search space contains all of the (finite) fitness values stored in the following way: enumerate each fitness value as a coordinate on an n-dimensional space (the number n can "vary" but must be bounded, this is easily done except in the real world), then run over the ordered list, concatenating the binary representation of the fitness of the coordinate to yield the real number representing the search space. Random = random. 
* Now, what do the NFL results really mean, if basically every problem we're averaging over is completely random? Of course all algorithms will perform the same. We're basically just averaging over a terrible problem that we cannot learn from at all. 
* The solution? Only look at performance on subsets of problems. Proposed by Droste98perhaps Also look at Igel03classes

''Introduction''

What is NFL? Introduce the core problem and explain how it has been applied to cover all search and optimization.
</div>
<div tiddler="OptionsPanel" modified="200507141410" modifier="joeraii" tags="systemTiddlers">These interface options are saved in your browser
                  
Your username for signing your edits. 

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; Save Backups
&lt;&lt;option chkAutoSave&gt;&gt; Auto Save
&lt;&lt;option chkGenerateAnRssFeed&gt;&gt; Generate an RSS Feed
&lt;&lt;option chkRegExpSearch&gt;&gt; Reg Exp Search
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; Case-sensitive Search
&lt;&lt;option chkAnimate&gt;&gt; Enable Animations
    
See AdvancedOptions</div>
<div tiddler="Papers: Evolvability" modified="200507141121" modifier="joeraii" tags="paper evolvability research">* ''Marc Toussaint''
* ''"[[Perspective: Evolvability]]" Kirschner and Gerhart'' 
Evolvability is an organism's capacity to generate heritable phenotypic variation.
* ''"[[Evolvability and Static vs. Dynamic Fitness]]" Glickman and Sycara''
Static fitness functions cause loss of variability/variation and thus degradation of evolvability.
* ''"[[Some Representation and Ecological Aspects of Evolvability]]" Tim Taylor'' 
 The aspects of the system providing the "drive" for evolvability has been neglected. Even if a system has a capacity for high evovlability, it will not realize this capacity if the appropriate selection pressures are absent.
* ''"[[Measuring Evolvability as the Rate of Complexity Increase]]" Nehaniv''
Theoretical measure of complexity.
* ''"[[String Rewriting Grammar Optimized Using an Evolvability Measure]]"  Hideaki Suzuki''
** What is an objective measure for evolvability?
** What are the necessary conditions for an ~ALife system to be highly evolvable?
** How can we optimize an ~ALife system design in terms of evolvability?
* ''"[[Evolvability of an RNA Virus is Determined by its Mutational Neighborhood]]"  Christina Burch and Lin Chao (Nature)''
* ''"[[Evolvability is a Selectable Trait]]"  David Earl and Michael Deem (PNAS)''</div>
<div tiddler="Perspective: Evolvability" modified="200507131231" modifier="joeraii" tags="paper evolvability research">No description yet</div>
<div tiddler="Rich Sutton" modified="200507141520" modifier="joeraii" tags="clipping ai sutton">* [[What's Wrong with Artificial Intelligence]]
* [[Verification, the Key to AI]]</div>
<div tiddler="SideBarOptions" modified="200507151612" modifier="joeraii" tags="systemTiddlers">&lt;&lt;listOpen&gt;&gt;</div>
<div tiddler="SideBarTabs" modified="200507131948" modifier="joeraii" tags="systemTiddlers">&lt;&lt;tabs txtMainTab
Timeline Timeline TabTimeline
Tags "All tags" TabTags
More "More lists" TabMore&gt;&gt;</div>
<div tiddler="Siglets" modified="200507151624" modifier="joeraii" tags="addition introduction">[[Siglets]] are bits of CSS code that correspond to a specific tag. In the sidebar at left, the small colored squares are siglets generated from the first tag of each tiddler, note how the color is preserved in the Tiddler title, and the body as well.  The shape is preserved across the sidebars and the popups, and the color is preserved everywhere. Using many colors and shapes helps your brain to develop associations faster, as well as makes it easier to scan the page for important information (e.g. TODO entries). 

Siglets help you keep track of some kind type or class information associated with a certain Tiddly entry, for example a TODO item tiddly, or a tiddly about Work, etc. They allow you to quickly scan a list of tiddlys and pick out what is necessary for a certain task. For example you can tag TODO tiddlies with an obnoxious color so that you make them want to go away.  @@color(orange):For something really cool look at the popup menus.@@

@@color(yellow):Currently siglets don't render correctly in the tiddler body or title.@@ This is due to my lack of understanding of div elements, and how to make them not line-break. Ultimately this might require completely re-engineering siglets, but for now, changing the text background color will suffice (although it is ugly, somewhat distracting, and makes things difficult to read in some cases). 

The CSS code for doing the color, shape, etc., can be found in the top of StyleSheet .</div>
<div tiddler="SiteSubtitle" modified="200507150009" modifier="joeraii" tags="systemTiddlers excludeLists">&lt;&lt;closeAll&gt;&gt; - &lt;&lt;permaview&gt;&gt;</div>
<div tiddler="SiteTitle" modified="200507141658" modifier="joeraii" tags="systemTiddlers excludeLists">siglet</div>
<div tiddler="SiteUrl" modified="200507131947" modifier="joeraii" tags="systemTiddlers excludeLists">http://www.cs.utexas.edu/~joeraii/datagarden</div>
<div tiddler="Some Representation and Ecological Aspects of Evolvability" modified="200507112050" modifier="joeraii" tags="paper evolvability research">Type the text for 'Some Representation and Ecological Aspects of Evolvability' here.</div>
<div tiddler="String Rewriting Grammar Optimized Using an Evolvability Measure" modified="200507131459" modifier="joeraii" tags="paper evolvability research">* Measure evolvability as average change in fitness.</div>
<div tiddler="TabMore" modified="200507122046" modifier="joeraii" tags="systemTiddlers">&lt;&lt;tabs txtMoreTab
All "All tiddlers" TabMoreAll
Missing "Missing tiddlers" TabMoreMissing
Orphans "Orphaned tiddlers" TabMoreOrphans
&gt;&gt;</div>
<div tiddler="TabMoreAll" modified="200507122046" modifier="joeraii" tags="systemTiddlers">&lt;&lt;list all&gt;&gt;</div>
<div tiddler="TabMoreMissing" modified="200507122046" modifier="joeraii" tags="systemTiddlers">&lt;&lt;list missing&gt;&gt;</div>
<div tiddler="TabMoreOrphans" modified="200507122046" modifier="joeraii" tags="systemTiddlers">&lt;&lt;list orphans&gt;&gt;</div>
<div tiddler="TabTags" modified="200507122046" modifier="joeraii" tags="systemTiddlers">&lt;&lt;allTags&gt;&gt;</div>
<div tiddler="TabTimeline" modified="200507122046" modifier="joeraii" tags="systemTiddlers">&lt;&lt;timeline&gt;&gt;</div>
<div tiddler="TextFormatting" modified="200507141509" modifier="joeraii" tags="usability interface">!!Some kind of Header
!Header?

''Bold''
==Strike==
__Underline__
//Italic//
2^^3^^=8
a~~ij~~ = -a~~ji~~
@@highlight@@
@@color(green):green colored@@
@@bgcolor(#ff0000):color(#ffffff):red colored@@
*Legende zum Vorlesungsverzeichnis
**@@bgcolor(#a0ffa0):color(black): bedeutet hier@@
**@@bgcolor(#ffdead):color(black): etwas anderes@@
**@@bgcolor(#ffbfff):color(black): Lanthanides@@
**@@bgcolor(#ff99cc):color(black): Actinides@@
**@@bgcolor(#ffc0c0):color(black): Transition metals@@
**@@bgcolor(#cccccc):color(black): Poor metals@@
**@@bgcolor(#cccc99):color(black): Metalloids@@
**@@bgcolor(#a0ffa0):color(black): Nonmetals@@
**@@bgcolor(#ffff99):color(black): Halogens@@
**@@bgcolor(#c0ffff):color(black): Noble gases@@

*** @@color(#a0ffa0):TODO@@
*** @@color(#ffdead):IBM@@
*** @@color(#ffbfff):Research@@
*** @@color(#ff99cc):Japan@@
*** @@color(#ffc0c0):Culture@@</div>
<div tiddler="TiddlyWikiRemote" modified="200507141654" modifier="joeraii" tags="serverside remote">[[Here|http://www.phiffer.org/tiddly]]</div>
<div tiddler="Towards an Empirical Measure of Evolvability" modified="200507132032" modifier="joeraii" tags="paper evolvability research gecco2005">//Joseph Reisinger, Kenneth O. Stanley and Risto Miikkulainen (2005). Towards an Empirical Measure of Evolvability, Proceedings of the Genetic and Evolutionary Computation Conference (GECCO-2005) Workshop ~Program.//

Genetic representations that do not employ a one-to-one mapping of genotype to phenotype are known as indirect encodings, and can be much more efficient than direct encodings for complex problems. Increasing a representation's capacity to facilitate effective search, i.e. its evolvability, has long been a goal of Evolutionary ~Computation. However, currently no benchmarks exist to measure evolvability. One reason is that it is difficult to decouple a representation's capacity to evolve under any fitness function, i.e. the latent evolvability, and its performance on a specific benchmark. Towards this goal, a method is proposed in this paper that measures the representation's ability to extract invariant properties from a changing fitness function. The test is applied to three distinct representations and it is able to distinguish all three. Ultimately, this test can serve as the foundation for performing controlled experiments determining what factors contribute to evolvability. </div>
<div tiddler="Verification, the Key to AI" modified="200507132032" modifier="joeraii" tags="clipping ai sutton">[[Rich Sutton]]

11/15/2001

It is a bit unseemly for an AI researcher to claim to have a special insight or plan for how his field should proceed. If he has such, why doesn't he just pursue it and, if he is right, exhibit its special fruits? Without denying that, there is still a role for assessing and analyzing the field as a whole, for diagnosing the ills that repeatedly plague it, and to suggest general solutions.

The insight that I would claim to have is that the key to a successful AI is that it can tell for itself whether or not it is working correctly. At one level this is a pragmatic issue. If the AI can't tell for itself whether it is working properly, then some person has to make that assessment and make any necessary modifications. An AI that can assess itself may be able to make the modifications itself.

The Verification Principle:

An AI system can create and maintain knowledge only to the extent that it can verify that knowledge itself.

Successful verification occurs in all search-based AI systems, such as planners, game-players, even genetic algorithms. Deep Blue, for example, produces a score for each of its possible moves through an extensive search. Its belief that a particular move is a good one is verified by the search tree that shows its inevitable production of a good position. These systems don't have to be told what choices to make; they can tell for themselves. Image trying to program a chess machine by telling it what kinds of moves to make in each kind of position. Many early chess programs were constructed in this way. The problem, of course, was that there were many different kinds of chess positions. And the more advice and rules for move selection given by programmers, the more complex the system became and the more unexpected interactions there were between rules. The programs became brittle and unreliable, requiring constant maintainence, and before long this whole approach lost out to the "brute force" searchers.
Although search-based planners verify at the move selection level, they typically cannot verify at other levels. For example, they often take their state-evaluation scoring function as given. Even Deep Blue cannot search to the end of the game and relies on a human-tuned position-scoring function that it does not assess on its own. A major strength of the champion backgammon program, ~TD-Gammon, is that it does assess and improve its own scoring function.

Another important level at which search-based planners are almost never subject to verification is that which specifies the outcomes of the moves, actions, or operators. In games such as chess with a limited number of legal moves we can easily imagine programming in the consequences of all of them accurately. But if we imagine planning in a broader AI context, then many of the allowed actions will not have their outcomes completely known. If I take the bagel to Leslie's office, will she be there? How long will it take to drive to work? Will I finish this report today? So many of the decisions we take every day have uncertain and changing effects. Nevertheless, modern AI systems almost never take this into account. They assume that all the action models will be entered accurately by hand, even though these may be most of the knowledge in or ever produced by the system.

Finally, let us make the same point about knowledge in general. Consider any AI system and the knowledge that it has. It may be an expert system or a large database like ~CYC. Or it may be a robot with knowledge of a building's layout, or knowledge about how to react in various situations. In all these cases we can ask if the AI system can verify its own knowledge, or whether it requires people to intervene to detect errors and unforeseen interactions, and make corrections. As long as the latter is the case we will never be able to build really large knowledge systems. They will always be brittle and unreliable, and limited in size to what people can monitor and understand themselves.

"Never program anything bigger than your head"

And yet it is overwhelmingly the case that today's AI systems are not able to verify their own knowledge. Large ontologies and knowledge bases are built that are totally reliant on human construction and maintainence. "Birds have wings" they say, but of course they have no way of verifying this.</div>
<div tiddler="What's Wrong with Artificial Intelligence" modified="200507141438" modifier="joeraii" tags="clipping ai research sutton">[[Rich Sutton]]

11/12/2001

I hold that AI has gone astray by neglecting its essential objective --- the turning over of responsibility for the decision-making and organization of the AI system to the AI system itself. It has become an accepted, indeed lauded, form of success in the field to exhibit a complex system that works well primarily because of some insight the designers have had into solving a particular problem. This is part of an anti-theoretic, or "engineering stance", that considers itself open to any way of solving a problem. But whatever the merits of this approach as engineering, it is not really addressing the objective of AI. For AI it is not enough merely to achieve a better system; it matters how the system was made. The reason it matters can ultimately be considered a practical one, one of scaling. An AI system too reliant on manual tuning, for example, will not be able to scale past what can be held in the heads of a few programmers. This, it seems to me, is essentially the situation we are in today in AI. Our AI systems are limited because we have failed to turn over responsibility for them to them.

Please forgive me for this which must seem a rather broad and vague criticism of AI. One way to proceed would be to detail the criticism with regard to more specific subfields or subparts of AI. But rather than narrowing the scope, let us first try to go the other way. Let us try to talk in general about the longer-term goals of AI which we can share and agree on. In broadest outlines, I think we all envision systems which can ultimately incorporate large amounts of world knowledge. This means knowing things like how to move around, what a bagel looks like, that people have feet, etc. And knowing these things just means that they can be combined flexibly, in a variety of combinations, to achieve whatever are the goals of the AI. If hungry, for example, perhaps the AI can combine its bagel recognizer with its movement knowledge, in some sense, so as to approach and consume the bagel. This is a cartoon view of AI -- as knowledge plus its flexible combination -- but it suffices as a good place to start. Note that it already places us beyond the goals of a pure performance system. We seek knowledge that can be used flexibly, i.e., in several different ways, and at least somewhat independently of its expected initial use.

With respect to this cartoon view of AI, my concern is simply with ensuring the correctness of the AI's knowledge. There is a lot of knowledge, and inevitably some of it will be incorrrect. Who is responsible for maintaining correctness, people or the machine? I think we would all agree that, as much as possible, we would like the AI system to somehow maintain its own knowledge, thus relieving us of a major burden. But it is hard to see how this might be done; easier to simply fix the knowledge ourselves. This is where we are today.</div>
<div tiddler="-evolution" modified="200507181503" modifier="joeraii" tags="notes evolvability evolution theory">Each genotype g can be written as a tuple (x, ), where x is the phenotype and  is the neutral traits. The main point is that  evolves just like x. " is basically how good the mutational phenotypic variability matches the distribution of good organisms."  is a parameter describing the space around this x. 

Is this a useful separation? Aren't there degrees of neutrality? Can two genotypes have the same neutral traits and phenotypes, but different evolvability structures? -- __Of course__ This occurs when it is the non-neutral traits that create x, then looking at only  for the evolvability structure is misleading. 

From notes pg. 50 7/2/05.</div>
<div tiddler="" modified="200507182040" modifier="joeraii" tags="culture japan"></div>
<div tiddler="pytw" modified="200508242116" modifier="YourName" tags="introduction addition">pytw is a simple serverside backend written in pure python. Its available separate from siglet, [[here|http://www.cs.utexas.edu/~joeraii/pytw]]</div>
<div tiddler="TagCloud" modified="200508172213" modifier="joeraii" tags="macro systemConfig excludeLists">version.extensions.tagCloud = {major: 0, minor: 1, revision: 0, date: new Date(2005,7,31)}; 

config.macros.tagCloud = { noTags: "No tag cloud created because there are no tags." }; 

config.macros.tagCloud.handler = function(place,macroName,params) { 
 var tagCloudWrapper = createTiddlyElement(place,"div",null,"tagCloud",null); 
 var tags = store.getTags(); 
 if(tags.length == 0) 
createTiddlyElement(tagCloudWrapper,"span",null,null,this.noTags); 
  //Findout the maximum number of tags 
  var mostTags = 0; 
  for (t=0; t&lt;tags.length; t++) { 
   if (tags[t][1] &gt; mostTags) mostTags = tags[t][1]; 
  } 
  //divide the mostTags into 6 segments for the 6 different tagCloud sizes 
  var tagSegment = mostTags / 4; 
  for (t=0; t&lt;tags.length; t++) { 
  if( tags[t][0].substr(0,6) != "author" &amp;&amp; tags[t][0] != "excludeLists" &amp;&amp;  tags[t][0] != "systemTiddlers")
{
   var tagCloudElement =createTiddlyElement(tagCloudWrapper,"span",null,null,null); 
 tagCloudWrapper.appendChild(document.createTextNode(" ")); 
   var theTag = createTiddlyButton(tagCloudElement,tags[t][0],this.tooltip + tags[t][0],onClickTag,"tagCloud"+(Math.round(tags[t][1]/tagSegment)+1)); 
   theTag.setAttribute("tag",tags [t][0]); 
   theTag.setAttribute("tags",tags [t][0]); 
  } 
}
}; 

setStylesheet(".tagCloud span{height: 1.8em; margin-top: 3px; margin-bottom: 3px; }.tagCloud1{font-size: 1.0em;}.tagCloud2{font-size: 1.2em;}.tagCloud3{font-size: 1.4em;}.tagCloud4{font-size: 1.6em;}.tagCloud5{font-size: 1.8em;font-weight: bold;}","tagCloudsStyles"); </div>
<div tiddler="CloudWrapper" modified="200508310220" modifier="YourName" tags="visualization usability addition">Tag Cloud by Clint Checketts: [[http://15black.bluedepot.com/twtests/tagcloud.htm|http://15black.bluedepot.com/twtests/tagcloud.htm]]
... done siglet style.

&lt;&lt;tagCloud&gt;&gt;
==:( unfortunately the popup context menus don't appear==
==Still a few display glitches.==
Seems to render OK in firefox, weird little bounding-box bug with Safari. No clue about IE (I care though... sort of... email me).</div>
<div tiddler="StyleSheet" modified="200509061229" modifier="joeraii" tags="stylesheet systemTiddlers interface">/* The siglet default shape definition */
.siglet { display: none;  float: left; margin-right: 0.5em; height: 1em; width: 1em;  border: 1px solid black; }

/* Needs to come before the per-tag color-setting for title */
.title { position: relative; cursor:move; border: 1px solid black; font-size: 1.5em; padding-left: 2px; padding-right: 2px; padding-bottom: 1px;  }
.tiddler { position:relative; }
.body {background:#4a525a;}
a:link, .body a:visited { background-color: none;  }
.viewer a:hover { text-decoration: underline; }
.tiddlyLinkExisting { border: 1px solid black;  padding-left: 2px; padding-right: 2px;   }
.tiddlyLinkExisting:hover { text-decoration: none; border: 1px solid white; }
.button { border: 1px solid /*#666;*/ #4a525a; }
.viewer .tiddlyLinkExisting { font-size: 7pt; font-weight: normal; white-space: nowrap; }
.viewer .tiddlyLinkNonExisting { color: #BBC; font-style: italic; }
.viewer .tiddlyLinkNonExisting:hover { background: none; text-decoration: underline; color: #930; }
.viewer .externalLink { text-decoration: underline; color: #BBC; }
.viewer .externalLink:hover { text-decoration: underline; color: #cd4bff; }

.body .button { font-size: 6pt; line-height: 120%; }
.body .button:hover { color: white; border: 1px solid white; }
.editor .footer A, body, body a, .viewer, #siteSubtitle a {color: white; border: 0px; }

[[SigletColors]]

/* Needed to supress coloring the viewer background based on tag. */
.viewer .siglet, .title .siglet, .footer .siglet { display: none; }

#titleLine, #sidebarOptions, #sidebarOptions .tiddlyLink, .tabSelected, .tabUnselected, .tabContents, #popup, #popup .tiddlyLink, #popup a, h1,h2,h3,h4  { color: #eee; background: #2a323a; }

body { font-size: 8pt; font-family: verdana, helvetica; background: #4a525a;}
#titleLine { display: block; } 
#siteTitle { float: left; letter-spacing: 0.3em;  padding-left: 1em;  }
#siteSubtitle {  text-align: right; padding-right: 2em; }
#siteSubtitle a:hover { color: #adf702; }
#displayArea { margin: 1em 0.1em 0em 23em; padding: 0px 12px 20px 12px; }  

.body { padding: 1em;  text-align: justify; border: 1px solid #666; margin-top: 1em; }

.viewer pre { width: 100%; overflow: auto; }
.highlight, .marked { background: #cd4bff; }

#sidebar { float: left; margin: 1em 0em 0em 1em; width: 22em; }
#sidebarOptions {font-size: 7pt; padding: 0.75em; }
#sidebarOptions .tiddlyLink { font-size: 8pt; display: block; border: 0px; line-height: 120% }
#sidebarOptions .tiddlyLink:hover, #sidebarTabs .tiddlyLinkExisting:hover {border: 0px; text-decoration: underline; }
#sidebarOptions .tiddlyLinkNonExisting:hover, #sidebarTabs
.tiddlyLinkNonExisting:hover { text-decoration: underline; color: #930; }
.tabSelected { color: #adf702;  }
.tabContents { font-size: 9px; padding: 6px; }
.tabContents .button, .tabContents .tiddlyLink { color: white; border: 0px; display: block; }
.tabContents .button:hover { background: orange; }
.tabContents .tiddlyLink:hover { background: none; }
.sidebarContentEven { background: #5a6270; padding: 0.25em 0.5em 0.25em 0.5em;  }
.sidebarContentOdd { background: #6a7280; padding: 0.25em 0.5em 0.25em 0.5em; }
.sidebarContentEven .tiddlyLink, .sidebarContentEven .button { background: #5a6270; }
.sidebarContentOdd  .tiddlyLink, .sidebarContentOdd .button  { background: #6a7280; }

.footer {  font-size: 8px; padding-top: 0.5em; padding-bottom: 0.5em;}
.footer .footerTags { float: left; }
.footer .footerRefs { float: right;  }
.footer .button, .footer .tiddlyLink {margin-right: 0.2em; padding: 0px; padding-left: 1px; padding-right: 1px; }
.footer .button:hover { color: white; border: 1px solid white; }
.footer .footerRefs .tiddlyLink:hover { color: #dde; border: 1px solid white; }
.footer .footerRefs .tiddlyLink { margin-right: 0.2em; }
.footer #popup .tiddlyLink { float: none; border: none; }

.toolbar {float: right; }
.toolbar .button {color: #888;  }
.toolbar .button:hover { text-decoration: none; color: #333; background: #EEE; }
.toolbar .button:active { color: white; background: #ccff87; }
.toolbar a { padding: 0.3em 0.5em 0.3em 0.5em;  border: 1px solid #888;   }

#popup { width: 20em; display: none; position: absolute; font-size: 7pt; border: 1px #999 solid; z-index: 10; }
#popup a { text-decoration: none; display: block;  line-height: 100%; margin-bottom: 0.28em;  }
#popup a:hover { background: white; color: #073252; }
#popup hr { border: none; }

#popup .siglet { display: block;  }

.zoomer { border: none; font-size: 0pt; }

.tagCloud a:hover {text-decoration: none; background: orange;}
.tagCloud { line-height: 2em; }
.tagCloud #popup a { text-decoration: none;  }
.tagCloud #popup .tiddlyLink { float:none; border: none; }
.tagCloud #popup {width: auto; }</div>
<div tiddler="SigletColors" modified="200509061224" modifier="joeraii" tags="stylesheet systemTiddlers interface">/*System-wide tag colorings: Need all the display: inlines for hiding non-existant siglets. */
[tag="systemTiddlers"] { color: #222; background: #ccc; }
[tag="macro"] { color: #222; background: #fefc03; }
[tag="paper"] { color: #222; background: #cf3; display: inline; }
[tag="clipping"] { color: #222; background: #fc0; display: inline; }
[tag="todo"] { background: #f30; display: inline; }
[tag="!"] { background: #d64422; display: inline; border: 1px solid orange; }
[tag="interesting"] { background: #96c; display: inline; }
[tag="notes"] { background: #3c6; display: inline;  }
[tag="book"] { background: #39c; display: inline; }
[tag="visualization"] { background: #f99; display: inline; }
[tag="culture"] { background: #c69; border: 1px dashed white; display: inline; }
[tag="addition"] { color: #222; background: #3ff; display: inline; }
[tag="introduction"] { background: #c9f; }
[tag="stylesheet"] { background: black; display: inline; }
[tag="want"] { color: #222; background: #bdeeff; display: inline; border: 1px dashed black; }
[tag="evolvability"] { color: #222; background: #bdeeff; display: inline; }
[tag="list"] { color: #222; background: #ddd; display: inline; }
[tag="japan"] { background: #ff8a22; border: 1px dashed black; display: inline; }
[tag="development"] { background: #ff8a22; display: inline; }
[tag="representation"] { background: #8a3b78; display: inline; }
[tag="complexity"] { background: #29558b; display: inline; }
[tag="programming"] { color: #222; background: #fff200; display: inline; }
[tag="ibm"] { color: white; background: #112fff; display: inline; border: 1px solid white; }
[tag="dynamic"] { color: red; background: #fff200; display: inline; border: 1px dashed red; }
[tag="_invisible"] { color: #222;display: inline;  }
[tag="addition"] { background-color: #33ffff; display: inline; }
[tag="introduction"] { background-color: #cc99ff; display: inline; border: 1px
dotted white;  }

/* Specific siglet level shape overrides Good color: #ff00bd; */
[tag="systemTiddlers"].siglet, [tag="stylesheet"].siglet, [tag="macro"].siglet { display: inline; width: 0.5em; margin-right: 0.75em; margin-left: 0.25em; }

</div>
<div tiddler="pytw hits: 0(0) siglet hits: 4433(8605) " modified="200712030035" modifier="_dynamic" tags="dynamic log personal">
186	lj2322.inktomisearch.com
157	lj611772.inktomisearch.com
135	lm502011.inktomisearch.com
128	fj1011.inktomisearch.com
91	egspd42460.ask.com
91	lj1340.inktomisearch.com
88	lj9118.inktomisearch.com
88	egspd42446.ask.com
79	lj601033.inktomisearch.com
78	5ac7ce42.bb.sky.com
61	lj601644.inktomisearch.com
61	fj5025.inktomisearch.com
58	lj611772.crawl.yahoo.net
57	egspd42462.ask.com
56	lj611429.inktomisearch.com
52	lj611429.crawl.yahoo.net
51	fj1008.inktomisearch.com
40	fj301021.inktomisearch.com
37	lj511033.crawl.yahoo.net
37	lj611617.inktomisearch.com
35	msnbot.msn.com
34	ip67-154-88-233.z88-154-67.customer.algx.net
33	argon.hmstudio.hu
32	lm502011.crawl.yahoo.net
32	lj611472.inktomisearch.com
32	pool-72-92-80-76.phlapa.fios.verizon.net
31	mu-017064.dhcp.missouri.edu
31	lj910384.inktomisearch.com
29	lj1352.inktomisearch.com
24	lj611546.inktomisearch.com
24	cpe-70-113-27-111.austin.res.rr.com
23	yktgi01e0-s4.watson.ibm.com
23	host-213-213-196-53.brutele.be
20	lj511931.crawl.yahoo.net
19	68-190-80-216.dhcp.mdsn.wi.charter.com
17	h7203.upc-h.chello.nl
17	lj910384.crawl.yahoo.net
17	fj301003.inktomisearch.com
16	lj601638.inktomisearch.com
16	lj2161.inktomisearch.com
16	ct501069.inktomisearch.com
16	lj2554.inktomisearch.com
15	lan-84-240-58-172.vln.skynet.lt
15	rz502446.inktomisearch.com
15	pool-71-246-23-44.phlapa.fios.verizon.net
14	lj9014.inktomisearch.com
14	lj910194.inktomisearch.com
14	nolmstd-cadent1-24-52-179-41.clvdoh.adelphia.net
14	rz502206.inktomisearch.com
14	acbc3717.ipt.aol.com
13	213.213.196.148.brutele.be
12	nat88.nipltd.com
12	dyn-83-156-94-73.ppp.tiscali.fr
11	vs841.rosehosting.com
11	adsl-70-237-163-80.dsl.sfldmi.sbcglobal.net
11	204-85-65-68.wc.rl-nc.ntc-com.net
11	fj5010.inktomisearch.com
11	egspd42101.ask.com
10	a32248.upc-a.chello.nl
10	pool-71-162-238-179.phlapa.fios.verizon.net
10	lj611238.inktomisearch.com
10	livebot-65-55-209-54.search.live.com
9	gate-de.freescale.com
9	c-68-53-107-41.hsd1.tn.comcast.net
9	host-81-191-156-59.bluecom.no
9	pool-72-92-80-16.phlapa.fios.verizon.net
8	u.azdigw02.index.or.jp
8	opncrd1.search.mud.yahoo.com
8	c-24-218-203-192.hsd1.ma.comcast.net
8	crawler4040.ask.com
8	12-223-248-214.client.insightbb.com
8	crawl-66-249-70-186.googlebot.com
8	64-198-88-100.xwires.net
8	64.124.85.72.become.com
8	ct501304.inktomisearch.com
8	h13092.upc-h.chello.nl
8	c-68-54-174-199.hsd1.md.comcast.net
8	livebot-207-46-98-49.search.live.com
8	free.mekensleep.com
8	a37223.upc-a.chello.nl
8	lj511002.crawl.yahoo.net
8	ce01pc08.netcabo.net
7	d199-126-170-17.abhsia.telus.net
7	121.97.105.207.bti.net.ph
7	wbs-196-2-124-250.wbs.co.za
7	dsl081-073-002.sfo1.dsl.speakeasy.net
7	ca527-ch01-bl05.tx-dallas0.sa.earthlink.net
7	lj602245.inktomisearch.com
7	crawler100.ask.com
7	c-24-62-122-110.hsd1.ma.comcast.net
7	81-5-142-218.dsl.eclipse.net.uk
7	119-144.127-70.tampabay.res.rr.com
7	egspd42468.ask.com
7	customer.vpls.net
7	troglodyte.passereaux.jmsp.net
7	lm501022.inktomisearch.com
7	egspd42059.teoma.com
7	shepherd.logos.k.u-tokyo.ac.jp
6	lj611546.crawl.yahoo.net
6	aclermont-ferrand-157-1-38-190.w86-194.abo.wanadoo.fr
6	ac5-webproxy74.direcpc.com
6	bi01p1.nc.us.ibm.com
6	lj9076.inktomisearch.com
6	host-12-22-56-33.certive.com
6	livebot-65-55-212-188.search.live.com
6	82-170-36-132.dsl.ip.tiscali.nl
6	c906b577.virtua.com.br
6	linac.txcorp.com
6	c-67-160-173-220.hsd1.or.comcast.net
6	213-162-100-101.matthe005.adsl.metronet.co.uk
6	c-24-6-248-82.hsd1.ca.comcast.net
6	millionsquarefeet.com
6	70-57-149-211.mpls.qwest.net
6	lap81-1-82-245-69-185.fbx.proxad.net
6	213.213.196.173.brutele.be
6	lj611828.inktomisearch.com
6	cpe-24-193-236-148.ucwphilly.res.rr.com
6	lm502000.inktomisearch.com
6	83.72.231.124.ip.tele2adsl.dk
6	dsl254-071-197.nyc1.dsl.speakeasy.net
6	hs-out-f136.google.com
6	xd-22-78-a8.bta.net.cn
6	p54ae7163.dip.t-dialin.net
6	cdt4000.inktomisearch.com
6	cdev6017.yst.corp.yahoo.com
6	egspd42122.ask.com
5	modemcable106.129-131-66.mc.videotron.ca
5	crawl-66-249-65-43.googlebot.com
5	crawl-66-249-72-193.googlebot.com
5	ppp154-114.lns1.mel3.internode.on.net
5	c-67-190-50-11.hsd1.co.comcast.net
5	eve-micro183.ucdavis.edu
5	pat.ccf.org
5	0030bd02f6ca.click-network.com
5	proxy-5v.club-internet.fr
5	74.72.344a.static.theplanet.com
5	ip67-94-101-190.z101-94-67.customer.algx.net
5	lj601931.inktomisearch.com
5	cpe-68-175-79-43.nyc.res.rr.com
5	adsl-75-0-237-48.dsl.crchtx.sbcglobal.net
5	irl-crawler3.cs.tamu.edu
5	g2spf.jeeves.ask.info
5	inetgate.nl.sykes.com
5	cpe0014380e1523-cm00159a041c3c.cpe.net.cable.rogers.com
5	c-67-185-136-97.hsd1.wa.comcast.net
5	ordi61-235.icmcb-bordeaux.cnrs.fr
5	c-24-11-95-175.hsd1.mi.comcast.net
5	agp.stanford.edu
5	64-142-43-45.dsl.static.sonic.net
5	lj612345.inktomisearch.com
5	midd-cache-2.server.ntli.net
5	crawl-66-249-65-146.googlebot.com
5	24-136-10-126.hnc-bsr1.chi-hnc.il.cable.rcn.com
5	ryan.pediatrics.wisc.edu
5	livebot-207-46-98-52.search.live.com
5	c-69-181-82-141.hsd1.ca.comcast.net
5	dsl092-052-049.phl1.dsl.speakeasy.net
5	wuw-td41difgig.dybb.com
5	sgl69-1-82-231-119-148.fbx.proxad.net
5	dhcp106.fis.unical.it
5	cpe-74-65-252-243.nyc.res.rr.com
5	c-67-161-78-120.hsd1.ca.comcast.net
5	a79204.upc-a.chello.nl
5	proxy3.tufts-health.com
5	pc243.ulstein.no
5	p5113-ipad504marunouchi.tokyo.ocn.ne.jp
5	122x215x159x81.ap122.ftth.ucom.ne.jp
5	lj910005.inktomisearch.com
5	cmbg-cache-1.server.ntli.net
4	proxy.dexia.be
4	p54bd5206.dip.t-dialin.net
4	glenlivet.hud.ac.uk
4	ool-44c31b18.dyn.optonline.net
4	crawl26-public.alexa.com
4	ven06-1-82-234-157-28.fbx.proxad.net
4	lj2137.inktomisearch.com
4	pool-71-249-56-113.nycmny.east.verizon.net
4	lj511275.crawl.yahoo.net
4	a81-84-64-57.cpe.netcabo.pt
4	cpe-65-28-165-35.neb.res.rr.com
4	68-76-132-236.ded.ameritech.net
4	foobar.sita.aero
4	class23.smith.udel.edu
4	njproxy1.avaya.com
4	crs057.goo.ne.jp
4	211.253.244.43.ap.zero-isp.net
4	206-169-247-2.gen.twtelecom.net
4	liberty-proxy.lmig.com
4	host-24-149-166-106.patmedia.net
4	webcache.cs.bham.ac.uk
4	c-24-118-138-74.hsd1.mn.comcast.net
4	proxy1.search.scd.yahoo.net
4	g195076.upc-g.chello.nl
4	cpe-60-228-6-5.nsw.bigpond.net.au
4	host-213-213-196-215.brutele.be
4	i155219.upc-i.chello.nl
4	dsl-202-52-60-180.nsw.veridas.net
4	43-177.126-70.tampabay.res.rr.com
4	c-75-68-209-133.hsd1.vt.comcast.net
4	c-71-56-7-87.hsd1.ga.comcast.net
4	218-214-113-66.people.net.au
4	adsl-19-19-53.asm.bellsouth.net
4	62-101-126-237.ip.fastwebnet.it
4	12-219-144-158.client.mchsi.com
4	84-105-239-66.cable.quicknet.nl
4	3209ds1-rdo.0.fullrate.dk
4	lj602189.inktomisearch.com
4	ool-435131a2.dyn.optonline.net
4	tp-s2-c91-3.router.hinet.net
4	dslb-084-056-145-051.pools.arcor-ip.net
4	82-95.8-67.tampabay.res.rr.com
4	12-205-235-186.client.mchsi.com
4	jyxo.etargetnet.com
4	dj101001.inktomisearch.com
4	c-24-4-34-191.hsd1.ca.comcast.net
4	mail.bfkh.hu
4	c-67-168-202-157.hsd1.or.comcast.net
4	bad-bart.lcp.nrl.navy.mil
4	www-gw3.credit-suisse.com
4	ip-213-190-58-131.static.b4net.lt
4	82-34-145-205.cable.ubr04.gray.blueyonder.co.uk
4	cpe-70-93-240-248.san.res.rr.com
4	i220-108-208-159.s02.a013.ap.plala.or.jp
4	pcp01494921pcs.rte20201.de.comcast.net
4	d122.nexlink.net
4	cpe-71-74-161-107.indy.res.rr.com
4	216.215.139.10.nw.nuvox.net
4	213-0-232-107.dialup.nuria.telefonica-data.net
4	c-24-17-56-254.hsd1.wa.comcast.net
4	bi01p1.co.us.ibm.com
4	crawl-66-249-66-145.googlebot.com
4	avelizy-155-1-81-120.w90-2.abo.wanadoo.fr
4	p54b31383.dip0.t-ipconnect.de
4	mv521031.inktomisearch.com
4	c-24-34-119-59.hsd1.ma.comcast.net
4	84-203-5-240.mysmart.ie
4	cpe-60-228-46-128.nsw.bigpond.net.au
4	pslux.cec.eu.int
4	dneg-fw.dneg.com
4	pool-71-241-188-56.buff.east.verizon.net
4	pool-162-84-154-227.ny5030.east.verizon.net
4	host244-114.pool83221.interbusiness.it
4	lj611664.inktomisearch.com
4	smtp.cbsh.com
4	sfilter124-2.itc.swri.edu
4	pool-68-161-5-122.ny325.east.verizon.net
4	lj611480.crawl.yahoo.net
4	ip-253-genesys.miratech.ua
4	crawl-66-249-66-141.googlebot.com
4	ct501007.inktomisearch.com
3	nor75-10-82-226-75-140.fbx.proxad.net
3	user-0cdfb1i.cable.mindspring.com
3	crawler.bloglines.com
3	inetgw.ummhc.org
3	trotsky.ucdavis.edu
3	c-71-228-217-171.hsd1.tn.comcast.net
3	mnch-d9b869e6.pool.mediaways.net
3	89-172-11-137.adsl.net.t-com.hr
3	h3211.upc-h.chello.nl
3	crawler4.irl.cs.tamu.edu
3	pool-71-123-52-75.phlapa.fios.verizon.net
3	h-66-134-124-10.lsanca54.covad.net
3	csc-fch-chd-1-ign-pub.amer.csc.com
3	crawl-66-249-65-7.googlebot.com
3	proxy-4m.club-internet.fr
3	ntl208h101-64-100.nt.net
3	138-72-40-157.pixar.com
3	83-65-203-114.work.xdsl-line.inode.at
3	adsl-71-159-53-131.dsl.ltrkar.sbcglobal.net
3	bay-bridge.veritas.com
3	mail.euroclear.com
3	89-36-94-200.skynet-telecom.ro
3	p5082b96b.dip0.t-ipconnect.de
3	crawl-66-249-71-72.googlebot.com
3	nott-cache-3.server.ntli.net
3	webcache-kotnet-2.kuleuven.ac.be
3	host52-148.pool877.interbusiness.it
3	esprx02x.nokia.com
3	61-220-225-98.hinet-ip.hinet.net
3	bsn-77-65-47.dial-up.dsl.siol.net
3	xd-22-175-a8.bta.net.cn
3	cpe-69-207-169-65.rochester.res.rr.com
3	hse-toronto-ppp296583.sympatico.ca
3	d-ip-129-15-140-102.cate.ou.edu
3	71-14-123-079.dhcp.gnvl.sc.charter.com
3	i121-114-122-93.s05.a013.ap.plala.or.jp
3	lw-box30.moderndedicate.com
3	shepley.parc.xerox.com
3	ws202.deh.ehnr.state.nc.us
3	mt501001.inktomisearch.com
3	l192-117-118-92.broadband.actcom.net.il
3	ip-122-152-140-205.asianetcom.net
3	home-193067.iasi.astral.ro
3	crawl-66-249-72-148.googlebot.com
3	cpe-024-211-144-200.nc.res.rr.com
3	69-161-44-202.sbtnvt.adelphia.net
3	host-24-225-178-19.patmedia.net
3	www.furl.net
3	host86-136-191-30.range86-136.btcentralplus.com
3	p54a1528c.dip.t-dialin.net
3	bucket1.ncl.ac.uk
3	c-68-49-106-186.hsd1.md.comcast.net
3	p508eaf3f.dip0.t-ipconnect.de
3	p21195-adsao01motoma-acca.hiroshima.ocn.ne.jp
3	mered7-finjangw.ser.netvision.net.il
3	zaq3d7d7d74.zaq.ne.jp
3	proxy.zkb.ch
3	c-24-23-167-234.hsd1.ca.comcast.net
3	d47-69-73-183.nap.wideopenwest.com
3	home-213-240-225-101.megalan.bg
3	ursus.spray.net.pl
3	access68.terremark.com
3	crawl-66-249-71-56.googlebot.com
3	h-66-17-68-242.noclli.covad.net
3	cpe-58-164-37-224.nsw.bigpond.net.au.37.164.58.in-addr.arpa
3	ip68-3-206-95.ph.ph.cox.net
3	ed.fortech.lv
3	0x555124f1.adsl.cybercity.dk
3	201-209-182-172.genericrev.cantv.net
3	livebot-65-55-212-189.search.live.com
3	kmcomputer.stanford.edu
3	gralla.ucsf.edu
3	nomad.cognos.com
3	cpe-69-205-160-140.stny.res.rr.com
3	toronto-hse-ppp4170326.sympatico.ca
3	n114h182.uncnet.ru
3	p54a030bf.dip0.t-ipconnect.de
3	cblmdm72-240-73-69.buckeyecom.net
3	cpe0012171a33b3-cm014270111967.cpe.net.cable.rogers.com
3	204.138.static-adsl.customer.ch.easynet.net
3	59-190-66-6.eonet.ne.jp
3	host188-91-static.13-87-r.retail.telecomitalia.it
3	cybersphere.plus.com
3	blueice2n1.de.ibm.com
3	pd95445b0.dip0.t-ipconnect.de
3	82-39-113-2.cable.ubr03.newy.blueyonder.co.uk
3	71-32-128-3.roch.qwest.net
3	adsl-75-34-100-187.dsl.austtx.sbcglobal.net
3	tcnj-157-103.tcnj.edu
3	crawl-66-249-72-180.googlebot.com
3	frodo.acad.cai.cam.ac.uk
3	ip70-179-70-67.dc.dc.cox.net
3	168-103-203-195.hlrn.qwest.net
3	mykonos.vcl.uh.edu
3	ver78-3-82-243-36-55.fbx.proxad.net
3	dmz1.bsiag.com
3	lj511881.crawl.yahoo.net
3	ac8e030a.ipt.aol.com
3	82-36-141-116.cable.ubr02.perr.blueyonder.co.uk
3	synapse.ucsd.edu
3	091-141-020-024.dyn.one.at
3	techcity5.rain.fr
3	mai-gla-cpk.coxinc.com
3	host15-168.pool8253.interbusiness.it
3	p54a155f0.dip.t-dialin.net
3	proxy-w.ccra-adrc.gc.ca
3	pcp0011824409pcs.union01.nj.comcast.net
3	adijon-106-1-4-177.w80-11.abo.wanadoo.fr
3	palo12.pacific.net.sg
3	crawl-66-249-65-210.googlebot.com
3	adv_office.unis.no
3	c-71-57-10-225.hsd1.il.comcast.net
3	bucket6.ncl.ac.uk
3	a82129.upc-a.chello.nl
3	lj612257.inktomisearch.com
3	chello062179069170.chello.pl
3	aeolus96.baidu027.net
3	ppp-69-238-230-58.dsl.pltn13.pacbell.net
3	dj501000.inktomisearch.com
3	202-156-12-11.cache.maxonline.com.sg
3	dsl28-137-100.fastxdsl.nl
3	c-68-45-34-32.hsd1.nj.comcast.net
3	info.mckesson.com
3	dsl182-110.as6911.net
3	host120-153-dynamic.55-82-r.retail.telecomitalia.it
3	cable-72-53-35-113.cia.com
3	webmail.revolutionprep.com
3	cpe1-4-36.cable.triera.net
3	auv38.internetdsl.tpnet.pl
3	c-69-180-16-96.hsd1.ga.comcast.net
3	202-156-6-83.cache.maxonline.com.sg
3	cpe-204-210-104-248.hawaii.res.rr.com
3	72.72.344a.static.theplanet.com
3	82-169-31-184-mx.xdsl.tiscali.nl
3	housegate10.house.gov
3	cust91-dsl56.idnet.net
3	c-69-139-145-157.hsd1.md.comcast.net
3	rgnb-d9b87886.pool.mediaways.net
3	bbnwebdproxy5.europe.hp.net
3	livebot-65-55-235-143.search.live.com
3	cm-80.111.159.100.chello.no
3	24_72_153_21.hyperband.com
3	m125.net81-65-54.noos.fr
3	gate-az.freescale.com
3	0x50a69a56.arcnxx20.adsl-dhcp.tele.dk
3	user-0c8hs8c.cable.mindspring.com
3	adsl-70-230-184-51.dsl.stlsmo.sbcglobal.net
3	dslb-088-072-245-124.pools.arcor-ip.net
3	proxy.corp.comindico.com.au
3	a212-113-164-104.netcabo.pt
3	livebot-65-55-209-74.search.live.com
3	207-255-227-055-dhcp.jst.pa.atlanticbb.net
3	usamvb1-fo.b.astral.ro
3	crawl-66-249-66-194.googlebot.com
3	adsl-69-237-157-228.dsl.irvnca.pacbell.net
3	bl5-159-15.dsl.telepac.pt
3	proxy1.credit-agricole.fr
3	c-68-36-13-212.hsd1.nj.comcast.net
3	customer-reverse-entry.216.93.189.59
3	adsl-71-145-146-51.dsl.austtx.sbcglobal.net
3	adsl-69-234-154-34.dsl.irvnca.pacbell.net
3	dhcp-54-167.caltech.edu
3	a62-248-134-116.elisa-laajakaista.fi
3	node-40241d22.mdw.onnet.us.uu.net
3	bl6-25-152.dsl.telepac.pt
3	mne69-2-81-56-91-16.fbx.proxad.net
3	fj5016.inktomisearch.com
3	anantes-151-1-34-239.w83-195.abo.wanadoo.fr
3	llf310004.crawl.yahoo.net
3	moscow-cuda-gen2-70-36-31-116.losaca.adelphia.net
3	pool-71-96-136-245.dfw.dsl-w.verizon.net
3	us_proxy_indy.xh1.lilly.com
3	fj5009.inktomisearch.com
3	pixpat.austin.ibm.com
3	updraft.nsstc.nasa.gov
3	247.188.192.61.tokyo.bflets.alpha-net.ne.jp
3	www.d-prog.cz
3	bl6-10-52.dsl.telepac.pt
3	crawl1.cosmixcorp.com
3	81-208-97-2.ip.fastwebnet.it
3	dig.poyry.com
3	f-hme0.intec.co.jp
3	adsl-68-76-217-147.dsl.bltnin.ameritech.net
3	crawl-66-249-65-209.googlebot.com
3	proxy03phl.sap-ag.de
3	cpe001346f27bb9-cm00407b87c460.cpe.net.cable.rogers.com
3	s010600c049b52697.vf.shawcable.net
3	67-40-194-158.tukw.qwest.net
3	mars.lblmedia.ru
3	akilebo.monbo.net
3	modemcable160.4-37-24.mc.videotron.ca
3	ip-216-23-121-91.adsl.one.net
3	ip230.172.adsl.wplus.ru
3	crawl-66-249-66-130.googlebot.com
3	195-23-114-130.net.novis.pt
3	adsl-67-114-152-206.dsl.sntc01.pacbell.net
3	69-173-78-103.albyny.adelphia.net

</div>

</div></body></html>
<script type="text/javascript">
config.options.pasPassword = "";

function checkUnsavedChanges() {};

var savecallback = function(request) {  
    if( request.responseText )
        displayMessage(request.responseText); 
}

TiddlyWiki.prototype._saveTiddler = TiddlyWiki.prototype.saveTiddler;
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags) {
    var x = this._saveTiddler(title,newTitle,newBody,modifier,modified,tags);
  
    content = 'save=true&title=' + encodeURIComponent(newTitle) +
                '&oldtitle=' + encodeURIComponent(title) +
                '&body=' + encodeURIComponent(newBody) +
                '&author=' + encodeURIComponent(modifier) +
                '&tags=' + encodeURIComponent(tags) +
                '&password=' + encodeURIComponent(config.options.pasPassword);
    remote(content, savecallback); 
  
    return x;
};


var deletecallback = function(request) {  
    if( request.responseText )
        displayMessage(request.responseText); 
}

TiddlyWiki.prototype._removeTiddler = TiddlyWiki.prototype.removeTiddler;
TiddlyWiki.prototype.removeTiddler = function(title) {
    
    var x = this._removeTiddler( title );
    content = 'delete=true&title=' + encodeURIComponent(title) + 
                '&password=' + encodeURIComponent(config.options.pasPassword);
    remote(content, deletecallback); 
   
    return x;
};



function remote(content, callback) {
    
    try {
        netscape.security.PrivilegeManager.enablePrivilege('UniversalBrowserRead');
    } catch(e) {
        // TODO: Alert the user if we actually needed that privilege
    }
    
    if (window.XMLHttpRequest) {
        var request = new XMLHttpRequest();
    } else if (window.ActiveXObject) {
        var request = new ActiveXObject("Microsoft.XMLHTTP");
    } else {
        return;
    }
    request.open('POST', "index.cgi", true);
    request.onreadystatechange = function() {
        if (request.readyState == 4) {
            callback(request);
        }
    }
    request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    request.setRequestHeader('Referer', window.location);
    request.setRequestHeader('User-Agent', 'pytw');
    request.send(content);
}

/**************************************************
 * dom-drag.js
 * 09.25.2001
 * www.youngpup.net
 **************************************************
 * 10.28.2001 - fixed minor bug where events
 * sometimes fired off the handle, not the root.
 **************************************************/

var Drag = {

  obj : null,

  init : function(o, oRoot, minX, maxX, minY, maxY)
  {
    o.onmousedown = Drag.start;

    o.root = oRoot && oRoot != null ? oRoot : o ;

    if (isNaN(parseInt(o.root.style.left  ))) o.root.style.left   = "0px";
    if (isNaN(parseInt(o.root.style.top   ))) o.root.style.top    = "0px";

    o.minX  = typeof minX != 'undefined' ? minX : null;
    o.minY  = typeof minY != 'undefined' ? minY : null;
    o.maxX  = typeof maxX != 'undefined' ? maxX : null;
    o.maxY  = typeof maxY != 'undefined' ? maxY : null;

    o.root.onDragStart  = new Function();
    o.root.onDragEnd  = new Function();
    o.root.onDrag   = new Function();
  },

  start : function(e)
  {
    var o = Drag.obj = this;
    e = Drag.fixE(e);
    var y = parseInt(o.root.style.top);
    var x = parseInt(o.root.style.left);
    o.root.onDragStart(x, y, Drag.obj.root);

    o.lastMouseX  = e.clientX;
    o.lastMouseY  = e.clientY;
      
      if (o.minX != null) o.minMouseX = e.clientX - x + o.minX;
      if (o.maxX != null) o.maxMouseX = o.minMouseX + o.maxX - o.minX;

      if (o.minY != null) o.minMouseY = e.clientY - y + o.minY;
      if (o.maxY != null) o.maxMouseY = o.minMouseY + o.maxY - o.minY;

    document.onmousemove  = Drag.drag;
    document.onmouseup    = Drag.end;

    Drag.obj.root.style["z-index"] = "10";
    return false;
  },

  drag : function(e)
  {
    e = Drag.fixE(e);
    var o = Drag.obj;

    var ey  = e.clientY;
    var ex  = e.clientX;
    var y = parseInt(o.root.style.top);
    var x = parseInt(o.root.style.left);
    var nx, ny;

    if (o.minX != null) ex = Math.max(ex, o.minMouseX);
    if (o.maxX != null) ex = Math.min(ex, o.maxMouseX);
    if (o.minY != null) ey = Math.max(ey, o.minMouseY);
    if (o.maxY != null) ey = Math.min(ey, o.maxMouseY);

    nx = x + (ex - o.lastMouseX);
    ny = y + (ey - o.lastMouseY);

    Drag.obj.root.style["left"] = nx + "px";
    Drag.obj.root.style["top"] = ny + "px";
    Drag.obj.lastMouseX = ex;
    Drag.obj.lastMouseY = ey;

    Drag.obj.root.onDrag(nx, ny, Drag.obj.root);
    return false;
  },

  end : function()
  {
    document.onmousemove = null;
    document.onmouseup   = null;
    Drag.obj.root.style["z-index"] = "0";
    Drag.obj.root.onDragEnd(  parseInt(Drag.obj.root.style["left"]), 
                  parseInt(Drag.obj.root.style["top"]), Drag.obj.root);
    Drag.obj = null;
  },

  fixE : function(e)
  {
    if (typeof e == 'undefined') e = window.event;
    if (typeof e.layerX == 'undefined') e.layerX = e.offsetX;
    if (typeof e.layerY == 'undefined') e.layerY = e.offsetY;
    return e;
  }
};
    

config.macros.saveSession.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,saveSession);
}
// Event handler for clicking on toolbar close others button
function onClickToolbarCloseOthers(e)
{
    if (!e) var e = window.event;
    clearMessage();
    if(this.parentNode.id)
          closeAllBut(this.parentNode.id.substr(7));
    // NOTE: added this refresh
  refreshSidebar("SideBarOptions");

}

function closeAllBut(keeptitle)
{
    clearMessage();
    var place = document.getElementById("tiddlerDisplay");
    var tiddler = place.firstChild;
    var nextTiddler;
    while(tiddler)
        {
        nextTiddler = tiddler.nextSibling;
        if(tiddler.id)
            if(tiddler.id.substr(0,7) == "tiddler")
                {
                var title = tiddler.id.substr(7);
                if(title != keeptitle && !document.getElementById("editor" + title))
                    place.removeChild(tiddler);
                }
        tiddler = nextTiddler;
        }

}
function saveSession()
{
  // NOTE: save session
  var tiddlerDisplay = document.getElementById("tiddlerDisplay");
  var newBody = "";
  for(var t=0;t<tiddlerDisplay.childNodes.length;t++)
  {
    if( tiddlerDisplay.childNodes[t].id )
    {
      newBody += "[[" + tiddlerDisplay.childNodes[t].id.substr(7) + "]] ";
    }
  }
//alert(newBody);

  store.saveTiddler("DefaultTiddlers","DefaultTiddlers",newBody,config.options.txtUserName,new Date(),"systemTiddlers excludeLists");
  if(config.options.chkAutoSave)
    saveChanges();

}

config.options.chkFoldedSearch = false;

// Event handler for clicking on toolbar close
function onClickToolbarEdit(e)
{
	clearMessage();
	var title = this.parentNode.id.substr(7);
	if(this.parentNode.id) {
		unfoldTiddler(title);
		displayTiddler(null,title,2,null,null,false,false);
	}
}

// Event handler for clicking on toolbar fold
function onClickToolbarFold(e)
{
    if (!e) var e = window.event;
    clearMessage();
    //alert(this.id);
    if(this.parentNode.id)
    {
	  foldTiddler(this.parentNode.id.substr(7));
    }
    // NOTE: need this for clickl title version
    else if(this.id)
    {
	  foldTiddler(this.id.substr(5));
    }
}    

// Event handler for clicking on toolbar fold
function onClickToolbarUnfold(e)
{
    if (!e) var e = window.event;
    clearMessage();
    if(this.parentNode.id)
	  unfoldTiddler(this.parentNode.id.substr(7));
    else if(this.id)
    {
	  unfoldTiddler(this.id.substr(5));
    }
}

function foldTiddler(title)
{
    var body = document.getElementById("body" + title);
    var footer = document.getElementById("footer" + title);
    var theTitle = document.getElementById("title" + title);

    if((body != null) && (body.style.display != "none")) {
	  body.style.display = "none";
          footer.style.display = "none";
    //theTitle.onclick = onClickToolbarUnfold;
    //createTiddlerToolbar(title,false,true);
    
    }
}

function unfoldTiddler(title)
{
    var body = document.getElementById("body" + title);
    var footer = document.getElementById("footer" + title);
    var theTitle = document.getElementById("title" + title);

    if((body != null) && (body.style.display != "block")) {
	  body.style.display = "block";
          footer.style.display = "block";
    //theTitle.onclick = onClickToolbarFold;
          //createTiddlerToolbar(title,false,false);
    }
}

config.macros.refreshDynamic = {label: "refresh", prompt: "Refresh dynamic tiddlers."};
config.macros.refreshDynamic.handler = function(place)
{ 
  createTiddlyButton(place,this.label,this.prompt,onClickToolbarRefresh);
}
var refreshcallback = function(request) {  
    if( request.responseText )
    {
        displayMessage(request.responseText); 
        
        // Delete the old dynamic tiddlers.
        //displayMessage( "Got refresh. Deleting old dynamics..." );
        for(var t in store.tiddlers)
        {
            if( store.tiddlers[t].modifier == "_dynamic" )
            {
                delete store.tiddlers[t];
                store.notify(t,true);
                store.dirty = true;
            }
        }
                
        var tiddlers = request.responseXML.documentElement;
        tiddlers = tiddlers.getElementsByTagName("div");
        for (var i = 0; i < tiddlers.length; i++) 
        {
                var tiddler = tiddlers[i];
                var title = tiddler.getAttribute("tiddler");
                var modified = tiddler.getAttribute("modified");
                var modifier = tiddler.getAttribute("modifier");
                var tags = tiddler.getAttribute("tags");
                var body;
                if( tiddler.firstChild )
                {
                    body = tiddler.firstChild.data;
                    //displayMessage( tiddler.firstChild.data );
                }
                else
                {
                    body = "";
                    //displayMessage( "none" );
                }
        // Can't do this because of the implied SS save. OK for one tiddler, not
        // ok for many.
        //store.saveTiddler( title, title, body, modifier, Date.convertFromYYYYMMDDHHMM(modified), tags);
        //displayMessage( "Saving new dynamics..." );
              var tiddler = store.tiddlers[title];
              if(tiddler)
                delete store.tiddlers[title];
              else
                tiddler = new Tiddler();
              tiddler.set(title,body,modifier,Date.convertFromYYYYMMDDHHMM(modified),tags);
              store.tiddlers[title] = tiddler;
              store.notify(title,true);

                if ( document.getElementById("viewer" + title)) 
                {
                    displayTiddler(null, title, 1, null, null, null, false);
                }
        }
        clearMessage();
    }
}

// Event handler for clicking on toolbar fold
function onClickToolbarRefresh(e)
{
    if (!e) var e = window.event;
    clearMessage();
    //alert(this.id);
    if(this.parentNode.id)
    {
        displayMessage( "Refreshing dynamic tiddlers..." );
        content = 'refresh=true&title=' + encodeURIComponent(this.parentNode.id.substr(7));
        remote( content, refreshcallback); 
    }

}    


// NOTE: we don't save the password in the cookie.

config.macros.option.onChangeOption = function(e)
{
	var opt = this.getAttribute("option");
	var elementType,valueField;
	if(opt)
		{
		switch(opt.substr(0,3))
			{
			case "txt":
			case "pas":
				elementType = "input";
				valueField = "value";
				break;
			case "chk":
				elementType = "input";
				valueField = "checked";
				break;
			}
		config.options[opt] = this[valueField];
		saveOptionCookie(opt);
		var nodes = document.getElementsByTagName(elementType);
		for(var t=0; t<nodes.length; t++)
			{
			var optNode = nodes[t].getAttribute("option");
			if(opt == optNode)
				nodes[t][valueField] = this[valueField];
			}
		}
	return(true);
}

config.macros.option.handler = function(place,macroName,params)
{
	var opt = params[0];
	if(config.options[opt] == undefined)
		return;
	var c;
	switch(opt.substr(0,3))
		{
		case "txt":
			c = document.createElement("input");
			c.onkeyup = this.onChangeOption;
			c.setAttribute("option",opt);
			c.size = 15;
			c.value = config.options[opt];
			place.appendChild(c);
			break;
		case "pas":
			c = document.createElement("input");
			c.setAttribute("type","password");
			c.onkeyup = this.onChangeOption;
			c.setAttribute("option",opt);
			c.size = 15;
			c.value = config.options[opt];
			place.appendChild(c);
			break;
		case "chk":
			c = document.createElement("input");
			c.setAttribute("type","checkbox");
			c.onclick = this.onChangeOption;
			c.setAttribute("option",opt);
			c.checked = config.options[opt];
			place.appendChild(c);
			break;
		}
}

// NOTE: this just stores your password in plain text on your HD. Not
// particularly recommended for security nuts.

// This change is extremely trivial.

function loadOptionsCookie()
{
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++)
		{
		var p = cookies[c].indexOf("=");
		if(p != -1)
			{
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			switch(name.substr(0,3))
				{
				case "txt":
				case "pas":
					config.options[name] = unescape(value);
					break;
				case "chk":
					config.options[name] = value == "true";
					break;
				}
			}
		}
}

function saveOptionCookie(name)
{
	var c = name + "=";
	switch(name.substr(0,3))
		{
		case "txt":
		case "pas":
			c += escape(config.options[name].toString());
			break;
		case "chk":
			c += config.options[name] ? "true" : "false";
			break;
		}
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

</script>
<!--
     FILE ARCHIVED ON 06:35:11 Dec 03, 2007 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 02:04:57 Jul 12, 2025.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 0.626
  exclusion.robots: 0.031
  exclusion.robots.policy: 0.018
  esindex: 0.011
  cdx.remote: 75.075
  LoadShardBlock: 2051.698 (3)
  PetaboxLoader3.resolve: 2310.528 (3)
  PetaboxLoader3.datanode: 91.479 (4)
  load_resource: 465.875
-->